%% -*- mode: erlang; -*-

{require_otp_vsn, "R16|17.*"}.

{erl_dep_retries, 10}.

{deps, [
        {lager,".*",
         {git,"https://github.com/basho/lager", {tag, "2.1.1"}}},
        {opscoderl_wm, ".*",
         {git, "https://github.com/chef/opscoderl_wm.git", {branch,"master"}}},
        {erlsom, ".*",
         {git, "https://github.com/chef/erlsom",
          {branch, "integer_long_string_probs"}}},
        {iso8601, ".*",
         {git, "https://github.com/chef/erlang_iso8601",
          {branch, "master"}}},
        {erlware_commons, ".*",
         {git, "https://github.com/erlware/erlware_commons",
          {tag, "v0.11.1"}}},
        {mixer, ".*",
          {git, "https://github.com/chef/mixer", {tag, "0.1.1"}}},
        {mini_s3, ".*",
         {git, "https://github.com/chef/mini_s3",
          {branch, "master"}}},
        {meck, ".*",
         {git, "https://github.com/eproxus/meck.git", {tag, "0.8.3"}}},
        {sqerl, ".*",
         {git, "https://github.com/chef/sqerl", {branch, "master"}}},
        {envy, ".*",
         {git, "https://github.com/manderson26/envy", {branch, "master"}}},
        {sync, ".*",
         {git, "https://github.com/rustyio/sync", {branch, "master"}}},
        {eper, ".*",
         {git, "https://github.com/massemanet/eper", {branch, "master"}}}
       ]}.


{erl_opts, [
    debug_info,
    {parse_transform, lager_transform},
    warnings_as_errors,
    {i, "include"}
]}.

{eunit_compile_opts, [{d,'EUNIT_TEST'}]}.

{plugins, [{pc, "0.3.0"}]}.

{xref_checks,
 [exports_not_used,
  undefined_function_calls]}.

{cover_enabled, true}.

{pre_hooks, [
             {clean, "make version_clean"},
             {compile, "make VERSION"}
]}.

{profiles, [
    {dev, [
        {relx, [{dev_mode, true}]}
       ]},
    {test, [
        {deps, [
            {cth_readable,
                {git, "https://github.com/ferd/cth_readable.git", {branch, "master"}}}
        ]}
    ]}
]}.

{ct_opts, [
    {dir, "test"},
    {ct_hooks, [cth_readable_failonly, cth_readable_shell]}
]}.

{relx, [
  {release,{bookshelf,{cmd,"cat VERSION"}},
    [bookshelf,
     {sync, load},
     {eunit, load},
     {mixer, load},
     syntax_tools,
     compiler,
     eper,
     {pooler, load},
     {sqerl, load}
  ]},
  {extended_start_script,true},
  {overlay,[{template,"config/vm.args","vm.args"},
            {template,"config/app.config","sys.config"},
            {copy,"schema","."}
           ]}
]}.
