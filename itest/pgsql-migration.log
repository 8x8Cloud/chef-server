# Logfile created on 2012-04-26 14:08:42 -0700 by logger.rb/25413
I, [2012-04-26T14:08:42.804353 #10205]  INFO -- : (0.000314s) SET standard_conforming_strings = ON
I, [2012-04-26T14:08:42.804560 #10205]  INFO -- : (0.000094s) SET client_min_messages = 'WARNING'
I, [2012-04-26T14:08:42.804693 #10205]  INFO -- : (0.000086s) SET DateStyle = 'ISO'
E, [2012-04-26T14:08:42.812749 #10205] ERROR -- : PG::Error: ERROR:  relation "schema_info" does not exist
LINE 1: SELECT NULL FROM "schema_info" LIMIT 1
                         ^: SELECT NULL FROM "schema_info" LIMIT 1
I, [2012-04-26T14:08:42.817833 #10205]  INFO -- : (0.004613s) CREATE TABLE "schema_info" ("version" integer DEFAULT 0 NOT NULL)
I, [2012-04-26T14:08:42.818553 #10205]  INFO -- : (0.000534s) SELECT 1 AS "one" FROM "schema_info" LIMIT 1
I, [2012-04-26T14:08:42.820479 #10205]  INFO -- : (0.001727s) SELECT pg_attribute.attname FROM pg_class, pg_attribute, pg_index, pg_namespace WHERE pg_class.oid = pg_attribute.attrelid AND pg_class.relnamespace = pg_namespace.oid AND pg_class.oid = pg_index.indrelid AND pg_index.indkey[0] = pg_attribute.attnum AND pg_index.indisprimary = 't' AND pg_class.relname = 'schema_info'
I, [2012-04-26T14:08:42.821417 #10205]  INFO -- : (0.000752s) INSERT INTO "schema_info" ("version") VALUES (0) RETURNING NULL
I, [2012-04-26T14:08:42.822044 #10205]  INFO -- : (0.000398s) SELECT COUNT(*) AS "count" FROM "schema_info" LIMIT 1
I, [2012-04-26T14:08:42.822484 #10205]  INFO -- : (0.000262s) SELECT "version" FROM "schema_info" LIMIT 1
I, [2012-04-26T14:08:42.838415 #10205]  INFO -- : Begin applying migration version 1, direction: up
I, [2012-04-26T14:08:42.838862 #10205]  INFO -- : (0.000331s) BEGIN
I, [2012-04-26T14:08:42.844539 #10205]  INFO -- : (0.005299s) CREATE TABLE "users" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "username" text NOT NULL UNIQUE, "email" text NOT NULL UNIQUE, "pubkey_version" integer NOT NULL, "public_key" text, "serialized_object" text, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-04-26T14:08:42.844926 #10205]  INFO -- : (0.000208s) UPDATE "schema_info" SET "version" = 1
I, [2012-04-26T14:08:42.845997 #10205]  INFO -- : (0.001005s) COMMIT
I, [2012-04-26T14:08:42.846063 #10205]  INFO -- : Finished applying migration version 1, direction: up, took 0.007651 seconds
I, [2012-04-26T14:08:42.846096 #10205]  INFO -- : Begin applying migration version 2, direction: up
I, [2012-04-26T14:08:42.846290 #10205]  INFO -- : (0.000135s) BEGIN
I, [2012-04-26T14:08:42.851037 #10205]  INFO -- : (0.004349s) CREATE TABLE "nodes" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "environment" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" text, UNIQUE ("org_id", "name"))
I, [2012-04-26T14:08:42.851819 #10205]  INFO -- : (0.000615s) CREATE INDEX "nodes_org_id_index" ON "nodes" ("org_id")
I, [2012-04-26T14:08:42.852504 #10205]  INFO -- : (0.000580s) CREATE INDEX "nodes_org_id_environment_index" ON "nodes" ("org_id", "environment")
I, [2012-04-26T14:08:42.852786 #10205]  INFO -- : (0.000152s) UPDATE "schema_info" SET "version" = 2
I, [2012-04-26T14:08:42.853466 #10205]  INFO -- : (0.000621s) COMMIT
I, [2012-04-26T14:08:42.853531 #10205]  INFO -- : Finished applying migration version 2, direction: up, took 0.007431 seconds
I, [2012-04-26T14:08:42.853565 #10205]  INFO -- : Begin applying migration version 3, direction: up
I, [2012-04-26T14:08:42.853727 #10205]  INFO -- : (0.000110s) BEGIN
I, [2012-04-26T14:08:42.857929 #10205]  INFO -- : (0.003777s) CREATE TABLE "clients" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, "name" text NOT NULL, "public_key" text, "validator" boolean NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "pubkey_version" smallint NOT NULL, CONSTRAINT "org_id_name_unique" UNIQUE ("org_id", "name"))
I, [2012-04-26T14:08:42.859560 #10205]  INFO -- : (0.001016s) CREATE INDEX "clients_org_id_index" ON "clients" ("org_id")
I, [2012-04-26T14:08:42.860014 #10205]  INFO -- : (0.000236s) UPDATE "schema_info" SET "version" = 3
I, [2012-04-26T14:08:42.860862 #10205]  INFO -- : (0.000756s) COMMIT
I, [2012-04-26T14:08:42.860972 #10205]  INFO -- : Finished applying migration version 3, direction: up, took 0.007398 seconds
I, [2012-04-26T14:08:42.861025 #10205]  INFO -- : Begin applying migration version 4, direction: up
I, [2012-04-26T14:08:42.861369 #10205]  INFO -- : (0.000261s) BEGIN
I, [2012-04-26T14:08:42.866285 #10205]  INFO -- : (0.004321s) CREATE TABLE "roles" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T14:08:42.867094 #10205]  INFO -- : (0.000609s) CREATE INDEX "roles_org_id_index" ON "roles" ("org_id")
I, [2012-04-26T14:08:42.867318 #10205]  INFO -- : (0.000157s) ALTER TABLE roles ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T14:08:42.867576 #10205]  INFO -- : (0.000135s) UPDATE "schema_info" SET "version" = 4
I, [2012-04-26T14:08:42.868119 #10205]  INFO -- : (0.000491s) COMMIT
I, [2012-04-26T14:08:42.868174 #10205]  INFO -- : Finished applying migration version 4, direction: up, took 0.007149 seconds
I, [2012-04-26T14:08:42.868208 #10205]  INFO -- : Begin applying migration version 5, direction: up
I, [2012-04-26T14:08:42.868348 #10205]  INFO -- : (0.000089s) BEGIN
I, [2012-04-26T14:08:42.868668 #10205]  INFO -- : (0.000172s) ALTER TABLE "nodes" ADD COLUMN "last_audit_id" bytea
I, [2012-04-26T14:08:42.873707 #10205]  INFO -- : (0.004720s) CREATE TABLE "node_audit" ("audit_id" bytea NOT NULL, "node_id" char(32), "status" varchar(16), "start_time" timestamp NOT NULL, "end_time" timestamp NULL, "event_data" text NULL, PRIMARY KEY ("audit_id"), CONSTRAINT "node_id_fk" FOREIGN KEY ("node_id") REFERENCES "nodes")
I, [2012-04-26T14:08:42.874864 #10205]  INFO -- : (0.000939s) CREATE INDEX "node_audit_node_id_index" ON "node_audit" ("node_id")
I, [2012-04-26T14:08:42.878792 #10205]  INFO -- : (0.003238s) CREATE TABLE "node_audit_detail" ("audit_id" bytea NOT NULL, "seq" int NOT NULL, "duration" int NOT NULL, "res_id" varchar(255) NOT NULL, "res_type" varchar(16) NOT NULL, "res_name" varchar(255) NOT NULL, "res_result" varchar(16) NULL, "res_initial_state" text NULL, "res_final_state" text NULL, "delta" text NULL, PRIMARY KEY ("audit_id", "seq"), CONSTRAINT "audit_id_fk" FOREIGN KEY ("audit_id") REFERENCES "node_audit")
I, [2012-04-26T14:08:42.879126 #10205]  INFO -- : (0.000169s) UPDATE "schema_info" SET "version" = 5
I, [2012-04-26T14:08:42.880071 #10205]  INFO -- : (0.000880s) COMMIT
I, [2012-04-26T14:08:42.880134 #10205]  INFO -- : Finished applying migration version 5, direction: up, took 0.011921 seconds
I, [2012-04-26T14:08:42.880170 #10205]  INFO -- : Begin applying migration version 6, direction: up
I, [2012-04-26T14:08:42.880416 #10205]  INFO -- : (0.000193s) BEGIN
I, [2012-04-26T14:08:42.885469 #10205]  INFO -- : (0.004710s) CREATE TABLE "data_bags" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, UNIQUE ("org_id", "name"))
I, [2012-04-26T14:08:42.886599 #10205]  INFO -- : (0.000924s) CREATE INDEX "data_bags_org_id_index" ON "data_bags" ("org_id")
I, [2012-04-26T14:08:42.886899 #10205]  INFO -- : (0.000158s) UPDATE "schema_info" SET "version" = 6
I, [2012-04-26T14:08:42.887531 #10205]  INFO -- : (0.000567s) COMMIT
I, [2012-04-26T14:08:42.887626 #10205]  INFO -- : Finished applying migration version 6, direction: up, took 0.007444 seconds
I, [2012-04-26T14:08:42.887684 #10205]  INFO -- : Begin applying migration version 7, direction: up
I, [2012-04-26T14:08:42.887879 #10205]  INFO -- : (0.000129s) BEGIN
I, [2012-04-26T14:08:42.891671 #10205]  INFO -- : (0.003248s) CREATE TABLE "data_bag_items" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "data_bag_name" text NOT NULL, "item_name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "data_bag_name", "item_name"))
I, [2012-04-26T14:08:42.892468 #10205]  INFO -- : (0.000615s) CREATE INDEX "data_bag_items_org_id_index" ON "data_bag_items" ("org_id")
I, [2012-04-26T14:08:42.892706 #10205]  INFO -- : (0.000153s) ALTER TABLE data_bag_items ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T14:08:42.892979 #10205]  INFO -- : (0.000143s) UPDATE "schema_info" SET "version" = 7
I, [2012-04-26T14:08:42.893582 #10205]  INFO -- : (0.000551s) COMMIT
I, [2012-04-26T14:08:42.893633 #10205]  INFO -- : Finished applying migration version 7, direction: up, took 0.005951 seconds
I, [2012-04-26T14:08:42.893666 #10205]  INFO -- : Begin applying migration version 8, direction: up
I, [2012-04-26T14:08:42.893866 #10205]  INFO -- : (0.000141s) BEGIN
I, [2012-04-26T14:08:42.899174 #10205]  INFO -- : (0.004768s) CREATE TABLE "environments" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T14:08:42.900078 #10205]  INFO -- : (0.000726s) CREATE INDEX "environments_org_id_index" ON "environments" ("org_id")
I, [2012-04-26T14:08:42.900272 #10205]  INFO -- : (0.000132s) ALTER TABLE environments ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T14:08:42.900526 #10205]  INFO -- : (0.000135s) UPDATE "schema_info" SET "version" = 8
I, [2012-04-26T14:08:42.901066 #10205]  INFO -- : (0.000486s) COMMIT
I, [2012-04-26T14:08:42.901129 #10205]  INFO -- : Finished applying migration version 8, direction: up, took 0.007457 seconds
I, [2012-04-26T14:08:42.901164 #10205]  INFO -- : Begin applying migration version 9, direction: up
I, [2012-04-26T14:08:42.901317 #10205]  INFO -- : (0.000099s) BEGIN
I, [2012-04-26T14:08:42.902974 #10205]  INFO -- : (0.001473s) ALTER TABLE "data_bag_items" ADD FOREIGN KEY ("org_id", "data_bag_name") REFERENCES "data_bags"("org_id", "name") ON DELETE CASCADE ON UPDATE CASCADE
I, [2012-04-26T14:08:42.903251 #10205]  INFO -- : (0.000151s) UPDATE "schema_info" SET "version" = 9
I, [2012-04-26T14:08:42.903770 #10205]  INFO -- : (0.000463s) COMMIT
I, [2012-04-26T14:08:42.903829 #10205]  INFO -- : Finished applying migration version 9, direction: up, took 0.002661 seconds
I, [2012-04-26T14:08:42.903861 #10205]  INFO -- : Begin applying migration version 10, direction: up
I, [2012-04-26T14:08:42.903993 #10205]  INFO -- : (0.000085s) BEGIN
I, [2012-04-26T14:08:42.904462 #10205]  INFO -- : (0.000352s) DROP INDEX "clients_org_id_index"
I, [2012-04-26T14:08:42.904776 #10205]  INFO -- : (0.000195s) DROP INDEX "environments_org_id_index"
I, [2012-04-26T14:08:42.905034 #10205]  INFO -- : (0.000148s) DROP INDEX "nodes_org_id_index"
I, [2012-04-26T14:08:42.905784 #10205]  INFO -- : (0.000311s) DROP INDEX "roles_org_id_index"
I, [2012-04-26T14:08:42.906280 #10205]  INFO -- : (0.000332s) DROP INDEX "data_bags_org_id_index"
I, [2012-04-26T14:08:42.906665 #10205]  INFO -- : (0.000257s) DROP INDEX "data_bag_items_org_id_index"
I, [2012-04-26T14:08:42.907042 #10205]  INFO -- : (0.000206s) UPDATE "schema_info" SET "version" = 10
I, [2012-04-26T14:08:42.908181 #10205]  INFO -- : (0.001059s) COMMIT
I, [2012-04-26T14:08:42.908266 #10205]  INFO -- : Finished applying migration version 10, direction: up, took 0.004399 seconds
I, [2012-04-26T14:08:42.908302 #10205]  INFO -- : Begin applying migration version 11, direction: up
I, [2012-04-26T14:08:42.908504 #10205]  INFO -- : (0.000145s) BEGIN
I, [2012-04-26T14:08:42.909009 #10205]  INFO -- : (0.000236s) ALTER TABLE "users" ADD COLUMN "external_authentication_uid" text NULL
I, [2012-04-26T14:08:42.909281 #10205]  INFO -- : (0.000196s) ALTER TABLE "users" ADD COLUMN "recovery_authentication_enabled" boolean NULL
I, [2012-04-26T14:08:42.909554 #10205]  INFO -- : (0.000201s) ALTER TABLE "users" ALTER COLUMN "email" DROP NOT NULL
I, [2012-04-26T14:08:42.909906 #10205]  INFO -- : (0.000187s) UPDATE "schema_info" SET "version" = 11
I, [2012-04-26T14:08:42.910432 #10205]  INFO -- : (0.000453s) COMMIT
I, [2012-04-26T14:08:42.910485 #10205]  INFO -- : Finished applying migration version 11, direction: up, took 0.002179 seconds
I, [2012-04-26T14:13:11.977286 #11708]  INFO -- : (0.000303s) SET standard_conforming_strings = ON
I, [2012-04-26T14:13:11.977519 #11708]  INFO -- : (0.000099s) SET client_min_messages = 'WARNING'
I, [2012-04-26T14:13:11.977668 #11708]  INFO -- : (0.000100s) SET DateStyle = 'ISO'
E, [2012-04-26T14:13:11.985077 #11708] ERROR -- : PG::Error: ERROR:  relation "schema_info" does not exist
LINE 1: SELECT NULL FROM "schema_info" LIMIT 1
                         ^: SELECT NULL FROM "schema_info" LIMIT 1
I, [2012-04-26T14:13:11.989779 #11708]  INFO -- : (0.004401s) CREATE TABLE "schema_info" ("version" integer DEFAULT 0 NOT NULL)
I, [2012-04-26T14:13:11.990687 #11708]  INFO -- : (0.000689s) SELECT 1 AS "one" FROM "schema_info" LIMIT 1
I, [2012-04-26T14:13:11.992694 #11708]  INFO -- : (0.001810s) SELECT pg_attribute.attname FROM pg_class, pg_attribute, pg_index, pg_namespace WHERE pg_class.oid = pg_attribute.attrelid AND pg_class.relnamespace = pg_namespace.oid AND pg_class.oid = pg_index.indrelid AND pg_index.indkey[0] = pg_attribute.attnum AND pg_index.indisprimary = 't' AND pg_class.relname = 'schema_info'
I, [2012-04-26T14:13:11.993624 #11708]  INFO -- : (0.000650s) INSERT INTO "schema_info" ("version") VALUES (0) RETURNING NULL
I, [2012-04-26T14:13:11.994233 #11708]  INFO -- : (0.000362s) SELECT COUNT(*) AS "count" FROM "schema_info" LIMIT 1
I, [2012-04-26T14:13:11.994634 #11708]  INFO -- : (0.000215s) SELECT "version" FROM "schema_info" LIMIT 1
I, [2012-04-26T14:13:12.010327 #11708]  INFO -- : Begin applying migration version 1, direction: up
I, [2012-04-26T14:13:12.010593 #11708]  INFO -- : (0.000147s) BEGIN
I, [2012-04-26T14:13:12.016082 #11708]  INFO -- : (0.005088s) CREATE TABLE "users" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "username" text NOT NULL UNIQUE, "email" text NOT NULL UNIQUE, "pubkey_version" integer NOT NULL, "public_key" text, "serialized_object" text, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-04-26T14:13:12.016492 #11708]  INFO -- : (0.000234s) UPDATE "schema_info" SET "version" = 1
I, [2012-04-26T14:13:12.017406 #11708]  INFO -- : (0.000852s) COMMIT
I, [2012-04-26T14:13:12.017477 #11708]  INFO -- : Finished applying migration version 1, direction: up, took 0.007154 seconds
I, [2012-04-26T14:13:12.017515 #11708]  INFO -- : Begin applying migration version 2, direction: up
I, [2012-04-26T14:13:12.017714 #11708]  INFO -- : (0.000137s) BEGIN
I, [2012-04-26T14:13:12.022062 #11708]  INFO -- : (0.003927s) CREATE TABLE "nodes" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "environment" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" text, UNIQUE ("org_id", "name"))
I, [2012-04-26T14:13:12.023188 #11708]  INFO -- : (0.000879s) CREATE INDEX "nodes_org_id_index" ON "nodes" ("org_id")
I, [2012-04-26T14:13:12.024052 #11708]  INFO -- : (0.000707s) CREATE INDEX "nodes_org_id_environment_index" ON "nodes" ("org_id", "environment")
I, [2012-04-26T14:13:12.024354 #11708]  INFO -- : (0.000156s) UPDATE "schema_info" SET "version" = 2
I, [2012-04-26T14:13:12.025505 #11708]  INFO -- : (0.001094s) COMMIT
I, [2012-04-26T14:13:12.025564 #11708]  INFO -- : Finished applying migration version 2, direction: up, took 0.008045 seconds
I, [2012-04-26T14:13:12.025599 #11708]  INFO -- : Begin applying migration version 3, direction: up
I, [2012-04-26T14:13:12.025753 #11708]  INFO -- : (0.000099s) BEGIN
I, [2012-04-26T14:13:12.029519 #11708]  INFO -- : (0.003344s) CREATE TABLE "clients" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, "name" text NOT NULL, "public_key" text, "validator" boolean NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "pubkey_version" smallint NOT NULL, CONSTRAINT "org_id_name_unique" UNIQUE ("org_id", "name"))
I, [2012-04-26T14:13:12.030568 #11708]  INFO -- : (0.000923s) CREATE INDEX "clients_org_id_index" ON "clients" ("org_id")
I, [2012-04-26T14:13:12.030921 #11708]  INFO -- : (0.000229s) UPDATE "schema_info" SET "version" = 3
I, [2012-04-26T14:13:12.031563 #11708]  INFO -- : (0.000579s) COMMIT
I, [2012-04-26T14:13:12.031623 #11708]  INFO -- : Finished applying migration version 3, direction: up, took 0.006020 seconds
I, [2012-04-26T14:13:12.031658 #11708]  INFO -- : Begin applying migration version 4, direction: up
I, [2012-04-26T14:13:12.031872 #11708]  INFO -- : (0.000162s) BEGIN
I, [2012-04-26T14:13:12.036485 #11708]  INFO -- : (0.004247s) CREATE TABLE "roles" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T14:13:12.037530 #11708]  INFO -- : (0.000860s) CREATE INDEX "roles_org_id_index" ON "roles" ("org_id")
I, [2012-04-26T14:13:12.037835 #11708]  INFO -- : (0.000224s) ALTER TABLE roles ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T14:13:12.038255 #11708]  INFO -- : (0.000224s) UPDATE "schema_info" SET "version" = 4
I, [2012-04-26T14:13:12.038892 #11708]  INFO -- : (0.000550s) COMMIT
I, [2012-04-26T14:13:12.038986 #11708]  INFO -- : Finished applying migration version 4, direction: up, took 0.007316 seconds
I, [2012-04-26T14:13:12.039045 #11708]  INFO -- : Begin applying migration version 5, direction: up
I, [2012-04-26T14:13:12.039248 #11708]  INFO -- : (0.000118s) BEGIN
I, [2012-04-26T14:13:12.039657 #11708]  INFO -- : (0.000227s) ALTER TABLE "nodes" ADD COLUMN "last_audit_id" bytea
I, [2012-04-26T14:13:12.044471 #11708]  INFO -- : (0.004444s) CREATE TABLE "node_audit" ("audit_id" bytea NOT NULL, "node_id" char(32), "status" varchar(16), "start_time" timestamp NOT NULL, "end_time" timestamp NULL, "event_data" text NULL, PRIMARY KEY ("audit_id"), CONSTRAINT "node_id_fk" FOREIGN KEY ("node_id") REFERENCES "nodes")
I, [2012-04-26T14:13:12.045499 #11708]  INFO -- : (0.000803s) CREATE INDEX "node_audit_node_id_index" ON "node_audit" ("node_id")
I, [2012-04-26T14:13:12.048892 #11708]  INFO -- : (0.002936s) CREATE TABLE "node_audit_detail" ("audit_id" bytea NOT NULL, "seq" int NOT NULL, "duration" int NOT NULL, "res_id" varchar(255) NOT NULL, "res_type" varchar(16) NOT NULL, "res_name" varchar(255) NOT NULL, "res_result" varchar(16) NULL, "res_initial_state" text NULL, "res_final_state" text NULL, "delta" text NULL, PRIMARY KEY ("audit_id", "seq"), CONSTRAINT "audit_id_fk" FOREIGN KEY ("audit_id") REFERENCES "node_audit")
I, [2012-04-26T14:13:12.049239 #11708]  INFO -- : (0.000160s) UPDATE "schema_info" SET "version" = 5
I, [2012-04-26T14:13:12.050480 #11708]  INFO -- : (0.001179s) COMMIT
I, [2012-04-26T14:13:12.050544 #11708]  INFO -- : Finished applying migration version 5, direction: up, took 0.011499 seconds
I, [2012-04-26T14:13:12.050580 #11708]  INFO -- : Begin applying migration version 6, direction: up
I, [2012-04-26T14:13:12.050755 #11708]  INFO -- : (0.000120s) BEGIN
I, [2012-04-26T14:13:12.055414 #11708]  INFO -- : (0.004317s) CREATE TABLE "data_bags" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, UNIQUE ("org_id", "name"))
I, [2012-04-26T14:13:12.056498 #11708]  INFO -- : (0.000892s) CREATE INDEX "data_bags_org_id_index" ON "data_bags" ("org_id")
I, [2012-04-26T14:13:12.056874 #11708]  INFO -- : (0.000209s) UPDATE "schema_info" SET "version" = 6
I, [2012-04-26T14:13:12.057637 #11708]  INFO -- : (0.000698s) COMMIT
I, [2012-04-26T14:13:12.057698 #11708]  INFO -- : Finished applying migration version 6, direction: up, took 0.007114 seconds
I, [2012-04-26T14:13:12.057734 #11708]  INFO -- : Begin applying migration version 7, direction: up
I, [2012-04-26T14:13:12.057896 #11708]  INFO -- : (0.000108s) BEGIN
I, [2012-04-26T14:13:12.061311 #11708]  INFO -- : (0.003043s) CREATE TABLE "data_bag_items" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "data_bag_name" text NOT NULL, "item_name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "data_bag_name", "item_name"))
I, [2012-04-26T14:13:12.062134 #11708]  INFO -- : (0.000673s) CREATE INDEX "data_bag_items_org_id_index" ON "data_bag_items" ("org_id")
I, [2012-04-26T14:13:12.062327 #11708]  INFO -- : (0.000131s) ALTER TABLE data_bag_items ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T14:13:12.062575 #11708]  INFO -- : (0.000131s) UPDATE "schema_info" SET "version" = 7
I, [2012-04-26T14:13:12.063303 #11708]  INFO -- : (0.000673s) COMMIT
I, [2012-04-26T14:13:12.063368 #11708]  INFO -- : Finished applying migration version 7, direction: up, took 0.005630 seconds
I, [2012-04-26T14:13:12.063403 #11708]  INFO -- : Begin applying migration version 8, direction: up
I, [2012-04-26T14:13:12.063579 #11708]  INFO -- : (0.000120s) BEGIN
I, [2012-04-26T14:13:12.067999 #11708]  INFO -- : (0.004061s) CREATE TABLE "environments" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T14:13:12.068919 #11708]  INFO -- : (0.000739s) CREATE INDEX "environments_org_id_index" ON "environments" ("org_id")
I, [2012-04-26T14:13:12.069204 #11708]  INFO -- : (0.000187s) ALTER TABLE environments ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T14:13:12.069544 #11708]  INFO -- : (0.000165s) UPDATE "schema_info" SET "version" = 8
I, [2012-04-26T14:13:12.070470 #11708]  INFO -- : (0.000864s) COMMIT
I, [2012-04-26T14:13:12.070529 #11708]  INFO -- : Finished applying migration version 8, direction: up, took 0.007121 seconds
I, [2012-04-26T14:13:12.070569 #11708]  INFO -- : Begin applying migration version 9, direction: up
I, [2012-04-26T14:13:12.070745 #11708]  INFO -- : (0.000110s) BEGIN
I, [2012-04-26T14:13:12.072338 #11708]  INFO -- : (0.001398s) ALTER TABLE "data_bag_items" ADD FOREIGN KEY ("org_id", "data_bag_name") REFERENCES "data_bags"("org_id", "name") ON DELETE CASCADE ON UPDATE CASCADE
I, [2012-04-26T14:13:12.072725 #11708]  INFO -- : (0.000248s) UPDATE "schema_info" SET "version" = 9
I, [2012-04-26T14:13:12.073331 #11708]  INFO -- : (0.000549s) COMMIT
I, [2012-04-26T14:13:12.073379 #11708]  INFO -- : Finished applying migration version 9, direction: up, took 0.002810 seconds
I, [2012-04-26T14:13:12.073412 #11708]  INFO -- : Begin applying migration version 10, direction: up
I, [2012-04-26T14:13:12.073533 #11708]  INFO -- : (0.000073s) BEGIN
I, [2012-04-26T14:13:12.073947 #11708]  INFO -- : (0.000307s) DROP INDEX "clients_org_id_index"
I, [2012-04-26T14:13:12.074191 #11708]  INFO -- : (0.000151s) DROP INDEX "environments_org_id_index"
I, [2012-04-26T14:13:12.074426 #11708]  INFO -- : (0.000145s) DROP INDEX "nodes_org_id_index"
I, [2012-04-26T14:13:12.074651 #11708]  INFO -- : (0.000139s) DROP INDEX "roles_org_id_index"
I, [2012-04-26T14:13:12.074874 #11708]  INFO -- : (0.000136s) DROP INDEX "data_bags_org_id_index"
I, [2012-04-26T14:13:12.075115 #11708]  INFO -- : (0.000148s) DROP INDEX "data_bag_items_org_id_index"
I, [2012-04-26T14:13:12.075405 #11708]  INFO -- : (0.000171s) UPDATE "schema_info" SET "version" = 10
I, [2012-04-26T14:13:12.076697 #11708]  INFO -- : (0.001208s) COMMIT
I, [2012-04-26T14:13:12.076787 #11708]  INFO -- : Finished applying migration version 10, direction: up, took 0.003370 seconds
I, [2012-04-26T14:13:12.076822 #11708]  INFO -- : Begin applying migration version 11, direction: up
I, [2012-04-26T14:13:12.076972 #11708]  INFO -- : (0.000099s) BEGIN
I, [2012-04-26T14:13:12.077430 #11708]  INFO -- : (0.000233s) ALTER TABLE "users" ADD COLUMN "external_authentication_uid" text NULL
I, [2012-04-26T14:13:12.077740 #11708]  INFO -- : (0.000254s) ALTER TABLE "users" ADD COLUMN "recovery_authentication_enabled" boolean NULL
I, [2012-04-26T14:13:12.077976 #11708]  INFO -- : (0.000173s) ALTER TABLE "users" ALTER COLUMN "email" DROP NOT NULL
I, [2012-04-26T14:13:12.078269 #11708]  INFO -- : (0.000166s) UPDATE "schema_info" SET "version" = 11
I, [2012-04-26T14:13:12.078793 #11708]  INFO -- : (0.000452s) COMMIT
I, [2012-04-26T14:13:12.078847 #11708]  INFO -- : Finished applying migration version 11, direction: up, took 0.002021 seconds
I, [2012-04-26T14:15:51.019476 #11883]  INFO -- : (0.000405s) SET standard_conforming_strings = ON
I, [2012-04-26T14:15:51.019748 #11883]  INFO -- : (0.000137s) SET client_min_messages = 'WARNING'
I, [2012-04-26T14:15:51.019930 #11883]  INFO -- : (0.000134s) SET DateStyle = 'ISO'
E, [2012-04-26T14:15:51.027727 #11883] ERROR -- : PG::Error: ERROR:  relation "schema_info" does not exist
LINE 1: SELECT NULL FROM "schema_info" LIMIT 1
                         ^: SELECT NULL FROM "schema_info" LIMIT 1
I, [2012-04-26T14:15:51.032602 #11883]  INFO -- : (0.004597s) CREATE TABLE "schema_info" ("version" integer DEFAULT 0 NOT NULL)
I, [2012-04-26T14:15:51.033408 #11883]  INFO -- : (0.000597s) SELECT 1 AS "one" FROM "schema_info" LIMIT 1
I, [2012-04-26T14:15:51.035334 #11883]  INFO -- : (0.001722s) SELECT pg_attribute.attname FROM pg_class, pg_attribute, pg_index, pg_namespace WHERE pg_class.oid = pg_attribute.attrelid AND pg_class.relnamespace = pg_namespace.oid AND pg_class.oid = pg_index.indrelid AND pg_index.indkey[0] = pg_attribute.attnum AND pg_index.indisprimary = 't' AND pg_class.relname = 'schema_info'
I, [2012-04-26T14:15:51.036162 #11883]  INFO -- : (0.000635s) INSERT INTO "schema_info" ("version") VALUES (0) RETURNING NULL
I, [2012-04-26T14:15:51.036766 #11883]  INFO -- : (0.000345s) SELECT COUNT(*) AS "count" FROM "schema_info" LIMIT 1
I, [2012-04-26T14:15:51.037187 #11883]  INFO -- : (0.000252s) SELECT "version" FROM "schema_info" LIMIT 1
I, [2012-04-26T14:15:51.052919 #11883]  INFO -- : Begin applying migration version 1, direction: up
I, [2012-04-26T14:15:51.053177 #11883]  INFO -- : (0.000147s) BEGIN
I, [2012-04-26T14:15:51.058662 #11883]  INFO -- : (0.005087s) CREATE TABLE "users" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "username" text NOT NULL UNIQUE, "email" text NOT NULL UNIQUE, "pubkey_version" integer NOT NULL, "public_key" text, "serialized_object" text, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-04-26T14:15:51.059025 #11883]  INFO -- : (0.000203s) UPDATE "schema_info" SET "version" = 1
I, [2012-04-26T14:15:51.059992 #11883]  INFO -- : (0.000908s) COMMIT
I, [2012-04-26T14:15:51.060060 #11883]  INFO -- : Finished applying migration version 1, direction: up, took 0.007145 seconds
I, [2012-04-26T14:15:51.060094 #11883]  INFO -- : Begin applying migration version 2, direction: up
I, [2012-04-26T14:15:51.060314 #11883]  INFO -- : (0.000168s) BEGIN
I, [2012-04-26T14:15:51.065449 #11883]  INFO -- : (0.004732s) CREATE TABLE "nodes" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "environment" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" text, UNIQUE ("org_id", "name"))
I, [2012-04-26T14:15:51.066472 #11883]  INFO -- : (0.000816s) CREATE INDEX "nodes_org_id_index" ON "nodes" ("org_id")
I, [2012-04-26T14:15:51.067482 #11883]  INFO -- : (0.000829s) CREATE INDEX "nodes_org_id_environment_index" ON "nodes" ("org_id", "environment")
I, [2012-04-26T14:15:51.067818 #11883]  INFO -- : (0.000164s) UPDATE "schema_info" SET "version" = 2
I, [2012-04-26T14:15:51.068498 #11883]  INFO -- : (0.000606s) COMMIT
I, [2012-04-26T14:15:51.068558 #11883]  INFO -- : Finished applying migration version 2, direction: up, took 0.008459 seconds
I, [2012-04-26T14:15:51.068594 #11883]  INFO -- : Begin applying migration version 3, direction: up
I, [2012-04-26T14:15:51.068799 #11883]  INFO -- : (0.000151s) BEGIN
I, [2012-04-26T14:15:51.072788 #11883]  INFO -- : (0.003595s) CREATE TABLE "clients" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, "name" text NOT NULL, "public_key" text, "validator" boolean NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "pubkey_version" smallint NOT NULL, CONSTRAINT "org_id_name_unique" UNIQUE ("org_id", "name"))
I, [2012-04-26T14:15:51.074083 #11883]  INFO -- : (0.001138s) CREATE INDEX "clients_org_id_index" ON "clients" ("org_id")
I, [2012-04-26T14:15:51.074712 #11883]  INFO -- : (0.000455s) UPDATE "schema_info" SET "version" = 3
I, [2012-04-26T14:15:51.075351 #11883]  INFO -- : (0.000559s) COMMIT
I, [2012-04-26T14:15:51.075417 #11883]  INFO -- : Finished applying migration version 3, direction: up, took 0.006819 seconds
I, [2012-04-26T14:15:51.075452 #11883]  INFO -- : Begin applying migration version 4, direction: up
I, [2012-04-26T14:15:51.075638 #11883]  INFO -- : (0.000127s) BEGIN
I, [2012-04-26T14:15:51.079539 #11883]  INFO -- : (0.003386s) CREATE TABLE "roles" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T14:15:51.080464 #11883]  INFO -- : (0.000767s) CREATE INDEX "roles_org_id_index" ON "roles" ("org_id")
I, [2012-04-26T14:15:51.080701 #11883]  INFO -- : (0.000165s) ALTER TABLE roles ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T14:15:51.081003 #11883]  INFO -- : (0.000175s) UPDATE "schema_info" SET "version" = 4
I, [2012-04-26T14:15:51.081903 #11883]  INFO -- : (0.000834s) COMMIT
I, [2012-04-26T14:15:51.081963 #11883]  INFO -- : Finished applying migration version 4, direction: up, took 0.006506 seconds
I, [2012-04-26T14:15:51.081996 #11883]  INFO -- : Begin applying migration version 5, direction: up
I, [2012-04-26T14:15:51.082227 #11883]  INFO -- : (0.000176s) BEGIN
I, [2012-04-26T14:15:51.082669 #11883]  INFO -- : (0.000276s) ALTER TABLE "nodes" ADD COLUMN "last_audit_id" bytea
I, [2012-04-26T14:15:51.087043 #11883]  INFO -- : (0.004025s) CREATE TABLE "node_audit" ("audit_id" bytea NOT NULL, "node_id" char(32), "status" varchar(16), "start_time" timestamp NOT NULL, "end_time" timestamp NULL, "event_data" text NULL, PRIMARY KEY ("audit_id"), CONSTRAINT "node_id_fk" FOREIGN KEY ("node_id") REFERENCES "nodes")
I, [2012-04-26T14:15:51.087998 #11883]  INFO -- : (0.000759s) CREATE INDEX "node_audit_node_id_index" ON "node_audit" ("node_id")
I, [2012-04-26T14:15:51.091737 #11883]  INFO -- : (0.003295s) CREATE TABLE "node_audit_detail" ("audit_id" bytea NOT NULL, "seq" int NOT NULL, "duration" int NOT NULL, "res_id" varchar(255) NOT NULL, "res_type" varchar(16) NOT NULL, "res_name" varchar(255) NOT NULL, "res_result" varchar(16) NULL, "res_initial_state" text NULL, "res_final_state" text NULL, "delta" text NULL, PRIMARY KEY ("audit_id", "seq"), CONSTRAINT "audit_id_fk" FOREIGN KEY ("audit_id") REFERENCES "node_audit")
I, [2012-04-26T14:15:51.092128 #11883]  INFO -- : (0.000210s) UPDATE "schema_info" SET "version" = 5
I, [2012-04-26T14:15:51.093138 #11883]  INFO -- : (0.000924s) COMMIT
I, [2012-04-26T14:15:51.093229 #11883]  INFO -- : Finished applying migration version 5, direction: up, took 0.011221 seconds
I, [2012-04-26T14:15:51.093289 #11883]  INFO -- : Begin applying migration version 6, direction: up
I, [2012-04-26T14:15:51.093487 #11883]  INFO -- : (0.000123s) BEGIN
I, [2012-04-26T14:15:51.097858 #11883]  INFO -- : (0.004009s) CREATE TABLE "data_bags" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, UNIQUE ("org_id", "name"))
I, [2012-04-26T14:15:51.098958 #11883]  INFO -- : (0.000890s) CREATE INDEX "data_bags_org_id_index" ON "data_bags" ("org_id")
I, [2012-04-26T14:15:51.099337 #11883]  INFO -- : (0.000212s) UPDATE "schema_info" SET "version" = 6
I, [2012-04-26T14:15:51.099979 #11883]  INFO -- : (0.000553s) COMMIT
I, [2012-04-26T14:15:51.100063 #11883]  INFO -- : Finished applying migration version 6, direction: up, took 0.006774 seconds
I, [2012-04-26T14:15:51.100102 #11883]  INFO -- : Begin applying migration version 7, direction: up
I, [2012-04-26T14:15:51.100324 #11883]  INFO -- : (0.000159s) BEGIN
I, [2012-04-26T14:15:51.104495 #11883]  INFO -- : (0.003689s) CREATE TABLE "data_bag_items" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "data_bag_name" text NOT NULL, "item_name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "data_bag_name", "item_name"))
I, [2012-04-26T14:15:51.105315 #11883]  INFO -- : (0.000640s) CREATE INDEX "data_bag_items_org_id_index" ON "data_bag_items" ("org_id")
I, [2012-04-26T14:15:51.105608 #11883]  INFO -- : (0.000218s) ALTER TABLE data_bag_items ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T14:15:51.105884 #11883]  INFO -- : (0.000146s) UPDATE "schema_info" SET "version" = 7
I, [2012-04-26T14:15:51.107255 #11883]  INFO -- : (0.001310s) COMMIT
I, [2012-04-26T14:15:51.107322 #11883]  INFO -- : Finished applying migration version 7, direction: up, took 0.007216 seconds
I, [2012-04-26T14:15:51.107356 #11883]  INFO -- : Begin applying migration version 8, direction: up
I, [2012-04-26T14:15:51.107684 #11883]  INFO -- : (0.000271s) BEGIN
I, [2012-04-26T14:15:51.112942 #11883]  INFO -- : (0.004887s) CREATE TABLE "environments" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T14:15:51.113730 #11883]  INFO -- : (0.000622s) CREATE INDEX "environments_org_id_index" ON "environments" ("org_id")
I, [2012-04-26T14:15:51.113995 #11883]  INFO -- : (0.000187s) ALTER TABLE environments ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T14:15:51.114363 #11883]  INFO -- : (0.000161s) UPDATE "schema_info" SET "version" = 8
I, [2012-04-26T14:15:51.115357 #11883]  INFO -- : (0.000909s) COMMIT
I, [2012-04-26T14:15:51.115416 #11883]  INFO -- : Finished applying migration version 8, direction: up, took 0.008056 seconds
I, [2012-04-26T14:15:51.115447 #11883]  INFO -- : Begin applying migration version 9, direction: up
I, [2012-04-26T14:15:51.115678 #11883]  INFO -- : (0.000179s) BEGIN
I, [2012-04-26T14:15:51.117367 #11883]  INFO -- : (0.001503s) ALTER TABLE "data_bag_items" ADD FOREIGN KEY ("org_id", "data_bag_name") REFERENCES "data_bags"("org_id", "name") ON DELETE CASCADE ON UPDATE CASCADE
I, [2012-04-26T14:15:51.117638 #11883]  INFO -- : (0.000129s) UPDATE "schema_info" SET "version" = 9
I, [2012-04-26T14:15:51.118436 #11883]  INFO -- : (0.000741s) COMMIT
I, [2012-04-26T14:15:51.118494 #11883]  INFO -- : Finished applying migration version 9, direction: up, took 0.003044 seconds
I, [2012-04-26T14:15:51.118528 #11883]  INFO -- : Begin applying migration version 10, direction: up
I, [2012-04-26T14:15:51.118834 #11883]  INFO -- : (0.000253s) BEGIN
I, [2012-04-26T14:15:51.119328 #11883]  INFO -- : (0.000360s) DROP INDEX "clients_org_id_index"
I, [2012-04-26T14:15:51.119643 #11883]  INFO -- : (0.000200s) DROP INDEX "environments_org_id_index"
I, [2012-04-26T14:15:51.119959 #11883]  INFO -- : (0.000200s) DROP INDEX "nodes_org_id_index"
I, [2012-04-26T14:15:51.120379 #11883]  INFO -- : (0.000245s) DROP INDEX "roles_org_id_index"
I, [2012-04-26T14:15:51.120740 #11883]  INFO -- : (0.000211s) DROP INDEX "data_bags_org_id_index"
I, [2012-04-26T14:15:51.121131 #11883]  INFO -- : (0.000273s) DROP INDEX "data_bag_items_org_id_index"
I, [2012-04-26T14:15:51.121462 #11883]  INFO -- : (0.000161s) UPDATE "schema_info" SET "version" = 10
I, [2012-04-26T14:15:51.122387 #11883]  INFO -- : (0.000865s) COMMIT
I, [2012-04-26T14:15:51.122471 #11883]  INFO -- : Finished applying migration version 10, direction: up, took 0.003934 seconds
I, [2012-04-26T14:15:51.122532 #11883]  INFO -- : Begin applying migration version 11, direction: up
I, [2012-04-26T14:15:51.122726 #11883]  INFO -- : (0.000121s) BEGIN
I, [2012-04-26T14:15:51.123270 #11883]  INFO -- : (0.000309s) ALTER TABLE "users" ADD COLUMN "external_authentication_uid" text NULL
I, [2012-04-26T14:15:51.123556 #11883]  INFO -- : (0.000207s) ALTER TABLE "users" ADD COLUMN "recovery_authentication_enabled" boolean NULL
I, [2012-04-26T14:15:51.123781 #11883]  INFO -- : (0.000165s) ALTER TABLE "users" ALTER COLUMN "email" DROP NOT NULL
I, [2012-04-26T14:15:51.124038 #11883]  INFO -- : (0.000143s) UPDATE "schema_info" SET "version" = 11
I, [2012-04-26T14:15:51.124553 #11883]  INFO -- : (0.000460s) COMMIT
I, [2012-04-26T14:15:51.124607 #11883]  INFO -- : Finished applying migration version 11, direction: up, took 0.002076 seconds
I, [2012-04-26T15:37:40.294940 #12674]  INFO -- : (0.000352s) SET standard_conforming_strings = ON
I, [2012-04-26T15:37:40.500321 #12674]  INFO -- : (0.000271s) SET client_min_messages = 'WARNING'
I, [2012-04-26T15:37:40.501558 #12674]  INFO -- : (0.000286s) SET DateStyle = 'ISO'
E, [2012-04-26T15:37:40.574764 #12674] ERROR -- : PG::Error: ERROR:  relation "schema_info" does not exist
LINE 1: SELECT NULL FROM "schema_info" LIMIT 1
                         ^: SELECT NULL FROM "schema_info" LIMIT 1
I, [2012-04-26T15:37:40.639314 #12674]  INFO -- : (0.063933s) CREATE TABLE "schema_info" ("version" integer DEFAULT 0 NOT NULL)
I, [2012-04-26T15:37:40.640125 #12674]  INFO -- : (0.000575s) SELECT 1 AS "one" FROM "schema_info" LIMIT 1
I, [2012-04-26T15:37:40.642079 #12674]  INFO -- : (0.001759s) SELECT pg_attribute.attname FROM pg_class, pg_attribute, pg_index, pg_namespace WHERE pg_class.oid = pg_attribute.attrelid AND pg_class.relnamespace = pg_namespace.oid AND pg_class.oid = pg_index.indrelid AND pg_index.indkey[0] = pg_attribute.attnum AND pg_index.indisprimary = 't' AND pg_class.relname = 'schema_info'
I, [2012-04-26T15:37:40.643092 #12674]  INFO -- : (0.000815s) INSERT INTO "schema_info" ("version") VALUES (0) RETURNING NULL
I, [2012-04-26T15:37:40.643895 #12674]  INFO -- : (0.000504s) SELECT COUNT(*) AS "count" FROM "schema_info" LIMIT 1
I, [2012-04-26T15:37:40.644369 #12674]  INFO -- : (0.000292s) SELECT "version" FROM "schema_info" LIMIT 1
I, [2012-04-26T15:37:40.659434 #12674]  INFO -- : Begin applying migration version 1, direction: up
I, [2012-04-26T15:37:40.659692 #12674]  INFO -- : (0.000142s) BEGIN
I, [2012-04-26T15:37:40.665166 #12674]  INFO -- : (0.005072s) CREATE TABLE "users" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "username" text NOT NULL UNIQUE, "email" text NOT NULL UNIQUE, "pubkey_version" integer NOT NULL, "public_key" text, "serialized_object" text, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-04-26T15:37:40.665618 #12674]  INFO -- : (0.000255s) UPDATE "schema_info" SET "version" = 1
I, [2012-04-26T15:37:40.667141 #12674]  INFO -- : (0.001462s) COMMIT
I, [2012-04-26T15:37:40.667207 #12674]  INFO -- : Finished applying migration version 1, direction: up, took 0.007776 seconds
I, [2012-04-26T15:37:40.667243 #12674]  INFO -- : Begin applying migration version 2, direction: up
I, [2012-04-26T15:37:40.667580 #12674]  INFO -- : (0.000283s) BEGIN
I, [2012-04-26T15:37:40.671896 #12674]  INFO -- : (0.003925s) CREATE TABLE "nodes" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "environment" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" text, UNIQUE ("org_id", "name"))
I, [2012-04-26T15:37:40.672863 #12674]  INFO -- : (0.000783s) CREATE INDEX "nodes_org_id_index" ON "nodes" ("org_id")
I, [2012-04-26T15:37:40.673734 #12674]  INFO -- : (0.000727s) CREATE INDEX "nodes_org_id_environment_index" ON "nodes" ("org_id", "environment")
I, [2012-04-26T15:37:40.674133 #12674]  INFO -- : (0.000194s) UPDATE "schema_info" SET "version" = 2
I, [2012-04-26T15:37:40.674955 #12674]  INFO -- : (0.000759s) COMMIT
I, [2012-04-26T15:37:40.675018 #12674]  INFO -- : Finished applying migration version 2, direction: up, took 0.007770 seconds
I, [2012-04-26T15:37:40.675053 #12674]  INFO -- : Begin applying migration version 3, direction: up
I, [2012-04-26T15:37:40.675211 #12674]  INFO -- : (0.000104s) BEGIN
I, [2012-04-26T15:37:40.679454 #12674]  INFO -- : (0.003795s) CREATE TABLE "clients" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, "name" text NOT NULL, "public_key" text, "validator" boolean NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "pubkey_version" smallint NOT NULL, CONSTRAINT "org_id_name_unique" UNIQUE ("org_id", "name"))
I, [2012-04-26T15:37:40.680514 #12674]  INFO -- : (0.000867s) CREATE INDEX "clients_org_id_index" ON "clients" ("org_id")
I, [2012-04-26T15:37:40.680875 #12674]  INFO -- : (0.000193s) UPDATE "schema_info" SET "version" = 3
I, [2012-04-26T15:37:40.682238 #12674]  INFO -- : (0.001268s) COMMIT
I, [2012-04-26T15:37:40.682337 #12674]  INFO -- : Finished applying migration version 3, direction: up, took 0.007274 seconds
I, [2012-04-26T15:37:40.682397 #12674]  INFO -- : Begin applying migration version 4, direction: up
I, [2012-04-26T15:37:40.682649 #12674]  INFO -- : (0.000169s) BEGIN
I, [2012-04-26T15:37:40.687414 #12674]  INFO -- : (0.004359s) CREATE TABLE "roles" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T15:37:40.688493 #12674]  INFO -- : (0.000946s) CREATE INDEX "roles_org_id_index" ON "roles" ("org_id")
I, [2012-04-26T15:37:40.688830 #12674]  INFO -- : (0.000264s) ALTER TABLE roles ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T15:37:40.689143 #12674]  INFO -- : (0.000174s) UPDATE "schema_info" SET "version" = 4
I, [2012-04-26T15:37:40.689928 #12674]  INFO -- : (0.000717s) COMMIT
I, [2012-04-26T15:37:40.689992 #12674]  INFO -- : Finished applying migration version 4, direction: up, took 0.007595 seconds
I, [2012-04-26T15:37:40.690027 #12674]  INFO -- : Begin applying migration version 5, direction: up
I, [2012-04-26T15:37:40.690206 #12674]  INFO -- : (0.000123s) BEGIN
I, [2012-04-26T15:37:40.690554 #12674]  INFO -- : (0.000183s) ALTER TABLE "nodes" ADD COLUMN "last_audit_id" bytea
I, [2012-04-26T15:37:40.694700 #12674]  INFO -- : (0.003798s) CREATE TABLE "node_audit" ("audit_id" bytea NOT NULL, "node_id" char(32), "status" varchar(16), "start_time" timestamp NOT NULL, "end_time" timestamp NULL, "event_data" text NULL, PRIMARY KEY ("audit_id"), CONSTRAINT "node_id_fk" FOREIGN KEY ("node_id") REFERENCES "nodes")
I, [2012-04-26T15:37:40.695574 #12674]  INFO -- : (0.000714s) CREATE INDEX "node_audit_node_id_index" ON "node_audit" ("node_id")
I, [2012-04-26T15:37:40.701865 #12674]  INFO -- : (0.005730s) CREATE TABLE "node_audit_detail" ("audit_id" bytea NOT NULL, "seq" int NOT NULL, "duration" int NOT NULL, "res_id" varchar(255) NOT NULL, "res_type" varchar(16) NOT NULL, "res_name" varchar(255) NOT NULL, "res_result" varchar(16) NULL, "res_initial_state" text NULL, "res_final_state" text NULL, "delta" text NULL, PRIMARY KEY ("audit_id", "seq"), CONSTRAINT "audit_id_fk" FOREIGN KEY ("audit_id") REFERENCES "node_audit")
I, [2012-04-26T15:37:40.702291 #12674]  INFO -- : (0.000231s) UPDATE "schema_info" SET "version" = 5
I, [2012-04-26T15:37:40.705600 #12674]  INFO -- : (0.003235s) COMMIT
I, [2012-04-26T15:37:40.705696 #12674]  INFO -- : Finished applying migration version 5, direction: up, took 0.015660 seconds
I, [2012-04-26T15:37:40.705752 #12674]  INFO -- : Begin applying migration version 6, direction: up
I, [2012-04-26T15:37:40.706041 #12674]  INFO -- : (0.000202s) BEGIN
I, [2012-04-26T15:37:40.718668 #12674]  INFO -- : (0.012123s) CREATE TABLE "data_bags" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, UNIQUE ("org_id", "name"))
I, [2012-04-26T15:37:40.723039 #12674]  INFO -- : (0.004190s) CREATE INDEX "data_bags_org_id_index" ON "data_bags" ("org_id")
I, [2012-04-26T15:37:40.723492 #12674]  INFO -- : (0.000300s) UPDATE "schema_info" SET "version" = 6
I, [2012-04-26T15:37:40.726576 #12674]  INFO -- : (0.003017s) COMMIT
I, [2012-04-26T15:37:40.726640 #12674]  INFO -- : Finished applying migration version 6, direction: up, took 0.020888 seconds
I, [2012-04-26T15:37:40.726674 #12674]  INFO -- : Begin applying migration version 7, direction: up
I, [2012-04-26T15:37:40.726881 #12674]  INFO -- : (0.000149s) BEGIN
I, [2012-04-26T15:37:40.732035 #12674]  INFO -- : (0.004765s) CREATE TABLE "data_bag_items" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "data_bag_name" text NOT NULL, "item_name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "data_bag_name", "item_name"))
I, [2012-04-26T15:37:40.733092 #12674]  INFO -- : (0.000889s) CREATE INDEX "data_bag_items_org_id_index" ON "data_bag_items" ("org_id")
I, [2012-04-26T15:37:40.733389 #12674]  INFO -- : (0.000231s) ALTER TABLE data_bag_items ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T15:37:40.733765 #12674]  INFO -- : (0.000239s) UPDATE "schema_info" SET "version" = 7
I, [2012-04-26T15:37:40.734781 #12674]  INFO -- : (0.000952s) COMMIT
I, [2012-04-26T15:37:40.734847 #12674]  INFO -- : Finished applying migration version 7, direction: up, took 0.008168 seconds
I, [2012-04-26T15:37:40.734881 #12674]  INFO -- : Begin applying migration version 8, direction: up
I, [2012-04-26T15:37:40.735107 #12674]  INFO -- : (0.000169s) BEGIN
I, [2012-04-26T15:37:40.739694 #12674]  INFO -- : (0.004215s) CREATE TABLE "environments" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T15:37:40.740854 #12674]  INFO -- : (0.000956s) CREATE INDEX "environments_org_id_index" ON "environments" ("org_id")
I, [2012-04-26T15:37:40.741142 #12674]  INFO -- : (0.000187s) ALTER TABLE environments ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T15:37:40.741452 #12674]  INFO -- : (0.000173s) UPDATE "schema_info" SET "version" = 8
I, [2012-04-26T15:37:40.742218 #12674]  INFO -- : (0.000683s) COMMIT
I, [2012-04-26T15:37:40.742305 #12674]  INFO -- : Finished applying migration version 8, direction: up, took 0.007414 seconds
I, [2012-04-26T15:37:40.742351 #12674]  INFO -- : Begin applying migration version 9, direction: up
I, [2012-04-26T15:37:40.742544 #12674]  INFO -- : (0.000125s) BEGIN
I, [2012-04-26T15:37:40.744802 #12674]  INFO -- : (0.002007s) ALTER TABLE "data_bag_items" ADD FOREIGN KEY ("org_id", "data_bag_name") REFERENCES "data_bags"("org_id", "name") ON DELETE CASCADE ON UPDATE CASCADE
I, [2012-04-26T15:37:40.745140 #12674]  INFO -- : (0.000146s) UPDATE "schema_info" SET "version" = 9
I, [2012-04-26T15:37:40.745719 #12674]  INFO -- : (0.000520s) COMMIT
I, [2012-04-26T15:37:40.745777 #12674]  INFO -- : Finished applying migration version 9, direction: up, took 0.003422 seconds
I, [2012-04-26T15:37:40.745826 #12674]  INFO -- : Begin applying migration version 10, direction: up
I, [2012-04-26T15:37:40.745964 #12674]  INFO -- : (0.000084s) BEGIN
I, [2012-04-26T15:37:40.746398 #12674]  INFO -- : (0.000321s) DROP INDEX "clients_org_id_index"
I, [2012-04-26T15:37:40.746651 #12674]  INFO -- : (0.000157s) DROP INDEX "environments_org_id_index"
I, [2012-04-26T15:37:40.746892 #12674]  INFO -- : (0.000151s) DROP INDEX "nodes_org_id_index"
I, [2012-04-26T15:37:40.747125 #12674]  INFO -- : (0.000143s) DROP INDEX "roles_org_id_index"
I, [2012-04-26T15:37:40.747368 #12674]  INFO -- : (0.000150s) DROP INDEX "data_bags_org_id_index"
I, [2012-04-26T15:37:40.747644 #12674]  INFO -- : (0.000171s) DROP INDEX "data_bag_items_org_id_index"
I, [2012-04-26T15:37:40.747883 #12674]  INFO -- : (0.000132s) UPDATE "schema_info" SET "version" = 10
I, [2012-04-26T15:37:40.748771 #12674]  INFO -- : (0.000834s) COMMIT
I, [2012-04-26T15:37:40.748824 #12674]  INFO -- : Finished applying migration version 10, direction: up, took 0.002995 seconds
I, [2012-04-26T15:37:40.748866 #12674]  INFO -- : Begin applying migration version 11, direction: up
I, [2012-04-26T15:37:40.749039 #12674]  INFO -- : (0.000123s) BEGIN
I, [2012-04-26T15:37:40.749602 #12674]  INFO -- : (0.000357s) ALTER TABLE "users" ADD COLUMN "external_authentication_uid" text NULL
I, [2012-04-26T15:37:40.749821 #12674]  INFO -- : (0.000167s) ALTER TABLE "users" ADD COLUMN "recovery_authentication_enabled" boolean NULL
I, [2012-04-26T15:37:40.750056 #12674]  INFO -- : (0.000184s) ALTER TABLE "users" ALTER COLUMN "email" DROP NOT NULL
I, [2012-04-26T15:37:40.750365 #12674]  INFO -- : (0.000177s) UPDATE "schema_info" SET "version" = 11
I, [2012-04-26T15:37:40.751076 #12674]  INFO -- : (0.000617s) COMMIT
I, [2012-04-26T15:37:40.751135 #12674]  INFO -- : Finished applying migration version 11, direction: up, took 0.002272 seconds
I, [2012-04-26T15:40:49.451693 #12851]  INFO -- : (0.000375s) SET standard_conforming_strings = ON
I, [2012-04-26T15:40:49.451968 #12851]  INFO -- : (0.000140s) SET client_min_messages = 'WARNING'
I, [2012-04-26T15:40:49.452171 #12851]  INFO -- : (0.000146s) SET DateStyle = 'ISO'
E, [2012-04-26T15:40:49.459861 #12851] ERROR -- : PG::Error: ERROR:  relation "schema_info" does not exist
LINE 1: SELECT NULL FROM "schema_info" LIMIT 1
                         ^: SELECT NULL FROM "schema_info" LIMIT 1
I, [2012-04-26T15:40:49.464866 #12851]  INFO -- : (0.004736s) CREATE TABLE "schema_info" ("version" integer DEFAULT 0 NOT NULL)
I, [2012-04-26T15:40:49.465669 #12851]  INFO -- : (0.000621s) SELECT 1 AS "one" FROM "schema_info" LIMIT 1
I, [2012-04-26T15:40:49.469129 #12851]  INFO -- : (0.003111s) SELECT pg_attribute.attname FROM pg_class, pg_attribute, pg_index, pg_namespace WHERE pg_class.oid = pg_attribute.attrelid AND pg_class.relnamespace = pg_namespace.oid AND pg_class.oid = pg_index.indrelid AND pg_index.indkey[0] = pg_attribute.attnum AND pg_index.indisprimary = 't' AND pg_class.relname = 'schema_info'
I, [2012-04-26T15:40:49.470149 #12851]  INFO -- : (0.000821s) INSERT INTO "schema_info" ("version") VALUES (0) RETURNING NULL
I, [2012-04-26T15:40:49.470814 #12851]  INFO -- : (0.000435s) SELECT COUNT(*) AS "count" FROM "schema_info" LIMIT 1
I, [2012-04-26T15:40:49.471271 #12851]  INFO -- : (0.000274s) SELECT "version" FROM "schema_info" LIMIT 1
I, [2012-04-26T15:40:49.486736 #12851]  INFO -- : Begin applying migration version 1, direction: up
I, [2012-04-26T15:40:49.487002 #12851]  INFO -- : (0.000151s) BEGIN
I, [2012-04-26T15:40:49.492875 #12851]  INFO -- : (0.005481s) CREATE TABLE "users" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "username" text NOT NULL UNIQUE, "email" text NOT NULL UNIQUE, "pubkey_version" integer NOT NULL, "public_key" text, "serialized_object" text, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-04-26T15:40:49.493307 #12851]  INFO -- : (0.000254s) UPDATE "schema_info" SET "version" = 1
I, [2012-04-26T15:40:49.495147 #12851]  INFO -- : (0.001758s) COMMIT
I, [2012-04-26T15:40:49.495212 #12851]  INFO -- : Finished applying migration version 1, direction: up, took 0.008479 seconds
I, [2012-04-26T15:40:49.495245 #12851]  INFO -- : Begin applying migration version 2, direction: up
I, [2012-04-26T15:40:49.495480 #12851]  INFO -- : (0.000174s) BEGIN
I, [2012-04-26T15:40:49.500233 #12851]  INFO -- : (0.004352s) CREATE TABLE "nodes" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "environment" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" text, UNIQUE ("org_id", "name"))
I, [2012-04-26T15:40:49.501435 #12851]  INFO -- : (0.001032s) CREATE INDEX "nodes_org_id_index" ON "nodes" ("org_id")
I, [2012-04-26T15:40:49.502272 #12851]  INFO -- : (0.000685s) CREATE INDEX "nodes_org_id_environment_index" ON "nodes" ("org_id", "environment")
I, [2012-04-26T15:40:49.502568 #12851]  INFO -- : (0.000154s) UPDATE "schema_info" SET "version" = 2
I, [2012-04-26T15:40:49.503304 #12851]  INFO -- : (0.000677s) COMMIT
I, [2012-04-26T15:40:49.503365 #12851]  INFO -- : Finished applying migration version 2, direction: up, took 0.008115 seconds
I, [2012-04-26T15:40:49.503402 #12851]  INFO -- : Begin applying migration version 3, direction: up
I, [2012-04-26T15:40:49.503597 #12851]  INFO -- : (0.000141s) BEGIN
I, [2012-04-26T15:40:49.508220 #12851]  INFO -- : (0.004219s) CREATE TABLE "clients" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, "name" text NOT NULL, "public_key" text, "validator" boolean NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "pubkey_version" smallint NOT NULL, CONSTRAINT "org_id_name_unique" UNIQUE ("org_id", "name"))
I, [2012-04-26T15:40:49.509271 #12851]  INFO -- : (0.000856s) CREATE INDEX "clients_org_id_index" ON "clients" ("org_id")
I, [2012-04-26T15:40:49.509686 #12851]  INFO -- : (0.000214s) UPDATE "schema_info" SET "version" = 3
I, [2012-04-26T15:40:49.510470 #12851]  INFO -- : (0.000698s) COMMIT
I, [2012-04-26T15:40:49.510536 #12851]  INFO -- : Finished applying migration version 3, direction: up, took 0.007130 seconds
I, [2012-04-26T15:40:49.510573 #12851]  INFO -- : Begin applying migration version 4, direction: up
I, [2012-04-26T15:40:49.510785 #12851]  INFO -- : (0.000151s) BEGIN
I, [2012-04-26T15:40:49.514851 #12851]  INFO -- : (0.003474s) CREATE TABLE "roles" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T15:40:49.515777 #12851]  INFO -- : (0.000788s) CREATE INDEX "roles_org_id_index" ON "roles" ("org_id")
I, [2012-04-26T15:40:49.516028 #12851]  INFO -- : (0.000187s) ALTER TABLE roles ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T15:40:49.516374 #12851]  INFO -- : (0.000219s) UPDATE "schema_info" SET "version" = 4
I, [2012-04-26T15:40:49.517006 #12851]  INFO -- : (0.000570s) COMMIT
I, [2012-04-26T15:40:49.517058 #12851]  INFO -- : Finished applying migration version 4, direction: up, took 0.006481 seconds
I, [2012-04-26T15:40:49.517090 #12851]  INFO -- : Begin applying migration version 5, direction: up
I, [2012-04-26T15:40:49.517424 #12851]  INFO -- : (0.000264s) BEGIN
I, [2012-04-26T15:40:49.517808 #12851]  INFO -- : (0.000222s) ALTER TABLE "nodes" ADD COLUMN "last_audit_id" bytea
I, [2012-04-26T15:40:49.522099 #12851]  INFO -- : (0.003956s) CREATE TABLE "node_audit" ("audit_id" bytea NOT NULL, "node_id" char(32), "status" varchar(16), "start_time" timestamp NOT NULL, "end_time" timestamp NULL, "event_data" text NULL, PRIMARY KEY ("audit_id"), CONSTRAINT "node_id_fk" FOREIGN KEY ("node_id") REFERENCES "nodes")
I, [2012-04-26T15:40:49.523126 #12851]  INFO -- : (0.000803s) CREATE INDEX "node_audit_node_id_index" ON "node_audit" ("node_id")
I, [2012-04-26T15:40:49.527368 #12851]  INFO -- : (0.003644s) CREATE TABLE "node_audit_detail" ("audit_id" bytea NOT NULL, "seq" int NOT NULL, "duration" int NOT NULL, "res_id" varchar(255) NOT NULL, "res_type" varchar(16) NOT NULL, "res_name" varchar(255) NOT NULL, "res_result" varchar(16) NULL, "res_initial_state" text NULL, "res_final_state" text NULL, "delta" text NULL, PRIMARY KEY ("audit_id", "seq"), CONSTRAINT "audit_id_fk" FOREIGN KEY ("audit_id") REFERENCES "node_audit")
I, [2012-04-26T15:40:49.527732 #12851]  INFO -- : (0.000183s) UPDATE "schema_info" SET "version" = 5
I, [2012-04-26T15:40:49.528895 #12851]  INFO -- : (0.001084s) COMMIT
I, [2012-04-26T15:40:49.528954 #12851]  INFO -- : Finished applying migration version 5, direction: up, took 0.011860 seconds
I, [2012-04-26T15:40:49.528989 #12851]  INFO -- : Begin applying migration version 6, direction: up
I, [2012-04-26T15:40:49.529237 #12851]  INFO -- : (0.000193s) BEGIN
I, [2012-04-26T15:40:49.533226 #12851]  INFO -- : (0.003653s) CREATE TABLE "data_bags" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, UNIQUE ("org_id", "name"))
I, [2012-04-26T15:40:49.534488 #12851]  INFO -- : (0.001054s) CREATE INDEX "data_bags_org_id_index" ON "data_bags" ("org_id")
I, [2012-04-26T15:40:49.534882 #12851]  INFO -- : (0.000199s) UPDATE "schema_info" SET "version" = 6
I, [2012-04-26T15:40:49.535501 #12851]  INFO -- : (0.000550s) COMMIT
I, [2012-04-26T15:40:49.535562 #12851]  INFO -- : Finished applying migration version 6, direction: up, took 0.006568 seconds
I, [2012-04-26T15:40:49.535609 #12851]  INFO -- : Begin applying migration version 7, direction: up
I, [2012-04-26T15:40:49.535800 #12851]  INFO -- : (0.000122s) BEGIN
I, [2012-04-26T15:40:49.540600 #12851]  INFO -- : (0.004242s) CREATE TABLE "data_bag_items" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "data_bag_name" text NOT NULL, "item_name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "data_bag_name", "item_name"))
I, [2012-04-26T15:40:49.541698 #12851]  INFO -- : (0.000949s) CREATE INDEX "data_bag_items_org_id_index" ON "data_bag_items" ("org_id")
I, [2012-04-26T15:40:49.542082 #12851]  INFO -- : (0.000306s) ALTER TABLE data_bag_items ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T15:40:49.542505 #12851]  INFO -- : (0.000284s) UPDATE "schema_info" SET "version" = 7
I, [2012-04-26T15:40:49.543398 #12851]  INFO -- : (0.000835s) COMMIT
I, [2012-04-26T15:40:49.543461 #12851]  INFO -- : Finished applying migration version 7, direction: up, took 0.007852 seconds
I, [2012-04-26T15:40:49.543496 #12851]  INFO -- : Begin applying migration version 8, direction: up
I, [2012-04-26T15:40:49.543678 #12851]  INFO -- : (0.000132s) BEGIN
I, [2012-04-26T15:40:49.548722 #12851]  INFO -- : (0.004694s) CREATE TABLE "environments" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T15:40:49.549498 #12851]  INFO -- : (0.000613s) CREATE INDEX "environments_org_id_index" ON "environments" ("org_id")
I, [2012-04-26T15:40:49.549790 #12851]  INFO -- : (0.000217s) ALTER TABLE environments ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T15:40:49.550238 #12851]  INFO -- : (0.000307s) UPDATE "schema_info" SET "version" = 8
I, [2012-04-26T15:40:49.550911 #12851]  INFO -- : (0.000609s) COMMIT
I, [2012-04-26T15:40:49.550975 #12851]  INFO -- : Finished applying migration version 8, direction: up, took 0.007474 seconds
I, [2012-04-26T15:40:49.551010 #12851]  INFO -- : Begin applying migration version 9, direction: up
I, [2012-04-26T15:40:49.551174 #12851]  INFO -- : (0.000096s) BEGIN
I, [2012-04-26T15:40:49.552736 #12851]  INFO -- : (0.001381s) ALTER TABLE "data_bag_items" ADD FOREIGN KEY ("org_id", "data_bag_name") REFERENCES "data_bags"("org_id", "name") ON DELETE CASCADE ON UPDATE CASCADE
I, [2012-04-26T15:40:49.552986 #12851]  INFO -- : (0.000132s) UPDATE "schema_info" SET "version" = 9
I, [2012-04-26T15:40:49.554217 #12851]  INFO -- : (0.001177s) COMMIT
I, [2012-04-26T15:40:49.554285 #12851]  INFO -- : Finished applying migration version 9, direction: up, took 0.003272 seconds
I, [2012-04-26T15:40:49.554318 #12851]  INFO -- : Begin applying migration version 10, direction: up
I, [2012-04-26T15:40:49.554581 #12851]  INFO -- : (0.000205s) BEGIN
I, [2012-04-26T15:40:49.555269 #12851]  INFO -- : (0.000505s) DROP INDEX "clients_org_id_index"
I, [2012-04-26T15:40:49.555656 #12851]  INFO -- : (0.000231s) DROP INDEX "environments_org_id_index"
I, [2012-04-26T15:40:49.555953 #12851]  INFO -- : (0.000193s) DROP INDEX "nodes_org_id_index"
I, [2012-04-26T15:40:49.556271 #12851]  INFO -- : (0.000209s) DROP INDEX "roles_org_id_index"
I, [2012-04-26T15:40:49.556639 #12851]  INFO -- : (0.000207s) DROP INDEX "data_bags_org_id_index"
I, [2012-04-26T15:40:49.556944 #12851]  INFO -- : (0.000192s) DROP INDEX "data_bag_items_org_id_index"
I, [2012-04-26T15:40:49.557279 #12851]  INFO -- : (0.000187s) UPDATE "schema_info" SET "version" = 10
I, [2012-04-26T15:40:49.558324 #12851]  INFO -- : (0.000983s) COMMIT
I, [2012-04-26T15:40:49.558404 #12851]  INFO -- : Finished applying migration version 10, direction: up, took 0.004076 seconds
I, [2012-04-26T15:40:49.558465 #12851]  INFO -- : Begin applying migration version 11, direction: up
I, [2012-04-26T15:40:49.558651 #12851]  INFO -- : (0.000118s) BEGIN
I, [2012-04-26T15:40:49.559195 #12851]  INFO -- : (0.000304s) ALTER TABLE "users" ADD COLUMN "external_authentication_uid" text NULL
I, [2012-04-26T15:40:49.559447 #12851]  INFO -- : (0.000193s) ALTER TABLE "users" ADD COLUMN "recovery_authentication_enabled" boolean NULL
I, [2012-04-26T15:40:49.559677 #12851]  INFO -- : (0.000175s) ALTER TABLE "users" ALTER COLUMN "email" DROP NOT NULL
I, [2012-04-26T15:40:49.559934 #12851]  INFO -- : (0.000147s) UPDATE "schema_info" SET "version" = 11
I, [2012-04-26T15:40:49.560458 #12851]  INFO -- : (0.000470s) COMMIT
I, [2012-04-26T15:40:49.560511 #12851]  INFO -- : Finished applying migration version 11, direction: up, took 0.002048 seconds
I, [2012-04-26T15:42:23.366354 #13023]  INFO -- : (0.000372s) SET standard_conforming_strings = ON
I, [2012-04-26T15:42:23.366618 #13023]  INFO -- : (0.000131s) SET client_min_messages = 'WARNING'
I, [2012-04-26T15:42:23.366804 #13023]  INFO -- : (0.000123s) SET DateStyle = 'ISO'
E, [2012-04-26T15:42:23.374471 #13023] ERROR -- : PG::Error: ERROR:  relation "schema_info" does not exist
LINE 1: SELECT NULL FROM "schema_info" LIMIT 1
                         ^: SELECT NULL FROM "schema_info" LIMIT 1
I, [2012-04-26T15:42:23.379544 #13023]  INFO -- : (0.004830s) CREATE TABLE "schema_info" ("version" integer DEFAULT 0 NOT NULL)
I, [2012-04-26T15:42:23.380400 #13023]  INFO -- : (0.000658s) SELECT 1 AS "one" FROM "schema_info" LIMIT 1
I, [2012-04-26T15:42:23.382394 #13023]  INFO -- : (0.001797s) SELECT pg_attribute.attname FROM pg_class, pg_attribute, pg_index, pg_namespace WHERE pg_class.oid = pg_attribute.attrelid AND pg_class.relnamespace = pg_namespace.oid AND pg_class.oid = pg_index.indrelid AND pg_index.indkey[0] = pg_attribute.attnum AND pg_index.indisprimary = 't' AND pg_class.relname = 'schema_info'
I, [2012-04-26T15:42:23.383300 #13023]  INFO -- : (0.000704s) INSERT INTO "schema_info" ("version") VALUES (0) RETURNING NULL
I, [2012-04-26T15:42:23.383916 #13023]  INFO -- : (0.000369s) SELECT COUNT(*) AS "count" FROM "schema_info" LIMIT 1
I, [2012-04-26T15:42:23.384252 #13023]  INFO -- : (0.000168s) SELECT "version" FROM "schema_info" LIMIT 1
I, [2012-04-26T15:42:23.399810 #13023]  INFO -- : Begin applying migration version 1, direction: up
I, [2012-04-26T15:42:23.400062 #13023]  INFO -- : (0.000139s) BEGIN
I, [2012-04-26T15:42:23.405742 #13023]  INFO -- : (0.005288s) CREATE TABLE "users" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "username" text NOT NULL UNIQUE, "email" text NOT NULL UNIQUE, "pubkey_version" integer NOT NULL, "public_key" text, "serialized_object" text, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-04-26T15:42:23.406156 #13023]  INFO -- : (0.000260s) UPDATE "schema_info" SET "version" = 1
I, [2012-04-26T15:42:23.407010 #13023]  INFO -- : (0.000789s) COMMIT
I, [2012-04-26T15:42:23.407117 #13023]  INFO -- : Finished applying migration version 1, direction: up, took 0.007300 seconds
I, [2012-04-26T15:42:23.407182 #13023]  INFO -- : Begin applying migration version 2, direction: up
I, [2012-04-26T15:42:23.407424 #13023]  INFO -- : (0.000150s) BEGIN
I, [2012-04-26T15:42:23.412262 #13023]  INFO -- : (0.004148s) CREATE TABLE "nodes" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "environment" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" text, UNIQUE ("org_id", "name"))
I, [2012-04-26T15:42:23.413310 #13023]  INFO -- : (0.000838s) CREATE INDEX "nodes_org_id_index" ON "nodes" ("org_id")
I, [2012-04-26T15:42:23.414274 #13023]  INFO -- : (0.000812s) CREATE INDEX "nodes_org_id_environment_index" ON "nodes" ("org_id", "environment")
I, [2012-04-26T15:42:23.414602 #13023]  INFO -- : (0.000180s) UPDATE "schema_info" SET "version" = 2
I, [2012-04-26T15:42:23.415378 #13023]  INFO -- : (0.000707s) COMMIT
I, [2012-04-26T15:42:23.415441 #13023]  INFO -- : Finished applying migration version 2, direction: up, took 0.008259 seconds
I, [2012-04-26T15:42:23.415481 #13023]  INFO -- : Begin applying migration version 3, direction: up
I, [2012-04-26T15:42:23.415675 #13023]  INFO -- : (0.000128s) BEGIN
I, [2012-04-26T15:42:23.419734 #13023]  INFO -- : (0.003642s) CREATE TABLE "clients" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, "name" text NOT NULL, "public_key" text, "validator" boolean NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "pubkey_version" smallint NOT NULL, CONSTRAINT "org_id_name_unique" UNIQUE ("org_id", "name"))
I, [2012-04-26T15:42:23.420736 #13023]  INFO -- : (0.000820s) CREATE INDEX "clients_org_id_index" ON "clients" ("org_id")
I, [2012-04-26T15:42:23.421034 #13023]  INFO -- : (0.000155s) UPDATE "schema_info" SET "version" = 3
I, [2012-04-26T15:42:23.421615 #13023]  INFO -- : (0.000518s) COMMIT
I, [2012-04-26T15:42:23.421693 #13023]  INFO -- : Finished applying migration version 3, direction: up, took 0.006207 seconds
I, [2012-04-26T15:42:23.421735 #13023]  INFO -- : Begin applying migration version 4, direction: up
I, [2012-04-26T15:42:23.421946 #13023]  INFO -- : (0.000144s) BEGIN
I, [2012-04-26T15:42:23.426513 #13023]  INFO -- : (0.003953s) CREATE TABLE "roles" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T15:42:23.427395 #13023]  INFO -- : (0.000722s) CREATE INDEX "roles_org_id_index" ON "roles" ("org_id")
I, [2012-04-26T15:42:23.427645 #13023]  INFO -- : (0.000180s) ALTER TABLE roles ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T15:42:23.428009 #13023]  INFO -- : (0.000241s) UPDATE "schema_info" SET "version" = 4
I, [2012-04-26T15:42:23.428811 #13023]  INFO -- : (0.000750s) COMMIT
I, [2012-04-26T15:42:23.428865 #13023]  INFO -- : Finished applying migration version 4, direction: up, took 0.007127 seconds
I, [2012-04-26T15:42:23.428899 #13023]  INFO -- : Begin applying migration version 5, direction: up
I, [2012-04-26T15:42:23.429042 #13023]  INFO -- : (0.000091s) BEGIN
I, [2012-04-26T15:42:23.429532 #13023]  INFO -- : (0.000309s) ALTER TABLE "nodes" ADD COLUMN "last_audit_id" bytea
I, [2012-04-26T15:42:23.434205 #13023]  INFO -- : (0.004325s) CREATE TABLE "node_audit" ("audit_id" bytea NOT NULL, "node_id" char(32), "status" varchar(16), "start_time" timestamp NOT NULL, "end_time" timestamp NULL, "event_data" text NULL, PRIMARY KEY ("audit_id"), CONSTRAINT "node_id_fk" FOREIGN KEY ("node_id") REFERENCES "nodes")
I, [2012-04-26T15:42:23.435485 #13023]  INFO -- : (0.001042s) CREATE INDEX "node_audit_node_id_index" ON "node_audit" ("node_id")
I, [2012-04-26T15:42:23.439903 #13023]  INFO -- : (0.003715s) CREATE TABLE "node_audit_detail" ("audit_id" bytea NOT NULL, "seq" int NOT NULL, "duration" int NOT NULL, "res_id" varchar(255) NOT NULL, "res_type" varchar(16) NOT NULL, "res_name" varchar(255) NOT NULL, "res_result" varchar(16) NULL, "res_initial_state" text NULL, "res_final_state" text NULL, "delta" text NULL, PRIMARY KEY ("audit_id", "seq"), CONSTRAINT "audit_id_fk" FOREIGN KEY ("audit_id") REFERENCES "node_audit")
I, [2012-04-26T15:42:23.440234 #13023]  INFO -- : (0.000161s) UPDATE "schema_info" SET "version" = 5
I, [2012-04-26T15:42:23.441449 #13023]  INFO -- : (0.001154s) COMMIT
I, [2012-04-26T15:42:23.441511 #13023]  INFO -- : Finished applying migration version 5, direction: up, took 0.012609 seconds
I, [2012-04-26T15:42:23.441545 #13023]  INFO -- : Begin applying migration version 6, direction: up
I, [2012-04-26T15:42:23.441723 #13023]  INFO -- : (0.000123s) BEGIN
I, [2012-04-26T15:42:23.446825 #13023]  INFO -- : (0.004756s) CREATE TABLE "data_bags" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, UNIQUE ("org_id", "name"))
I, [2012-04-26T15:42:23.447731 #13023]  INFO -- : (0.000754s) CREATE INDEX "data_bags_org_id_index" ON "data_bags" ("org_id")
I, [2012-04-26T15:42:23.448054 #13023]  INFO -- : (0.000186s) UPDATE "schema_info" SET "version" = 6
I, [2012-04-26T15:42:23.448584 #13023]  INFO -- : (0.000466s) COMMIT
I, [2012-04-26T15:42:23.448648 #13023]  INFO -- : Finished applying migration version 6, direction: up, took 0.007099 seconds
I, [2012-04-26T15:42:23.448684 #13023]  INFO -- : Begin applying migration version 7, direction: up
I, [2012-04-26T15:42:23.448858 #13023]  INFO -- : (0.000113s) BEGIN
I, [2012-04-26T15:42:23.452190 #13023]  INFO -- : (0.002960s) CREATE TABLE "data_bag_items" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "data_bag_name" text NOT NULL, "item_name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "data_bag_name", "item_name"))
I, [2012-04-26T15:42:23.453033 #13023]  INFO -- : (0.000696s) CREATE INDEX "data_bag_items_org_id_index" ON "data_bag_items" ("org_id")
I, [2012-04-26T15:42:23.453290 #13023]  INFO -- : (0.000169s) ALTER TABLE data_bag_items ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T15:42:23.453669 #13023]  INFO -- : (0.000202s) UPDATE "schema_info" SET "version" = 7
I, [2012-04-26T15:42:23.454292 #13023]  INFO -- : (0.000534s) COMMIT
I, [2012-04-26T15:42:23.454367 #13023]  INFO -- : Finished applying migration version 7, direction: up, took 0.005678 seconds
I, [2012-04-26T15:42:23.454403 #13023]  INFO -- : Begin applying migration version 8, direction: up
I, [2012-04-26T15:42:23.454564 #13023]  INFO -- : (0.000108s) BEGIN
I, [2012-04-26T15:42:23.459071 #13023]  INFO -- : (0.004072s) CREATE TABLE "environments" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T15:42:23.460157 #13023]  INFO -- : (0.000921s) CREATE INDEX "environments_org_id_index" ON "environments" ("org_id")
I, [2012-04-26T15:42:23.460446 #13023]  INFO -- : (0.000221s) ALTER TABLE environments ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T15:42:23.460830 #13023]  INFO -- : (0.000237s) UPDATE "schema_info" SET "version" = 8
I, [2012-04-26T15:42:23.461740 #13023]  INFO -- : (0.000846s) COMMIT
I, [2012-04-26T15:42:23.461805 #13023]  INFO -- : Finished applying migration version 8, direction: up, took 0.007397 seconds
I, [2012-04-26T15:42:23.461839 #13023]  INFO -- : Begin applying migration version 9, direction: up
I, [2012-04-26T15:42:23.461985 #13023]  INFO -- : (0.000094s) BEGIN
I, [2012-04-26T15:42:23.463631 #13023]  INFO -- : (0.001463s) ALTER TABLE "data_bag_items" ADD FOREIGN KEY ("org_id", "data_bag_name") REFERENCES "data_bags"("org_id", "name") ON DELETE CASCADE ON UPDATE CASCADE
I, [2012-04-26T15:42:23.463927 #13023]  INFO -- : (0.000172s) UPDATE "schema_info" SET "version" = 9
I, [2012-04-26T15:42:23.464565 #13023]  INFO -- : (0.000561s) COMMIT
I, [2012-04-26T15:42:23.464622 #13023]  INFO -- : Finished applying migration version 9, direction: up, took 0.002778 seconds
I, [2012-04-26T15:42:23.464654 #13023]  INFO -- : Begin applying migration version 10, direction: up
I, [2012-04-26T15:42:23.464826 #13023]  INFO -- : (0.000120s) BEGIN
I, [2012-04-26T15:42:23.465254 #13023]  INFO -- : (0.000307s) DROP INDEX "clients_org_id_index"
I, [2012-04-26T15:42:23.465503 #13023]  INFO -- : (0.000156s) DROP INDEX "environments_org_id_index"
I, [2012-04-26T15:42:23.465738 #13023]  INFO -- : (0.000148s) DROP INDEX "nodes_org_id_index"
I, [2012-04-26T15:42:23.466021 #13023]  INFO -- : (0.000192s) DROP INDEX "roles_org_id_index"
I, [2012-04-26T15:42:23.466439 #13023]  INFO -- : (0.000275s) DROP INDEX "data_bags_org_id_index"
I, [2012-04-26T15:42:23.466903 #13023]  INFO -- : (0.000279s) DROP INDEX "data_bag_items_org_id_index"
I, [2012-04-26T15:42:23.467269 #13023]  INFO -- : (0.000185s) UPDATE "schema_info" SET "version" = 10
I, [2012-04-26T15:42:23.468302 #13023]  INFO -- : (0.000952s) COMMIT
I, [2012-04-26T15:42:23.468368 #13023]  INFO -- : Finished applying migration version 10, direction: up, took 0.003709 seconds
I, [2012-04-26T15:42:23.468404 #13023]  INFO -- : Begin applying migration version 11, direction: up
I, [2012-04-26T15:42:23.468550 #13023]  INFO -- : (0.000093s) BEGIN
I, [2012-04-26T15:42:23.469022 #13023]  INFO -- : (0.000246s) ALTER TABLE "users" ADD COLUMN "external_authentication_uid" text NULL
I, [2012-04-26T15:42:23.469282 #13023]  INFO -- : (0.000199s) ALTER TABLE "users" ADD COLUMN "recovery_authentication_enabled" boolean NULL
I, [2012-04-26T15:42:23.469509 #13023]  INFO -- : (0.000168s) ALTER TABLE "users" ALTER COLUMN "email" DROP NOT NULL
I, [2012-04-26T15:42:23.469765 #13023]  INFO -- : (0.000136s) UPDATE "schema_info" SET "version" = 11
I, [2012-04-26T15:42:23.470525 #13023]  INFO -- : (0.000696s) COMMIT
I, [2012-04-26T15:42:23.470580 #13023]  INFO -- : Finished applying migration version 11, direction: up, took 0.002172 seconds
I, [2012-04-26T15:47:59.221269 #13215]  INFO -- : (0.000333s) SET standard_conforming_strings = ON
I, [2012-04-26T15:47:59.221578 #13215]  INFO -- : (0.000182s) SET client_min_messages = 'WARNING'
I, [2012-04-26T15:47:59.221813 #13215]  INFO -- : (0.000179s) SET DateStyle = 'ISO'
E, [2012-04-26T15:47:59.229487 #13215] ERROR -- : PG::Error: ERROR:  relation "schema_info" does not exist
LINE 1: SELECT NULL FROM "schema_info" LIMIT 1
                         ^: SELECT NULL FROM "schema_info" LIMIT 1
I, [2012-04-26T15:47:59.234516 #13215]  INFO -- : (0.004747s) CREATE TABLE "schema_info" ("version" integer DEFAULT 0 NOT NULL)
I, [2012-04-26T15:47:59.235413 #13215]  INFO -- : (0.000688s) SELECT 1 AS "one" FROM "schema_info" LIMIT 1
I, [2012-04-26T15:47:59.237415 #13215]  INFO -- : (0.001788s) SELECT pg_attribute.attname FROM pg_class, pg_attribute, pg_index, pg_namespace WHERE pg_class.oid = pg_attribute.attrelid AND pg_class.relnamespace = pg_namespace.oid AND pg_class.oid = pg_index.indrelid AND pg_index.indkey[0] = pg_attribute.attnum AND pg_index.indisprimary = 't' AND pg_class.relname = 'schema_info'
I, [2012-04-26T15:47:59.238861 #13215]  INFO -- : (0.001210s) INSERT INTO "schema_info" ("version") VALUES (0) RETURNING NULL
I, [2012-04-26T15:47:59.239515 #13215]  INFO -- : (0.000409s) SELECT COUNT(*) AS "count" FROM "schema_info" LIMIT 1
I, [2012-04-26T15:47:59.239887 #13215]  INFO -- : (0.000191s) SELECT "version" FROM "schema_info" LIMIT 1
I, [2012-04-26T15:47:59.256287 #13215]  INFO -- : Begin applying migration version 1, direction: up
I, [2012-04-26T15:47:59.256551 #13215]  INFO -- : (0.000153s) BEGIN
I, [2012-04-26T15:47:59.262232 #13215]  INFO -- : (0.005284s) CREATE TABLE "users" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "username" text NOT NULL UNIQUE, "email" text NOT NULL UNIQUE, "pubkey_version" integer NOT NULL, "public_key" text, "serialized_object" text, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-04-26T15:47:59.262627 #13215]  INFO -- : (0.000214s) UPDATE "schema_info" SET "version" = 1
I, [2012-04-26T15:47:59.263474 #13215]  INFO -- : (0.000782s) COMMIT
I, [2012-04-26T15:47:59.263558 #13215]  INFO -- : Finished applying migration version 1, direction: up, took 0.007273 seconds
I, [2012-04-26T15:47:59.263592 #13215]  INFO -- : Begin applying migration version 2, direction: up
I, [2012-04-26T15:47:59.263781 #13215]  INFO -- : (0.000137s) BEGIN
I, [2012-04-26T15:47:59.268479 #13215]  INFO -- : (0.004305s) CREATE TABLE "nodes" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "environment" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" text, UNIQUE ("org_id", "name"))
I, [2012-04-26T15:47:59.269561 #13215]  INFO -- : (0.000853s) CREATE INDEX "nodes_org_id_index" ON "nodes" ("org_id")
I, [2012-04-26T15:47:59.270414 #13215]  INFO -- : (0.000691s) CREATE INDEX "nodes_org_id_environment_index" ON "nodes" ("org_id", "environment")
I, [2012-04-26T15:47:59.270781 #13215]  INFO -- : (0.000208s) UPDATE "schema_info" SET "version" = 2
I, [2012-04-26T15:47:59.272274 #13215]  INFO -- : (0.001431s) COMMIT
I, [2012-04-26T15:47:59.272337 #13215]  INFO -- : Finished applying migration version 2, direction: up, took 0.008739 seconds
I, [2012-04-26T15:47:59.272371 #13215]  INFO -- : Begin applying migration version 3, direction: up
I, [2012-04-26T15:47:59.272667 #13215]  INFO -- : (0.000242s) BEGIN
I, [2012-04-26T15:47:59.276261 #13215]  INFO -- : (0.003177s) CREATE TABLE "clients" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, "name" text NOT NULL, "public_key" text, "validator" boolean NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "pubkey_version" smallint NOT NULL, CONSTRAINT "org_id_name_unique" UNIQUE ("org_id", "name"))
I, [2012-04-26T15:47:59.277064 #13215]  INFO -- : (0.000654s) CREATE INDEX "clients_org_id_index" ON "clients" ("org_id")
I, [2012-04-26T15:47:59.277480 #13215]  INFO -- : (0.000228s) UPDATE "schema_info" SET "version" = 3
I, [2012-04-26T15:47:59.278107 #13215]  INFO -- : (0.000545s) COMMIT
I, [2012-04-26T15:47:59.278188 #13215]  INFO -- : Finished applying migration version 3, direction: up, took 0.005812 seconds
I, [2012-04-26T15:47:59.278226 #13215]  INFO -- : Begin applying migration version 4, direction: up
I, [2012-04-26T15:47:59.278471 #13215]  INFO -- : (0.000162s) BEGIN
I, [2012-04-26T15:47:59.283211 #13215]  INFO -- : (0.004178s) CREATE TABLE "roles" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T15:47:59.284067 #13215]  INFO -- : (0.000635s) CREATE INDEX "roles_org_id_index" ON "roles" ("org_id")
I, [2012-04-26T15:47:59.284291 #13215]  INFO -- : (0.000155s) ALTER TABLE roles ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T15:47:59.284584 #13215]  INFO -- : (0.000148s) UPDATE "schema_info" SET "version" = 4
I, [2012-04-26T15:47:59.285212 #13215]  INFO -- : (0.000572s) COMMIT
I, [2012-04-26T15:47:59.285268 #13215]  INFO -- : Finished applying migration version 4, direction: up, took 0.007039 seconds
I, [2012-04-26T15:47:59.285302 #13215]  INFO -- : Begin applying migration version 5, direction: up
I, [2012-04-26T15:47:59.285456 #13215]  INFO -- : (0.000102s) BEGIN
I, [2012-04-26T15:47:59.285886 #13215]  INFO -- : (0.000275s) ALTER TABLE "nodes" ADD COLUMN "last_audit_id" bytea
I, [2012-04-26T15:47:59.290242 #13215]  INFO -- : (0.004041s) CREATE TABLE "node_audit" ("audit_id" bytea NOT NULL, "node_id" char(32), "status" varchar(16), "start_time" timestamp NOT NULL, "end_time" timestamp NULL, "event_data" text NULL, PRIMARY KEY ("audit_id"), CONSTRAINT "node_id_fk" FOREIGN KEY ("node_id") REFERENCES "nodes")
I, [2012-04-26T15:47:59.291248 #13215]  INFO -- : (0.000828s) CREATE INDEX "node_audit_node_id_index" ON "node_audit" ("node_id")
I, [2012-04-26T15:47:59.295733 #13215]  INFO -- : (0.003799s) CREATE TABLE "node_audit_detail" ("audit_id" bytea NOT NULL, "seq" int NOT NULL, "duration" int NOT NULL, "res_id" varchar(255) NOT NULL, "res_type" varchar(16) NOT NULL, "res_name" varchar(255) NOT NULL, "res_result" varchar(16) NULL, "res_initial_state" text NULL, "res_final_state" text NULL, "delta" text NULL, PRIMARY KEY ("audit_id", "seq"), CONSTRAINT "audit_id_fk" FOREIGN KEY ("audit_id") REFERENCES "node_audit")
I, [2012-04-26T15:47:59.296154 #13215]  INFO -- : (0.000209s) UPDATE "schema_info" SET "version" = 5
I, [2012-04-26T15:47:59.297361 #13215]  INFO -- : (0.001137s) COMMIT
I, [2012-04-26T15:47:59.297422 #13215]  INFO -- : Finished applying migration version 5, direction: up, took 0.012116 seconds
I, [2012-04-26T15:47:59.297457 #13215]  INFO -- : Begin applying migration version 6, direction: up
I, [2012-04-26T15:47:59.297642 #13215]  INFO -- : (0.000129s) BEGIN
I, [2012-04-26T15:47:59.301775 #13215]  INFO -- : (0.003784s) CREATE TABLE "data_bags" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, UNIQUE ("org_id", "name"))
I, [2012-04-26T15:47:59.302800 #13215]  INFO -- : (0.000820s) CREATE INDEX "data_bags_org_id_index" ON "data_bags" ("org_id")
I, [2012-04-26T15:47:59.303198 #13215]  INFO -- : (0.000244s) UPDATE "schema_info" SET "version" = 6
I, [2012-04-26T15:47:59.303976 #13215]  INFO -- : (0.000695s) COMMIT
I, [2012-04-26T15:47:59.304073 #13215]  INFO -- : Finished applying migration version 6, direction: up, took 0.006604 seconds
I, [2012-04-26T15:47:59.304116 #13215]  INFO -- : Begin applying migration version 7, direction: up
I, [2012-04-26T15:47:59.304328 #13215]  INFO -- : (0.000130s) BEGIN
I, [2012-04-26T15:47:59.307899 #13215]  INFO -- : (0.003175s) CREATE TABLE "data_bag_items" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "data_bag_name" text NOT NULL, "item_name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "data_bag_name", "item_name"))
I, [2012-04-26T15:47:59.308774 #13215]  INFO -- : (0.000718s) CREATE INDEX "data_bag_items_org_id_index" ON "data_bag_items" ("org_id")
I, [2012-04-26T15:47:59.309044 #13215]  INFO -- : (0.000199s) ALTER TABLE data_bag_items ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T15:47:59.309339 #13215]  INFO -- : (0.000172s) UPDATE "schema_info" SET "version" = 7
I, [2012-04-26T15:47:59.309921 #13215]  INFO -- : (0.000527s) COMMIT
I, [2012-04-26T15:47:59.309986 #13215]  INFO -- : Finished applying migration version 7, direction: up, took 0.005865 seconds
I, [2012-04-26T15:47:59.310020 #13215]  INFO -- : Begin applying migration version 8, direction: up
I, [2012-04-26T15:47:59.310287 #13215]  INFO -- : (0.000212s) BEGIN
I, [2012-04-26T15:47:59.315297 #13215]  INFO -- : (0.004629s) CREATE TABLE "environments" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T15:47:59.316312 #13215]  INFO -- : (0.000752s) CREATE INDEX "environments_org_id_index" ON "environments" ("org_id")
I, [2012-04-26T15:47:59.316618 #13215]  INFO -- : (0.000198s) ALTER TABLE environments ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T15:47:59.316957 #13215]  INFO -- : (0.000159s) UPDATE "schema_info" SET "version" = 8
I, [2012-04-26T15:47:59.317614 #13215]  INFO -- : (0.000593s) COMMIT
I, [2012-04-26T15:47:59.317680 #13215]  INFO -- : Finished applying migration version 8, direction: up, took 0.007654 seconds
I, [2012-04-26T15:47:59.317715 #13215]  INFO -- : Begin applying migration version 9, direction: up
I, [2012-04-26T15:47:59.317919 #13215]  INFO -- : (0.000142s) BEGIN
I, [2012-04-26T15:47:59.319623 #13215]  INFO -- : (0.001487s) ALTER TABLE "data_bag_items" ADD FOREIGN KEY ("org_id", "data_bag_name") REFERENCES "data_bags"("org_id", "name") ON DELETE CASCADE ON UPDATE CASCADE
I, [2012-04-26T15:47:59.320034 #13215]  INFO -- : (0.000259s) UPDATE "schema_info" SET "version" = 9
I, [2012-04-26T15:47:59.320781 #13215]  INFO -- : (0.000688s) COMMIT
I, [2012-04-26T15:47:59.320835 #13215]  INFO -- : Finished applying migration version 9, direction: up, took 0.003115 seconds
I, [2012-04-26T15:47:59.320868 #13215]  INFO -- : Begin applying migration version 10, direction: up
I, [2012-04-26T15:47:59.321009 #13215]  INFO -- : (0.000092s) BEGIN
I, [2012-04-26T15:47:59.321448 #13215]  INFO -- : (0.000324s) DROP INDEX "clients_org_id_index"
I, [2012-04-26T15:47:59.321696 #13215]  INFO -- : (0.000155s) DROP INDEX "environments_org_id_index"
I, [2012-04-26T15:47:59.322089 #13215]  INFO -- : (0.000291s) DROP INDEX "nodes_org_id_index"
I, [2012-04-26T15:47:59.322526 #13215]  INFO -- : (0.000267s) DROP INDEX "roles_org_id_index"
I, [2012-04-26T15:47:59.322963 #13215]  INFO -- : (0.000292s) DROP INDEX "data_bags_org_id_index"
I, [2012-04-26T15:47:59.323374 #13215]  INFO -- : (0.000294s) DROP INDEX "data_bag_items_org_id_index"
I, [2012-04-26T15:47:59.323743 #13215]  INFO -- : (0.000188s) UPDATE "schema_info" SET "version" = 10
I, [2012-04-26T15:47:59.324667 #13215]  INFO -- : (0.000844s) COMMIT
I, [2012-04-26T15:47:59.324756 #13215]  INFO -- : Finished applying migration version 10, direction: up, took 0.003876 seconds
I, [2012-04-26T15:47:59.324816 #13215]  INFO -- : Begin applying migration version 11, direction: up
I, [2012-04-26T15:47:59.325026 #13215]  INFO -- : (0.000129s) BEGIN
I, [2012-04-26T15:47:59.325563 #13215]  INFO -- : (0.000238s) ALTER TABLE "users" ADD COLUMN "external_authentication_uid" text NULL
I, [2012-04-26T15:47:59.325859 #13215]  INFO -- : (0.000239s) ALTER TABLE "users" ADD COLUMN "recovery_authentication_enabled" boolean NULL
I, [2012-04-26T15:47:59.326065 #13215]  INFO -- : (0.000157s) ALTER TABLE "users" ALTER COLUMN "email" DROP NOT NULL
I, [2012-04-26T15:47:59.326303 #13215]  INFO -- : (0.000130s) UPDATE "schema_info" SET "version" = 11
I, [2012-04-26T15:47:59.326859 #13215]  INFO -- : (0.000504s) COMMIT
I, [2012-04-26T15:47:59.326907 #13215]  INFO -- : Finished applying migration version 11, direction: up, took 0.002092 seconds
I, [2012-04-26T15:48:56.701282 #13395]  INFO -- : (0.000317s) SET standard_conforming_strings = ON
I, [2012-04-26T15:48:56.701510 #13395]  INFO -- : (0.000097s) SET client_min_messages = 'WARNING'
I, [2012-04-26T15:48:56.701672 #13395]  INFO -- : (0.000114s) SET DateStyle = 'ISO'
E, [2012-04-26T15:48:56.709583 #13395] ERROR -- : PG::Error: ERROR:  relation "schema_info" does not exist
LINE 1: SELECT NULL FROM "schema_info" LIMIT 1
                         ^: SELECT NULL FROM "schema_info" LIMIT 1
I, [2012-04-26T15:48:56.714416 #13395]  INFO -- : (0.004558s) CREATE TABLE "schema_info" ("version" integer DEFAULT 0 NOT NULL)
I, [2012-04-26T15:48:56.715174 #13395]  INFO -- : (0.000525s) SELECT 1 AS "one" FROM "schema_info" LIMIT 1
I, [2012-04-26T15:48:56.717682 #13395]  INFO -- : (0.002282s) SELECT pg_attribute.attname FROM pg_class, pg_attribute, pg_index, pg_namespace WHERE pg_class.oid = pg_attribute.attrelid AND pg_class.relnamespace = pg_namespace.oid AND pg_class.oid = pg_index.indrelid AND pg_index.indkey[0] = pg_attribute.attnum AND pg_index.indisprimary = 't' AND pg_class.relname = 'schema_info'
I, [2012-04-26T15:48:56.718647 #13395]  INFO -- : (0.000726s) INSERT INTO "schema_info" ("version") VALUES (0) RETURNING NULL
I, [2012-04-26T15:48:56.719351 #13395]  INFO -- : (0.000438s) SELECT COUNT(*) AS "count" FROM "schema_info" LIMIT 1
I, [2012-04-26T15:48:56.719799 #13395]  INFO -- : (0.000232s) SELECT "version" FROM "schema_info" LIMIT 1
I, [2012-04-26T15:48:56.736017 #13395]  INFO -- : Begin applying migration version 1, direction: up
I, [2012-04-26T15:48:56.736405 #13395]  INFO -- : (0.000258s) BEGIN
I, [2012-04-26T15:48:56.741931 #13395]  INFO -- : (0.005121s) CREATE TABLE "users" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "username" text NOT NULL UNIQUE, "email" text NOT NULL UNIQUE, "pubkey_version" integer NOT NULL, "public_key" text, "serialized_object" text, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-04-26T15:48:56.742389 #13395]  INFO -- : (0.000256s) UPDATE "schema_info" SET "version" = 1
I, [2012-04-26T15:48:56.743091 #13395]  INFO -- : (0.000643s) COMMIT
I, [2012-04-26T15:48:56.743151 #13395]  INFO -- : Finished applying migration version 1, direction: up, took 0.007139 seconds
I, [2012-04-26T15:48:56.743186 #13395]  INFO -- : Begin applying migration version 2, direction: up
I, [2012-04-26T15:48:56.743340 #13395]  INFO -- : (0.000096s) BEGIN
I, [2012-04-26T15:48:56.747759 #13395]  INFO -- : (0.004009s) CREATE TABLE "nodes" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "environment" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" text, UNIQUE ("org_id", "name"))
I, [2012-04-26T15:48:56.749085 #13395]  INFO -- : (0.001072s) CREATE INDEX "nodes_org_id_index" ON "nodes" ("org_id")
I, [2012-04-26T15:48:56.750063 #13395]  INFO -- : (0.000795s) CREATE INDEX "nodes_org_id_environment_index" ON "nodes" ("org_id", "environment")
I, [2012-04-26T15:48:56.750411 #13395]  INFO -- : (0.000192s) UPDATE "schema_info" SET "version" = 2
I, [2012-04-26T15:48:56.751269 #13395]  INFO -- : (0.000772s) COMMIT
I, [2012-04-26T15:48:56.751374 #13395]  INFO -- : Finished applying migration version 2, direction: up, took 0.008178 seconds
I, [2012-04-26T15:48:56.751437 #13395]  INFO -- : Begin applying migration version 3, direction: up
I, [2012-04-26T15:48:56.751682 #13395]  INFO -- : (0.000161s) BEGIN
I, [2012-04-26T15:48:56.755642 #13395]  INFO -- : (0.003531s) CREATE TABLE "clients" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, "name" text NOT NULL, "public_key" text, "validator" boolean NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "pubkey_version" smallint NOT NULL, CONSTRAINT "org_id_name_unique" UNIQUE ("org_id", "name"))
I, [2012-04-26T15:48:56.756506 #13395]  INFO -- : (0.000705s) CREATE INDEX "clients_org_id_index" ON "clients" ("org_id")
I, [2012-04-26T15:48:56.756800 #13395]  INFO -- : (0.000152s) UPDATE "schema_info" SET "version" = 3
I, [2012-04-26T15:48:56.757310 #13395]  INFO -- : (0.000457s) COMMIT
I, [2012-04-26T15:48:56.757363 #13395]  INFO -- : Finished applying migration version 3, direction: up, took 0.005927 seconds
I, [2012-04-26T15:48:56.757395 #13395]  INFO -- : Begin applying migration version 4, direction: up
I, [2012-04-26T15:48:56.757534 #13395]  INFO -- : (0.000088s) BEGIN
I, [2012-04-26T15:48:56.762643 #13395]  INFO -- : (0.004742s) CREATE TABLE "roles" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T15:48:56.764166 #13395]  INFO -- : (0.001285s) CREATE INDEX "roles_org_id_index" ON "roles" ("org_id")
I, [2012-04-26T15:48:56.764576 #13395]  INFO -- : (0.000275s) ALTER TABLE roles ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T15:48:56.764915 #13395]  INFO -- : (0.000186s) UPDATE "schema_info" SET "version" = 4
I, [2012-04-26T15:48:56.765679 #13395]  INFO -- : (0.000686s) COMMIT
I, [2012-04-26T15:48:56.765743 #13395]  INFO -- : Finished applying migration version 4, direction: up, took 0.008343 seconds
I, [2012-04-26T15:48:56.765779 #13395]  INFO -- : Begin applying migration version 5, direction: up
I, [2012-04-26T15:48:56.765938 #13395]  INFO -- : (0.000105s) BEGIN
I, [2012-04-26T15:48:56.766309 #13395]  INFO -- : (0.000208s) ALTER TABLE "nodes" ADD COLUMN "last_audit_id" bytea
I, [2012-04-26T15:48:56.771444 #13395]  INFO -- : (0.004806s) CREATE TABLE "node_audit" ("audit_id" bytea NOT NULL, "node_id" char(32), "status" varchar(16), "start_time" timestamp NOT NULL, "end_time" timestamp NULL, "event_data" text NULL, PRIMARY KEY ("audit_id"), CONSTRAINT "node_id_fk" FOREIGN KEY ("node_id") REFERENCES "nodes")
I, [2012-04-26T15:48:56.772590 #13395]  INFO -- : (0.000946s) CREATE INDEX "node_audit_node_id_index" ON "node_audit" ("node_id")
I, [2012-04-26T15:48:56.776681 #13395]  INFO -- : (0.003356s) CREATE TABLE "node_audit_detail" ("audit_id" bytea NOT NULL, "seq" int NOT NULL, "duration" int NOT NULL, "res_id" varchar(255) NOT NULL, "res_type" varchar(16) NOT NULL, "res_name" varchar(255) NOT NULL, "res_result" varchar(16) NULL, "res_initial_state" text NULL, "res_final_state" text NULL, "delta" text NULL, PRIMARY KEY ("audit_id", "seq"), CONSTRAINT "audit_id_fk" FOREIGN KEY ("audit_id") REFERENCES "node_audit")
I, [2012-04-26T15:48:56.777033 #13395]  INFO -- : (0.000171s) UPDATE "schema_info" SET "version" = 5
I, [2012-04-26T15:48:56.778038 #13395]  INFO -- : (0.000937s) COMMIT
I, [2012-04-26T15:48:56.778105 #13395]  INFO -- : Finished applying migration version 5, direction: up, took 0.012321 seconds
I, [2012-04-26T15:48:56.778139 #13395]  INFO -- : Begin applying migration version 6, direction: up
I, [2012-04-26T15:48:56.778318 #13395]  INFO -- : (0.000124s) BEGIN
I, [2012-04-26T15:48:56.783390 #13395]  INFO -- : (0.004721s) CREATE TABLE "data_bags" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, UNIQUE ("org_id", "name"))
I, [2012-04-26T15:48:56.784752 #13395]  INFO -- : (0.001124s) CREATE INDEX "data_bags_org_id_index" ON "data_bags" ("org_id")
I, [2012-04-26T15:48:56.785118 #13395]  INFO -- : (0.000193s) UPDATE "schema_info" SET "version" = 6
I, [2012-04-26T15:48:56.786018 #13395]  INFO -- : (0.000820s) COMMIT
I, [2012-04-26T15:48:56.786122 #13395]  INFO -- : Finished applying migration version 6, direction: up, took 0.007972 seconds
I, [2012-04-26T15:48:56.786185 #13395]  INFO -- : Begin applying migration version 7, direction: up
I, [2012-04-26T15:48:56.786395 #13395]  INFO -- : (0.000135s) BEGIN
I, [2012-04-26T15:48:56.790135 #13395]  INFO -- : (0.003109s) CREATE TABLE "data_bag_items" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "data_bag_name" text NOT NULL, "item_name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "data_bag_name", "item_name"))
I, [2012-04-26T15:48:56.791378 #13395]  INFO -- : (0.001033s) CREATE INDEX "data_bag_items_org_id_index" ON "data_bag_items" ("org_id")
I, [2012-04-26T15:48:56.791726 #13395]  INFO -- : (0.000233s) ALTER TABLE data_bag_items ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T15:48:56.792115 #13395]  INFO -- : (0.000209s) UPDATE "schema_info" SET "version" = 7
I, [2012-04-26T15:48:56.792873 #13395]  INFO -- : (0.000645s) COMMIT
I, [2012-04-26T15:48:56.792953 #13395]  INFO -- : Finished applying migration version 7, direction: up, took 0.006767 seconds
I, [2012-04-26T15:48:56.793008 #13395]  INFO -- : Begin applying migration version 8, direction: up
I, [2012-04-26T15:48:56.793211 #13395]  INFO -- : (0.000131s) BEGIN
I, [2012-04-26T15:48:56.797795 #13395]  INFO -- : (0.004193s) CREATE TABLE "environments" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T15:48:56.798653 #13395]  INFO -- : (0.000693s) CREATE INDEX "environments_org_id_index" ON "environments" ("org_id")
I, [2012-04-26T15:48:56.798897 #13395]  INFO -- : (0.000174s) ALTER TABLE environments ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T15:48:56.799180 #13395]  INFO -- : (0.000154s) UPDATE "schema_info" SET "version" = 8
I, [2012-04-26T15:48:56.799874 #13395]  INFO -- : (0.000634s) COMMIT
I, [2012-04-26T15:48:56.799938 #13395]  INFO -- : Finished applying migration version 8, direction: up, took 0.006931 seconds
I, [2012-04-26T15:48:56.799974 #13395]  INFO -- : Begin applying migration version 9, direction: up
I, [2012-04-26T15:48:56.800165 #13395]  INFO -- : (0.000137s) BEGIN
I, [2012-04-26T15:48:56.802717 #13395]  INFO -- : (0.002356s) ALTER TABLE "data_bag_items" ADD FOREIGN KEY ("org_id", "data_bag_name") REFERENCES "data_bags"("org_id", "name") ON DELETE CASCADE ON UPDATE CASCADE
I, [2012-04-26T15:48:56.803137 #13395]  INFO -- : (0.000207s) UPDATE "schema_info" SET "version" = 9
I, [2012-04-26T15:48:56.803945 #13395]  INFO -- : (0.000713s) COMMIT
I, [2012-04-26T15:48:56.804018 #13395]  INFO -- : Finished applying migration version 9, direction: up, took 0.004039 seconds
I, [2012-04-26T15:48:56.804055 #13395]  INFO -- : Begin applying migration version 10, direction: up
I, [2012-04-26T15:48:56.804262 #13395]  INFO -- : (0.000127s) BEGIN
I, [2012-04-26T15:48:56.804861 #13395]  INFO -- : (0.000411s) DROP INDEX "clients_org_id_index"
I, [2012-04-26T15:48:56.805228 #13395]  INFO -- : (0.000229s) DROP INDEX "environments_org_id_index"
I, [2012-04-26T15:48:56.805639 #13395]  INFO -- : (0.000289s) DROP INDEX "nodes_org_id_index"
I, [2012-04-26T15:48:56.805985 #13395]  INFO -- : (0.000190s) DROP INDEX "roles_org_id_index"
I, [2012-04-26T15:48:56.806254 #13395]  INFO -- : (0.000162s) DROP INDEX "data_bags_org_id_index"
I, [2012-04-26T15:48:56.806532 #13395]  INFO -- : (0.000172s) DROP INDEX "data_bag_items_org_id_index"
I, [2012-04-26T15:48:56.806802 #13395]  INFO -- : (0.000149s) UPDATE "schema_info" SET "version" = 10
I, [2012-04-26T15:48:56.807680 #13395]  INFO -- : (0.000821s) COMMIT
I, [2012-04-26T15:48:56.807741 #13395]  INFO -- : Finished applying migration version 10, direction: up, took 0.003683 seconds
I, [2012-04-26T15:48:56.807776 #13395]  INFO -- : Begin applying migration version 11, direction: up
I, [2012-04-26T15:48:56.807946 #13395]  INFO -- : (0.000119s) BEGIN
I, [2012-04-26T15:48:56.808363 #13395]  INFO -- : (0.000215s) ALTER TABLE "users" ADD COLUMN "external_authentication_uid" text NULL
I, [2012-04-26T15:48:56.808611 #13395]  INFO -- : (0.000190s) ALTER TABLE "users" ADD COLUMN "recovery_authentication_enabled" boolean NULL
I, [2012-04-26T15:48:56.808813 #13395]  INFO -- : (0.000148s) ALTER TABLE "users" ALTER COLUMN "email" DROP NOT NULL
I, [2012-04-26T15:48:56.809056 #13395]  INFO -- : (0.000132s) UPDATE "schema_info" SET "version" = 11
I, [2012-04-26T15:48:56.809936 #13395]  INFO -- : (0.000823s) COMMIT
I, [2012-04-26T15:48:56.809990 #13395]  INFO -- : Finished applying migration version 11, direction: up, took 0.002211 seconds
I, [2012-04-26T15:50:13.489477 #13567]  INFO -- : (0.000362s) SET standard_conforming_strings = ON
I, [2012-04-26T15:50:13.489712 #13567]  INFO -- : (0.000101s) SET client_min_messages = 'WARNING'
I, [2012-04-26T15:50:13.489914 #13567]  INFO -- : (0.000139s) SET DateStyle = 'ISO'
E, [2012-04-26T15:50:13.497700 #13567] ERROR -- : PG::Error: ERROR:  relation "schema_info" does not exist
LINE 1: SELECT NULL FROM "schema_info" LIMIT 1
                         ^: SELECT NULL FROM "schema_info" LIMIT 1
I, [2012-04-26T15:50:13.503025 #13567]  INFO -- : (0.005049s) CREATE TABLE "schema_info" ("version" integer DEFAULT 0 NOT NULL)
I, [2012-04-26T15:50:13.503789 #13567]  INFO -- : (0.000578s) SELECT 1 AS "one" FROM "schema_info" LIMIT 1
I, [2012-04-26T15:50:13.505848 #13567]  INFO -- : (0.001861s) SELECT pg_attribute.attname FROM pg_class, pg_attribute, pg_index, pg_namespace WHERE pg_class.oid = pg_attribute.attrelid AND pg_class.relnamespace = pg_namespace.oid AND pg_class.oid = pg_index.indrelid AND pg_index.indkey[0] = pg_attribute.attnum AND pg_index.indisprimary = 't' AND pg_class.relname = 'schema_info'
I, [2012-04-26T15:50:13.506863 #13567]  INFO -- : (0.000823s) INSERT INTO "schema_info" ("version") VALUES (0) RETURNING NULL
I, [2012-04-26T15:50:13.507488 #13567]  INFO -- : (0.000374s) SELECT COUNT(*) AS "count" FROM "schema_info" LIMIT 1
I, [2012-04-26T15:50:13.507971 #13567]  INFO -- : (0.000275s) SELECT "version" FROM "schema_info" LIMIT 1
I, [2012-04-26T15:50:13.524093 #13567]  INFO -- : Begin applying migration version 1, direction: up
I, [2012-04-26T15:50:13.524387 #13567]  INFO -- : (0.000182s) BEGIN
I, [2012-04-26T15:50:13.529787 #13567]  INFO -- : (0.005010s) CREATE TABLE "users" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "username" text NOT NULL UNIQUE, "email" text NOT NULL UNIQUE, "pubkey_version" integer NOT NULL, "public_key" text, "serialized_object" text, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-04-26T15:50:13.530224 #13567]  INFO -- : (0.000257s) UPDATE "schema_info" SET "version" = 1
I, [2012-04-26T15:50:13.531322 #13567]  INFO -- : (0.000993s) COMMIT
I, [2012-04-26T15:50:13.531563 #13567]  INFO -- : Finished applying migration version 1, direction: up, took 0.007430 seconds
I, [2012-04-26T15:50:13.531658 #13567]  INFO -- : Begin applying migration version 2, direction: up
I, [2012-04-26T15:50:13.531980 #13567]  INFO -- : (0.000222s) BEGIN
I, [2012-04-26T15:50:13.536437 #13567]  INFO -- : (0.004058s) CREATE TABLE "nodes" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "environment" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" text, UNIQUE ("org_id", "name"))
I, [2012-04-26T15:50:13.537306 #13567]  INFO -- : (0.000670s) CREATE INDEX "nodes_org_id_index" ON "nodes" ("org_id")
I, [2012-04-26T15:50:13.538128 #13567]  INFO -- : (0.000674s) CREATE INDEX "nodes_org_id_environment_index" ON "nodes" ("org_id", "environment")
I, [2012-04-26T15:50:13.538514 #13567]  INFO -- : (0.000186s) UPDATE "schema_info" SET "version" = 2
I, [2012-04-26T15:50:13.539125 #13567]  INFO -- : (0.000548s) COMMIT
I, [2012-04-26T15:50:13.539198 #13567]  INFO -- : Finished applying migration version 2, direction: up, took 0.007542 seconds
I, [2012-04-26T15:50:13.539237 #13567]  INFO -- : Begin applying migration version 3, direction: up
I, [2012-04-26T15:50:13.539404 #13567]  INFO -- : (0.000107s) BEGIN
I, [2012-04-26T15:50:13.542950 #13567]  INFO -- : (0.003111s) CREATE TABLE "clients" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, "name" text NOT NULL, "public_key" text, "validator" boolean NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "pubkey_version" smallint NOT NULL, CONSTRAINT "org_id_name_unique" UNIQUE ("org_id", "name"))
I, [2012-04-26T15:50:13.544206 #13567]  INFO -- : (0.001068s) CREATE INDEX "clients_org_id_index" ON "clients" ("org_id")
I, [2012-04-26T15:50:13.544641 #13567]  INFO -- : (0.000243s) UPDATE "schema_info" SET "version" = 3
I, [2012-04-26T15:50:13.545499 #13567]  INFO -- : (0.000758s) COMMIT
I, [2012-04-26T15:50:13.545591 #13567]  INFO -- : Finished applying migration version 3, direction: up, took 0.006343 seconds
I, [2012-04-26T15:50:13.545650 #13567]  INFO -- : Begin applying migration version 4, direction: up
I, [2012-04-26T15:50:13.545837 #13567]  INFO -- : (0.000121s) BEGIN
I, [2012-04-26T15:50:13.550480 #13567]  INFO -- : (0.004172s) CREATE TABLE "roles" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T15:50:13.551248 #13567]  INFO -- : (0.000612s) CREATE INDEX "roles_org_id_index" ON "roles" ("org_id")
I, [2012-04-26T15:50:13.551466 #13567]  INFO -- : (0.000155s) ALTER TABLE roles ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T15:50:13.551738 #13567]  INFO -- : (0.000146s) UPDATE "schema_info" SET "version" = 4
I, [2012-04-26T15:50:13.552418 #13567]  INFO -- : (0.000621s) COMMIT
I, [2012-04-26T15:50:13.552484 #13567]  INFO -- : Finished applying migration version 4, direction: up, took 0.006835 seconds
I, [2012-04-26T15:50:13.552517 #13567]  INFO -- : Begin applying migration version 5, direction: up
I, [2012-04-26T15:50:13.552750 #13567]  INFO -- : (0.000176s) BEGIN
I, [2012-04-26T15:50:13.553125 #13567]  INFO -- : (0.000208s) ALTER TABLE "nodes" ADD COLUMN "last_audit_id" bytea
I, [2012-04-26T15:50:13.557428 #13567]  INFO -- : (0.003964s) CREATE TABLE "node_audit" ("audit_id" bytea NOT NULL, "node_id" char(32), "status" varchar(16), "start_time" timestamp NOT NULL, "end_time" timestamp NULL, "event_data" text NULL, PRIMARY KEY ("audit_id"), CONSTRAINT "node_id_fk" FOREIGN KEY ("node_id") REFERENCES "nodes")
I, [2012-04-26T15:50:13.558570 #13567]  INFO -- : (0.000911s) CREATE INDEX "node_audit_node_id_index" ON "node_audit" ("node_id")
I, [2012-04-26T15:50:13.563316 #13567]  INFO -- : (0.003971s) CREATE TABLE "node_audit_detail" ("audit_id" bytea NOT NULL, "seq" int NOT NULL, "duration" int NOT NULL, "res_id" varchar(255) NOT NULL, "res_type" varchar(16) NOT NULL, "res_name" varchar(255) NOT NULL, "res_result" varchar(16) NULL, "res_initial_state" text NULL, "res_final_state" text NULL, "delta" text NULL, PRIMARY KEY ("audit_id", "seq"), CONSTRAINT "audit_id_fk" FOREIGN KEY ("audit_id") REFERENCES "node_audit")
I, [2012-04-26T15:50:13.563737 #13567]  INFO -- : (0.000194s) UPDATE "schema_info" SET "version" = 5
I, [2012-04-26T15:50:13.564768 #13567]  INFO -- : (0.000951s) COMMIT
I, [2012-04-26T15:50:13.564857 #13567]  INFO -- : Finished applying migration version 5, direction: up, took 0.012332 seconds
I, [2012-04-26T15:50:13.564897 #13567]  INFO -- : Begin applying migration version 6, direction: up
I, [2012-04-26T15:50:13.565120 #13567]  INFO -- : (0.000161s) BEGIN
I, [2012-04-26T15:50:13.569305 #13567]  INFO -- : (0.003646s) CREATE TABLE "data_bags" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, UNIQUE ("org_id", "name"))
I, [2012-04-26T15:50:13.570713 #13567]  INFO -- : (0.001196s) CREATE INDEX "data_bags_org_id_index" ON "data_bags" ("org_id")
I, [2012-04-26T15:50:13.571150 #13567]  INFO -- : (0.000233s) UPDATE "schema_info" SET "version" = 6
I, [2012-04-26T15:50:13.572509 #13567]  INFO -- : (0.001259s) COMMIT
I, [2012-04-26T15:50:13.572609 #13567]  INFO -- : Finished applying migration version 6, direction: up, took 0.007703 seconds
I, [2012-04-26T15:50:13.572660 #13567]  INFO -- : Begin applying migration version 7, direction: up
I, [2012-04-26T15:50:13.572879 #13567]  INFO -- : (0.000142s) BEGIN
I, [2012-04-26T15:50:13.576567 #13567]  INFO -- : (0.003239s) CREATE TABLE "data_bag_items" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "data_bag_name" text NOT NULL, "item_name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "data_bag_name", "item_name"))
I, [2012-04-26T15:50:13.577347 #13567]  INFO -- : (0.000605s) CREATE INDEX "data_bag_items_org_id_index" ON "data_bag_items" ("org_id")
I, [2012-04-26T15:50:13.577638 #13567]  INFO -- : (0.000220s) ALTER TABLE data_bag_items ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T15:50:13.578011 #13567]  INFO -- : (0.000208s) UPDATE "schema_info" SET "version" = 7
I, [2012-04-26T15:50:13.578831 #13567]  INFO -- : (0.000749s) COMMIT
I, [2012-04-26T15:50:13.578921 #13567]  INFO -- : Finished applying migration version 7, direction: up, took 0.006253 seconds
I, [2012-04-26T15:50:13.578976 #13567]  INFO -- : Begin applying migration version 8, direction: up
I, [2012-04-26T15:50:13.579216 #13567]  INFO -- : (0.000154s) BEGIN
I, [2012-04-26T15:50:13.584324 #13567]  INFO -- : (0.004458s) CREATE TABLE "environments" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T15:50:13.585221 #13567]  INFO -- : (0.000741s) CREATE INDEX "environments_org_id_index" ON "environments" ("org_id")
I, [2012-04-26T15:50:13.585446 #13567]  INFO -- : (0.000155s) ALTER TABLE environments ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T15:50:13.585761 #13567]  INFO -- : (0.000173s) UPDATE "schema_info" SET "version" = 8
I, [2012-04-26T15:50:13.586363 #13567]  INFO -- : (0.000534s) COMMIT
I, [2012-04-26T15:50:13.586426 #13567]  INFO -- : Finished applying migration version 8, direction: up, took 0.007448 seconds
I, [2012-04-26T15:50:13.586460 #13567]  INFO -- : Begin applying migration version 9, direction: up
I, [2012-04-26T15:50:13.586722 #13567]  INFO -- : (0.000198s) BEGIN
I, [2012-04-26T15:50:13.588344 #13567]  INFO -- : (0.001425s) ALTER TABLE "data_bag_items" ADD FOREIGN KEY ("org_id", "data_bag_name") REFERENCES "data_bags"("org_id", "name") ON DELETE CASCADE ON UPDATE CASCADE
I, [2012-04-26T15:50:13.588736 #13567]  INFO -- : (0.000274s) UPDATE "schema_info" SET "version" = 9
I, [2012-04-26T15:50:13.589359 #13567]  INFO -- : (0.000560s) COMMIT
I, [2012-04-26T15:50:13.589420 #13567]  INFO -- : Finished applying migration version 9, direction: up, took 0.002956 seconds
I, [2012-04-26T15:50:13.589454 #13567]  INFO -- : Begin applying migration version 10, direction: up
I, [2012-04-26T15:50:13.589635 #13567]  INFO -- : (0.000127s) BEGIN
I, [2012-04-26T15:50:13.590094 #13567]  INFO -- : (0.000333s) DROP INDEX "clients_org_id_index"
I, [2012-04-26T15:50:13.590418 #13567]  INFO -- : (0.000216s) DROP INDEX "environments_org_id_index"
I, [2012-04-26T15:50:13.590724 #13567]  INFO -- : (0.000192s) DROP INDEX "nodes_org_id_index"
I, [2012-04-26T15:50:13.591132 #13567]  INFO -- : (0.000269s) DROP INDEX "roles_org_id_index"
I, [2012-04-26T15:50:13.591450 #13567]  INFO -- : (0.000198s) DROP INDEX "data_bags_org_id_index"
I, [2012-04-26T15:50:13.591876 #13567]  INFO -- : (0.000319s) DROP INDEX "data_bag_items_org_id_index"
I, [2012-04-26T15:50:13.592208 #13567]  INFO -- : (0.000202s) UPDATE "schema_info" SET "version" = 10
I, [2012-04-26T15:50:13.593216 #13567]  INFO -- : (0.000933s) COMMIT
I, [2012-04-26T15:50:13.593301 #13567]  INFO -- : Finished applying migration version 10, direction: up, took 0.003836 seconds
I, [2012-04-26T15:50:13.593354 #13567]  INFO -- : Begin applying migration version 11, direction: up
I, [2012-04-26T15:50:13.593536 #13567]  INFO -- : (0.000115s) BEGIN
I, [2012-04-26T15:50:13.594105 #13567]  INFO -- : (0.000328s) ALTER TABLE "users" ADD COLUMN "external_authentication_uid" text NULL
I, [2012-04-26T15:50:13.594422 #13567]  INFO -- : (0.000223s) ALTER TABLE "users" ADD COLUMN "recovery_authentication_enabled" boolean NULL
I, [2012-04-26T15:50:13.594712 #13567]  INFO -- : (0.000214s) ALTER TABLE "users" ALTER COLUMN "email" DROP NOT NULL
I, [2012-04-26T15:50:13.595052 #13567]  INFO -- : (0.000186s) UPDATE "schema_info" SET "version" = 11
I, [2012-04-26T15:50:13.595589 #13567]  INFO -- : (0.000456s) COMMIT
I, [2012-04-26T15:50:13.595672 #13567]  INFO -- : Finished applying migration version 11, direction: up, took 0.002311 seconds
I, [2012-04-26T15:51:05.252650 #13838]  INFO -- : (0.000392s) SET standard_conforming_strings = ON
I, [2012-04-26T15:51:05.252918 #13838]  INFO -- : (0.000130s) SET client_min_messages = 'WARNING'
I, [2012-04-26T15:51:05.253065 #13838]  INFO -- : (0.000098s) SET DateStyle = 'ISO'
E, [2012-04-26T15:51:05.261762 #13838] ERROR -- : PG::Error: ERROR:  relation "schema_info" does not exist
LINE 1: SELECT NULL FROM "schema_info" LIMIT 1
                         ^: SELECT NULL FROM "schema_info" LIMIT 1
I, [2012-04-26T15:51:05.266589 #13838]  INFO -- : (0.004410s) CREATE TABLE "schema_info" ("version" integer DEFAULT 0 NOT NULL)
I, [2012-04-26T15:51:05.267404 #13838]  INFO -- : (0.000597s) SELECT 1 AS "one" FROM "schema_info" LIMIT 1
I, [2012-04-26T15:51:05.269977 #13838]  INFO -- : (0.002345s) SELECT pg_attribute.attname FROM pg_class, pg_attribute, pg_index, pg_namespace WHERE pg_class.oid = pg_attribute.attrelid AND pg_class.relnamespace = pg_namespace.oid AND pg_class.oid = pg_index.indrelid AND pg_index.indkey[0] = pg_attribute.attnum AND pg_index.indisprimary = 't' AND pg_class.relname = 'schema_info'
I, [2012-04-26T15:51:05.271028 #13838]  INFO -- : (0.000729s) INSERT INTO "schema_info" ("version") VALUES (0) RETURNING NULL
I, [2012-04-26T15:51:05.271657 #13838]  INFO -- : (0.000341s) SELECT COUNT(*) AS "count" FROM "schema_info" LIMIT 1
I, [2012-04-26T15:51:05.271989 #13838]  INFO -- : (0.000145s) SELECT "version" FROM "schema_info" LIMIT 1
I, [2012-04-26T15:51:05.288471 #13838]  INFO -- : Begin applying migration version 1, direction: up
I, [2012-04-26T15:51:05.288809 #13838]  INFO -- : (0.000218s) BEGIN
I, [2012-04-26T15:51:05.293730 #13838]  INFO -- : (0.004504s) CREATE TABLE "users" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "username" text NOT NULL UNIQUE, "email" text NOT NULL UNIQUE, "pubkey_version" integer NOT NULL, "public_key" text, "serialized_object" text, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-04-26T15:51:05.294205 #13838]  INFO -- : (0.000266s) UPDATE "schema_info" SET "version" = 1
I, [2012-04-26T15:51:05.294581 #13838]  INFO -- : (0.000307s) COMMIT
I, [2012-04-26T15:51:05.294647 #13838]  INFO -- : Finished applying migration version 1, direction: up, took 0.006182 seconds
I, [2012-04-26T15:51:05.294682 #13838]  INFO -- : Begin applying migration version 2, direction: up
I, [2012-04-26T15:51:05.294910 #13838]  INFO -- : (0.000173s) BEGIN
I, [2012-04-26T15:51:05.299677 #13838]  INFO -- : (0.004358s) CREATE TABLE "nodes" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "environment" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" text, UNIQUE ("org_id", "name"))
I, [2012-04-26T15:51:05.300946 #13838]  INFO -- : (0.001042s) CREATE INDEX "nodes_org_id_index" ON "nodes" ("org_id")
I, [2012-04-26T15:51:05.302055 #13838]  INFO -- : (0.000888s) CREATE INDEX "nodes_org_id_environment_index" ON "nodes" ("org_id", "environment")
I, [2012-04-26T15:51:05.302467 #13838]  INFO -- : (0.000222s) UPDATE "schema_info" SET "version" = 2
I, [2012-04-26T15:51:05.303327 #13838]  INFO -- : (0.000787s) COMMIT
I, [2012-04-26T15:51:05.303387 #13838]  INFO -- : Finished applying migration version 2, direction: up, took 0.008701 seconds
I, [2012-04-26T15:51:05.303422 #13838]  INFO -- : Begin applying migration version 3, direction: up
I, [2012-04-26T15:51:05.303579 #13838]  INFO -- : (0.000103s) BEGIN
I, [2012-04-26T15:51:05.307277 #13838]  INFO -- : (0.003283s) CREATE TABLE "clients" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, "name" text NOT NULL, "public_key" text, "validator" boolean NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "pubkey_version" smallint NOT NULL, CONSTRAINT "org_id_name_unique" UNIQUE ("org_id", "name"))
I, [2012-04-26T15:51:05.308139 #13838]  INFO -- : (0.000711s) CREATE INDEX "clients_org_id_index" ON "clients" ("org_id")
I, [2012-04-26T15:51:05.308471 #13838]  INFO -- : (0.000197s) UPDATE "schema_info" SET "version" = 3
I, [2012-04-26T15:51:05.309652 #13838]  INFO -- : (0.001117s) COMMIT
I, [2012-04-26T15:51:05.309710 #13838]  INFO -- : Finished applying migration version 3, direction: up, took 0.006284 seconds
I, [2012-04-26T15:51:05.309743 #13838]  INFO -- : Begin applying migration version 4, direction: up
I, [2012-04-26T15:51:05.309892 #13838]  INFO -- : (0.000098s) BEGIN
I, [2012-04-26T15:51:05.315003 #13838]  INFO -- : (0.004753s) CREATE TABLE "roles" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T15:51:05.316050 #13838]  INFO -- : (0.000812s) CREATE INDEX "roles_org_id_index" ON "roles" ("org_id")
I, [2012-04-26T15:51:05.316374 #13838]  INFO -- : (0.000239s) ALTER TABLE roles ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T15:51:05.316697 #13838]  INFO -- : (0.000186s) UPDATE "schema_info" SET "version" = 4
I, [2012-04-26T15:51:05.317290 #13838]  INFO -- : (0.000529s) COMMIT
I, [2012-04-26T15:51:05.317357 #13838]  INFO -- : Finished applying migration version 4, direction: up, took 0.007609 seconds
I, [2012-04-26T15:51:05.317393 #13838]  INFO -- : Begin applying migration version 5, direction: up
I, [2012-04-26T15:51:05.317578 #13838]  INFO -- : (0.000130s) BEGIN
I, [2012-04-26T15:51:05.317958 #13838]  INFO -- : (0.000213s) ALTER TABLE "nodes" ADD COLUMN "last_audit_id" bytea
I, [2012-04-26T15:51:05.322668 #13838]  INFO -- : (0.004338s) CREATE TABLE "node_audit" ("audit_id" bytea NOT NULL, "node_id" char(32), "status" varchar(16), "start_time" timestamp NOT NULL, "end_time" timestamp NULL, "event_data" text NULL, PRIMARY KEY ("audit_id"), CONSTRAINT "node_id_fk" FOREIGN KEY ("node_id") REFERENCES "nodes")
I, [2012-04-26T15:51:05.323925 #13838]  INFO -- : (0.000989s) CREATE INDEX "node_audit_node_id_index" ON "node_audit" ("node_id")
I, [2012-04-26T15:51:05.328346 #13838]  INFO -- : (0.003699s) CREATE TABLE "node_audit_detail" ("audit_id" bytea NOT NULL, "seq" int NOT NULL, "duration" int NOT NULL, "res_id" varchar(255) NOT NULL, "res_type" varchar(16) NOT NULL, "res_name" varchar(255) NOT NULL, "res_result" varchar(16) NULL, "res_initial_state" text NULL, "res_final_state" text NULL, "delta" text NULL, PRIMARY KEY ("audit_id", "seq"), CONSTRAINT "audit_id_fk" FOREIGN KEY ("audit_id") REFERENCES "node_audit")
I, [2012-04-26T15:51:05.328688 #13838]  INFO -- : (0.000165s) UPDATE "schema_info" SET "version" = 5
I, [2012-04-26T15:51:05.329653 #13838]  INFO -- : (0.000906s) COMMIT
I, [2012-04-26T15:51:05.329721 #13838]  INFO -- : Finished applying migration version 5, direction: up, took 0.012323 seconds
I, [2012-04-26T15:51:05.329754 #13838]  INFO -- : Begin applying migration version 6, direction: up
I, [2012-04-26T15:51:05.329977 #13838]  INFO -- : (0.000162s) BEGIN
I, [2012-04-26T15:51:05.334504 #13838]  INFO -- : (0.004149s) CREATE TABLE "data_bags" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, UNIQUE ("org_id", "name"))
I, [2012-04-26T15:51:05.335683 #13838]  INFO -- : (0.000963s) CREATE INDEX "data_bags_org_id_index" ON "data_bags" ("org_id")
I, [2012-04-26T15:51:05.336085 #13838]  INFO -- : (0.000223s) UPDATE "schema_info" SET "version" = 6
I, [2012-04-26T15:51:05.336901 #13838]  INFO -- : (0.000719s) COMMIT
I, [2012-04-26T15:51:05.337011 #13838]  INFO -- : Finished applying migration version 6, direction: up, took 0.007245 seconds
I, [2012-04-26T15:51:05.337071 #13838]  INFO -- : Begin applying migration version 7, direction: up
I, [2012-04-26T15:51:05.337293 #13838]  INFO -- : (0.000139s) BEGIN
I, [2012-04-26T15:51:05.341443 #13838]  INFO -- : (0.003563s) CREATE TABLE "data_bag_items" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "data_bag_name" text NOT NULL, "item_name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "data_bag_name", "item_name"))
I, [2012-04-26T15:51:05.342293 #13838]  INFO -- : (0.000685s) CREATE INDEX "data_bag_items_org_id_index" ON "data_bag_items" ("org_id")
I, [2012-04-26T15:51:05.342557 #13838]  INFO -- : (0.000172s) ALTER TABLE data_bag_items ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T15:51:05.342941 #13838]  INFO -- : (0.000199s) UPDATE "schema_info" SET "version" = 7
I, [2012-04-26T15:51:05.343590 #13838]  INFO -- : (0.000563s) COMMIT
I, [2012-04-26T15:51:05.343676 #13838]  INFO -- : Finished applying migration version 7, direction: up, took 0.006600 seconds
I, [2012-04-26T15:51:05.343733 #13838]  INFO -- : Begin applying migration version 8, direction: up
I, [2012-04-26T15:51:05.343965 #13838]  INFO -- : (0.000145s) BEGIN
I, [2012-04-26T15:51:05.348700 #13838]  INFO -- : (0.004167s) CREATE TABLE "environments" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T15:51:05.349443 #13838]  INFO -- : (0.000582s) CREATE INDEX "environments_org_id_index" ON "environments" ("org_id")
I, [2012-04-26T15:51:05.349713 #13838]  INFO -- : (0.000206s) ALTER TABLE environments ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T15:51:05.349986 #13838]  INFO -- : (0.000145s) UPDATE "schema_info" SET "version" = 8
I, [2012-04-26T15:51:05.350558 #13838]  INFO -- : (0.000512s) COMMIT
I, [2012-04-26T15:51:05.350622 #13838]  INFO -- : Finished applying migration version 8, direction: up, took 0.006889 seconds
I, [2012-04-26T15:51:05.350657 #13838]  INFO -- : Begin applying migration version 9, direction: up
I, [2012-04-26T15:51:05.350803 #13838]  INFO -- : (0.000094s) BEGIN
I, [2012-04-26T15:51:05.352451 #13838]  INFO -- : (0.001460s) ALTER TABLE "data_bag_items" ADD FOREIGN KEY ("org_id", "data_bag_name") REFERENCES "data_bags"("org_id", "name") ON DELETE CASCADE ON UPDATE CASCADE
I, [2012-04-26T15:51:05.352712 #13838]  INFO -- : (0.000131s) UPDATE "schema_info" SET "version" = 9
I, [2012-04-26T15:51:05.353423 #13838]  INFO -- : (0.000655s) COMMIT
I, [2012-04-26T15:51:05.353486 #13838]  INFO -- : Finished applying migration version 9, direction: up, took 0.002826 seconds
I, [2012-04-26T15:51:05.353520 #13838]  INFO -- : Begin applying migration version 10, direction: up
I, [2012-04-26T15:51:05.353690 #13838]  INFO -- : (0.000117s) BEGIN
I, [2012-04-26T15:51:05.354154 #13838]  INFO -- : (0.000340s) DROP INDEX "clients_org_id_index"
I, [2012-04-26T15:51:05.354415 #13838]  INFO -- : (0.000162s) DROP INDEX "environments_org_id_index"
I, [2012-04-26T15:51:05.354690 #13838]  INFO -- : (0.000163s) DROP INDEX "nodes_org_id_index"
I, [2012-04-26T15:51:05.354984 #13838]  INFO -- : (0.000185s) DROP INDEX "roles_org_id_index"
I, [2012-04-26T15:51:05.355351 #13838]  INFO -- : (0.000218s) DROP INDEX "data_bags_org_id_index"
I, [2012-04-26T15:51:05.355844 #13838]  INFO -- : (0.000335s) DROP INDEX "data_bag_items_org_id_index"
I, [2012-04-26T15:51:05.356220 #13838]  INFO -- : (0.000204s) UPDATE "schema_info" SET "version" = 10
I, [2012-04-26T15:51:05.357431 #13838]  INFO -- : (0.001111s) COMMIT
I, [2012-04-26T15:51:05.357536 #13838]  INFO -- : Finished applying migration version 10, direction: up, took 0.004001 seconds
I, [2012-04-26T15:51:05.357602 #13838]  INFO -- : Begin applying migration version 11, direction: up
I, [2012-04-26T15:51:05.357842 #13838]  INFO -- : (0.000134s) BEGIN
I, [2012-04-26T15:51:05.358432 #13838]  INFO -- : (0.000281s) ALTER TABLE "users" ADD COLUMN "external_authentication_uid" text NULL
I, [2012-04-26T15:51:05.358706 #13838]  INFO -- : (0.000213s) ALTER TABLE "users" ADD COLUMN "recovery_authentication_enabled" boolean NULL
I, [2012-04-26T15:51:05.358913 #13838]  INFO -- : (0.000153s) ALTER TABLE "users" ALTER COLUMN "email" DROP NOT NULL
I, [2012-04-26T15:51:05.359244 #13838]  INFO -- : (0.000184s) UPDATE "schema_info" SET "version" = 11
I, [2012-04-26T15:51:05.359821 #13838]  INFO -- : (0.000507s) COMMIT
I, [2012-04-26T15:51:05.359893 #13838]  INFO -- : Finished applying migration version 11, direction: up, took 0.002286 seconds
I, [2012-04-26T15:52:48.533304 #14509]  INFO -- : (0.000324s) SET standard_conforming_strings = ON
I, [2012-04-26T15:52:48.533532 #14509]  INFO -- : (0.000096s) SET client_min_messages = 'WARNING'
I, [2012-04-26T15:52:48.533660 #14509]  INFO -- : (0.000081s) SET DateStyle = 'ISO'
E, [2012-04-26T15:52:48.541056 #14509] ERROR -- : PG::Error: ERROR:  relation "schema_info" does not exist
LINE 1: SELECT NULL FROM "schema_info" LIMIT 1
                         ^: SELECT NULL FROM "schema_info" LIMIT 1
I, [2012-04-26T15:52:48.545444 #14509]  INFO -- : (0.004121s) CREATE TABLE "schema_info" ("version" integer DEFAULT 0 NOT NULL)
I, [2012-04-26T15:52:48.546218 #14509]  INFO -- : (0.000570s) SELECT 1 AS "one" FROM "schema_info" LIMIT 1
I, [2012-04-26T15:52:48.548221 #14509]  INFO -- : (0.001805s) SELECT pg_attribute.attname FROM pg_class, pg_attribute, pg_index, pg_namespace WHERE pg_class.oid = pg_attribute.attrelid AND pg_class.relnamespace = pg_namespace.oid AND pg_class.oid = pg_index.indrelid AND pg_index.indkey[0] = pg_attribute.attnum AND pg_index.indisprimary = 't' AND pg_class.relname = 'schema_info'
I, [2012-04-26T15:52:48.549137 #14509]  INFO -- : (0.000717s) INSERT INTO "schema_info" ("version") VALUES (0) RETURNING NULL
I, [2012-04-26T15:52:48.549780 #14509]  INFO -- : (0.000400s) SELECT COUNT(*) AS "count" FROM "schema_info" LIMIT 1
I, [2012-04-26T15:52:48.550219 #14509]  INFO -- : (0.000257s) SELECT "version" FROM "schema_info" LIMIT 1
I, [2012-04-26T15:52:48.565794 #14509]  INFO -- : Begin applying migration version 1, direction: up
I, [2012-04-26T15:52:48.566107 #14509]  INFO -- : (0.000194s) BEGIN
I, [2012-04-26T15:52:48.573129 #14509]  INFO -- : (0.006607s) CREATE TABLE "users" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "username" text NOT NULL UNIQUE, "email" text NOT NULL UNIQUE, "pubkey_version" integer NOT NULL, "public_key" text, "serialized_object" text, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-04-26T15:52:48.573564 #14509]  INFO -- : (0.000247s) UPDATE "schema_info" SET "version" = 1
I, [2012-04-26T15:52:48.574544 #14509]  INFO -- : (0.000923s) COMMIT
I, [2012-04-26T15:52:48.574604 #14509]  INFO -- : Finished applying migration version 1, direction: up, took 0.008814 seconds
I, [2012-04-26T15:52:48.574638 #14509]  INFO -- : Begin applying migration version 2, direction: up
I, [2012-04-26T15:52:48.574825 #14509]  INFO -- : (0.000134s) BEGIN
I, [2012-04-26T15:52:48.579198 #14509]  INFO -- : (0.003989s) CREATE TABLE "nodes" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "environment" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" text, UNIQUE ("org_id", "name"))
I, [2012-04-26T15:52:48.580119 #14509]  INFO -- : (0.000699s) CREATE INDEX "nodes_org_id_index" ON "nodes" ("org_id")
I, [2012-04-26T15:52:48.581096 #14509]  INFO -- : (0.000834s) CREATE INDEX "nodes_org_id_environment_index" ON "nodes" ("org_id", "environment")
I, [2012-04-26T15:52:48.581436 #14509]  INFO -- : (0.000199s) UPDATE "schema_info" SET "version" = 2
I, [2012-04-26T15:52:48.582037 #14509]  INFO -- : (0.000541s) COMMIT
I, [2012-04-26T15:52:48.582112 #14509]  INFO -- : Finished applying migration version 2, direction: up, took 0.007468 seconds
I, [2012-04-26T15:52:48.582150 #14509]  INFO -- : Begin applying migration version 3, direction: up
I, [2012-04-26T15:52:48.582309 #14509]  INFO -- : (0.000102s) BEGIN
I, [2012-04-26T15:52:48.586301 #14509]  INFO -- : (0.003576s) CREATE TABLE "clients" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, "name" text NOT NULL, "public_key" text, "validator" boolean NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "pubkey_version" smallint NOT NULL, CONSTRAINT "org_id_name_unique" UNIQUE ("org_id", "name"))
I, [2012-04-26T15:52:48.587247 #14509]  INFO -- : (0.000758s) CREATE INDEX "clients_org_id_index" ON "clients" ("org_id")
I, [2012-04-26T15:52:48.588029 #14509]  INFO -- : (0.000597s) UPDATE "schema_info" SET "version" = 3
I, [2012-04-26T15:52:48.588795 #14509]  INFO -- : (0.000672s) COMMIT
I, [2012-04-26T15:52:48.588864 #14509]  INFO -- : Finished applying migration version 3, direction: up, took 0.006709 seconds
I, [2012-04-26T15:52:48.588921 #14509]  INFO -- : Begin applying migration version 4, direction: up
I, [2012-04-26T15:52:48.589095 #14509]  INFO -- : (0.000115s) BEGIN
I, [2012-04-26T15:52:48.593952 #14509]  INFO -- : (0.004466s) CREATE TABLE "roles" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T15:52:48.594958 #14509]  INFO -- : (0.000861s) CREATE INDEX "roles_org_id_index" ON "roles" ("org_id")
I, [2012-04-26T15:52:48.595181 #14509]  INFO -- : (0.000159s) ALTER TABLE roles ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T15:52:48.595639 #14509]  INFO -- : (0.000342s) UPDATE "schema_info" SET "version" = 4
I, [2012-04-26T15:52:48.596354 #14509]  INFO -- : (0.000658s) COMMIT
I, [2012-04-26T15:52:48.596419 #14509]  INFO -- : Finished applying migration version 4, direction: up, took 0.007494 seconds
I, [2012-04-26T15:52:48.596452 #14509]  INFO -- : Begin applying migration version 5, direction: up
I, [2012-04-26T15:52:48.596724 #14509]  INFO -- : (0.000216s) BEGIN
I, [2012-04-26T15:52:48.597149 #14509]  INFO -- : (0.000268s) ALTER TABLE "nodes" ADD COLUMN "last_audit_id" bytea
I, [2012-04-26T15:52:48.601346 #14509]  INFO -- : (0.003883s) CREATE TABLE "node_audit" ("audit_id" bytea NOT NULL, "node_id" char(32), "status" varchar(16), "start_time" timestamp NOT NULL, "end_time" timestamp NULL, "event_data" text NULL, PRIMARY KEY ("audit_id"), CONSTRAINT "node_id_fk" FOREIGN KEY ("node_id") REFERENCES "nodes")
I, [2012-04-26T15:52:48.602432 #14509]  INFO -- : (0.000860s) CREATE INDEX "node_audit_node_id_index" ON "node_audit" ("node_id")
I, [2012-04-26T15:52:48.606387 #14509]  INFO -- : (0.003463s) CREATE TABLE "node_audit_detail" ("audit_id" bytea NOT NULL, "seq" int NOT NULL, "duration" int NOT NULL, "res_id" varchar(255) NOT NULL, "res_type" varchar(16) NOT NULL, "res_name" varchar(255) NOT NULL, "res_result" varchar(16) NULL, "res_initial_state" text NULL, "res_final_state" text NULL, "delta" text NULL, PRIMARY KEY ("audit_id", "seq"), CONSTRAINT "audit_id_fk" FOREIGN KEY ("audit_id") REFERENCES "node_audit")
I, [2012-04-26T15:52:48.607062 #14509]  INFO -- : (0.000205s) UPDATE "schema_info" SET "version" = 5
I, [2012-04-26T15:52:48.608288 #14509]  INFO -- : (0.001142s) COMMIT
I, [2012-04-26T15:52:48.608354 #14509]  INFO -- : Finished applying migration version 5, direction: up, took 0.011897 seconds
I, [2012-04-26T15:52:48.608389 #14509]  INFO -- : Begin applying migration version 6, direction: up
I, [2012-04-26T15:52:48.608629 #14509]  INFO -- : (0.000186s) BEGIN
I, [2012-04-26T15:52:48.612866 #14509]  INFO -- : (0.003888s) CREATE TABLE "data_bags" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, UNIQUE ("org_id", "name"))
I, [2012-04-26T15:52:48.614109 #14509]  INFO -- : (0.001058s) CREATE INDEX "data_bags_org_id_index" ON "data_bags" ("org_id")
I, [2012-04-26T15:52:48.614515 #14509]  INFO -- : (0.000213s) UPDATE "schema_info" SET "version" = 6
I, [2012-04-26T15:52:48.615545 #14509]  INFO -- : (0.000965s) COMMIT
I, [2012-04-26T15:52:48.615624 #14509]  INFO -- : Finished applying migration version 6, direction: up, took 0.007226 seconds
I, [2012-04-26T15:52:48.615661 #14509]  INFO -- : Begin applying migration version 7, direction: up
I, [2012-04-26T15:52:48.615879 #14509]  INFO -- : (0.000138s) BEGIN
I, [2012-04-26T15:52:48.619939 #14509]  INFO -- : (0.003635s) CREATE TABLE "data_bag_items" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "data_bag_name" text NOT NULL, "item_name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "data_bag_name", "item_name"))
I, [2012-04-26T15:52:48.620977 #14509]  INFO -- : (0.000906s) CREATE INDEX "data_bag_items_org_id_index" ON "data_bag_items" ("org_id")
I, [2012-04-26T15:52:48.621406 #14509]  INFO -- : (0.000338s) ALTER TABLE data_bag_items ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T15:52:48.621690 #14509]  INFO -- : (0.000153s) UPDATE "schema_info" SET "version" = 7
I, [2012-04-26T15:52:48.622407 #14509]  INFO -- : (0.000658s) COMMIT
I, [2012-04-26T15:52:48.622472 #14509]  INFO -- : Finished applying migration version 7, direction: up, took 0.006806 seconds
I, [2012-04-26T15:52:48.622505 #14509]  INFO -- : Begin applying migration version 8, direction: up
I, [2012-04-26T15:52:48.622686 #14509]  INFO -- : (0.000120s) BEGIN
I, [2012-04-26T15:52:48.627705 #14509]  INFO -- : (0.004413s) CREATE TABLE "environments" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T15:52:48.628614 #14509]  INFO -- : (0.000757s) CREATE INDEX "environments_org_id_index" ON "environments" ("org_id")
I, [2012-04-26T15:52:48.628895 #14509]  INFO -- : (0.000208s) ALTER TABLE environments ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T15:52:48.629282 #14509]  INFO -- : (0.000250s) UPDATE "schema_info" SET "version" = 8
I, [2012-04-26T15:52:48.630340 #14509]  INFO -- : (0.000996s) COMMIT
I, [2012-04-26T15:52:48.630402 #14509]  INFO -- : Finished applying migration version 8, direction: up, took 0.007892 seconds
I, [2012-04-26T15:52:48.630436 #14509]  INFO -- : Begin applying migration version 9, direction: up
I, [2012-04-26T15:52:48.630706 #14509]  INFO -- : (0.000214s) BEGIN
I, [2012-04-26T15:52:48.632318 #14509]  INFO -- : (0.001421s) ALTER TABLE "data_bag_items" ADD FOREIGN KEY ("org_id", "data_bag_name") REFERENCES "data_bags"("org_id", "name") ON DELETE CASCADE ON UPDATE CASCADE
I, [2012-04-26T15:52:48.632688 #14509]  INFO -- : (0.000245s) UPDATE "schema_info" SET "version" = 9
I, [2012-04-26T15:52:48.633733 #14509]  INFO -- : (0.000982s) COMMIT
I, [2012-04-26T15:52:48.633793 #14509]  INFO -- : Finished applying migration version 9, direction: up, took 0.003353 seconds
I, [2012-04-26T15:52:48.633827 #14509]  INFO -- : Begin applying migration version 10, direction: up
I, [2012-04-26T15:52:48.634005 #14509]  INFO -- : (0.000123s) BEGIN
I, [2012-04-26T15:52:48.634851 #14509]  INFO -- : (0.000676s) DROP INDEX "clients_org_id_index"
I, [2012-04-26T15:52:48.635269 #14509]  INFO -- : (0.000293s) DROP INDEX "environments_org_id_index"
I, [2012-04-26T15:52:48.635630 #14509]  INFO -- : (0.000204s) DROP INDEX "nodes_org_id_index"
I, [2012-04-26T15:52:48.635955 #14509]  INFO -- : (0.000199s) DROP INDEX "roles_org_id_index"
I, [2012-04-26T15:52:48.636241 #14509]  INFO -- : (0.000175s) DROP INDEX "data_bags_org_id_index"
I, [2012-04-26T15:52:48.636619 #14509]  INFO -- : (0.000213s) DROP INDEX "data_bag_items_org_id_index"
I, [2012-04-26T15:52:48.636974 #14509]  INFO -- : (0.000201s) UPDATE "schema_info" SET "version" = 10
I, [2012-04-26T15:52:48.637866 #14509]  INFO -- : (0.000832s) COMMIT
I, [2012-04-26T15:52:48.637927 #14509]  INFO -- : Finished applying migration version 10, direction: up, took 0.004095 seconds
I, [2012-04-26T15:52:48.637962 #14509]  INFO -- : Begin applying migration version 11, direction: up
I, [2012-04-26T15:52:48.638122 #14509]  INFO -- : (0.000105s) BEGIN
I, [2012-04-26T15:52:48.638543 #14509]  INFO -- : (0.000213s) ALTER TABLE "users" ADD COLUMN "external_authentication_uid" text NULL
I, [2012-04-26T15:52:48.638758 #14509]  INFO -- : (0.000161s) ALTER TABLE "users" ADD COLUMN "recovery_authentication_enabled" boolean NULL
I, [2012-04-26T15:52:48.638964 #14509]  INFO -- : (0.000155s) ALTER TABLE "users" ALTER COLUMN "email" DROP NOT NULL
I, [2012-04-26T15:52:48.639184 #14509]  INFO -- : (0.000119s) UPDATE "schema_info" SET "version" = 11
I, [2012-04-26T15:52:48.639667 #14509]  INFO -- : (0.000432s) COMMIT
I, [2012-04-26T15:52:48.639724 #14509]  INFO -- : Finished applying migration version 11, direction: up, took 0.001759 seconds
I, [2012-04-26T15:55:37.183194 #15141]  INFO -- : (0.000457s) SET standard_conforming_strings = ON
I, [2012-04-26T15:55:37.183488 #15141]  INFO -- : (0.000163s) SET client_min_messages = 'WARNING'
I, [2012-04-26T15:55:37.183627 #15141]  INFO -- : (0.000089s) SET DateStyle = 'ISO'
E, [2012-04-26T15:55:37.191483 #15141] ERROR -- : PG::Error: ERROR:  relation "schema_info" does not exist
LINE 1: SELECT NULL FROM "schema_info" LIMIT 1
                         ^: SELECT NULL FROM "schema_info" LIMIT 1
I, [2012-04-26T15:55:37.196062 #15141]  INFO -- : (0.004302s) CREATE TABLE "schema_info" ("version" integer DEFAULT 0 NOT NULL)
I, [2012-04-26T15:55:37.196947 #15141]  INFO -- : (0.000694s) SELECT 1 AS "one" FROM "schema_info" LIMIT 1
I, [2012-04-26T15:55:37.198851 #15141]  INFO -- : (0.001703s) SELECT pg_attribute.attname FROM pg_class, pg_attribute, pg_index, pg_namespace WHERE pg_class.oid = pg_attribute.attrelid AND pg_class.relnamespace = pg_namespace.oid AND pg_class.oid = pg_index.indrelid AND pg_index.indkey[0] = pg_attribute.attnum AND pg_index.indisprimary = 't' AND pg_class.relname = 'schema_info'
I, [2012-04-26T15:55:37.200014 #15141]  INFO -- : (0.000964s) INSERT INTO "schema_info" ("version") VALUES (0) RETURNING NULL
I, [2012-04-26T15:55:37.200703 #15141]  INFO -- : (0.000448s) SELECT COUNT(*) AS "count" FROM "schema_info" LIMIT 1
I, [2012-04-26T15:55:37.201023 #15141]  INFO -- : (0.000152s) SELECT "version" FROM "schema_info" LIMIT 1
I, [2012-04-26T15:55:37.217151 #15141]  INFO -- : Begin applying migration version 1, direction: up
I, [2012-04-26T15:55:37.217491 #15141]  INFO -- : (0.000219s) BEGIN
I, [2012-04-26T15:55:37.223152 #15141]  INFO -- : (0.005238s) CREATE TABLE "users" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "username" text NOT NULL UNIQUE, "email" text NOT NULL UNIQUE, "pubkey_version" integer NOT NULL, "public_key" text, "serialized_object" text, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-04-26T15:55:37.223647 #15141]  INFO -- : (0.000294s) UPDATE "schema_info" SET "version" = 1
I, [2012-04-26T15:55:37.224482 #15141]  INFO -- : (0.000773s) COMMIT
I, [2012-04-26T15:55:37.224542 #15141]  INFO -- : Finished applying migration version 1, direction: up, took 0.007394 seconds
I, [2012-04-26T15:55:37.224575 #15141]  INFO -- : Begin applying migration version 2, direction: up
I, [2012-04-26T15:55:37.224757 #15141]  INFO -- : (0.000129s) BEGIN
I, [2012-04-26T15:55:37.228743 #15141]  INFO -- : (0.003597s) CREATE TABLE "nodes" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "environment" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" text, UNIQUE ("org_id", "name"))
I, [2012-04-26T15:55:37.229511 #15141]  INFO -- : (0.000630s) CREATE INDEX "nodes_org_id_index" ON "nodes" ("org_id")
I, [2012-04-26T15:55:37.230363 #15141]  INFO -- : (0.000747s) CREATE INDEX "nodes_org_id_environment_index" ON "nodes" ("org_id", "environment")
I, [2012-04-26T15:55:37.230612 #15141]  INFO -- : (0.000134s) UPDATE "schema_info" SET "version" = 2
I, [2012-04-26T15:55:37.231620 #15141]  INFO -- : (0.000952s) COMMIT
I, [2012-04-26T15:55:37.231682 #15141]  INFO -- : Finished applying migration version 2, direction: up, took 0.007102 seconds
I, [2012-04-26T15:55:37.231715 #15141]  INFO -- : Begin applying migration version 3, direction: up
I, [2012-04-26T15:55:37.231902 #15141]  INFO -- : (0.000137s) BEGIN
I, [2012-04-26T15:55:37.235712 #15141]  INFO -- : (0.003412s) CREATE TABLE "clients" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, "name" text NOT NULL, "public_key" text, "validator" boolean NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "pubkey_version" smallint NOT NULL, CONSTRAINT "org_id_name_unique" UNIQUE ("org_id", "name"))
I, [2012-04-26T15:55:37.236431 #15141]  INFO -- : (0.000585s) CREATE INDEX "clients_org_id_index" ON "clients" ("org_id")
I, [2012-04-26T15:55:37.236730 #15141]  INFO -- : (0.000181s) UPDATE "schema_info" SET "version" = 3
I, [2012-04-26T15:55:37.237285 #15141]  INFO -- : (0.000506s) COMMIT
I, [2012-04-26T15:55:37.237334 #15141]  INFO -- : Finished applying migration version 3, direction: up, took 0.005615 seconds
I, [2012-04-26T15:55:37.237367 #15141]  INFO -- : Begin applying migration version 4, direction: up
I, [2012-04-26T15:55:37.237518 #15141]  INFO -- : (0.000100s) BEGIN
I, [2012-04-26T15:55:37.241048 #15141]  INFO -- : (0.003200s) CREATE TABLE "roles" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T15:55:37.241745 #15141]  INFO -- : (0.000561s) CREATE INDEX "roles_org_id_index" ON "roles" ("org_id")
I, [2012-04-26T15:55:37.242003 #15141]  INFO -- : (0.000198s) ALTER TABLE roles ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T15:55:37.242291 #15141]  INFO -- : (0.000174s) UPDATE "schema_info" SET "version" = 4
I, [2012-04-26T15:55:37.243697 #15141]  INFO -- : (0.001349s) COMMIT
I, [2012-04-26T15:55:37.243757 #15141]  INFO -- : Finished applying migration version 4, direction: up, took 0.006385 seconds
I, [2012-04-26T15:55:37.243791 #15141]  INFO -- : Begin applying migration version 5, direction: up
I, [2012-04-26T15:55:37.244021 #15141]  INFO -- : (0.000175s) BEGIN
I, [2012-04-26T15:55:37.244386 #15141]  INFO -- : (0.000201s) ALTER TABLE "nodes" ADD COLUMN "last_audit_id" bytea
I, [2012-04-26T15:55:37.247766 #15141]  INFO -- : (0.003070s) CREATE TABLE "node_audit" ("audit_id" bytea NOT NULL, "node_id" char(32), "status" varchar(16), "start_time" timestamp NOT NULL, "end_time" timestamp NULL, "event_data" text NULL, PRIMARY KEY ("audit_id"), CONSTRAINT "node_id_fk" FOREIGN KEY ("node_id") REFERENCES "nodes")
I, [2012-04-26T15:55:37.248578 #15141]  INFO -- : (0.000696s) CREATE INDEX "node_audit_node_id_index" ON "node_audit" ("node_id")
I, [2012-04-26T15:55:37.252336 #15141]  INFO -- : (0.003363s) CREATE TABLE "node_audit_detail" ("audit_id" bytea NOT NULL, "seq" int NOT NULL, "duration" int NOT NULL, "res_id" varchar(255) NOT NULL, "res_type" varchar(16) NOT NULL, "res_name" varchar(255) NOT NULL, "res_result" varchar(16) NULL, "res_initial_state" text NULL, "res_final_state" text NULL, "delta" text NULL, PRIMARY KEY ("audit_id", "seq"), CONSTRAINT "audit_id_fk" FOREIGN KEY ("audit_id") REFERENCES "node_audit")
I, [2012-04-26T15:55:37.252667 #15141]  INFO -- : (0.000158s) UPDATE "schema_info" SET "version" = 5
I, [2012-04-26T15:55:37.253885 #15141]  INFO -- : (0.001149s) COMMIT
I, [2012-04-26T15:55:37.253954 #15141]  INFO -- : Finished applying migration version 5, direction: up, took 0.010160 seconds
I, [2012-04-26T15:55:37.253986 #15141]  INFO -- : Begin applying migration version 6, direction: up
I, [2012-04-26T15:55:37.254294 #15141]  INFO -- : (0.000252s) BEGIN
I, [2012-04-26T15:55:37.258269 #15141]  INFO -- : (0.003637s) CREATE TABLE "data_bags" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, UNIQUE ("org_id", "name"))
I, [2012-04-26T15:55:37.259250 #15141]  INFO -- : (0.000855s) CREATE INDEX "data_bags_org_id_index" ON "data_bags" ("org_id")
I, [2012-04-26T15:55:37.259582 #15141]  INFO -- : (0.000223s) UPDATE "schema_info" SET "version" = 6
I, [2012-04-26T15:55:37.260338 #15141]  INFO -- : (0.000692s) COMMIT
I, [2012-04-26T15:55:37.260399 #15141]  INFO -- : Finished applying migration version 6, direction: up, took 0.006408 seconds
I, [2012-04-26T15:55:37.260433 #15141]  INFO -- : Begin applying migration version 7, direction: up
I, [2012-04-26T15:55:37.260575 #15141]  INFO -- : (0.000092s) BEGIN
I, [2012-04-26T15:55:37.264086 #15141]  INFO -- : (0.003172s) CREATE TABLE "data_bag_items" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "data_bag_name" text NOT NULL, "item_name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "data_bag_name", "item_name"))
I, [2012-04-26T15:55:37.265017 #15141]  INFO -- : (0.000798s) CREATE INDEX "data_bag_items_org_id_index" ON "data_bag_items" ("org_id")
I, [2012-04-26T15:55:37.265304 #15141]  INFO -- : (0.000215s) ALTER TABLE data_bag_items ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T15:55:37.265594 #15141]  INFO -- : (0.000164s) UPDATE "schema_info" SET "version" = 7
I, [2012-04-26T15:55:37.266164 #15141]  INFO -- : (0.000510s) COMMIT
I, [2012-04-26T15:55:37.266215 #15141]  INFO -- : Finished applying migration version 7, direction: up, took 0.005777 seconds
I, [2012-04-26T15:55:37.266247 #15141]  INFO -- : Begin applying migration version 8, direction: up
I, [2012-04-26T15:55:37.266375 #15141]  INFO -- : (0.000080s) BEGIN
I, [2012-04-26T15:55:37.272048 #15141]  INFO -- : (0.005342s) CREATE TABLE "environments" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T15:55:37.272831 #15141]  INFO -- : (0.000642s) CREATE INDEX "environments_org_id_index" ON "environments" ("org_id")
I, [2012-04-26T15:55:37.273032 #15141]  INFO -- : (0.000131s) ALTER TABLE environments ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T15:55:37.273335 #15141]  INFO -- : (0.000177s) UPDATE "schema_info" SET "version" = 8
I, [2012-04-26T15:55:37.274231 #15141]  INFO -- : (0.000840s) COMMIT
I, [2012-04-26T15:55:37.274291 #15141]  INFO -- : Finished applying migration version 8, direction: up, took 0.008039 seconds
I, [2012-04-26T15:55:37.274326 #15141]  INFO -- : Begin applying migration version 9, direction: up
I, [2012-04-26T15:55:37.274512 #15141]  INFO -- : (0.000134s) BEGIN
I, [2012-04-26T15:55:37.276186 #15141]  INFO -- : (0.001495s) ALTER TABLE "data_bag_items" ADD FOREIGN KEY ("org_id", "data_bag_name") REFERENCES "data_bags"("org_id", "name") ON DELETE CASCADE ON UPDATE CASCADE
I, [2012-04-26T15:55:37.276607 #15141]  INFO -- : (0.000308s) UPDATE "schema_info" SET "version" = 9
I, [2012-04-26T15:55:37.277308 #15141]  INFO -- : (0.000651s) COMMIT
I, [2012-04-26T15:55:37.277357 #15141]  INFO -- : Finished applying migration version 9, direction: up, took 0.003028 seconds
I, [2012-04-26T15:55:37.277390 #15141]  INFO -- : Begin applying migration version 10, direction: up
I, [2012-04-26T15:55:37.277641 #15141]  INFO -- : (0.000191s) BEGIN
I, [2012-04-26T15:55:37.278069 #15141]  INFO -- : (0.000320s) DROP INDEX "clients_org_id_index"
I, [2012-04-26T15:55:37.278385 #15141]  INFO -- : (0.000218s) DROP INDEX "environments_org_id_index"
I, [2012-04-26T15:55:37.278686 #15141]  INFO -- : (0.000209s) DROP INDEX "nodes_org_id_index"
I, [2012-04-26T15:55:37.278996 #15141]  INFO -- : (0.000212s) DROP INDEX "roles_org_id_index"
I, [2012-04-26T15:55:37.279277 #15141]  INFO -- : (0.000166s) DROP INDEX "data_bags_org_id_index"
I, [2012-04-26T15:55:37.279520 #15141]  INFO -- : (0.000148s) DROP INDEX "data_bag_items_org_id_index"
I, [2012-04-26T15:55:37.279728 #15141]  INFO -- : (0.000109s) UPDATE "schema_info" SET "version" = 10
I, [2012-04-26T15:55:37.280591 #15141]  INFO -- : (0.000812s) COMMIT
I, [2012-04-26T15:55:37.280652 #15141]  INFO -- : Finished applying migration version 10, direction: up, took 0.003258 seconds
I, [2012-04-26T15:55:37.280687 #15141]  INFO -- : Begin applying migration version 11, direction: up
I, [2012-04-26T15:55:37.280817 #15141]  INFO -- : (0.000079s) BEGIN
I, [2012-04-26T15:55:37.281302 #15141]  INFO -- : (0.000277s) ALTER TABLE "users" ADD COLUMN "external_authentication_uid" text NULL
I, [2012-04-26T15:55:37.281622 #15141]  INFO -- : (0.000251s) ALTER TABLE "users" ADD COLUMN "recovery_authentication_enabled" boolean NULL
I, [2012-04-26T15:55:37.282152 #15141]  INFO -- : (0.000460s) ALTER TABLE "users" ALTER COLUMN "email" DROP NOT NULL
I, [2012-04-26T15:55:37.282439 #15141]  INFO -- : (0.000149s) UPDATE "schema_info" SET "version" = 11
I, [2012-04-26T15:55:37.283011 #15141]  INFO -- : (0.000515s) COMMIT
I, [2012-04-26T15:55:37.283062 #15141]  INFO -- : Finished applying migration version 11, direction: up, took 0.002371 seconds
I, [2012-04-26T15:58:40.873497 #15805]  INFO -- : (0.000477s) SET standard_conforming_strings = ON
I, [2012-04-26T15:58:40.873782 #15805]  INFO -- : (0.000154s) SET client_min_messages = 'WARNING'
I, [2012-04-26T15:58:40.873937 #15805]  INFO -- : (0.000096s) SET DateStyle = 'ISO'
E, [2012-04-26T15:58:40.882072 #15805] ERROR -- : PG::Error: ERROR:  relation "schema_info" does not exist
LINE 1: SELECT NULL FROM "schema_info" LIMIT 1
                         ^: SELECT NULL FROM "schema_info" LIMIT 1
I, [2012-04-26T15:58:40.886750 #15805]  INFO -- : (0.004392s) CREATE TABLE "schema_info" ("version" integer DEFAULT 0 NOT NULL)
I, [2012-04-26T15:58:40.887525 #15805]  INFO -- : (0.000579s) SELECT 1 AS "one" FROM "schema_info" LIMIT 1
I, [2012-04-26T15:58:40.889457 #15805]  INFO -- : (0.001743s) SELECT pg_attribute.attname FROM pg_class, pg_attribute, pg_index, pg_namespace WHERE pg_class.oid = pg_attribute.attrelid AND pg_class.relnamespace = pg_namespace.oid AND pg_class.oid = pg_index.indrelid AND pg_index.indkey[0] = pg_attribute.attnum AND pg_index.indisprimary = 't' AND pg_class.relname = 'schema_info'
I, [2012-04-26T15:58:40.890444 #15805]  INFO -- : (0.000796s) INSERT INTO "schema_info" ("version") VALUES (0) RETURNING NULL
I, [2012-04-26T15:58:40.891123 #15805]  INFO -- : (0.000447s) SELECT COUNT(*) AS "count" FROM "schema_info" LIMIT 1
I, [2012-04-26T15:58:40.891742 #15805]  INFO -- : (0.000428s) SELECT "version" FROM "schema_info" LIMIT 1
I, [2012-04-26T15:58:40.907449 #15805]  INFO -- : Begin applying migration version 1, direction: up
I, [2012-04-26T15:58:40.907706 #15805]  INFO -- : (0.000146s) BEGIN
I, [2012-04-26T15:58:40.913856 #15805]  INFO -- : (0.005761s) CREATE TABLE "users" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "username" text NOT NULL UNIQUE, "email" text NOT NULL UNIQUE, "pubkey_version" integer NOT NULL, "public_key" text, "serialized_object" text, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-04-26T15:58:40.914223 #15805]  INFO -- : (0.000173s) UPDATE "schema_info" SET "version" = 1
I, [2012-04-26T15:58:40.915501 #15805]  INFO -- : (0.001225s) COMMIT
I, [2012-04-26T15:58:40.915558 #15805]  INFO -- : Finished applying migration version 1, direction: up, took 0.008113 seconds
I, [2012-04-26T15:58:40.915612 #15805]  INFO -- : Begin applying migration version 2, direction: up
I, [2012-04-26T15:58:40.915762 #15805]  INFO -- : (0.000094s) BEGIN
I, [2012-04-26T15:58:40.919486 #15805]  INFO -- : (0.003351s) CREATE TABLE "nodes" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "environment" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" text, UNIQUE ("org_id", "name"))
I, [2012-04-26T15:58:40.920358 #15805]  INFO -- : (0.000738s) CREATE INDEX "nodes_org_id_index" ON "nodes" ("org_id")
I, [2012-04-26T15:58:40.921149 #15805]  INFO -- : (0.000675s) CREATE INDEX "nodes_org_id_environment_index" ON "nodes" ("org_id", "environment")
I, [2012-04-26T15:58:40.921409 #15805]  INFO -- : (0.000134s) UPDATE "schema_info" SET "version" = 2
I, [2012-04-26T15:58:40.922172 #15805]  INFO -- : (0.000709s) COMMIT
I, [2012-04-26T15:58:40.922231 #15805]  INFO -- : Finished applying migration version 2, direction: up, took 0.006616 seconds
I, [2012-04-26T15:58:40.922263 #15805]  INFO -- : Begin applying migration version 3, direction: up
I, [2012-04-26T15:58:40.922442 #15805]  INFO -- : (0.000126s) BEGIN
I, [2012-04-26T15:58:40.926210 #15805]  INFO -- : (0.003387s) CREATE TABLE "clients" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, "name" text NOT NULL, "public_key" text, "validator" boolean NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "pubkey_version" smallint NOT NULL, CONSTRAINT "org_id_name_unique" UNIQUE ("org_id", "name"))
I, [2012-04-26T15:58:40.927207 #15805]  INFO -- : (0.000890s) CREATE INDEX "clients_org_id_index" ON "clients" ("org_id")
I, [2012-04-26T15:58:40.927485 #15805]  INFO -- : (0.000155s) UPDATE "schema_info" SET "version" = 3
I, [2012-04-26T15:58:40.928177 #15805]  INFO -- : (0.000631s) COMMIT
I, [2012-04-26T15:58:40.928237 #15805]  INFO -- : Finished applying migration version 3, direction: up, took 0.005969 seconds
I, [2012-04-26T15:58:40.928270 #15805]  INFO -- : Begin applying migration version 4, direction: up
I, [2012-04-26T15:58:40.928459 #15805]  INFO -- : (0.000135s) BEGIN
I, [2012-04-26T15:58:40.932388 #15805]  INFO -- : (0.003590s) CREATE TABLE "roles" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T15:58:40.933375 #15805]  INFO -- : (0.000862s) CREATE INDEX "roles_org_id_index" ON "roles" ("org_id")
I, [2012-04-26T15:58:40.933630 #15805]  INFO -- : (0.000183s) ALTER TABLE roles ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T15:58:40.933916 #15805]  INFO -- : (0.000158s) UPDATE "schema_info" SET "version" = 4
I, [2012-04-26T15:58:40.934512 #15805]  INFO -- : (0.000536s) COMMIT
I, [2012-04-26T15:58:40.934560 #15805]  INFO -- : Finished applying migration version 4, direction: up, took 0.006286 seconds
I, [2012-04-26T15:58:40.934592 #15805]  INFO -- : Begin applying migration version 5, direction: up
I, [2012-04-26T15:58:40.934720 #15805]  INFO -- : (0.000081s) BEGIN
I, [2012-04-26T15:58:40.935028 #15805]  INFO -- : (0.000171s) ALTER TABLE "nodes" ADD COLUMN "last_audit_id" bytea
I, [2012-04-26T15:58:40.938588 #15805]  INFO -- : (0.003248s) CREATE TABLE "node_audit" ("audit_id" bytea NOT NULL, "node_id" char(32), "status" varchar(16), "start_time" timestamp NOT NULL, "end_time" timestamp NULL, "event_data" text NULL, PRIMARY KEY ("audit_id"), CONSTRAINT "node_id_fk" FOREIGN KEY ("node_id") REFERENCES "nodes")
I, [2012-04-26T15:58:40.939318 #15805]  INFO -- : (0.000601s) CREATE INDEX "node_audit_node_id_index" ON "node_audit" ("node_id")
I, [2012-04-26T15:58:40.942876 #15805]  INFO -- : (0.003152s) CREATE TABLE "node_audit_detail" ("audit_id" bytea NOT NULL, "seq" int NOT NULL, "duration" int NOT NULL, "res_id" varchar(255) NOT NULL, "res_type" varchar(16) NOT NULL, "res_name" varchar(255) NOT NULL, "res_result" varchar(16) NULL, "res_initial_state" text NULL, "res_final_state" text NULL, "delta" text NULL, PRIMARY KEY ("audit_id", "seq"), CONSTRAINT "audit_id_fk" FOREIGN KEY ("audit_id") REFERENCES "node_audit")
I, [2012-04-26T15:58:40.943190 #15805]  INFO -- : (0.000170s) UPDATE "schema_info" SET "version" = 5
I, [2012-04-26T15:58:40.944607 #15805]  INFO -- : (0.001339s) COMMIT
I, [2012-04-26T15:58:40.944667 #15805]  INFO -- : Finished applying migration version 5, direction: up, took 0.010071 seconds
I, [2012-04-26T15:58:40.944705 #15805]  INFO -- : Begin applying migration version 6, direction: up
I, [2012-04-26T15:58:40.945111 #15805]  INFO -- : (0.000340s) BEGIN
I, [2012-04-26T15:58:40.949228 #15805]  INFO -- : (0.003806s) CREATE TABLE "data_bags" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, UNIQUE ("org_id", "name"))
I, [2012-04-26T15:58:40.950238 #15805]  INFO -- : (0.000889s) CREATE INDEX "data_bags_org_id_index" ON "data_bags" ("org_id")
I, [2012-04-26T15:58:40.950537 #15805]  INFO -- : (0.000174s) UPDATE "schema_info" SET "version" = 6
I, [2012-04-26T15:58:40.951746 #15805]  INFO -- : (0.001152s) COMMIT
I, [2012-04-26T15:58:40.951809 #15805]  INFO -- : Finished applying migration version 6, direction: up, took 0.007099 seconds
I, [2012-04-26T15:58:40.951841 #15805]  INFO -- : Begin applying migration version 7, direction: up
I, [2012-04-26T15:58:40.952154 #15805]  INFO -- : (0.000257s) BEGIN
I, [2012-04-26T15:58:40.955511 #15805]  INFO -- : (0.003002s) CREATE TABLE "data_bag_items" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "data_bag_name" text NOT NULL, "item_name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "data_bag_name", "item_name"))
I, [2012-04-26T15:58:40.956306 #15805]  INFO -- : (0.000680s) CREATE INDEX "data_bag_items_org_id_index" ON "data_bag_items" ("org_id")
I, [2012-04-26T15:58:40.956507 #15805]  INFO -- : (0.000142s) ALTER TABLE data_bag_items ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T15:58:40.956749 #15805]  INFO -- : (0.000132s) UPDATE "schema_info" SET "version" = 7
I, [2012-04-26T15:58:40.958243 #15805]  INFO -- : (0.001429s) COMMIT
I, [2012-04-26T15:58:40.958300 #15805]  INFO -- : Finished applying migration version 7, direction: up, took 0.006455 seconds
I, [2012-04-26T15:58:40.958333 #15805]  INFO -- : Begin applying migration version 8, direction: up
I, [2012-04-26T15:58:40.958513 #15805]  INFO -- : (0.000133s) BEGIN
I, [2012-04-26T15:58:40.962479 #15805]  INFO -- : (0.003632s) CREATE TABLE "environments" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T15:58:40.963612 #15805]  INFO -- : (0.001012s) CREATE INDEX "environments_org_id_index" ON "environments" ("org_id")
I, [2012-04-26T15:58:40.963866 #15805]  INFO -- : (0.000176s) ALTER TABLE environments ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T15:58:40.964131 #15805]  INFO -- : (0.000138s) UPDATE "schema_info" SET "version" = 8
I, [2012-04-26T15:58:40.964821 #15805]  INFO -- : (0.000633s) COMMIT
I, [2012-04-26T15:58:40.964883 #15805]  INFO -- : Finished applying migration version 8, direction: up, took 0.006545 seconds
I, [2012-04-26T15:58:40.964915 #15805]  INFO -- : Begin applying migration version 9, direction: up
I, [2012-04-26T15:58:40.965098 #15805]  INFO -- : (0.000124s) BEGIN
I, [2012-04-26T15:58:40.966648 #15805]  INFO -- : (0.001360s) ALTER TABLE "data_bag_items" ADD FOREIGN KEY ("org_id", "data_bag_name") REFERENCES "data_bags"("org_id", "name") ON DELETE CASCADE ON UPDATE CASCADE
I, [2012-04-26T15:58:40.966946 #15805]  INFO -- : (0.000165s) UPDATE "schema_info" SET "version" = 9
I, [2012-04-26T15:58:40.967483 #15805]  INFO -- : (0.000485s) COMMIT
I, [2012-04-26T15:58:40.967532 #15805]  INFO -- : Finished applying migration version 9, direction: up, took 0.002612 seconds
I, [2012-04-26T15:58:40.967566 #15805]  INFO -- : Begin applying migration version 10, direction: up
I, [2012-04-26T15:58:40.967689 #15805]  INFO -- : (0.000075s) BEGIN
I, [2012-04-26T15:58:40.968100 #15805]  INFO -- : (0.000307s) DROP INDEX "clients_org_id_index"
I, [2012-04-26T15:58:40.968360 #15805]  INFO -- : (0.000162s) DROP INDEX "environments_org_id_index"
I, [2012-04-26T15:58:40.968773 #15805]  INFO -- : (0.000304s) DROP INDEX "nodes_org_id_index"
I, [2012-04-26T15:58:40.969045 #15805]  INFO -- : (0.000169s) DROP INDEX "roles_org_id_index"
I, [2012-04-26T15:58:40.969285 #15805]  INFO -- : (0.000144s) DROP INDEX "data_bags_org_id_index"
I, [2012-04-26T15:58:40.969518 #15805]  INFO -- : (0.000140s) DROP INDEX "data_bag_items_org_id_index"
I, [2012-04-26T15:58:40.969725 #15805]  INFO -- : (0.000111s) UPDATE "schema_info" SET "version" = 10
I, [2012-04-26T15:58:40.970660 #15805]  INFO -- : (0.000888s) COMMIT
I, [2012-04-26T15:58:40.970709 #15805]  INFO -- : Finished applying migration version 10, direction: up, took 0.003141 seconds
I, [2012-04-26T15:58:40.970740 #15805]  INFO -- : Begin applying migration version 11, direction: up
I, [2012-04-26T15:58:40.970901 #15805]  INFO -- : (0.000111s) BEGIN
I, [2012-04-26T15:58:40.971255 #15805]  INFO -- : (0.000172s) ALTER TABLE "users" ADD COLUMN "external_authentication_uid" text NULL
I, [2012-04-26T15:58:40.971442 #15805]  INFO -- : (0.000142s) ALTER TABLE "users" ADD COLUMN "recovery_authentication_enabled" boolean NULL
I, [2012-04-26T15:58:40.971612 #15805]  INFO -- : (0.000127s) ALTER TABLE "users" ALTER COLUMN "email" DROP NOT NULL
I, [2012-04-26T15:58:40.971805 #15805]  INFO -- : (0.000103s) UPDATE "schema_info" SET "version" = 11
I, [2012-04-26T15:58:40.972318 #15805]  INFO -- : (0.000470s) COMMIT
I, [2012-04-26T15:58:40.972363 #15805]  INFO -- : Finished applying migration version 11, direction: up, took 0.001620 seconds
I, [2012-04-26T16:01:54.590638 #15982]  INFO -- : (0.000354s) SET standard_conforming_strings = ON
I, [2012-04-26T16:01:54.590969 #15982]  INFO -- : (0.000195s) SET client_min_messages = 'WARNING'
I, [2012-04-26T16:01:54.591148 #15982]  INFO -- : (0.000118s) SET DateStyle = 'ISO'
E, [2012-04-26T16:01:54.598756 #15982] ERROR -- : PG::Error: ERROR:  relation "schema_info" does not exist
LINE 1: SELECT NULL FROM "schema_info" LIMIT 1
                         ^: SELECT NULL FROM "schema_info" LIMIT 1
I, [2012-04-26T16:01:54.603680 #15982]  INFO -- : (0.004660s) CREATE TABLE "schema_info" ("version" integer DEFAULT 0 NOT NULL)
I, [2012-04-26T16:01:54.604438 #15982]  INFO -- : (0.000558s) SELECT 1 AS "one" FROM "schema_info" LIMIT 1
I, [2012-04-26T16:01:54.606432 #15982]  INFO -- : (0.001790s) SELECT pg_attribute.attname FROM pg_class, pg_attribute, pg_index, pg_namespace WHERE pg_class.oid = pg_attribute.attrelid AND pg_class.relnamespace = pg_namespace.oid AND pg_class.oid = pg_index.indrelid AND pg_index.indkey[0] = pg_attribute.attnum AND pg_index.indisprimary = 't' AND pg_class.relname = 'schema_info'
I, [2012-04-26T16:01:54.607284 #15982]  INFO -- : (0.000659s) INSERT INTO "schema_info" ("version") VALUES (0) RETURNING NULL
I, [2012-04-26T16:01:54.607926 #15982]  INFO -- : (0.000400s) SELECT COUNT(*) AS "count" FROM "schema_info" LIMIT 1
I, [2012-04-26T16:01:54.608327 #15982]  INFO -- : (0.000219s) SELECT "version" FROM "schema_info" LIMIT 1
I, [2012-04-26T16:01:54.624046 #15982]  INFO -- : Begin applying migration version 1, direction: up
I, [2012-04-26T16:01:54.624290 #15982]  INFO -- : (0.000138s) BEGIN
I, [2012-04-26T16:01:54.630252 #15982]  INFO -- : (0.005594s) CREATE TABLE "users" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "username" text NOT NULL UNIQUE, "email" text NOT NULL UNIQUE, "pubkey_version" integer NOT NULL, "public_key" text, "serialized_object" text, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-04-26T16:01:54.630644 #15982]  INFO -- : (0.000204s) UPDATE "schema_info" SET "version" = 1
I, [2012-04-26T16:01:54.631627 #15982]  INFO -- : (0.000915s) COMMIT
I, [2012-04-26T16:01:54.631691 #15982]  INFO -- : Finished applying migration version 1, direction: up, took 0.007650 seconds
I, [2012-04-26T16:01:54.631724 #15982]  INFO -- : Begin applying migration version 2, direction: up
I, [2012-04-26T16:01:54.631904 #15982]  INFO -- : (0.000124s) BEGIN
I, [2012-04-26T16:01:54.636299 #15982]  INFO -- : (0.003994s) CREATE TABLE "nodes" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "environment" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" text, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:01:54.637398 #15982]  INFO -- : (0.000851s) CREATE INDEX "nodes_org_id_index" ON "nodes" ("org_id")
I, [2012-04-26T16:01:54.638365 #15982]  INFO -- : (0.000769s) CREATE INDEX "nodes_org_id_environment_index" ON "nodes" ("org_id", "environment")
I, [2012-04-26T16:01:54.638691 #15982]  INFO -- : (0.000180s) UPDATE "schema_info" SET "version" = 2
I, [2012-04-26T16:01:54.639580 #15982]  INFO -- : (0.000817s) COMMIT
I, [2012-04-26T16:01:54.639641 #15982]  INFO -- : Finished applying migration version 2, direction: up, took 0.007913 seconds
I, [2012-04-26T16:01:54.639674 #15982]  INFO -- : Begin applying migration version 3, direction: up
I, [2012-04-26T16:01:54.639893 #15982]  INFO -- : (0.000162s) BEGIN
I, [2012-04-26T16:01:54.644340 #15982]  INFO -- : (0.004030s) CREATE TABLE "clients" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, "name" text NOT NULL, "public_key" text, "validator" boolean NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "pubkey_version" smallint NOT NULL, CONSTRAINT "org_id_name_unique" UNIQUE ("org_id", "name"))
I, [2012-04-26T16:01:54.645177 #15982]  INFO -- : (0.000712s) CREATE INDEX "clients_org_id_index" ON "clients" ("org_id")
I, [2012-04-26T16:01:54.645433 #15982]  INFO -- : (0.000135s) UPDATE "schema_info" SET "version" = 3
I, [2012-04-26T16:01:54.646391 #15982]  INFO -- : (0.000903s) COMMIT
I, [2012-04-26T16:01:54.646450 #15982]  INFO -- : Finished applying migration version 3, direction: up, took 0.006771 seconds
I, [2012-04-26T16:01:54.646484 #15982]  INFO -- : Begin applying migration version 4, direction: up
I, [2012-04-26T16:01:54.646750 #15982]  INFO -- : (0.000219s) BEGIN
I, [2012-04-26T16:01:54.650866 #15982]  INFO -- : (0.003776s) CREATE TABLE "roles" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:01:54.651730 #15982]  INFO -- : (0.000646s) CREATE INDEX "roles_org_id_index" ON "roles" ("org_id")
I, [2012-04-26T16:01:54.651980 #15982]  INFO -- : (0.000174s) ALTER TABLE roles ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T16:01:54.652287 #15982]  INFO -- : (0.000166s) UPDATE "schema_info" SET "version" = 4
I, [2012-04-26T16:01:54.652878 #15982]  INFO -- : (0.000511s) COMMIT
I, [2012-04-26T16:01:54.652936 #15982]  INFO -- : Finished applying migration version 4, direction: up, took 0.006447 seconds
I, [2012-04-26T16:01:54.652977 #15982]  INFO -- : Begin applying migration version 5, direction: up
I, [2012-04-26T16:01:54.653131 #15982]  INFO -- : (0.000101s) BEGIN
I, [2012-04-26T16:01:54.653481 #15982]  INFO -- : (0.000192s) ALTER TABLE "nodes" ADD COLUMN "last_audit_id" bytea
I, [2012-04-26T16:01:54.657558 #15982]  INFO -- : (0.003746s) CREATE TABLE "node_audit" ("audit_id" bytea NOT NULL, "node_id" char(32), "status" varchar(16), "start_time" timestamp NOT NULL, "end_time" timestamp NULL, "event_data" text NULL, PRIMARY KEY ("audit_id"), CONSTRAINT "node_id_fk" FOREIGN KEY ("node_id") REFERENCES "nodes")
I, [2012-04-26T16:01:54.658586 #15982]  INFO -- : (0.000795s) CREATE INDEX "node_audit_node_id_index" ON "node_audit" ("node_id")
I, [2012-04-26T16:01:54.662582 #15982]  INFO -- : (0.003513s) CREATE TABLE "node_audit_detail" ("audit_id" bytea NOT NULL, "seq" int NOT NULL, "duration" int NOT NULL, "res_id" varchar(255) NOT NULL, "res_type" varchar(16) NOT NULL, "res_name" varchar(255) NOT NULL, "res_result" varchar(16) NULL, "res_initial_state" text NULL, "res_final_state" text NULL, "delta" text NULL, PRIMARY KEY ("audit_id", "seq"), CONSTRAINT "audit_id_fk" FOREIGN KEY ("audit_id") REFERENCES "node_audit")
I, [2012-04-26T16:01:54.662931 #15982]  INFO -- : (0.000174s) UPDATE "schema_info" SET "version" = 5
I, [2012-04-26T16:01:54.664014 #15982]  INFO -- : (0.001020s) COMMIT
I, [2012-04-26T16:01:54.664093 #15982]  INFO -- : Finished applying migration version 5, direction: up, took 0.011111 seconds
I, [2012-04-26T16:01:54.664130 #15982]  INFO -- : Begin applying migration version 6, direction: up
I, [2012-04-26T16:01:54.664329 #15982]  INFO -- : (0.000136s) BEGIN
I, [2012-04-26T16:01:54.668399 #15982]  INFO -- : (0.003713s) CREATE TABLE "data_bags" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:01:54.669436 #15982]  INFO -- : (0.000869s) CREATE INDEX "data_bags_org_id_index" ON "data_bags" ("org_id")
I, [2012-04-26T16:01:54.669830 #15982]  INFO -- : (0.000210s) UPDATE "schema_info" SET "version" = 6
I, [2012-04-26T16:01:54.670474 #15982]  INFO -- : (0.000539s) COMMIT
I, [2012-04-26T16:01:54.670569 #15982]  INFO -- : Finished applying migration version 6, direction: up, took 0.006429 seconds
I, [2012-04-26T16:01:54.670620 #15982]  INFO -- : Begin applying migration version 7, direction: up
I, [2012-04-26T16:01:54.670855 #15982]  INFO -- : (0.000158s) BEGIN
I, [2012-04-26T16:01:54.674750 #15982]  INFO -- : (0.003482s) CREATE TABLE "data_bag_items" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "data_bag_name" text NOT NULL, "item_name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "data_bag_name", "item_name"))
I, [2012-04-26T16:01:54.675640 #15982]  INFO -- : (0.000732s) CREATE INDEX "data_bag_items_org_id_index" ON "data_bag_items" ("org_id")
I, [2012-04-26T16:01:54.675928 #15982]  INFO -- : (0.000218s) ALTER TABLE data_bag_items ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T16:01:54.676209 #15982]  INFO -- : (0.000151s) UPDATE "schema_info" SET "version" = 7
I, [2012-04-26T16:01:54.677071 #15982]  INFO -- : (0.000810s) COMMIT
I, [2012-04-26T16:01:54.677125 #15982]  INFO -- : Finished applying migration version 7, direction: up, took 0.006505 seconds
I, [2012-04-26T16:01:54.677158 #15982]  INFO -- : Begin applying migration version 8, direction: up
I, [2012-04-26T16:01:54.677344 #15982]  INFO -- : (0.000135s) BEGIN
I, [2012-04-26T16:01:54.681783 #15982]  INFO -- : (0.004077s) CREATE TABLE "environments" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:01:54.682680 #15982]  INFO -- : (0.000731s) CREATE INDEX "environments_org_id_index" ON "environments" ("org_id")
I, [2012-04-26T16:01:54.682949 #15982]  INFO -- : (0.000187s) ALTER TABLE environments ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T16:01:54.683292 #15982]  INFO -- : (0.000165s) UPDATE "schema_info" SET "version" = 8
I, [2012-04-26T16:01:54.683882 #15982]  INFO -- : (0.000512s) COMMIT
I, [2012-04-26T16:01:54.683968 #15982]  INFO -- : Finished applying migration version 8, direction: up, took 0.006801 seconds
I, [2012-04-26T16:01:54.684008 #15982]  INFO -- : Begin applying migration version 9, direction: up
I, [2012-04-26T16:01:54.684195 #15982]  INFO -- : (0.000118s) BEGIN
I, [2012-04-26T16:01:54.686387 #15982]  INFO -- : (0.001933s) ALTER TABLE "data_bag_items" ADD FOREIGN KEY ("org_id", "data_bag_name") REFERENCES "data_bags"("org_id", "name") ON DELETE CASCADE ON UPDATE CASCADE
I, [2012-04-26T16:01:54.686717 #15982]  INFO -- : (0.000179s) UPDATE "schema_info" SET "version" = 9
I, [2012-04-26T16:01:54.687546 #15982]  INFO -- : (0.000773s) COMMIT
I, [2012-04-26T16:01:54.687607 #15982]  INFO -- : Finished applying migration version 9, direction: up, took 0.003596 seconds
I, [2012-04-26T16:01:54.687641 #15982]  INFO -- : Begin applying migration version 10, direction: up
I, [2012-04-26T16:01:54.687784 #15982]  INFO -- : (0.000092s) BEGIN
I, [2012-04-26T16:01:54.688253 #15982]  INFO -- : (0.000348s) DROP INDEX "clients_org_id_index"
I, [2012-04-26T16:01:54.688637 #15982]  INFO -- : (0.000281s) DROP INDEX "environments_org_id_index"
I, [2012-04-26T16:01:54.688901 #15982]  INFO -- : (0.000156s) DROP INDEX "nodes_org_id_index"
I, [2012-04-26T16:01:54.689136 #15982]  INFO -- : (0.000144s) DROP INDEX "roles_org_id_index"
I, [2012-04-26T16:01:54.689366 #15982]  INFO -- : (0.000141s) DROP INDEX "data_bags_org_id_index"
I, [2012-04-26T16:01:54.689598 #15982]  INFO -- : (0.000143s) DROP INDEX "data_bag_items_org_id_index"
I, [2012-04-26T16:01:54.689878 #15982]  INFO -- : (0.000171s) UPDATE "schema_info" SET "version" = 10
I, [2012-04-26T16:01:54.690939 #15982]  INFO -- : (0.000982s) COMMIT
I, [2012-04-26T16:01:54.691030 #15982]  INFO -- : Finished applying migration version 10, direction: up, took 0.003382 seconds
I, [2012-04-26T16:01:54.691070 #15982]  INFO -- : Begin applying migration version 11, direction: up
I, [2012-04-26T16:01:54.691247 #15982]  INFO -- : (0.000115s) BEGIN
I, [2012-04-26T16:01:54.691729 #15982]  INFO -- : (0.000239s) ALTER TABLE "users" ADD COLUMN "external_authentication_uid" text NULL
I, [2012-04-26T16:01:54.691990 #15982]  INFO -- : (0.000198s) ALTER TABLE "users" ADD COLUMN "recovery_authentication_enabled" boolean NULL
I, [2012-04-26T16:01:54.692257 #15982]  INFO -- : (0.000201s) ALTER TABLE "users" ALTER COLUMN "email" DROP NOT NULL
I, [2012-04-26T16:01:54.692575 #15982]  INFO -- : (0.000185s) UPDATE "schema_info" SET "version" = 11
I, [2012-04-26T16:01:54.693057 #15982]  INFO -- : (0.000408s) COMMIT
I, [2012-04-26T16:01:54.693118 #15982]  INFO -- : Finished applying migration version 11, direction: up, took 0.002044 seconds
I, [2012-04-26T16:04:40.286314 #16159]  INFO -- : (0.000457s) SET standard_conforming_strings = ON
I, [2012-04-26T16:04:40.286527 #16159]  INFO -- : (0.000082s) SET client_min_messages = 'WARNING'
I, [2012-04-26T16:04:40.286651 #16159]  INFO -- : (0.000078s) SET DateStyle = 'ISO'
E, [2012-04-26T16:04:40.294534 #16159] ERROR -- : PG::Error: ERROR:  relation "schema_info" does not exist
LINE 1: SELECT NULL FROM "schema_info" LIMIT 1
                         ^: SELECT NULL FROM "schema_info" LIMIT 1
I, [2012-04-26T16:04:40.300288 #16159]  INFO -- : (0.005482s) CREATE TABLE "schema_info" ("version" integer DEFAULT 0 NOT NULL)
I, [2012-04-26T16:04:40.301182 #16159]  INFO -- : (0.000638s) SELECT 1 AS "one" FROM "schema_info" LIMIT 1
I, [2012-04-26T16:04:40.303670 #16159]  INFO -- : (0.002288s) SELECT pg_attribute.attname FROM pg_class, pg_attribute, pg_index, pg_namespace WHERE pg_class.oid = pg_attribute.attrelid AND pg_class.relnamespace = pg_namespace.oid AND pg_class.oid = pg_index.indrelid AND pg_index.indkey[0] = pg_attribute.attnum AND pg_index.indisprimary = 't' AND pg_class.relname = 'schema_info'
I, [2012-04-26T16:04:40.304461 #16159]  INFO -- : (0.000563s) INSERT INTO "schema_info" ("version") VALUES (0) RETURNING NULL
I, [2012-04-26T16:04:40.305015 #16159]  INFO -- : (0.000316s) SELECT COUNT(*) AS "count" FROM "schema_info" LIMIT 1
I, [2012-04-26T16:04:40.305315 #16159]  INFO -- : (0.000125s) SELECT "version" FROM "schema_info" LIMIT 1
I, [2012-04-26T16:04:40.320554 #16159]  INFO -- : Begin applying migration version 1, direction: up
I, [2012-04-26T16:04:40.320802 #16159]  INFO -- : (0.000136s) BEGIN
I, [2012-04-26T16:04:40.326963 #16159]  INFO -- : (0.005754s) CREATE TABLE "users" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "username" text NOT NULL UNIQUE, "email" text NOT NULL UNIQUE, "pubkey_version" integer NOT NULL, "public_key" text, "serialized_object" text, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-04-26T16:04:40.327615 #16159]  INFO -- : (0.000349s) UPDATE "schema_info" SET "version" = 1
I, [2012-04-26T16:04:40.328336 #16159]  INFO -- : (0.000662s) COMMIT
I, [2012-04-26T16:04:40.328401 #16159]  INFO -- : Finished applying migration version 1, direction: up, took 0.007850 seconds
I, [2012-04-26T16:04:40.328435 #16159]  INFO -- : Begin applying migration version 2, direction: up
I, [2012-04-26T16:04:40.328632 #16159]  INFO -- : (0.000141s) BEGIN
I, [2012-04-26T16:04:40.333340 #16159]  INFO -- : (0.004319s) CREATE TABLE "nodes" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "environment" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" text, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:04:40.334170 #16159]  INFO -- : (0.000662s) CREATE INDEX "nodes_org_id_index" ON "nodes" ("org_id")
I, [2012-04-26T16:04:40.335129 #16159]  INFO -- : (0.000841s) CREATE INDEX "nodes_org_id_environment_index" ON "nodes" ("org_id", "environment")
I, [2012-04-26T16:04:40.335484 #16159]  INFO -- : (0.000162s) UPDATE "schema_info" SET "version" = 2
I, [2012-04-26T16:04:40.336251 #16159]  INFO -- : (0.000707s) COMMIT
I, [2012-04-26T16:04:40.336309 #16159]  INFO -- : Finished applying migration version 2, direction: up, took 0.007871 seconds
I, [2012-04-26T16:04:40.336343 #16159]  INFO -- : Begin applying migration version 3, direction: up
I, [2012-04-26T16:04:40.336521 #16159]  INFO -- : (0.000120s) BEGIN
I, [2012-04-26T16:04:40.341116 #16159]  INFO -- : (0.004159s) CREATE TABLE "clients" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, "name" text NOT NULL, "public_key" text, "validator" boolean NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "pubkey_version" smallint NOT NULL, CONSTRAINT "org_id_name_unique" UNIQUE ("org_id", "name"))
I, [2012-04-26T16:04:40.342314 #16159]  INFO -- : (0.000975s) CREATE INDEX "clients_org_id_index" ON "clients" ("org_id")
I, [2012-04-26T16:04:40.342735 #16159]  INFO -- : (0.000235s) UPDATE "schema_info" SET "version" = 3
I, [2012-04-26T16:04:40.343452 #16159]  INFO -- : (0.000630s) COMMIT
I, [2012-04-26T16:04:40.343514 #16159]  INFO -- : Finished applying migration version 3, direction: up, took 0.007166 seconds
I, [2012-04-26T16:04:40.343548 #16159]  INFO -- : Begin applying migration version 4, direction: up
I, [2012-04-26T16:04:40.343734 #16159]  INFO -- : (0.000130s) BEGIN
I, [2012-04-26T16:04:40.348279 #16159]  INFO -- : (0.004134s) CREATE TABLE "roles" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:04:40.349143 #16159]  INFO -- : (0.000708s) CREATE INDEX "roles_org_id_index" ON "roles" ("org_id")
I, [2012-04-26T16:04:40.349410 #16159]  INFO -- : (0.000201s) ALTER TABLE roles ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T16:04:40.349688 #16159]  INFO -- : (0.000145s) UPDATE "schema_info" SET "version" = 4
I, [2012-04-26T16:04:40.350608 #16159]  INFO -- : (0.000864s) COMMIT
I, [2012-04-26T16:04:40.350685 #16159]  INFO -- : Finished applying migration version 4, direction: up, took 0.007132 seconds
I, [2012-04-26T16:04:40.350720 #16159]  INFO -- : Begin applying migration version 5, direction: up
I, [2012-04-26T16:04:40.350899 #16159]  INFO -- : (0.000123s) BEGIN
I, [2012-04-26T16:04:40.351278 #16159]  INFO -- : (0.000212s) ALTER TABLE "nodes" ADD COLUMN "last_audit_id" bytea
I, [2012-04-26T16:04:40.355535 #16159]  INFO -- : (0.003922s) CREATE TABLE "node_audit" ("audit_id" bytea NOT NULL, "node_id" char(32), "status" varchar(16), "start_time" timestamp NOT NULL, "end_time" timestamp NULL, "event_data" text NULL, PRIMARY KEY ("audit_id"), CONSTRAINT "node_id_fk" FOREIGN KEY ("node_id") REFERENCES "nodes")
I, [2012-04-26T16:04:40.356500 #16159]  INFO -- : (0.000754s) CREATE INDEX "node_audit_node_id_index" ON "node_audit" ("node_id")
I, [2012-04-26T16:04:40.360522 #16159]  INFO -- : (0.003401s) CREATE TABLE "node_audit_detail" ("audit_id" bytea NOT NULL, "seq" int NOT NULL, "duration" int NOT NULL, "res_id" varchar(255) NOT NULL, "res_type" varchar(16) NOT NULL, "res_name" varchar(255) NOT NULL, "res_result" varchar(16) NULL, "res_initial_state" text NULL, "res_final_state" text NULL, "delta" text NULL, PRIMARY KEY ("audit_id", "seq"), CONSTRAINT "audit_id_fk" FOREIGN KEY ("audit_id") REFERENCES "node_audit")
I, [2012-04-26T16:04:40.360834 #16159]  INFO -- : (0.000152s) UPDATE "schema_info" SET "version" = 5
I, [2012-04-26T16:04:40.361863 #16159]  INFO -- : (0.000971s) COMMIT
I, [2012-04-26T16:04:40.361929 #16159]  INFO -- : Finished applying migration version 5, direction: up, took 0.011205 seconds
I, [2012-04-26T16:04:40.361963 #16159]  INFO -- : Begin applying migration version 6, direction: up
I, [2012-04-26T16:04:40.362252 #16159]  INFO -- : (0.000232s) BEGIN
I, [2012-04-26T16:04:40.366548 #16159]  INFO -- : (0.003957s) CREATE TABLE "data_bags" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:04:40.367427 #16159]  INFO -- : (0.000709s) CREATE INDEX "data_bags_org_id_index" ON "data_bags" ("org_id")
I, [2012-04-26T16:04:40.367753 #16159]  INFO -- : (0.000171s) UPDATE "schema_info" SET "version" = 6
I, [2012-04-26T16:04:40.368739 #16159]  INFO -- : (0.000920s) COMMIT
I, [2012-04-26T16:04:40.368819 #16159]  INFO -- : Finished applying migration version 6, direction: up, took 0.006850 seconds
I, [2012-04-26T16:04:40.368876 #16159]  INFO -- : Begin applying migration version 7, direction: up
I, [2012-04-26T16:04:40.369103 #16159]  INFO -- : (0.000139s) BEGIN
I, [2012-04-26T16:04:40.373052 #16159]  INFO -- : (0.003419s) CREATE TABLE "data_bag_items" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "data_bag_name" text NOT NULL, "item_name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "data_bag_name", "item_name"))
I, [2012-04-26T16:04:40.374081 #16159]  INFO -- : (0.000891s) CREATE INDEX "data_bag_items_org_id_index" ON "data_bag_items" ("org_id")
I, [2012-04-26T16:04:40.374388 #16159]  INFO -- : (0.000215s) ALTER TABLE data_bag_items ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T16:04:40.374763 #16159]  INFO -- : (0.000195s) UPDATE "schema_info" SET "version" = 7
I, [2012-04-26T16:04:40.375372 #16159]  INFO -- : (0.000524s) COMMIT
I, [2012-04-26T16:04:40.375439 #16159]  INFO -- : Finished applying migration version 7, direction: up, took 0.006562 seconds
I, [2012-04-26T16:04:40.375474 #16159]  INFO -- : Begin applying migration version 8, direction: up
I, [2012-04-26T16:04:40.375675 #16159]  INFO -- : (0.000140s) BEGIN
I, [2012-04-26T16:04:40.380345 #16159]  INFO -- : (0.004256s) CREATE TABLE "environments" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:04:40.381227 #16159]  INFO -- : (0.000719s) CREATE INDEX "environments_org_id_index" ON "environments" ("org_id")
I, [2012-04-26T16:04:40.381449 #16159]  INFO -- : (0.000162s) ALTER TABLE environments ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T16:04:40.381713 #16159]  INFO -- : (0.000143s) UPDATE "schema_info" SET "version" = 8
I, [2012-04-26T16:04:40.383072 #16159]  INFO -- : (0.001304s) COMMIT
I, [2012-04-26T16:04:40.383137 #16159]  INFO -- : Finished applying migration version 8, direction: up, took 0.007659 seconds
I, [2012-04-26T16:04:40.383170 #16159]  INFO -- : Begin applying migration version 9, direction: up
I, [2012-04-26T16:04:40.383393 #16159]  INFO -- : (0.000171s) BEGIN
I, [2012-04-26T16:04:40.385005 #16159]  INFO -- : (0.001439s) ALTER TABLE "data_bag_items" ADD FOREIGN KEY ("org_id", "data_bag_name") REFERENCES "data_bags"("org_id", "name") ON DELETE CASCADE ON UPDATE CASCADE
I, [2012-04-26T16:04:40.385306 #16159]  INFO -- : (0.000193s) UPDATE "schema_info" SET "version" = 9
I, [2012-04-26T16:04:40.385905 #16159]  INFO -- : (0.000544s) COMMIT
I, [2012-04-26T16:04:40.385971 #16159]  INFO -- : Finished applying migration version 9, direction: up, took 0.002792 seconds
I, [2012-04-26T16:04:40.386006 #16159]  INFO -- : Begin applying migration version 10, direction: up
I, [2012-04-26T16:04:40.386185 #16159]  INFO -- : (0.000130s) BEGIN
I, [2012-04-26T16:04:40.386642 #16159]  INFO -- : (0.000346s) DROP INDEX "clients_org_id_index"
I, [2012-04-26T16:04:40.386931 #16159]  INFO -- : (0.000187s) DROP INDEX "environments_org_id_index"
I, [2012-04-26T16:04:40.387309 #16159]  INFO -- : (0.000245s) DROP INDEX "nodes_org_id_index"
I, [2012-04-26T16:04:40.387674 #16159]  INFO -- : (0.000223s) DROP INDEX "roles_org_id_index"
I, [2012-04-26T16:04:40.388016 #16159]  INFO -- : (0.000211s) DROP INDEX "data_bags_org_id_index"
I, [2012-04-26T16:04:40.388392 #16159]  INFO -- : (0.000229s) DROP INDEX "data_bag_items_org_id_index"
I, [2012-04-26T16:04:40.388710 #16159]  INFO -- : (0.000185s) UPDATE "schema_info" SET "version" = 10
I, [2012-04-26T16:04:40.389607 #16159]  INFO -- : (0.000826s) COMMIT
I, [2012-04-26T16:04:40.389670 #16159]  INFO -- : Finished applying migration version 10, direction: up, took 0.003659 seconds
I, [2012-04-26T16:04:40.389707 #16159]  INFO -- : Begin applying migration version 11, direction: up
I, [2012-04-26T16:04:40.389841 #16159]  INFO -- : (0.000082s) BEGIN
I, [2012-04-26T16:04:40.390439 #16159]  INFO -- : (0.000302s) ALTER TABLE "users" ADD COLUMN "external_authentication_uid" text NULL
I, [2012-04-26T16:04:40.390781 #16159]  INFO -- : (0.000264s) ALTER TABLE "users" ADD COLUMN "recovery_authentication_enabled" boolean NULL
I, [2012-04-26T16:04:40.391040 #16159]  INFO -- : (0.000180s) ALTER TABLE "users" ALTER COLUMN "email" DROP NOT NULL
I, [2012-04-26T16:04:40.391338 #16159]  INFO -- : (0.000158s) UPDATE "schema_info" SET "version" = 11
I, [2012-04-26T16:04:40.391955 #16159]  INFO -- : (0.000544s) COMMIT
I, [2012-04-26T16:04:40.392008 #16159]  INFO -- : Finished applying migration version 11, direction: up, took 0.002298 seconds
I, [2012-04-26T16:19:44.170896 #16402]  INFO -- : (0.000398s) SET standard_conforming_strings = ON
I, [2012-04-26T16:19:44.171130 #16402]  INFO -- : (0.000102s) SET client_min_messages = 'WARNING'
I, [2012-04-26T16:19:44.171348 #16402]  INFO -- : (0.000162s) SET DateStyle = 'ISO'
E, [2012-04-26T16:19:44.178902 #16402] ERROR -- : PG::Error: ERROR:  relation "schema_info" does not exist
LINE 1: SELECT NULL FROM "schema_info" LIMIT 1
                         ^: SELECT NULL FROM "schema_info" LIMIT 1
I, [2012-04-26T16:19:44.184153 #16402]  INFO -- : (0.004985s) CREATE TABLE "schema_info" ("version" integer DEFAULT 0 NOT NULL)
I, [2012-04-26T16:19:44.185097 #16402]  INFO -- : (0.000744s) SELECT 1 AS "one" FROM "schema_info" LIMIT 1
I, [2012-04-26T16:19:44.187115 #16402]  INFO -- : (0.001827s) SELECT pg_attribute.attname FROM pg_class, pg_attribute, pg_index, pg_namespace WHERE pg_class.oid = pg_attribute.attrelid AND pg_class.relnamespace = pg_namespace.oid AND pg_class.oid = pg_index.indrelid AND pg_index.indkey[0] = pg_attribute.attnum AND pg_index.indisprimary = 't' AND pg_class.relname = 'schema_info'
I, [2012-04-26T16:19:44.188152 #16402]  INFO -- : (0.000811s) INSERT INTO "schema_info" ("version") VALUES (0) RETURNING NULL
I, [2012-04-26T16:19:44.188752 #16402]  INFO -- : (0.000351s) SELECT COUNT(*) AS "count" FROM "schema_info" LIMIT 1
I, [2012-04-26T16:19:44.189090 #16402]  INFO -- : (0.000142s) SELECT "version" FROM "schema_info" LIMIT 1
I, [2012-04-26T16:19:44.204621 #16402]  INFO -- : Begin applying migration version 1, direction: up
I, [2012-04-26T16:19:44.204874 #16402]  INFO -- : (0.000135s) BEGIN
I, [2012-04-26T16:19:44.210210 #16402]  INFO -- : (0.004939s) CREATE TABLE "users" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "username" text NOT NULL UNIQUE, "email" text NOT NULL UNIQUE, "pubkey_version" integer NOT NULL, "public_key" text, "serialized_object" text, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-04-26T16:19:44.210624 #16402]  INFO -- : (0.000216s) UPDATE "schema_info" SET "version" = 1
I, [2012-04-26T16:19:44.211641 #16402]  INFO -- : (0.000954s) COMMIT
I, [2012-04-26T16:19:44.211737 #16402]  INFO -- : Finished applying migration version 1, direction: up, took 0.007112 seconds
I, [2012-04-26T16:19:44.211778 #16402]  INFO -- : Begin applying migration version 2, direction: up
I, [2012-04-26T16:19:44.211938 #16402]  INFO -- : (0.000105s) BEGIN
I, [2012-04-26T16:19:44.216394 #16402]  INFO -- : (0.004041s) CREATE TABLE "nodes" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "environment" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" text, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:19:44.217586 #16402]  INFO -- : (0.000947s) CREATE INDEX "nodes_org_id_index" ON "nodes" ("org_id")
I, [2012-04-26T16:19:44.218541 #16402]  INFO -- : (0.000741s) CREATE INDEX "nodes_org_id_environment_index" ON "nodes" ("org_id", "environment")
I, [2012-04-26T16:19:44.219119 #16402]  INFO -- : (0.000385s) UPDATE "schema_info" SET "version" = 2
I, [2012-04-26T16:19:44.219991 #16402]  INFO -- : (0.000786s) COMMIT
I, [2012-04-26T16:19:44.220051 #16402]  INFO -- : Finished applying migration version 2, direction: up, took 0.008270 seconds
I, [2012-04-26T16:19:44.220086 #16402]  INFO -- : Begin applying migration version 3, direction: up
I, [2012-04-26T16:19:44.220242 #16402]  INFO -- : (0.000103s) BEGIN
I, [2012-04-26T16:19:44.224128 #16402]  INFO -- : (0.003469s) CREATE TABLE "clients" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, "name" text NOT NULL, "public_key" text, "validator" boolean NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "pubkey_version" smallint NOT NULL, CONSTRAINT "org_id_name_unique" UNIQUE ("org_id", "name"))
I, [2012-04-26T16:19:44.224867 #16402]  INFO -- : (0.000596s) CREATE INDEX "clients_org_id_index" ON "clients" ("org_id")
I, [2012-04-26T16:19:44.225278 #16402]  INFO -- : (0.000219s) UPDATE "schema_info" SET "version" = 3
I, [2012-04-26T16:19:44.225942 #16402]  INFO -- : (0.000582s) COMMIT
I, [2012-04-26T16:19:44.226031 #16402]  INFO -- : Finished applying migration version 3, direction: up, took 0.005934 seconds
I, [2012-04-26T16:19:44.226106 #16402]  INFO -- : Begin applying migration version 4, direction: up
I, [2012-04-26T16:19:44.226353 #16402]  INFO -- : (0.000147s) BEGIN
I, [2012-04-26T16:19:44.230884 #16402]  INFO -- : (0.003869s) CREATE TABLE "roles" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:19:44.231702 #16402]  INFO -- : (0.000645s) CREATE INDEX "roles_org_id_index" ON "roles" ("org_id")
I, [2012-04-26T16:19:44.231923 #16402]  INFO -- : (0.000151s) ALTER TABLE roles ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T16:19:44.232210 #16402]  INFO -- : (0.000156s) UPDATE "schema_info" SET "version" = 4
I, [2012-04-26T16:19:44.232824 #16402]  INFO -- : (0.000561s) COMMIT
I, [2012-04-26T16:19:44.232877 #16402]  INFO -- : Finished applying migration version 4, direction: up, took 0.006784 seconds
I, [2012-04-26T16:19:44.232912 #16402]  INFO -- : Begin applying migration version 5, direction: up
I, [2012-04-26T16:19:44.233242 #16402]  INFO -- : (0.000256s) BEGIN
I, [2012-04-26T16:19:44.233692 #16402]  INFO -- : (0.000286s) ALTER TABLE "nodes" ADD COLUMN "last_audit_id" bytea
I, [2012-04-26T16:19:44.237499 #16402]  INFO -- : (0.003463s) CREATE TABLE "node_audit" ("audit_id" bytea NOT NULL, "node_id" char(32), "status" varchar(16), "start_time" timestamp NOT NULL, "end_time" timestamp NULL, "event_data" text NULL, PRIMARY KEY ("audit_id"), CONSTRAINT "node_id_fk" FOREIGN KEY ("node_id") REFERENCES "nodes")
I, [2012-04-26T16:19:44.238553 #16402]  INFO -- : (0.000880s) CREATE INDEX "node_audit_node_id_index" ON "node_audit" ("node_id")
I, [2012-04-26T16:19:44.242414 #16402]  INFO -- : (0.003297s) CREATE TABLE "node_audit_detail" ("audit_id" bytea NOT NULL, "seq" int NOT NULL, "duration" int NOT NULL, "res_id" varchar(255) NOT NULL, "res_type" varchar(16) NOT NULL, "res_name" varchar(255) NOT NULL, "res_result" varchar(16) NULL, "res_initial_state" text NULL, "res_final_state" text NULL, "delta" text NULL, PRIMARY KEY ("audit_id", "seq"), CONSTRAINT "audit_id_fk" FOREIGN KEY ("audit_id") REFERENCES "node_audit")
I, [2012-04-26T16:19:44.242865 #16402]  INFO -- : (0.000230s) UPDATE "schema_info" SET "version" = 5
I, [2012-04-26T16:19:44.243940 #16402]  INFO -- : (0.000978s) COMMIT
I, [2012-04-26T16:19:44.244039 #16402]  INFO -- : Finished applying migration version 5, direction: up, took 0.011122 seconds
I, [2012-04-26T16:19:44.244077 #16402]  INFO -- : Begin applying migration version 6, direction: up
I, [2012-04-26T16:19:44.244285 #16402]  INFO -- : (0.000152s) BEGIN
I, [2012-04-26T16:19:44.249245 #16402]  INFO -- : (0.004485s) CREATE TABLE "data_bags" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:19:44.250436 #16402]  INFO -- : (0.000954s) CREATE INDEX "data_bags_org_id_index" ON "data_bags" ("org_id")
I, [2012-04-26T16:19:44.250843 #16402]  INFO -- : (0.000191s) UPDATE "schema_info" SET "version" = 6
I, [2012-04-26T16:19:44.251671 #16402]  INFO -- : (0.000741s) COMMIT
I, [2012-04-26T16:19:44.251738 #16402]  INFO -- : Finished applying migration version 6, direction: up, took 0.007656 seconds
I, [2012-04-26T16:19:44.251791 #16402]  INFO -- : Begin applying migration version 7, direction: up
I, [2012-04-26T16:19:44.252012 #16402]  INFO -- : (0.000137s) BEGIN
I, [2012-04-26T16:19:44.255633 #16402]  INFO -- : (0.002983s) CREATE TABLE "data_bag_items" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "data_bag_name" text NOT NULL, "item_name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "data_bag_name", "item_name"))
I, [2012-04-26T16:19:44.256453 #16402]  INFO -- : (0.000682s) CREATE INDEX "data_bag_items_org_id_index" ON "data_bag_items" ("org_id")
I, [2012-04-26T16:19:44.256648 #16402]  INFO -- : (0.000130s) ALTER TABLE data_bag_items ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T16:19:44.257001 #16402]  INFO -- : (0.000225s) UPDATE "schema_info" SET "version" = 7
I, [2012-04-26T16:19:44.257745 #16402]  INFO -- : (0.000679s) COMMIT
I, [2012-04-26T16:19:44.257810 #16402]  INFO -- : Finished applying migration version 7, direction: up, took 0.006019 seconds
I, [2012-04-26T16:19:44.257857 #16402]  INFO -- : Begin applying migration version 8, direction: up
I, [2012-04-26T16:19:44.258038 #16402]  INFO -- : (0.000122s) BEGIN
I, [2012-04-26T16:19:44.262229 #16402]  INFO -- : (0.003818s) CREATE TABLE "environments" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:19:44.263206 #16402]  INFO -- : (0.000800s) CREATE INDEX "environments_org_id_index" ON "environments" ("org_id")
I, [2012-04-26T16:19:44.263519 #16402]  INFO -- : (0.000213s) ALTER TABLE environments ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T16:19:44.263866 #16402]  INFO -- : (0.000174s) UPDATE "schema_info" SET "version" = 8
I, [2012-04-26T16:19:44.264530 #16402]  INFO -- : (0.000580s) COMMIT
I, [2012-04-26T16:19:44.264591 #16402]  INFO -- : Finished applying migration version 8, direction: up, took 0.006730 seconds
I, [2012-04-26T16:19:44.264627 #16402]  INFO -- : Begin applying migration version 9, direction: up
I, [2012-04-26T16:19:44.264783 #16402]  INFO -- : (0.000102s) BEGIN
I, [2012-04-26T16:19:44.266384 #16402]  INFO -- : (0.001412s) ALTER TABLE "data_bag_items" ADD FOREIGN KEY ("org_id", "data_bag_name") REFERENCES "data_bags"("org_id", "name") ON DELETE CASCADE ON UPDATE CASCADE
I, [2012-04-26T16:19:44.266701 #16402]  INFO -- : (0.000191s) UPDATE "schema_info" SET "version" = 9
I, [2012-04-26T16:19:44.267683 #16402]  INFO -- : (0.000930s) COMMIT
I, [2012-04-26T16:19:44.267734 #16402]  INFO -- : Finished applying migration version 9, direction: up, took 0.003104 seconds
I, [2012-04-26T16:19:44.267767 #16402]  INFO -- : Begin applying migration version 10, direction: up
I, [2012-04-26T16:19:44.268004 #16402]  INFO -- : (0.000190s) BEGIN
I, [2012-04-26T16:19:44.268420 #16402]  INFO -- : (0.000311s) DROP INDEX "clients_org_id_index"
I, [2012-04-26T16:19:44.268690 #16402]  INFO -- : (0.000175s) DROP INDEX "environments_org_id_index"
I, [2012-04-26T16:19:44.268987 #16402]  INFO -- : (0.000209s) DROP INDEX "nodes_org_id_index"
I, [2012-04-26T16:19:44.269277 #16402]  INFO -- : (0.000203s) DROP INDEX "roles_org_id_index"
I, [2012-04-26T16:19:44.269509 #16402]  INFO -- : (0.000143s) DROP INDEX "data_bags_org_id_index"
I, [2012-04-26T16:19:44.269784 #16402]  INFO -- : (0.000177s) DROP INDEX "data_bag_items_org_id_index"
I, [2012-04-26T16:19:44.270140 #16402]  INFO -- : (0.000185s) UPDATE "schema_info" SET "version" = 10
I, [2012-04-26T16:19:44.270978 #16402]  INFO -- : (0.000753s) COMMIT
I, [2012-04-26T16:19:44.271051 #16402]  INFO -- : Finished applying migration version 10, direction: up, took 0.003278 seconds
I, [2012-04-26T16:19:44.271088 #16402]  INFO -- : Begin applying migration version 11, direction: up
I, [2012-04-26T16:19:44.271248 #16402]  INFO -- : (0.000106s) BEGIN
I, [2012-04-26T16:19:44.271710 #16402]  INFO -- : (0.000238s) ALTER TABLE "users" ADD COLUMN "external_authentication_uid" text NULL
I, [2012-04-26T16:19:44.271984 #16402]  INFO -- : (0.000193s) ALTER TABLE "users" ADD COLUMN "recovery_authentication_enabled" boolean NULL
I, [2012-04-26T16:19:44.272264 #16402]  INFO -- : (0.000218s) ALTER TABLE "users" ALTER COLUMN "email" DROP NOT NULL
I, [2012-04-26T16:19:44.272563 #16402]  INFO -- : (0.000158s) UPDATE "schema_info" SET "version" = 11
I, [2012-04-26T16:19:44.273626 #16402]  INFO -- : (0.000981s) COMMIT
I, [2012-04-26T16:19:44.273691 #16402]  INFO -- : Finished applying migration version 11, direction: up, took 0.002599 seconds
I, [2012-04-26T16:21:25.063660 #16577]  INFO -- : (0.000484s) SET standard_conforming_strings = ON
I, [2012-04-26T16:21:25.064071 #16577]  INFO -- : (0.000274s) SET client_min_messages = 'WARNING'
I, [2012-04-26T16:21:25.064213 #16577]  INFO -- : (0.000088s) SET DateStyle = 'ISO'
E, [2012-04-26T16:21:25.071985 #16577] ERROR -- : PG::Error: ERROR:  relation "schema_info" does not exist
LINE 1: SELECT NULL FROM "schema_info" LIMIT 1
                         ^: SELECT NULL FROM "schema_info" LIMIT 1
I, [2012-04-26T16:21:25.076429 #16577]  INFO -- : (0.004090s) CREATE TABLE "schema_info" ("version" integer DEFAULT 0 NOT NULL)
I, [2012-04-26T16:21:25.077118 #16577]  INFO -- : (0.000505s) SELECT 1 AS "one" FROM "schema_info" LIMIT 1
I, [2012-04-26T16:21:25.079036 #16577]  INFO -- : (0.001714s) SELECT pg_attribute.attname FROM pg_class, pg_attribute, pg_index, pg_namespace WHERE pg_class.oid = pg_attribute.attrelid AND pg_class.relnamespace = pg_namespace.oid AND pg_class.oid = pg_index.indrelid AND pg_index.indkey[0] = pg_attribute.attnum AND pg_index.indisprimary = 't' AND pg_class.relname = 'schema_info'
I, [2012-04-26T16:21:25.079921 #16577]  INFO -- : (0.000682s) INSERT INTO "schema_info" ("version") VALUES (0) RETURNING NULL
I, [2012-04-26T16:21:25.080575 #16577]  INFO -- : (0.000427s) SELECT COUNT(*) AS "count" FROM "schema_info" LIMIT 1
I, [2012-04-26T16:21:25.080968 #16577]  INFO -- : (0.000219s) SELECT "version" FROM "schema_info" LIMIT 1
I, [2012-04-26T16:21:25.096142 #16577]  INFO -- : Begin applying migration version 1, direction: up
I, [2012-04-26T16:21:25.096530 #16577]  INFO -- : (0.000269s) BEGIN
I, [2012-04-26T16:21:25.102577 #16577]  INFO -- : (0.005673s) CREATE TABLE "users" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "username" text NOT NULL UNIQUE, "email" text NOT NULL UNIQUE, "pubkey_version" integer NOT NULL, "public_key" text, "serialized_object" text, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-04-26T16:21:25.102932 #16577]  INFO -- : (0.000172s) UPDATE "schema_info" SET "version" = 1
I, [2012-04-26T16:21:25.104297 #16577]  INFO -- : (0.001295s) COMMIT
I, [2012-04-26T16:21:25.104383 #16577]  INFO -- : Finished applying migration version 1, direction: up, took 0.008245 seconds
I, [2012-04-26T16:21:25.104417 #16577]  INFO -- : Begin applying migration version 2, direction: up
I, [2012-04-26T16:21:25.104718 #16577]  INFO -- : (0.000239s) BEGIN
I, [2012-04-26T16:21:25.108951 #16577]  INFO -- : (0.003834s) CREATE TABLE "nodes" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "environment" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" text, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:21:25.109812 #16577]  INFO -- : (0.000722s) CREATE INDEX "nodes_org_id_index" ON "nodes" ("org_id")
I, [2012-04-26T16:21:25.110617 #16577]  INFO -- : (0.000689s) CREATE INDEX "nodes_org_id_environment_index" ON "nodes" ("org_id", "environment")
I, [2012-04-26T16:21:25.110887 #16577]  INFO -- : (0.000146s) UPDATE "schema_info" SET "version" = 2
I, [2012-04-26T16:21:25.111991 #16577]  INFO -- : (0.001050s) COMMIT
I, [2012-04-26T16:21:25.112049 #16577]  INFO -- : Finished applying migration version 2, direction: up, took 0.007629 seconds
I, [2012-04-26T16:21:25.112082 #16577]  INFO -- : Begin applying migration version 3, direction: up
I, [2012-04-26T16:21:25.112260 #16577]  INFO -- : (0.000124s) BEGIN
I, [2012-04-26T16:21:25.116366 #16577]  INFO -- : (0.003715s) CREATE TABLE "clients" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, "name" text NOT NULL, "public_key" text, "validator" boolean NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "pubkey_version" smallint NOT NULL, CONSTRAINT "org_id_name_unique" UNIQUE ("org_id", "name"))
I, [2012-04-26T16:21:25.117152 #16577]  INFO -- : (0.000673s) CREATE INDEX "clients_org_id_index" ON "clients" ("org_id")
I, [2012-04-26T16:21:25.117403 #16577]  INFO -- : (0.000137s) UPDATE "schema_info" SET "version" = 3
I, [2012-04-26T16:21:25.118257 #16577]  INFO -- : (0.000799s) COMMIT
I, [2012-04-26T16:21:25.118316 #16577]  INFO -- : Finished applying migration version 3, direction: up, took 0.006229 seconds
I, [2012-04-26T16:21:25.118361 #16577]  INFO -- : Begin applying migration version 4, direction: up
I, [2012-04-26T16:21:25.118545 #16577]  INFO -- : (0.000133s) BEGIN
I, [2012-04-26T16:21:25.123226 #16577]  INFO -- : (0.004364s) CREATE TABLE "roles" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:21:25.124044 #16577]  INFO -- : (0.000706s) CREATE INDEX "roles_org_id_index" ON "roles" ("org_id")
I, [2012-04-26T16:21:25.124350 #16577]  INFO -- : (0.000239s) ALTER TABLE roles ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T16:21:25.124691 #16577]  INFO -- : (0.000222s) UPDATE "schema_info" SET "version" = 4
I, [2012-04-26T16:21:25.125221 #16577]  INFO -- : (0.000474s) COMMIT
I, [2012-04-26T16:21:25.125269 #16577]  INFO -- : Finished applying migration version 4, direction: up, took 0.006905 seconds
I, [2012-04-26T16:21:25.125300 #16577]  INFO -- : Begin applying migration version 5, direction: up
I, [2012-04-26T16:21:25.125427 #16577]  INFO -- : (0.000081s) BEGIN
I, [2012-04-26T16:21:25.125780 #16577]  INFO -- : (0.000215s) ALTER TABLE "nodes" ADD COLUMN "last_audit_id" bytea
I, [2012-04-26T16:21:25.129154 #16577]  INFO -- : (0.003048s) CREATE TABLE "node_audit" ("audit_id" bytea NOT NULL, "node_id" char(32), "status" varchar(16), "start_time" timestamp NOT NULL, "end_time" timestamp NULL, "event_data" text NULL, PRIMARY KEY ("audit_id"), CONSTRAINT "node_id_fk" FOREIGN KEY ("node_id") REFERENCES "nodes")
I, [2012-04-26T16:21:25.129993 #16577]  INFO -- : (0.000716s) CREATE INDEX "node_audit_node_id_index" ON "node_audit" ("node_id")
I, [2012-04-26T16:21:25.133344 #16577]  INFO -- : (0.002951s) CREATE TABLE "node_audit_detail" ("audit_id" bytea NOT NULL, "seq" int NOT NULL, "duration" int NOT NULL, "res_id" varchar(255) NOT NULL, "res_type" varchar(16) NOT NULL, "res_name" varchar(255) NOT NULL, "res_result" varchar(16) NULL, "res_initial_state" text NULL, "res_final_state" text NULL, "delta" text NULL, PRIMARY KEY ("audit_id", "seq"), CONSTRAINT "audit_id_fk" FOREIGN KEY ("audit_id") REFERENCES "node_audit")
I, [2012-04-26T16:21:25.133763 #16577]  INFO -- : (0.000286s) UPDATE "schema_info" SET "version" = 5
I, [2012-04-26T16:21:25.135124 #16577]  INFO -- : (0.001304s) COMMIT
I, [2012-04-26T16:21:25.135183 #16577]  INFO -- : Finished applying migration version 5, direction: up, took 0.009879 seconds
I, [2012-04-26T16:21:25.135215 #16577]  INFO -- : Begin applying migration version 6, direction: up
I, [2012-04-26T16:21:25.135458 #16577]  INFO -- : (0.000188s) BEGIN
I, [2012-04-26T16:21:25.139472 #16577]  INFO -- : (0.003703s) CREATE TABLE "data_bags" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:21:25.140369 #16577]  INFO -- : (0.000771s) CREATE INDEX "data_bags_org_id_index" ON "data_bags" ("org_id")
I, [2012-04-26T16:21:25.140637 #16577]  INFO -- : (0.000140s) UPDATE "schema_info" SET "version" = 6
I, [2012-04-26T16:21:25.141209 #16577]  INFO -- : (0.000518s) COMMIT
I, [2012-04-26T16:21:25.141268 #16577]  INFO -- : Finished applying migration version 6, direction: up, took 0.006048 seconds
I, [2012-04-26T16:21:25.141303 #16577]  INFO -- : Begin applying migration version 7, direction: up
I, [2012-04-26T16:21:25.141441 #16577]  INFO -- : (0.000083s) BEGIN
I, [2012-04-26T16:21:25.144888 #16577]  INFO -- : (0.003108s) CREATE TABLE "data_bag_items" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "data_bag_name" text NOT NULL, "item_name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "data_bag_name", "item_name"))
I, [2012-04-26T16:21:25.145793 #16577]  INFO -- : (0.000777s) CREATE INDEX "data_bag_items_org_id_index" ON "data_bag_items" ("org_id")
I, [2012-04-26T16:21:25.146076 #16577]  INFO -- : (0.000211s) ALTER TABLE data_bag_items ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T16:21:25.146312 #16577]  INFO -- : (0.000118s) UPDATE "schema_info" SET "version" = 7
I, [2012-04-26T16:21:25.147173 #16577]  INFO -- : (0.000809s) COMMIT
I, [2012-04-26T16:21:25.147235 #16577]  INFO -- : Finished applying migration version 7, direction: up, took 0.005929 seconds
I, [2012-04-26T16:21:25.147267 #16577]  INFO -- : Begin applying migration version 8, direction: up
I, [2012-04-26T16:21:25.147439 #16577]  INFO -- : (0.000120s) BEGIN
I, [2012-04-26T16:21:25.151107 #16577]  INFO -- : (0.003341s) CREATE TABLE "environments" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:21:25.151968 #16577]  INFO -- : (0.000742s) CREATE INDEX "environments_org_id_index" ON "environments" ("org_id")
I, [2012-04-26T16:21:25.152296 #16577]  INFO -- : (0.000262s) ALTER TABLE environments ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T16:21:25.152576 #16577]  INFO -- : (0.000170s) UPDATE "schema_info" SET "version" = 8
I, [2012-04-26T16:21:25.153232 #16577]  INFO -- : (0.000603s) COMMIT
I, [2012-04-26T16:21:25.153291 #16577]  INFO -- : Finished applying migration version 8, direction: up, took 0.006019 seconds
I, [2012-04-26T16:21:25.153324 #16577]  INFO -- : Begin applying migration version 9, direction: up
I, [2012-04-26T16:21:25.153466 #16577]  INFO -- : (0.000094s) BEGIN
I, [2012-04-26T16:21:25.155054 #16577]  INFO -- : (0.001417s) ALTER TABLE "data_bag_items" ADD FOREIGN KEY ("org_id", "data_bag_name") REFERENCES "data_bags"("org_id", "name") ON DELETE CASCADE ON UPDATE CASCADE
I, [2012-04-26T16:21:25.155444 #16577]  INFO -- : (0.000272s) UPDATE "schema_info" SET "version" = 9
I, [2012-04-26T16:21:25.156102 #16577]  INFO -- : (0.000593s) COMMIT
I, [2012-04-26T16:21:25.156162 #16577]  INFO -- : Finished applying migration version 9, direction: up, took 0.002835 seconds
I, [2012-04-26T16:21:25.156195 #16577]  INFO -- : Begin applying migration version 10, direction: up
I, [2012-04-26T16:21:25.156416 #16577]  INFO -- : (0.000170s) BEGIN
I, [2012-04-26T16:21:25.156868 #16577]  INFO -- : (0.000332s) DROP INDEX "clients_org_id_index"
I, [2012-04-26T16:21:25.157187 #16577]  INFO -- : (0.000200s) DROP INDEX "environments_org_id_index"
I, [2012-04-26T16:21:25.157445 #16577]  INFO -- : (0.000149s) DROP INDEX "nodes_org_id_index"
I, [2012-04-26T16:21:25.157670 #16577]  INFO -- : (0.000135s) DROP INDEX "roles_org_id_index"
I, [2012-04-26T16:21:25.157908 #16577]  INFO -- : (0.000143s) DROP INDEX "data_bags_org_id_index"
I, [2012-04-26T16:21:25.158190 #16577]  INFO -- : (0.000170s) DROP INDEX "data_bag_items_org_id_index"
I, [2012-04-26T16:21:25.158400 #16577]  INFO -- : (0.000111s) UPDATE "schema_info" SET "version" = 10
I, [2012-04-26T16:21:25.159309 #16577]  INFO -- : (0.000859s) COMMIT
I, [2012-04-26T16:21:25.159360 #16577]  INFO -- : Finished applying migration version 10, direction: up, took 0.003162 seconds
I, [2012-04-26T16:21:25.159392 #16577]  INFO -- : Begin applying migration version 11, direction: up
I, [2012-04-26T16:21:25.159512 #16577]  INFO -- : (0.000074s) BEGIN
I, [2012-04-26T16:21:25.159859 #16577]  INFO -- : (0.000166s) ALTER TABLE "users" ADD COLUMN "external_authentication_uid" text NULL
I, [2012-04-26T16:21:25.160048 #16577]  INFO -- : (0.000142s) ALTER TABLE "users" ADD COLUMN "recovery_authentication_enabled" boolean NULL
I, [2012-04-26T16:21:25.160219 #16577]  INFO -- : (0.000128s) ALTER TABLE "users" ALTER COLUMN "email" DROP NOT NULL
I, [2012-04-26T16:21:25.160498 #16577]  INFO -- : (0.000186s) UPDATE "schema_info" SET "version" = 11
I, [2012-04-26T16:21:25.161022 #16577]  INFO -- : (0.000472s) COMMIT
I, [2012-04-26T16:21:25.161084 #16577]  INFO -- : Finished applying migration version 11, direction: up, took 0.001686 seconds
I, [2012-04-26T16:26:26.884024 #16832]  INFO -- : (0.000429s) SET standard_conforming_strings = ON
I, [2012-04-26T16:26:26.886305 #16832]  INFO -- : (0.000132s) SET client_min_messages = 'WARNING'
I, [2012-04-26T16:26:26.886973 #16832]  INFO -- : (0.000112s) SET DateStyle = 'ISO'
E, [2012-04-26T16:26:26.900248 #16832] ERROR -- : PG::Error: ERROR:  relation "schema_info" does not exist
LINE 1: SELECT NULL FROM "schema_info" LIMIT 1
                         ^: SELECT NULL FROM "schema_info" LIMIT 1
I, [2012-04-26T16:26:26.905133 #16832]  INFO -- : (0.004557s) CREATE TABLE "schema_info" ("version" integer DEFAULT 0 NOT NULL)
I, [2012-04-26T16:26:26.905890 #16832]  INFO -- : (0.000562s) SELECT 1 AS "one" FROM "schema_info" LIMIT 1
I, [2012-04-26T16:26:26.907685 #16832]  INFO -- : (0.001582s) SELECT pg_attribute.attname FROM pg_class, pg_attribute, pg_index, pg_namespace WHERE pg_class.oid = pg_attribute.attrelid AND pg_class.relnamespace = pg_namespace.oid AND pg_class.oid = pg_index.indrelid AND pg_index.indkey[0] = pg_attribute.attnum AND pg_index.indisprimary = 't' AND pg_class.relname = 'schema_info'
I, [2012-04-26T16:26:26.908788 #16832]  INFO -- : (0.000923s) INSERT INTO "schema_info" ("version") VALUES (0) RETURNING NULL
I, [2012-04-26T16:26:26.909479 #16832]  INFO -- : (0.000475s) SELECT COUNT(*) AS "count" FROM "schema_info" LIMIT 1
I, [2012-04-26T16:26:26.910012 #16832]  INFO -- : (0.000356s) SELECT "version" FROM "schema_info" LIMIT 1
I, [2012-04-26T16:26:26.925774 #16832]  INFO -- : Begin applying migration version 1, direction: up
I, [2012-04-26T16:26:26.926181 #16832]  INFO -- : (0.000299s) BEGIN
I, [2012-04-26T16:26:26.933158 #16832]  INFO -- : (0.006591s) CREATE TABLE "users" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "username" text NOT NULL UNIQUE, "email" text NOT NULL UNIQUE, "pubkey_version" integer NOT NULL, "public_key" text, "serialized_object" text, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-04-26T16:26:26.933700 #16832]  INFO -- : (0.000360s) UPDATE "schema_info" SET "version" = 1
I, [2012-04-26T16:26:26.934483 #16832]  INFO -- : (0.000721s) COMMIT
I, [2012-04-26T16:26:26.934551 #16832]  INFO -- : Finished applying migration version 1, direction: up, took 0.008780 seconds
I, [2012-04-26T16:26:26.934585 #16832]  INFO -- : Begin applying migration version 2, direction: up
I, [2012-04-26T16:26:26.934737 #16832]  INFO -- : (0.000099s) BEGIN
I, [2012-04-26T16:26:26.939210 #16832]  INFO -- : (0.004091s) CREATE TABLE "nodes" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "environment" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" text, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:26:26.940052 #16832]  INFO -- : (0.000673s) CREATE INDEX "nodes_org_id_index" ON "nodes" ("org_id")
I, [2012-04-26T16:26:26.940822 #16832]  INFO -- : (0.000640s) CREATE INDEX "nodes_org_id_environment_index" ON "nodes" ("org_id", "environment")
I, [2012-04-26T16:26:26.941113 #16832]  INFO -- : (0.000151s) UPDATE "schema_info" SET "version" = 2
I, [2012-04-26T16:26:26.941870 #16832]  INFO -- : (0.000699s) COMMIT
I, [2012-04-26T16:26:26.941932 #16832]  INFO -- : Finished applying migration version 2, direction: up, took 0.007342 seconds
I, [2012-04-26T16:26:26.941967 #16832]  INFO -- : Begin applying migration version 3, direction: up
I, [2012-04-26T16:26:26.942118 #16832]  INFO -- : (0.000100s) BEGIN
I, [2012-04-26T16:26:26.946705 #16832]  INFO -- : (0.004168s) CREATE TABLE "clients" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, "name" text NOT NULL, "public_key" text, "validator" boolean NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "pubkey_version" smallint NOT NULL, CONSTRAINT "org_id_name_unique" UNIQUE ("org_id", "name"))
I, [2012-04-26T16:26:26.948536 #16832]  INFO -- : (0.001592s) CREATE INDEX "clients_org_id_index" ON "clients" ("org_id")
I, [2012-04-26T16:26:26.948975 #16832]  INFO -- : (0.000212s) UPDATE "schema_info" SET "version" = 3
I, [2012-04-26T16:26:26.949627 #16832]  INFO -- : (0.000575s) COMMIT
I, [2012-04-26T16:26:26.949705 #16832]  INFO -- : Finished applying migration version 3, direction: up, took 0.007728 seconds
I, [2012-04-26T16:26:26.949757 #16832]  INFO -- : Begin applying migration version 4, direction: up
I, [2012-04-26T16:26:26.949943 #16832]  INFO -- : (0.000127s) BEGIN
I, [2012-04-26T16:26:26.953917 #16832]  INFO -- : (0.003596s) CREATE TABLE "roles" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:26:26.954761 #16832]  INFO -- : (0.000700s) CREATE INDEX "roles_org_id_index" ON "roles" ("org_id")
I, [2012-04-26T16:26:26.955019 #16832]  INFO -- : (0.000198s) ALTER TABLE roles ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T16:26:26.955272 #16832]  INFO -- : (0.000136s) UPDATE "schema_info" SET "version" = 4
I, [2012-04-26T16:26:26.956231 #16832]  INFO -- : (0.000906s) COMMIT
I, [2012-04-26T16:26:26.956292 #16832]  INFO -- : Finished applying migration version 4, direction: up, took 0.006532 seconds
I, [2012-04-26T16:26:26.956326 #16832]  INFO -- : Begin applying migration version 5, direction: up
I, [2012-04-26T16:26:26.956506 #16832]  INFO -- : (0.000130s) BEGIN
I, [2012-04-26T16:26:26.956881 #16832]  INFO -- : (0.000228s) ALTER TABLE "nodes" ADD COLUMN "last_audit_id" bytea
I, [2012-04-26T16:26:26.961204 #16832]  INFO -- : (0.004003s) CREATE TABLE "node_audit" ("audit_id" bytea NOT NULL, "node_id" char(32), "status" varchar(16), "start_time" timestamp NOT NULL, "end_time" timestamp NULL, "event_data" text NULL, PRIMARY KEY ("audit_id"), CONSTRAINT "node_id_fk" FOREIGN KEY ("node_id") REFERENCES "nodes")
I, [2012-04-26T16:26:26.962283 #16832]  INFO -- : (0.000895s) CREATE INDEX "node_audit_node_id_index" ON "node_audit" ("node_id")
I, [2012-04-26T16:26:26.966047 #16832]  INFO -- : (0.003309s) CREATE TABLE "node_audit_detail" ("audit_id" bytea NOT NULL, "seq" int NOT NULL, "duration" int NOT NULL, "res_id" varchar(255) NOT NULL, "res_type" varchar(16) NOT NULL, "res_name" varchar(255) NOT NULL, "res_result" varchar(16) NULL, "res_initial_state" text NULL, "res_final_state" text NULL, "delta" text NULL, PRIMARY KEY ("audit_id", "seq"), CONSTRAINT "audit_id_fk" FOREIGN KEY ("audit_id") REFERENCES "node_audit")
I, [2012-04-26T16:26:26.966365 #16832]  INFO -- : (0.000155s) UPDATE "schema_info" SET "version" = 5
I, [2012-04-26T16:26:26.967607 #16832]  INFO -- : (0.001180s) COMMIT
I, [2012-04-26T16:26:26.967669 #16832]  INFO -- : Finished applying migration version 5, direction: up, took 0.011339 seconds
I, [2012-04-26T16:26:26.967701 #16832]  INFO -- : Begin applying migration version 6, direction: up
I, [2012-04-26T16:26:26.967980 #16832]  INFO -- : (0.000218s) BEGIN
I, [2012-04-26T16:26:26.972309 #16832]  INFO -- : (0.003985s) CREATE TABLE "data_bags" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:26:26.973291 #16832]  INFO -- : (0.000755s) CREATE INDEX "data_bags_org_id_index" ON "data_bags" ("org_id")
I, [2012-04-26T16:26:26.973610 #16832]  INFO -- : (0.000178s) UPDATE "schema_info" SET "version" = 6
I, [2012-04-26T16:26:26.974258 #16832]  INFO -- : (0.000581s) COMMIT
I, [2012-04-26T16:26:26.974323 #16832]  INFO -- : Finished applying migration version 6, direction: up, took 0.006617 seconds
I, [2012-04-26T16:26:26.974359 #16832]  INFO -- : Begin applying migration version 7, direction: up
I, [2012-04-26T16:26:26.974538 #16832]  INFO -- : (0.000112s) BEGIN
I, [2012-04-26T16:26:26.978310 #16832]  INFO -- : (0.003394s) CREATE TABLE "data_bag_items" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "data_bag_name" text NOT NULL, "item_name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "data_bag_name", "item_name"))
I, [2012-04-26T16:26:26.979225 #16832]  INFO -- : (0.000738s) CREATE INDEX "data_bag_items_org_id_index" ON "data_bag_items" ("org_id")
I, [2012-04-26T16:26:26.979519 #16832]  INFO -- : (0.000195s) ALTER TABLE data_bag_items ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T16:26:26.979815 #16832]  INFO -- : (0.000160s) UPDATE "schema_info" SET "version" = 7
I, [2012-04-26T16:26:26.980385 #16832]  INFO -- : (0.000506s) COMMIT
I, [2012-04-26T16:26:26.980475 #16832]  INFO -- : Finished applying migration version 7, direction: up, took 0.006108 seconds
I, [2012-04-26T16:26:26.980528 #16832]  INFO -- : Begin applying migration version 8, direction: up
I, [2012-04-26T16:26:26.980770 #16832]  INFO -- : (0.000156s) BEGIN
I, [2012-04-26T16:26:26.985488 #16832]  INFO -- : (0.004145s) CREATE TABLE "environments" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:26:26.986448 #16832]  INFO -- : (0.000802s) CREATE INDEX "environments_org_id_index" ON "environments" ("org_id")
I, [2012-04-26T16:26:26.986729 #16832]  INFO -- : (0.000207s) ALTER TABLE environments ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T16:26:26.986992 #16832]  INFO -- : (0.000140s) UPDATE "schema_info" SET "version" = 8
I, [2012-04-26T16:26:26.987915 #16832]  INFO -- : (0.000872s) COMMIT
I, [2012-04-26T16:26:26.987968 #16832]  INFO -- : Finished applying migration version 8, direction: up, took 0.007440 seconds
I, [2012-04-26T16:26:26.988001 #16832]  INFO -- : Begin applying migration version 9, direction: up
I, [2012-04-26T16:26:26.988219 #16832]  INFO -- : (0.000166s) BEGIN
I, [2012-04-26T16:26:26.989783 #16832]  INFO -- : (0.001392s) ALTER TABLE "data_bag_items" ADD FOREIGN KEY ("org_id", "data_bag_name") REFERENCES "data_bags"("org_id", "name") ON DELETE CASCADE ON UPDATE CASCADE
I, [2012-04-26T16:26:26.990196 #16832]  INFO -- : (0.000277s) UPDATE "schema_info" SET "version" = 9
I, [2012-04-26T16:26:26.990813 #16832]  INFO -- : (0.000512s) COMMIT
I, [2012-04-26T16:26:26.990861 #16832]  INFO -- : Finished applying migration version 9, direction: up, took 0.002858 seconds
I, [2012-04-26T16:26:26.990892 #16832]  INFO -- : Begin applying migration version 10, direction: up
I, [2012-04-26T16:26:26.991018 #16832]  INFO -- : (0.000081s) BEGIN
I, [2012-04-26T16:26:26.991435 #16832]  INFO -- : (0.000319s) DROP INDEX "clients_org_id_index"
I, [2012-04-26T16:26:26.991680 #16832]  INFO -- : (0.000155s) DROP INDEX "environments_org_id_index"
I, [2012-04-26T16:26:26.992029 #16832]  INFO -- : (0.000259s) DROP INDEX "nodes_org_id_index"
I, [2012-04-26T16:26:26.992436 #16832]  INFO -- : (0.000267s) DROP INDEX "roles_org_id_index"
I, [2012-04-26T16:26:26.992744 #16832]  INFO -- : (0.000200s) DROP INDEX "data_bags_org_id_index"
I, [2012-04-26T16:26:26.993110 #16832]  INFO -- : (0.000263s) DROP INDEX "data_bag_items_org_id_index"
I, [2012-04-26T16:26:26.993451 #16832]  INFO -- : (0.000185s) UPDATE "schema_info" SET "version" = 10
I, [2012-04-26T16:26:26.994541 #16832]  INFO -- : (0.001025s) COMMIT
I, [2012-04-26T16:26:26.994604 #16832]  INFO -- : Finished applying migration version 10, direction: up, took 0.003707 seconds
I, [2012-04-26T16:26:26.994639 #16832]  INFO -- : Begin applying migration version 11, direction: up
I, [2012-04-26T16:26:26.994821 #16832]  INFO -- : (0.000119s) BEGIN
I, [2012-04-26T16:26:26.995295 #16832]  INFO -- : (0.000245s) ALTER TABLE "users" ADD COLUMN "external_authentication_uid" text NULL
I, [2012-04-26T16:26:26.995614 #16832]  INFO -- : (0.000237s) ALTER TABLE "users" ADD COLUMN "recovery_authentication_enabled" boolean NULL
I, [2012-04-26T16:26:26.995864 #16832]  INFO -- : (0.000176s) ALTER TABLE "users" ALTER COLUMN "email" DROP NOT NULL
I, [2012-04-26T16:26:26.996159 #16832]  INFO -- : (0.000175s) UPDATE "schema_info" SET "version" = 11
I, [2012-04-26T16:26:26.996715 #16832]  INFO -- : (0.000482s) COMMIT
I, [2012-04-26T16:26:26.996770 #16832]  INFO -- : Finished applying migration version 11, direction: up, took 0.002128 seconds
I, [2012-04-26T16:29:53.422071 #17030]  INFO -- : (0.000353s) SET standard_conforming_strings = ON
I, [2012-04-26T16:29:53.422361 #17030]  INFO -- : (0.000150s) SET client_min_messages = 'WARNING'
I, [2012-04-26T16:29:53.422560 #17030]  INFO -- : (0.000142s) SET DateStyle = 'ISO'
E, [2012-04-26T16:29:53.430614 #17030] ERROR -- : PG::Error: ERROR:  relation "schema_info" does not exist
LINE 1: SELECT NULL FROM "schema_info" LIMIT 1
                         ^: SELECT NULL FROM "schema_info" LIMIT 1
I, [2012-04-26T16:29:53.435785 #17030]  INFO -- : (0.004879s) CREATE TABLE "schema_info" ("version" integer DEFAULT 0 NOT NULL)
I, [2012-04-26T16:29:53.436612 #17030]  INFO -- : (0.000631s) SELECT 1 AS "one" FROM "schema_info" LIMIT 1
I, [2012-04-26T16:29:53.438418 #17030]  INFO -- : (0.001627s) SELECT pg_attribute.attname FROM pg_class, pg_attribute, pg_index, pg_namespace WHERE pg_class.oid = pg_attribute.attrelid AND pg_class.relnamespace = pg_namespace.oid AND pg_class.oid = pg_index.indrelid AND pg_index.indkey[0] = pg_attribute.attnum AND pg_index.indisprimary = 't' AND pg_class.relname = 'schema_info'
I, [2012-04-26T16:29:53.439325 #17030]  INFO -- : (0.000716s) INSERT INTO "schema_info" ("version") VALUES (0) RETURNING NULL
I, [2012-04-26T16:29:53.439962 #17030]  INFO -- : (0.000401s) SELECT COUNT(*) AS "count" FROM "schema_info" LIMIT 1
I, [2012-04-26T16:29:53.440560 #17030]  INFO -- : (0.000393s) SELECT "version" FROM "schema_info" LIMIT 1
I, [2012-04-26T16:29:53.456011 #17030]  INFO -- : Begin applying migration version 1, direction: up
I, [2012-04-26T16:29:53.456264 #17030]  INFO -- : (0.000141s) BEGIN
I, [2012-04-26T16:29:53.461706 #17030]  INFO -- : (0.005066s) CREATE TABLE "users" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "username" text NOT NULL UNIQUE, "email" text NOT NULL UNIQUE, "pubkey_version" integer NOT NULL, "public_key" text, "serialized_object" text, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-04-26T16:29:53.462124 #17030]  INFO -- : (0.000261s) UPDATE "schema_info" SET "version" = 1
I, [2012-04-26T16:29:53.462881 #17030]  INFO -- : (0.000703s) COMMIT
I, [2012-04-26T16:29:53.462942 #17030]  INFO -- : Finished applying migration version 1, direction: up, took 0.006935 seconds
I, [2012-04-26T16:29:53.462977 #17030]  INFO -- : Begin applying migration version 2, direction: up
I, [2012-04-26T16:29:53.463165 #17030]  INFO -- : (0.000135s) BEGIN
I, [2012-04-26T16:29:53.468743 #17030]  INFO -- : (0.005197s) CREATE TABLE "nodes" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "environment" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" text, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:29:53.469685 #17030]  INFO -- : (0.000739s) CREATE INDEX "nodes_org_id_index" ON "nodes" ("org_id")
I, [2012-04-26T16:29:53.470641 #17030]  INFO -- : (0.000823s) CREATE INDEX "nodes_org_id_environment_index" ON "nodes" ("org_id", "environment")
I, [2012-04-26T16:29:53.470974 #17030]  INFO -- : (0.000181s) UPDATE "schema_info" SET "version" = 2
I, [2012-04-26T16:29:53.471657 #17030]  INFO -- : (0.000623s) COMMIT
I, [2012-04-26T16:29:53.471715 #17030]  INFO -- : Finished applying migration version 2, direction: up, took 0.008734 seconds
I, [2012-04-26T16:29:53.471748 #17030]  INFO -- : Begin applying migration version 3, direction: up
I, [2012-04-26T16:29:53.471951 #17030]  INFO -- : (0.000135s) BEGIN
I, [2012-04-26T16:29:53.476194 #17030]  INFO -- : (0.003842s) CREATE TABLE "clients" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, "name" text NOT NULL, "public_key" text, "validator" boolean NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "pubkey_version" smallint NOT NULL, CONSTRAINT "org_id_name_unique" UNIQUE ("org_id", "name"))
I, [2012-04-26T16:29:53.477462 #17030]  INFO -- : (0.001075s) CREATE INDEX "clients_org_id_index" ON "clients" ("org_id")
I, [2012-04-26T16:29:53.477892 #17030]  INFO -- : (0.000215s) UPDATE "schema_info" SET "version" = 3
I, [2012-04-26T16:29:53.478681 #17030]  INFO -- : (0.000706s) COMMIT
I, [2012-04-26T16:29:53.478754 #17030]  INFO -- : Finished applying migration version 3, direction: up, took 0.007000 seconds
I, [2012-04-26T16:29:53.478798 #17030]  INFO -- : Begin applying migration version 4, direction: up
I, [2012-04-26T16:29:53.479013 #17030]  INFO -- : (0.000134s) BEGIN
I, [2012-04-26T16:29:53.483304 #17030]  INFO -- : (0.003916s) CREATE TABLE "roles" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:29:53.484331 #17030]  INFO -- : (0.000886s) CREATE INDEX "roles_org_id_index" ON "roles" ("org_id")
I, [2012-04-26T16:29:53.484587 #17030]  INFO -- : (0.000186s) ALTER TABLE roles ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T16:29:53.484947 #17030]  INFO -- : (0.000227s) UPDATE "schema_info" SET "version" = 4
I, [2012-04-26T16:29:53.485521 #17030]  INFO -- : (0.000518s) COMMIT
I, [2012-04-26T16:29:53.485579 #17030]  INFO -- : Finished applying migration version 4, direction: up, took 0.006781 seconds
I, [2012-04-26T16:29:53.485614 #17030]  INFO -- : Begin applying migration version 5, direction: up
I, [2012-04-26T16:29:53.485764 #17030]  INFO -- : (0.000097s) BEGIN
I, [2012-04-26T16:29:53.486095 #17030]  INFO -- : (0.000183s) ALTER TABLE "nodes" ADD COLUMN "last_audit_id" bytea
I, [2012-04-26T16:29:53.490389 #17030]  INFO -- : (0.003983s) CREATE TABLE "node_audit" ("audit_id" bytea NOT NULL, "node_id" char(32), "status" varchar(16), "start_time" timestamp NOT NULL, "end_time" timestamp NULL, "event_data" text NULL, PRIMARY KEY ("audit_id"), CONSTRAINT "node_id_fk" FOREIGN KEY ("node_id") REFERENCES "nodes")
I, [2012-04-26T16:29:53.491325 #17030]  INFO -- : (0.000775s) CREATE INDEX "node_audit_node_id_index" ON "node_audit" ("node_id")
I, [2012-04-26T16:29:53.494920 #17030]  INFO -- : (0.003123s) CREATE TABLE "node_audit_detail" ("audit_id" bytea NOT NULL, "seq" int NOT NULL, "duration" int NOT NULL, "res_id" varchar(255) NOT NULL, "res_type" varchar(16) NOT NULL, "res_name" varchar(255) NOT NULL, "res_result" varchar(16) NULL, "res_initial_state" text NULL, "res_final_state" text NULL, "delta" text NULL, PRIMARY KEY ("audit_id", "seq"), CONSTRAINT "audit_id_fk" FOREIGN KEY ("audit_id") REFERENCES "node_audit")
I, [2012-04-26T16:29:53.495231 #17030]  INFO -- : (0.000158s) UPDATE "schema_info" SET "version" = 5
I, [2012-04-26T16:29:53.647845 #17030]  INFO -- : (0.152537s) COMMIT
I, [2012-04-26T16:29:53.647939 #17030]  INFO -- : Finished applying migration version 5, direction: up, took 0.162320 seconds
I, [2012-04-26T16:29:53.647971 #17030]  INFO -- : Begin applying migration version 6, direction: up
I, [2012-04-26T16:29:53.648273 #17030]  INFO -- : (0.000245s) BEGIN
I, [2012-04-26T16:29:53.652702 #17030]  INFO -- : (0.004070s) CREATE TABLE "data_bags" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:29:53.653851 #17030]  INFO -- : (0.000940s) CREATE INDEX "data_bags_org_id_index" ON "data_bags" ("org_id")
I, [2012-04-26T16:29:53.654288 #17030]  INFO -- : (0.000221s) UPDATE "schema_info" SET "version" = 6
I, [2012-04-26T16:29:53.654933 #17030]  INFO -- : (0.000574s) COMMIT
I, [2012-04-26T16:29:53.654997 #17030]  INFO -- : Finished applying migration version 6, direction: up, took 0.007021 seconds
I, [2012-04-26T16:29:53.655033 #17030]  INFO -- : Begin applying migration version 7, direction: up
I, [2012-04-26T16:29:53.655238 #17030]  INFO -- : (0.000143s) BEGIN
I, [2012-04-26T16:29:53.659033 #17030]  INFO -- : (0.003287s) CREATE TABLE "data_bag_items" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "data_bag_name" text NOT NULL, "item_name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "data_bag_name", "item_name"))
I, [2012-04-26T16:29:53.659910 #17030]  INFO -- : (0.000720s) CREATE INDEX "data_bag_items_org_id_index" ON "data_bag_items" ("org_id")
I, [2012-04-26T16:29:53.660141 #17030]  INFO -- : (0.000160s) ALTER TABLE data_bag_items ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T16:29:53.660415 #17030]  INFO -- : (0.000149s) UPDATE "schema_info" SET "version" = 7
I, [2012-04-26T16:29:53.661997 #17030]  INFO -- : (0.001526s) COMMIT
I, [2012-04-26T16:29:53.662058 #17030]  INFO -- : Finished applying migration version 7, direction: up, took 0.007021 seconds
I, [2012-04-26T16:29:53.662091 #17030]  INFO -- : Begin applying migration version 8, direction: up
I, [2012-04-26T16:29:53.662275 #17030]  INFO -- : (0.000127s) BEGIN
I, [2012-04-26T16:29:53.667010 #17030]  INFO -- : (0.004377s) CREATE TABLE "environments" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:29:53.667980 #17030]  INFO -- : (0.000720s) CREATE INDEX "environments_org_id_index" ON "environments" ("org_id")
I, [2012-04-26T16:29:53.668260 #17030]  INFO -- : (0.000198s) ALTER TABLE environments ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T16:29:53.668621 #17030]  INFO -- : (0.000175s) UPDATE "schema_info" SET "version" = 8
I, [2012-04-26T16:29:53.669214 #17030]  INFO -- : (0.000525s) COMMIT
I, [2012-04-26T16:29:53.669291 #17030]  INFO -- : Finished applying migration version 8, direction: up, took 0.007189 seconds
I, [2012-04-26T16:29:53.669348 #17030]  INFO -- : Begin applying migration version 9, direction: up
I, [2012-04-26T16:29:53.669556 #17030]  INFO -- : (0.000127s) BEGIN
I, [2012-04-26T16:29:53.671939 #17030]  INFO -- : (0.002160s) ALTER TABLE "data_bag_items" ADD FOREIGN KEY ("org_id", "data_bag_name") REFERENCES "data_bags"("org_id", "name") ON DELETE CASCADE ON UPDATE CASCADE
I, [2012-04-26T16:29:53.672227 #17030]  INFO -- : (0.000145s) UPDATE "schema_info" SET "version" = 9
I, [2012-04-26T16:29:53.672831 #17030]  INFO -- : (0.000547s) COMMIT
I, [2012-04-26T16:29:53.672889 #17030]  INFO -- : Finished applying migration version 9, direction: up, took 0.003540 seconds
I, [2012-04-26T16:29:53.672923 #17030]  INFO -- : Begin applying migration version 10, direction: up
I, [2012-04-26T16:29:53.673062 #17030]  INFO -- : (0.000087s) BEGIN
I, [2012-04-26T16:29:53.673650 #17030]  INFO -- : (0.000470s) DROP INDEX "clients_org_id_index"
I, [2012-04-26T16:29:53.673926 #17030]  INFO -- : (0.000177s) DROP INDEX "environments_org_id_index"
I, [2012-04-26T16:29:53.674177 #17030]  INFO -- : (0.000159s) DROP INDEX "nodes_org_id_index"
I, [2012-04-26T16:29:53.674408 #17030]  INFO -- : (0.000143s) DROP INDEX "roles_org_id_index"
I, [2012-04-26T16:29:53.674636 #17030]  INFO -- : (0.000141s) DROP INDEX "data_bags_org_id_index"
I, [2012-04-26T16:29:53.674864 #17030]  INFO -- : (0.000140s) DROP INDEX "data_bag_items_org_id_index"
I, [2012-04-26T16:29:53.675107 #17030]  INFO -- : (0.000144s) UPDATE "schema_info" SET "version" = 10
I, [2012-04-26T16:29:53.675958 #17030]  INFO -- : (0.000789s) COMMIT
I, [2012-04-26T16:29:53.676005 #17030]  INFO -- : Finished applying migration version 10, direction: up, took 0.003078 seconds
I, [2012-04-26T16:29:53.676036 #17030]  INFO -- : Begin applying migration version 11, direction: up
I, [2012-04-26T16:29:53.676151 #17030]  INFO -- : (0.000070s) BEGIN
I, [2012-04-26T16:29:53.676514 #17030]  INFO -- : (0.000179s) ALTER TABLE "users" ADD COLUMN "external_authentication_uid" text NULL
I, [2012-04-26T16:29:53.676703 #17030]  INFO -- : (0.000142s) ALTER TABLE "users" ADD COLUMN "recovery_authentication_enabled" boolean NULL
I, [2012-04-26T16:29:53.676876 #17030]  INFO -- : (0.000129s) ALTER TABLE "users" ALTER COLUMN "email" DROP NOT NULL
I, [2012-04-26T16:29:53.677067 #17030]  INFO -- : (0.000104s) UPDATE "schema_info" SET "version" = 11
I, [2012-04-26T16:29:53.677537 #17030]  INFO -- : (0.000425s) COMMIT
I, [2012-04-26T16:29:53.677583 #17030]  INFO -- : Finished applying migration version 11, direction: up, took 0.001543 seconds
I, [2012-04-26T16:30:41.815646 #17200]  INFO -- : (0.000322s) SET standard_conforming_strings = ON
I, [2012-04-26T16:30:41.815872 #17200]  INFO -- : (0.000091s) SET client_min_messages = 'WARNING'
I, [2012-04-26T16:30:41.816038 #17200]  INFO -- : (0.000117s) SET DateStyle = 'ISO'
E, [2012-04-26T16:30:41.823856 #17200] ERROR -- : PG::Error: ERROR:  relation "schema_info" does not exist
LINE 1: SELECT NULL FROM "schema_info" LIMIT 1
                         ^: SELECT NULL FROM "schema_info" LIMIT 1
I, [2012-04-26T16:30:41.828709 #17200]  INFO -- : (0.004537s) CREATE TABLE "schema_info" ("version" integer DEFAULT 0 NOT NULL)
I, [2012-04-26T16:30:41.829483 #17200]  INFO -- : (0.000548s) SELECT 1 AS "one" FROM "schema_info" LIMIT 1
I, [2012-04-26T16:30:41.831468 #17200]  INFO -- : (0.001775s) SELECT pg_attribute.attname FROM pg_class, pg_attribute, pg_index, pg_namespace WHERE pg_class.oid = pg_attribute.attrelid AND pg_class.relnamespace = pg_namespace.oid AND pg_class.oid = pg_index.indrelid AND pg_index.indkey[0] = pg_attribute.attnum AND pg_index.indisprimary = 't' AND pg_class.relname = 'schema_info'
I, [2012-04-26T16:30:41.832308 #17200]  INFO -- : (0.000592s) INSERT INTO "schema_info" ("version") VALUES (0) RETURNING NULL
I, [2012-04-26T16:30:41.833166 #17200]  INFO -- : (0.000449s) SELECT COUNT(*) AS "count" FROM "schema_info" LIMIT 1
I, [2012-04-26T16:30:41.833587 #17200]  INFO -- : (0.000184s) SELECT "version" FROM "schema_info" LIMIT 1
I, [2012-04-26T16:30:41.850452 #17200]  INFO -- : Begin applying migration version 1, direction: up
I, [2012-04-26T16:30:41.850743 #17200]  INFO -- : (0.000152s) BEGIN
I, [2012-04-26T16:30:41.856040 #17200]  INFO -- : (0.004864s) CREATE TABLE "users" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "username" text NOT NULL UNIQUE, "email" text NOT NULL UNIQUE, "pubkey_version" integer NOT NULL, "public_key" text, "serialized_object" text, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-04-26T16:30:41.856470 #17200]  INFO -- : (0.000194s) UPDATE "schema_info" SET "version" = 1
I, [2012-04-26T16:30:41.857223 #17200]  INFO -- : (0.000692s) COMMIT
I, [2012-04-26T16:30:41.857303 #17200]  INFO -- : Finished applying migration version 1, direction: up, took 0.006854 seconds
I, [2012-04-26T16:30:41.857340 #17200]  INFO -- : Begin applying migration version 2, direction: up
I, [2012-04-26T16:30:41.857537 #17200]  INFO -- : (0.000141s) BEGIN
I, [2012-04-26T16:30:41.861965 #17200]  INFO -- : (0.004009s) CREATE TABLE "nodes" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "environment" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" text, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:30:41.863501 #17200]  INFO -- : (0.001299s) CREATE INDEX "nodes_org_id_index" ON "nodes" ("org_id")
I, [2012-04-26T16:30:41.864395 #17200]  INFO -- : (0.000729s) CREATE INDEX "nodes_org_id_environment_index" ON "nodes" ("org_id", "environment")
I, [2012-04-26T16:30:41.864772 #17200]  INFO -- : (0.000176s) UPDATE "schema_info" SET "version" = 2
I, [2012-04-26T16:30:41.865355 #17200]  INFO -- : (0.000524s) COMMIT
I, [2012-04-26T16:30:41.865410 #17200]  INFO -- : Finished applying migration version 2, direction: up, took 0.008066 seconds
I, [2012-04-26T16:30:41.865444 #17200]  INFO -- : Begin applying migration version 3, direction: up
I, [2012-04-26T16:30:41.865597 #17200]  INFO -- : (0.000100s) BEGIN
I, [2012-04-26T16:30:41.870375 #17200]  INFO -- : (0.004363s) CREATE TABLE "clients" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, "name" text NOT NULL, "public_key" text, "validator" boolean NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "pubkey_version" smallint NOT NULL, CONSTRAINT "org_id_name_unique" UNIQUE ("org_id", "name"))
I, [2012-04-26T16:30:41.871150 #17200]  INFO -- : (0.000629s) CREATE INDEX "clients_org_id_index" ON "clients" ("org_id")
I, [2012-04-26T16:30:41.871530 #17200]  INFO -- : (0.000189s) UPDATE "schema_info" SET "version" = 3
I, [2012-04-26T16:30:41.872598 #17200]  INFO -- : (0.000999s) COMMIT
I, [2012-04-26T16:30:41.872662 #17200]  INFO -- : Finished applying migration version 3, direction: up, took 0.007212 seconds
I, [2012-04-26T16:30:41.872697 #17200]  INFO -- : Begin applying migration version 4, direction: up
I, [2012-04-26T16:30:41.872911 #17200]  INFO -- : (0.000150s) BEGIN
I, [2012-04-26T16:30:41.876874 #17200]  INFO -- : (0.003516s) CREATE TABLE "roles" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:30:41.877801 #17200]  INFO -- : (0.000763s) CREATE INDEX "roles_org_id_index" ON "roles" ("org_id")
I, [2012-04-26T16:30:41.878070 #17200]  INFO -- : (0.000194s) ALTER TABLE roles ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T16:30:41.878402 #17200]  INFO -- : (0.000192s) UPDATE "schema_info" SET "version" = 4
I, [2012-04-26T16:30:41.879046 #17200]  INFO -- : (0.000574s) COMMIT
I, [2012-04-26T16:30:41.879113 #17200]  INFO -- : Finished applying migration version 4, direction: up, took 0.006412 seconds
I, [2012-04-26T16:30:41.879147 #17200]  INFO -- : Begin applying migration version 5, direction: up
I, [2012-04-26T16:30:41.879346 #17200]  INFO -- : (0.000140s) BEGIN
I, [2012-04-26T16:30:41.879743 #17200]  INFO -- : (0.000224s) ALTER TABLE "nodes" ADD COLUMN "last_audit_id" bytea
I, [2012-04-26T16:30:41.883947 #17200]  INFO -- : (0.003855s) CREATE TABLE "node_audit" ("audit_id" bytea NOT NULL, "node_id" char(32), "status" varchar(16), "start_time" timestamp NOT NULL, "end_time" timestamp NULL, "event_data" text NULL, PRIMARY KEY ("audit_id"), CONSTRAINT "node_id_fk" FOREIGN KEY ("node_id") REFERENCES "nodes")
I, [2012-04-26T16:30:41.884990 #17200]  INFO -- : (0.000816s) CREATE INDEX "node_audit_node_id_index" ON "node_audit" ("node_id")
I, [2012-04-26T16:30:41.889674 #17200]  INFO -- : (0.004189s) CREATE TABLE "node_audit_detail" ("audit_id" bytea NOT NULL, "seq" int NOT NULL, "duration" int NOT NULL, "res_id" varchar(255) NOT NULL, "res_type" varchar(16) NOT NULL, "res_name" varchar(255) NOT NULL, "res_result" varchar(16) NULL, "res_initial_state" text NULL, "res_final_state" text NULL, "delta" text NULL, PRIMARY KEY ("audit_id", "seq"), CONSTRAINT "audit_id_fk" FOREIGN KEY ("audit_id") REFERENCES "node_audit")
I, [2012-04-26T16:30:41.890146 #17200]  INFO -- : (0.000232s) UPDATE "schema_info" SET "version" = 5
I, [2012-04-26T16:30:41.891127 #17200]  INFO -- : (0.000916s) COMMIT
I, [2012-04-26T16:30:41.891190 #17200]  INFO -- : Finished applying migration version 5, direction: up, took 0.012038 seconds
I, [2012-04-26T16:30:41.891236 #17200]  INFO -- : Begin applying migration version 6, direction: up
I, [2012-04-26T16:30:41.891413 #17200]  INFO -- : (0.000121s) BEGIN
I, [2012-04-26T16:30:41.895372 #17200]  INFO -- : (0.003610s) CREATE TABLE "data_bags" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:30:41.896640 #17200]  INFO -- : (0.001016s) CREATE INDEX "data_bags_org_id_index" ON "data_bags" ("org_id")
I, [2012-04-26T16:30:41.897076 #17200]  INFO -- : (0.000216s) UPDATE "schema_info" SET "version" = 6
I, [2012-04-26T16:30:41.898102 #17200]  INFO -- : (0.000938s) COMMIT
I, [2012-04-26T16:30:41.898191 #17200]  INFO -- : Finished applying migration version 6, direction: up, took 0.006945 seconds
I, [2012-04-26T16:30:41.898251 #17200]  INFO -- : Begin applying migration version 7, direction: up
I, [2012-04-26T16:30:41.898497 #17200]  INFO -- : (0.000153s) BEGIN
I, [2012-04-26T16:30:41.902903 #17200]  INFO -- : (0.003807s) CREATE TABLE "data_bag_items" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "data_bag_name" text NOT NULL, "item_name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "data_bag_name", "item_name"))
I, [2012-04-26T16:30:41.903956 #17200]  INFO -- : (0.000888s) CREATE INDEX "data_bag_items_org_id_index" ON "data_bag_items" ("org_id")
I, [2012-04-26T16:30:41.904274 #17200]  INFO -- : (0.000257s) ALTER TABLE data_bag_items ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T16:30:41.904560 #17200]  INFO -- : (0.000145s) UPDATE "schema_info" SET "version" = 7
I, [2012-04-26T16:30:41.905463 #17200]  INFO -- : (0.000848s) COMMIT
I, [2012-04-26T16:30:41.905521 #17200]  INFO -- : Finished applying migration version 7, direction: up, took 0.007271 seconds
I, [2012-04-26T16:30:41.905557 #17200]  INFO -- : Begin applying migration version 8, direction: up
I, [2012-04-26T16:30:41.905778 #17200]  INFO -- : (0.000160s) BEGIN
I, [2012-04-26T16:30:41.910065 #17200]  INFO -- : (0.003914s) CREATE TABLE "environments" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:30:41.910945 #17200]  INFO -- : (0.000718s) CREATE INDEX "environments_org_id_index" ON "environments" ("org_id")
I, [2012-04-26T16:30:41.911244 #17200]  INFO -- : (0.000224s) ALTER TABLE environments ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T16:30:41.911511 #17200]  INFO -- : (0.000135s) UPDATE "schema_info" SET "version" = 8
I, [2012-04-26T16:30:41.912345 #17200]  INFO -- : (0.000778s) COMMIT
I, [2012-04-26T16:30:41.912407 #17200]  INFO -- : Finished applying migration version 8, direction: up, took 0.006846 seconds
I, [2012-04-26T16:30:41.912444 #17200]  INFO -- : Begin applying migration version 9, direction: up
I, [2012-04-26T16:30:41.912597 #17200]  INFO -- : (0.000099s) BEGIN
I, [2012-04-26T16:30:41.914177 #17200]  INFO -- : (0.001397s) ALTER TABLE "data_bag_items" ADD FOREIGN KEY ("org_id", "data_bag_name") REFERENCES "data_bags"("org_id", "name") ON DELETE CASCADE ON UPDATE CASCADE
I, [2012-04-26T16:30:41.914481 #17200]  INFO -- : (0.000173s) UPDATE "schema_info" SET "version" = 9
I, [2012-04-26T16:30:41.914937 #17200]  INFO -- : (0.000406s) COMMIT
I, [2012-04-26T16:30:41.914988 #17200]  INFO -- : Finished applying migration version 9, direction: up, took 0.002540 seconds
I, [2012-04-26T16:30:41.915021 #17200]  INFO -- : Begin applying migration version 10, direction: up
I, [2012-04-26T16:30:41.915181 #17200]  INFO -- : (0.000109s) BEGIN
I, [2012-04-26T16:30:41.915627 #17200]  INFO -- : (0.000327s) DROP INDEX "clients_org_id_index"
I, [2012-04-26T16:30:41.915901 #17200]  INFO -- : (0.000172s) DROP INDEX "environments_org_id_index"
I, [2012-04-26T16:30:41.916228 #17200]  INFO -- : (0.000218s) DROP INDEX "nodes_org_id_index"
I, [2012-04-26T16:30:41.916587 #17200]  INFO -- : (0.000266s) DROP INDEX "roles_org_id_index"
I, [2012-04-26T16:30:41.916899 #17200]  INFO -- : (0.000221s) DROP INDEX "data_bags_org_id_index"
I, [2012-04-26T16:30:41.917318 #17200]  INFO -- : (0.000319s) DROP INDEX "data_bag_items_org_id_index"
I, [2012-04-26T16:30:41.917710 #17200]  INFO -- : (0.000221s) UPDATE "schema_info" SET "version" = 10
I, [2012-04-26T16:30:41.918691 #17200]  INFO -- : (0.000896s) COMMIT
I, [2012-04-26T16:30:41.918758 #17200]  INFO -- : Finished applying migration version 10, direction: up, took 0.003732 seconds
I, [2012-04-26T16:30:41.918795 #17200]  INFO -- : Begin applying migration version 11, direction: up
I, [2012-04-26T16:30:41.918968 #17200]  INFO -- : (0.000095s) BEGIN
I, [2012-04-26T16:30:41.919410 #17200]  INFO -- : (0.000230s) ALTER TABLE "users" ADD COLUMN "external_authentication_uid" text NULL
I, [2012-04-26T16:30:41.919648 #17200]  INFO -- : (0.000181s) ALTER TABLE "users" ADD COLUMN "recovery_authentication_enabled" boolean NULL
I, [2012-04-26T16:30:41.919936 #17200]  INFO -- : (0.000230s) ALTER TABLE "users" ALTER COLUMN "email" DROP NOT NULL
I, [2012-04-26T16:30:41.920212 #17200]  INFO -- : (0.000161s) UPDATE "schema_info" SET "version" = 11
I, [2012-04-26T16:30:41.920962 #17200]  INFO -- : (0.000694s) COMMIT
I, [2012-04-26T16:30:41.921017 #17200]  INFO -- : Finished applying migration version 11, direction: up, took 0.002220 seconds
I, [2012-04-26T16:32:57.878243 #17384]  INFO -- : (0.000416s) SET standard_conforming_strings = ON
I, [2012-04-26T16:32:57.878548 #17384]  INFO -- : (0.000169s) SET client_min_messages = 'WARNING'
I, [2012-04-26T16:32:57.878745 #17384]  INFO -- : (0.000139s) SET DateStyle = 'ISO'
E, [2012-04-26T16:32:57.886465 #17384] ERROR -- : PG::Error: ERROR:  relation "schema_info" does not exist
LINE 1: SELECT NULL FROM "schema_info" LIMIT 1
                         ^: SELECT NULL FROM "schema_info" LIMIT 1
I, [2012-04-26T16:32:57.890775 #17384]  INFO -- : (0.004022s) CREATE TABLE "schema_info" ("version" integer DEFAULT 0 NOT NULL)
I, [2012-04-26T16:32:57.891535 #17384]  INFO -- : (0.000535s) SELECT 1 AS "one" FROM "schema_info" LIMIT 1
I, [2012-04-26T16:32:57.893564 #17384]  INFO -- : (0.001814s) SELECT pg_attribute.attname FROM pg_class, pg_attribute, pg_index, pg_namespace WHERE pg_class.oid = pg_attribute.attrelid AND pg_class.relnamespace = pg_namespace.oid AND pg_class.oid = pg_index.indrelid AND pg_index.indkey[0] = pg_attribute.attnum AND pg_index.indisprimary = 't' AND pg_class.relname = 'schema_info'
I, [2012-04-26T16:32:57.894522 #17384]  INFO -- : (0.000721s) INSERT INTO "schema_info" ("version") VALUES (0) RETURNING NULL
I, [2012-04-26T16:32:57.895167 #17384]  INFO -- : (0.000362s) SELECT COUNT(*) AS "count" FROM "schema_info" LIMIT 1
I, [2012-04-26T16:32:57.895512 #17384]  INFO -- : (0.000175s) SELECT "version" FROM "schema_info" LIMIT 1
I, [2012-04-26T16:32:57.912027 #17384]  INFO -- : Begin applying migration version 1, direction: up
I, [2012-04-26T16:32:57.912425 #17384]  INFO -- : (0.000278s) BEGIN
I, [2012-04-26T16:32:57.918611 #17384]  INFO -- : (0.005787s) CREATE TABLE "users" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "username" text NOT NULL UNIQUE, "email" text NOT NULL UNIQUE, "pubkey_version" integer NOT NULL, "public_key" text, "serialized_object" text, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-04-26T16:32:57.919030 #17384]  INFO -- : (0.000225s) UPDATE "schema_info" SET "version" = 1
I, [2012-04-26T16:32:57.919782 #17384]  INFO -- : (0.000683s) COMMIT
I, [2012-04-26T16:32:57.919849 #17384]  INFO -- : Finished applying migration version 1, direction: up, took 0.007827 seconds
I, [2012-04-26T16:32:57.919885 #17384]  INFO -- : Begin applying migration version 2, direction: up
I, [2012-04-26T16:32:57.920040 #17384]  INFO -- : (0.000100s) BEGIN
I, [2012-04-26T16:32:57.924326 #17384]  INFO -- : (0.003869s) CREATE TABLE "nodes" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "environment" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" text, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:32:57.925305 #17384]  INFO -- : (0.000731s) CREATE INDEX "nodes_org_id_index" ON "nodes" ("org_id")
I, [2012-04-26T16:32:57.926142 #17384]  INFO -- : (0.000698s) CREATE INDEX "nodes_org_id_environment_index" ON "nodes" ("org_id", "environment")
I, [2012-04-26T16:32:57.926467 #17384]  INFO -- : (0.000175s) UPDATE "schema_info" SET "version" = 2
I, [2012-04-26T16:32:57.927685 #17384]  INFO -- : (0.001152s) COMMIT
I, [2012-04-26T16:32:57.927767 #17384]  INFO -- : Finished applying migration version 2, direction: up, took 0.007877 seconds
I, [2012-04-26T16:32:57.927806 #17384]  INFO -- : Begin applying migration version 3, direction: up
I, [2012-04-26T16:32:57.928045 #17384]  INFO -- : (0.000161s) BEGIN
I, [2012-04-26T16:32:57.932638 #17384]  INFO -- : (0.003922s) CREATE TABLE "clients" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, "name" text NOT NULL, "public_key" text, "validator" boolean NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "pubkey_version" smallint NOT NULL, CONSTRAINT "org_id_name_unique" UNIQUE ("org_id", "name"))
I, [2012-04-26T16:32:57.933401 #17384]  INFO -- : (0.000610s) CREATE INDEX "clients_org_id_index" ON "clients" ("org_id")
I, [2012-04-26T16:32:57.933817 #17384]  INFO -- : (0.000228s) UPDATE "schema_info" SET "version" = 3
I, [2012-04-26T16:32:57.934655 #17384]  INFO -- : (0.000752s) COMMIT
I, [2012-04-26T16:32:57.934747 #17384]  INFO -- : Finished applying migration version 3, direction: up, took 0.006936 seconds
I, [2012-04-26T16:32:57.934788 #17384]  INFO -- : Begin applying migration version 4, direction: up
I, [2012-04-26T16:32:57.935274 #17384]  INFO -- : (0.000413s) BEGIN
I, [2012-04-26T16:32:57.940136 #17384]  INFO -- : (0.004249s) CREATE TABLE "roles" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:32:57.941081 #17384]  INFO -- : (0.000795s) CREATE INDEX "roles_org_id_index" ON "roles" ("org_id")
I, [2012-04-26T16:32:57.941429 #17384]  INFO -- : (0.000277s) ALTER TABLE roles ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T16:32:57.941790 #17384]  INFO -- : (0.000226s) UPDATE "schema_info" SET "version" = 4
I, [2012-04-26T16:32:57.942659 #17384]  INFO -- : (0.000805s) COMMIT
I, [2012-04-26T16:32:57.942725 #17384]  INFO -- : Finished applying migration version 4, direction: up, took 0.007934 seconds
I, [2012-04-26T16:32:57.942759 #17384]  INFO -- : Begin applying migration version 5, direction: up
I, [2012-04-26T16:32:57.942976 #17384]  INFO -- : (0.000160s) BEGIN
I, [2012-04-26T16:32:57.943318 #17384]  INFO -- : (0.000180s) ALTER TABLE "nodes" ADD COLUMN "last_audit_id" bytea
I, [2012-04-26T16:32:57.947395 #17384]  INFO -- : (0.003749s) CREATE TABLE "node_audit" ("audit_id" bytea NOT NULL, "node_id" char(32), "status" varchar(16), "start_time" timestamp NOT NULL, "end_time" timestamp NULL, "event_data" text NULL, PRIMARY KEY ("audit_id"), CONSTRAINT "node_id_fk" FOREIGN KEY ("node_id") REFERENCES "nodes")
I, [2012-04-26T16:32:57.948487 #17384]  INFO -- : (0.000870s) CREATE INDEX "node_audit_node_id_index" ON "node_audit" ("node_id")
I, [2012-04-26T16:32:57.951926 #17384]  INFO -- : (0.002998s) CREATE TABLE "node_audit_detail" ("audit_id" bytea NOT NULL, "seq" int NOT NULL, "duration" int NOT NULL, "res_id" varchar(255) NOT NULL, "res_type" varchar(16) NOT NULL, "res_name" varchar(255) NOT NULL, "res_result" varchar(16) NULL, "res_initial_state" text NULL, "res_final_state" text NULL, "delta" text NULL, PRIMARY KEY ("audit_id", "seq"), CONSTRAINT "audit_id_fk" FOREIGN KEY ("audit_id") REFERENCES "node_audit")
I, [2012-04-26T16:32:57.952374 #17384]  INFO -- : (0.000241s) UPDATE "schema_info" SET "version" = 5
I, [2012-04-26T16:32:57.953475 #17384]  INFO -- : (0.001018s) COMMIT
I, [2012-04-26T16:32:57.953536 #17384]  INFO -- : Finished applying migration version 5, direction: up, took 0.010771 seconds
I, [2012-04-26T16:32:57.953572 #17384]  INFO -- : Begin applying migration version 6, direction: up
I, [2012-04-26T16:32:57.953745 #17384]  INFO -- : (0.000121s) BEGIN
I, [2012-04-26T16:32:57.958062 #17384]  INFO -- : (0.003971s) CREATE TABLE "data_bags" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:32:57.959070 #17384]  INFO -- : (0.000791s) CREATE INDEX "data_bags_org_id_index" ON "data_bags" ("org_id")
I, [2012-04-26T16:32:57.959479 #17384]  INFO -- : (0.000204s) UPDATE "schema_info" SET "version" = 6
I, [2012-04-26T16:32:57.960201 #17384]  INFO -- : (0.000641s) COMMIT
I, [2012-04-26T16:32:57.960283 #17384]  INFO -- : Finished applying migration version 6, direction: up, took 0.006702 seconds
I, [2012-04-26T16:32:57.960325 #17384]  INFO -- : Begin applying migration version 7, direction: up
I, [2012-04-26T16:32:57.960528 #17384]  INFO -- : (0.000136s) BEGIN
I, [2012-04-26T16:32:57.964002 #17384]  INFO -- : (0.003089s) CREATE TABLE "data_bag_items" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "data_bag_name" text NOT NULL, "item_name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "data_bag_name", "item_name"))
I, [2012-04-26T16:32:57.964956 #17384]  INFO -- : (0.000801s) CREATE INDEX "data_bag_items_org_id_index" ON "data_bag_items" ("org_id")
I, [2012-04-26T16:32:57.965261 #17384]  INFO -- : (0.000248s) ALTER TABLE data_bag_items ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T16:32:57.965608 #17384]  INFO -- : (0.000224s) UPDATE "schema_info" SET "version" = 7
I, [2012-04-26T16:32:57.966488 #17384]  INFO -- : (0.000817s) COMMIT
I, [2012-04-26T16:32:57.966550 #17384]  INFO -- : Finished applying migration version 7, direction: up, took 0.006222 seconds
I, [2012-04-26T16:32:57.966584 #17384]  INFO -- : Begin applying migration version 8, direction: up
I, [2012-04-26T16:32:57.966767 #17384]  INFO -- : (0.000124s) BEGIN
I, [2012-04-26T16:32:57.971115 #17384]  INFO -- : (0.003990s) CREATE TABLE "environments" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:32:57.971947 #17384]  INFO -- : (0.000667s) CREATE INDEX "environments_org_id_index" ON "environments" ("org_id")
I, [2012-04-26T16:32:57.972175 #17384]  INFO -- : (0.000135s) ALTER TABLE environments ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T16:32:57.972447 #17384]  INFO -- : (0.000144s) UPDATE "schema_info" SET "version" = 8
I, [2012-04-26T16:32:57.973150 #17384]  INFO -- : (0.000640s) COMMIT
I, [2012-04-26T16:32:57.973214 #17384]  INFO -- : Finished applying migration version 8, direction: up, took 0.006625 seconds
I, [2012-04-26T16:32:57.973248 #17384]  INFO -- : Begin applying migration version 9, direction: up
I, [2012-04-26T16:32:57.973407 #17384]  INFO -- : (0.000104s) BEGIN
I, [2012-04-26T16:32:57.975042 #17384]  INFO -- : (0.001439s) ALTER TABLE "data_bag_items" ADD FOREIGN KEY ("org_id", "data_bag_name") REFERENCES "data_bags"("org_id", "name") ON DELETE CASCADE ON UPDATE CASCADE
I, [2012-04-26T16:32:57.975446 #17384]  INFO -- : (0.000279s) UPDATE "schema_info" SET "version" = 9
I, [2012-04-26T16:32:57.976254 #17384]  INFO -- : (0.000735s) COMMIT
I, [2012-04-26T16:32:57.976312 #17384]  INFO -- : Finished applying migration version 9, direction: up, took 0.003060 seconds
I, [2012-04-26T16:32:57.976345 #17384]  INFO -- : Begin applying migration version 10, direction: up
I, [2012-04-26T16:32:57.976572 #17384]  INFO -- : (0.000176s) BEGIN
I, [2012-04-26T16:32:57.977039 #17384]  INFO -- : (0.000343s) DROP INDEX "clients_org_id_index"
I, [2012-04-26T16:32:57.977350 #17384]  INFO -- : (0.000194s) DROP INDEX "environments_org_id_index"
I, [2012-04-26T16:32:57.977608 #17384]  INFO -- : (0.000148s) DROP INDEX "nodes_org_id_index"
I, [2012-04-26T16:32:57.977898 #17384]  INFO -- : (0.000192s) DROP INDEX "roles_org_id_index"
I, [2012-04-26T16:32:57.978303 #17384]  INFO -- : (0.000261s) DROP INDEX "data_bags_org_id_index"
I, [2012-04-26T16:32:57.978729 #17384]  INFO -- : (0.000266s) DROP INDEX "data_bag_items_org_id_index"
I, [2012-04-26T16:32:57.979098 #17384]  INFO -- : (0.000199s) UPDATE "schema_info" SET "version" = 10
I, [2012-04-26T16:32:57.980017 #17384]  INFO -- : (0.000832s) COMMIT
I, [2012-04-26T16:32:57.980081 #17384]  INFO -- : Finished applying migration version 10, direction: up, took 0.003731 seconds
I, [2012-04-26T16:32:57.980117 #17384]  INFO -- : Begin applying migration version 11, direction: up
I, [2012-04-26T16:32:57.980287 #17384]  INFO -- : (0.000109s) BEGIN
I, [2012-04-26T16:32:57.980938 #17384]  INFO -- : (0.000306s) ALTER TABLE "users" ADD COLUMN "external_authentication_uid" text NULL
I, [2012-04-26T16:32:57.981196 #17384]  INFO -- : (0.000177s) ALTER TABLE "users" ADD COLUMN "recovery_authentication_enabled" boolean NULL
I, [2012-04-26T16:32:57.981445 #17384]  INFO -- : (0.000174s) ALTER TABLE "users" ALTER COLUMN "email" DROP NOT NULL
I, [2012-04-26T16:32:57.981726 #17384]  INFO -- : (0.000159s) UPDATE "schema_info" SET "version" = 11
I, [2012-04-26T16:32:57.982207 #17384]  INFO -- : (0.000425s) COMMIT
I, [2012-04-26T16:32:57.982263 #17384]  INFO -- : Finished applying migration version 11, direction: up, took 0.002142 seconds
I, [2012-04-26T16:37:38.185799 #17573]  INFO -- : (0.000429s) SET standard_conforming_strings = ON
I, [2012-04-26T16:37:38.186040 #17573]  INFO -- : (0.000105s) SET client_min_messages = 'WARNING'
I, [2012-04-26T16:37:38.186174 #17573]  INFO -- : (0.000084s) SET DateStyle = 'ISO'
E, [2012-04-26T16:37:38.193779 #17573] ERROR -- : PG::Error: ERROR:  relation "schema_info" does not exist
LINE 1: SELECT NULL FROM "schema_info" LIMIT 1
                         ^: SELECT NULL FROM "schema_info" LIMIT 1
I, [2012-04-26T16:37:38.198262 #17573]  INFO -- : (0.004190s) CREATE TABLE "schema_info" ("version" integer DEFAULT 0 NOT NULL)
I, [2012-04-26T16:37:38.199032 #17573]  INFO -- : (0.000549s) SELECT 1 AS "one" FROM "schema_info" LIMIT 1
I, [2012-04-26T16:37:38.200947 #17573]  INFO -- : (0.001720s) SELECT pg_attribute.attname FROM pg_class, pg_attribute, pg_index, pg_namespace WHERE pg_class.oid = pg_attribute.attrelid AND pg_class.relnamespace = pg_namespace.oid AND pg_class.oid = pg_index.indrelid AND pg_index.indkey[0] = pg_attribute.attnum AND pg_index.indisprimary = 't' AND pg_class.relname = 'schema_info'
I, [2012-04-26T16:37:38.201900 #17573]  INFO -- : (0.000748s) INSERT INTO "schema_info" ("version") VALUES (0) RETURNING NULL
I, [2012-04-26T16:37:38.202577 #17573]  INFO -- : (0.000428s) SELECT COUNT(*) AS "count" FROM "schema_info" LIMIT 1
I, [2012-04-26T16:37:38.203041 #17573]  INFO -- : (0.000280s) SELECT "version" FROM "schema_info" LIMIT 1
I, [2012-04-26T16:37:38.218484 #17573]  INFO -- : Begin applying migration version 1, direction: up
I, [2012-04-26T16:37:38.218904 #17573]  INFO -- : (0.000310s) BEGIN
I, [2012-04-26T16:37:38.224603 #17573]  INFO -- : (0.005333s) CREATE TABLE "users" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "username" text NOT NULL UNIQUE, "email" text NOT NULL UNIQUE, "pubkey_version" integer NOT NULL, "public_key" text, "serialized_object" text, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-04-26T16:37:38.225040 #17573]  INFO -- : (0.000237s) UPDATE "schema_info" SET "version" = 1
I, [2012-04-26T16:37:38.225865 #17573]  INFO -- : (0.000769s) COMMIT
I, [2012-04-26T16:37:38.225930 #17573]  INFO -- : Finished applying migration version 1, direction: up, took 0.007449 seconds
I, [2012-04-26T16:37:38.225972 #17573]  INFO -- : Begin applying migration version 2, direction: up
I, [2012-04-26T16:37:38.226152 #17573]  INFO -- : (0.000128s) BEGIN
I, [2012-04-26T16:37:38.230926 #17573]  INFO -- : (0.004383s) CREATE TABLE "nodes" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "environment" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" text, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:37:38.231891 #17573]  INFO -- : (0.000761s) CREATE INDEX "nodes_org_id_index" ON "nodes" ("org_id")
I, [2012-04-26T16:37:38.232883 #17573]  INFO -- : (0.000815s) CREATE INDEX "nodes_org_id_environment_index" ON "nodes" ("org_id", "environment")
I, [2012-04-26T16:37:38.233183 #17573]  INFO -- : (0.000153s) UPDATE "schema_info" SET "version" = 2
I, [2012-04-26T16:37:38.233912 #17573]  INFO -- : (0.000671s) COMMIT
I, [2012-04-26T16:37:38.233972 #17573]  INFO -- : Finished applying migration version 2, direction: up, took 0.007995 seconds
I, [2012-04-26T16:37:38.234007 #17573]  INFO -- : Begin applying migration version 3, direction: up
I, [2012-04-26T16:37:38.234195 #17573]  INFO -- : (0.000132s) BEGIN
I, [2012-04-26T16:37:38.237961 #17573]  INFO -- : (0.003362s) CREATE TABLE "clients" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, "name" text NOT NULL, "public_key" text, "validator" boolean NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "pubkey_version" smallint NOT NULL, CONSTRAINT "org_id_name_unique" UNIQUE ("org_id", "name"))
I, [2012-04-26T16:37:38.238885 #17573]  INFO -- : (0.000791s) CREATE INDEX "clients_org_id_index" ON "clients" ("org_id")
I, [2012-04-26T16:37:38.239232 #17573]  INFO -- : (0.000191s) UPDATE "schema_info" SET "version" = 3
I, [2012-04-26T16:37:38.239865 #17573]  INFO -- : (0.000545s) COMMIT
I, [2012-04-26T16:37:38.239958 #17573]  INFO -- : Finished applying migration version 3, direction: up, took 0.005940 seconds
I, [2012-04-26T16:37:38.240017 #17573]  INFO -- : Begin applying migration version 4, direction: up
I, [2012-04-26T16:37:38.240240 #17573]  INFO -- : (0.000139s) BEGIN
I, [2012-04-26T16:37:38.244519 #17573]  INFO -- : (0.003900s) CREATE TABLE "roles" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:37:38.245488 #17573]  INFO -- : (0.000816s) CREATE INDEX "roles_org_id_index" ON "roles" ("org_id")
I, [2012-04-26T16:37:38.245766 #17573]  INFO -- : (0.000207s) ALTER TABLE roles ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T16:37:38.246055 #17573]  INFO -- : (0.000154s) UPDATE "schema_info" SET "version" = 4
I, [2012-04-26T16:37:38.246791 #17573]  INFO -- : (0.000675s) COMMIT
I, [2012-04-26T16:37:38.246858 #17573]  INFO -- : Finished applying migration version 4, direction: up, took 0.006841 seconds
I, [2012-04-26T16:37:38.246892 #17573]  INFO -- : Begin applying migration version 5, direction: up
I, [2012-04-26T16:37:38.247083 #17573]  INFO -- : (0.000134s) BEGIN
I, [2012-04-26T16:37:38.247493 #17573]  INFO -- : (0.000235s) ALTER TABLE "nodes" ADD COLUMN "last_audit_id" bytea
I, [2012-04-26T16:37:38.251958 #17573]  INFO -- : (0.004118s) CREATE TABLE "node_audit" ("audit_id" bytea NOT NULL, "node_id" char(32), "status" varchar(16), "start_time" timestamp NOT NULL, "end_time" timestamp NULL, "event_data" text NULL, PRIMARY KEY ("audit_id"), CONSTRAINT "node_id_fk" FOREIGN KEY ("node_id") REFERENCES "nodes")
I, [2012-04-26T16:37:38.253560 #17573]  INFO -- : (0.001360s) CREATE INDEX "node_audit_node_id_index" ON "node_audit" ("node_id")
I, [2012-04-26T16:37:38.257526 #17573]  INFO -- : (0.003316s) CREATE TABLE "node_audit_detail" ("audit_id" bytea NOT NULL, "seq" int NOT NULL, "duration" int NOT NULL, "res_id" varchar(255) NOT NULL, "res_type" varchar(16) NOT NULL, "res_name" varchar(255) NOT NULL, "res_result" varchar(16) NULL, "res_initial_state" text NULL, "res_final_state" text NULL, "delta" text NULL, PRIMARY KEY ("audit_id", "seq"), CONSTRAINT "audit_id_fk" FOREIGN KEY ("audit_id") REFERENCES "node_audit")
I, [2012-04-26T16:37:38.257952 #17573]  INFO -- : (0.000251s) UPDATE "schema_info" SET "version" = 5
I, [2012-04-26T16:37:38.259135 #17573]  INFO -- : (0.001117s) COMMIT
I, [2012-04-26T16:37:38.259200 #17573]  INFO -- : Finished applying migration version 5, direction: up, took 0.012304 seconds
I, [2012-04-26T16:37:38.259233 #17573]  INFO -- : Begin applying migration version 6, direction: up
I, [2012-04-26T16:37:38.259469 #17573]  INFO -- : (0.000174s) BEGIN
I, [2012-04-26T16:37:38.263862 #17573]  INFO -- : (0.004047s) CREATE TABLE "data_bags" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:37:38.265032 #17573]  INFO -- : (0.001003s) CREATE INDEX "data_bags_org_id_index" ON "data_bags" ("org_id")
I, [2012-04-26T16:37:38.265362 #17573]  INFO -- : (0.000186s) UPDATE "schema_info" SET "version" = 6
I, [2012-04-26T16:37:38.266003 #17573]  INFO -- : (0.000583s) COMMIT
I, [2012-04-26T16:37:38.266066 #17573]  INFO -- : Finished applying migration version 6, direction: up, took 0.006828 seconds
I, [2012-04-26T16:37:38.266101 #17573]  INFO -- : Begin applying migration version 7, direction: up
I, [2012-04-26T16:37:38.266276 #17573]  INFO -- : (0.000121s) BEGIN
I, [2012-04-26T16:37:38.269753 #17573]  INFO -- : (0.003092s) CREATE TABLE "data_bag_items" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "data_bag_name" text NOT NULL, "item_name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "data_bag_name", "item_name"))
I, [2012-04-26T16:37:38.270838 #17573]  INFO -- : (0.000873s) CREATE INDEX "data_bag_items_org_id_index" ON "data_bag_items" ("org_id")
I, [2012-04-26T16:37:38.271150 #17573]  INFO -- : (0.000216s) ALTER TABLE data_bag_items ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T16:37:38.271549 #17573]  INFO -- : (0.000206s) UPDATE "schema_info" SET "version" = 7
I, [2012-04-26T16:37:38.272199 #17573]  INFO -- : (0.000562s) COMMIT
I, [2012-04-26T16:37:38.272260 #17573]  INFO -- : Finished applying migration version 7, direction: up, took 0.006155 seconds
I, [2012-04-26T16:37:38.272296 #17573]  INFO -- : Begin applying migration version 8, direction: up
I, [2012-04-26T16:37:38.272520 #17573]  INFO -- : (0.000150s) BEGIN
I, [2012-04-26T16:37:38.277564 #17573]  INFO -- : (0.004468s) CREATE TABLE "environments" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:37:38.278663 #17573]  INFO -- : (0.000956s) CREATE INDEX "environments_org_id_index" ON "environments" ("org_id")
I, [2012-04-26T16:37:38.278900 #17573]  INFO -- : (0.000170s) ALTER TABLE environments ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T16:37:38.279195 #17573]  INFO -- : (0.000178s) UPDATE "schema_info" SET "version" = 8
I, [2012-04-26T16:37:38.280082 #17573]  INFO -- : (0.000833s) COMMIT
I, [2012-04-26T16:37:38.280146 #17573]  INFO -- : Finished applying migration version 8, direction: up, took 0.007846 seconds
I, [2012-04-26T16:37:38.280194 #17573]  INFO -- : Begin applying migration version 9, direction: up
I, [2012-04-26T16:37:38.280376 #17573]  INFO -- : (0.000123s) BEGIN
I, [2012-04-26T16:37:38.282044 #17573]  INFO -- : (0.001464s) ALTER TABLE "data_bag_items" ADD FOREIGN KEY ("org_id", "data_bag_name") REFERENCES "data_bags"("org_id", "name") ON DELETE CASCADE ON UPDATE CASCADE
I, [2012-04-26T16:37:38.282392 #17573]  INFO -- : (0.000238s) UPDATE "schema_info" SET "version" = 9
I, [2012-04-26T16:37:38.282977 #17573]  INFO -- : (0.000529s) COMMIT
I, [2012-04-26T16:37:38.283037 #17573]  INFO -- : Finished applying migration version 9, direction: up, took 0.002840 seconds
I, [2012-04-26T16:37:38.283071 #17573]  INFO -- : Begin applying migration version 10, direction: up
I, [2012-04-26T16:37:38.283211 #17573]  INFO -- : (0.000091s) BEGIN
I, [2012-04-26T16:37:38.283713 #17573]  INFO -- : (0.000384s) DROP INDEX "clients_org_id_index"
I, [2012-04-26T16:37:38.284168 #17573]  INFO -- : (0.000296s) DROP INDEX "environments_org_id_index"
I, [2012-04-26T16:37:38.284644 #17573]  INFO -- : (0.000298s) DROP INDEX "nodes_org_id_index"
I, [2012-04-26T16:37:38.285010 #17573]  INFO -- : (0.000202s) DROP INDEX "roles_org_id_index"
I, [2012-04-26T16:37:38.285360 #17573]  INFO -- : (0.000224s) DROP INDEX "data_bags_org_id_index"
I, [2012-04-26T16:37:38.285754 #17573]  INFO -- : (0.000271s) DROP INDEX "data_bag_items_org_id_index"
I, [2012-04-26T16:37:38.286152 #17573]  INFO -- : (0.000208s) UPDATE "schema_info" SET "version" = 10
I, [2012-04-26T16:37:38.287103 #17573]  INFO -- : (0.000892s) COMMIT
I, [2012-04-26T16:37:38.287165 #17573]  INFO -- : Finished applying migration version 10, direction: up, took 0.004089 seconds
I, [2012-04-26T16:37:38.287201 #17573]  INFO -- : Begin applying migration version 11, direction: up
I, [2012-04-26T16:37:38.287347 #17573]  INFO -- : (0.000092s) BEGIN
I, [2012-04-26T16:37:38.287791 #17573]  INFO -- : (0.000240s) ALTER TABLE "users" ADD COLUMN "external_authentication_uid" text NULL
I, [2012-04-26T16:37:38.288021 #17573]  INFO -- : (0.000174s) ALTER TABLE "users" ADD COLUMN "recovery_authentication_enabled" boolean NULL
I, [2012-04-26T16:37:38.288266 #17573]  INFO -- : (0.000186s) ALTER TABLE "users" ALTER COLUMN "email" DROP NOT NULL
I, [2012-04-26T16:37:38.288527 #17573]  INFO -- : (0.000144s) UPDATE "schema_info" SET "version" = 11
I, [2012-04-26T16:37:38.289072 #17573]  INFO -- : (0.000488s) COMMIT
I, [2012-04-26T16:37:38.289123 #17573]  INFO -- : Finished applying migration version 11, direction: up, took 0.001919 seconds
I, [2012-04-26T16:38:40.942922 #17764]  INFO -- : (0.000335s) SET standard_conforming_strings = ON
I, [2012-04-26T16:38:40.943222 #17764]  INFO -- : (0.000160s) SET client_min_messages = 'WARNING'
I, [2012-04-26T16:38:40.943401 #17764]  INFO -- : (0.000103s) SET DateStyle = 'ISO'
E, [2012-04-26T16:38:40.951009 #17764] ERROR -- : PG::Error: ERROR:  relation "schema_info" does not exist
LINE 1: SELECT NULL FROM "schema_info" LIMIT 1
                         ^: SELECT NULL FROM "schema_info" LIMIT 1
I, [2012-04-26T16:38:40.955413 #17764]  INFO -- : (0.004112s) CREATE TABLE "schema_info" ("version" integer DEFAULT 0 NOT NULL)
I, [2012-04-26T16:38:40.956157 #17764]  INFO -- : (0.000533s) SELECT 1 AS "one" FROM "schema_info" LIMIT 1
I, [2012-04-26T16:38:40.958218 #17764]  INFO -- : (0.001856s) SELECT pg_attribute.attname FROM pg_class, pg_attribute, pg_index, pg_namespace WHERE pg_class.oid = pg_attribute.attrelid AND pg_class.relnamespace = pg_namespace.oid AND pg_class.oid = pg_index.indrelid AND pg_index.indkey[0] = pg_attribute.attnum AND pg_index.indisprimary = 't' AND pg_class.relname = 'schema_info'
I, [2012-04-26T16:38:40.959072 #17764]  INFO -- : (0.000658s) INSERT INTO "schema_info" ("version") VALUES (0) RETURNING NULL
I, [2012-04-26T16:38:40.959674 #17764]  INFO -- : (0.000360s) SELECT COUNT(*) AS "count" FROM "schema_info" LIMIT 1
I, [2012-04-26T16:38:40.960025 #17764]  INFO -- : (0.000161s) SELECT "version" FROM "schema_info" LIMIT 1
I, [2012-04-26T16:38:40.976426 #17764]  INFO -- : Begin applying migration version 1, direction: up
I, [2012-04-26T16:38:40.976703 #17764]  INFO -- : (0.000143s) BEGIN
I, [2012-04-26T16:38:40.981832 #17764]  INFO -- : (0.004716s) CREATE TABLE "users" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "username" text NOT NULL UNIQUE, "email" text NOT NULL UNIQUE, "pubkey_version" integer NOT NULL, "public_key" text, "serialized_object" text, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-04-26T16:38:40.982280 #17764]  INFO -- : (0.000232s) UPDATE "schema_info" SET "version" = 1
I, [2012-04-26T16:38:40.982904 #17764]  INFO -- : (0.000557s) COMMIT
I, [2012-04-26T16:38:40.982969 #17764]  INFO -- : Finished applying migration version 1, direction: up, took 0.006548 seconds
I, [2012-04-26T16:38:40.983005 #17764]  INFO -- : Begin applying migration version 2, direction: up
I, [2012-04-26T16:38:40.983164 #17764]  INFO -- : (0.000102s) BEGIN
I, [2012-04-26T16:38:40.987630 #17764]  INFO -- : (0.004043s) CREATE TABLE "nodes" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "environment" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" text, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:38:40.988863 #17764]  INFO -- : (0.000983s) CREATE INDEX "nodes_org_id_index" ON "nodes" ("org_id")
I, [2012-04-26T16:38:40.989851 #17764]  INFO -- : (0.000830s) CREATE INDEX "nodes_org_id_environment_index" ON "nodes" ("org_id", "environment")
I, [2012-04-26T16:38:40.990193 #17764]  INFO -- : (0.000177s) UPDATE "schema_info" SET "version" = 2
I, [2012-04-26T16:38:40.990982 #17764]  INFO -- : (0.000711s) COMMIT
I, [2012-04-26T16:38:40.991060 #17764]  INFO -- : Finished applying migration version 2, direction: up, took 0.008051 seconds
I, [2012-04-26T16:38:40.991098 #17764]  INFO -- : Begin applying migration version 3, direction: up
I, [2012-04-26T16:38:40.991648 #17764]  INFO -- : (0.000489s) BEGIN
I, [2012-04-26T16:38:40.995881 #17764]  INFO -- : (0.003797s) CREATE TABLE "clients" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, "name" text NOT NULL, "public_key" text, "validator" boolean NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "pubkey_version" smallint NOT NULL, CONSTRAINT "org_id_name_unique" UNIQUE ("org_id", "name"))
I, [2012-04-26T16:38:40.996700 #17764]  INFO -- : (0.000640s) CREATE INDEX "clients_org_id_index" ON "clients" ("org_id")
I, [2012-04-26T16:38:40.997036 #17764]  INFO -- : (0.000201s) UPDATE "schema_info" SET "version" = 3
I, [2012-04-26T16:38:40.997627 #17764]  INFO -- : (0.000530s) COMMIT
I, [2012-04-26T16:38:40.997695 #17764]  INFO -- : Finished applying migration version 3, direction: up, took 0.006593 seconds
I, [2012-04-26T16:38:40.997730 #17764]  INFO -- : Begin applying migration version 4, direction: up
I, [2012-04-26T16:38:40.997932 #17764]  INFO -- : (0.000142s) BEGIN
I, [2012-04-26T16:38:41.002892 #17764]  INFO -- : (0.004566s) CREATE TABLE "roles" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:38:41.004028 #17764]  INFO -- : (0.000920s) CREATE INDEX "roles_org_id_index" ON "roles" ("org_id")
I, [2012-04-26T16:38:41.004529 #17764]  INFO -- : (0.000363s) ALTER TABLE roles ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T16:38:41.004961 #17764]  INFO -- : (0.000216s) UPDATE "schema_info" SET "version" = 4
I, [2012-04-26T16:38:41.005647 #17764]  INFO -- : (0.000585s) COMMIT
I, [2012-04-26T16:38:41.005740 #17764]  INFO -- : Finished applying migration version 4, direction: up, took 0.008001 seconds
I, [2012-04-26T16:38:41.005791 #17764]  INFO -- : Begin applying migration version 5, direction: up
I, [2012-04-26T16:38:41.006032 #17764]  INFO -- : (0.000142s) BEGIN
I, [2012-04-26T16:38:41.006504 #17764]  INFO -- : (0.000237s) ALTER TABLE "nodes" ADD COLUMN "last_audit_id" bytea
I, [2012-04-26T16:38:41.010890 #17764]  INFO -- : (0.004014s) CREATE TABLE "node_audit" ("audit_id" bytea NOT NULL, "node_id" char(32), "status" varchar(16), "start_time" timestamp NOT NULL, "end_time" timestamp NULL, "event_data" text NULL, PRIMARY KEY ("audit_id"), CONSTRAINT "node_id_fk" FOREIGN KEY ("node_id") REFERENCES "nodes")
I, [2012-04-26T16:38:41.011971 #17764]  INFO -- : (0.000853s) CREATE INDEX "node_audit_node_id_index" ON "node_audit" ("node_id")
I, [2012-04-26T16:38:41.016323 #17764]  INFO -- : (0.003558s) CREATE TABLE "node_audit_detail" ("audit_id" bytea NOT NULL, "seq" int NOT NULL, "duration" int NOT NULL, "res_id" varchar(255) NOT NULL, "res_type" varchar(16) NOT NULL, "res_name" varchar(255) NOT NULL, "res_result" varchar(16) NULL, "res_initial_state" text NULL, "res_final_state" text NULL, "delta" text NULL, PRIMARY KEY ("audit_id", "seq"), CONSTRAINT "audit_id_fk" FOREIGN KEY ("audit_id") REFERENCES "node_audit")
I, [2012-04-26T16:38:41.016765 #17764]  INFO -- : (0.000194s) UPDATE "schema_info" SET "version" = 5
I, [2012-04-26T16:38:41.017833 #17764]  INFO -- : (0.000977s) COMMIT
I, [2012-04-26T16:38:41.017903 #17764]  INFO -- : Finished applying migration version 5, direction: up, took 0.012110 seconds
I, [2012-04-26T16:38:41.017939 #17764]  INFO -- : Begin applying migration version 6, direction: up
I, [2012-04-26T16:38:41.018206 #17764]  INFO -- : (0.000208s) BEGIN
I, [2012-04-26T16:38:41.022846 #17764]  INFO -- : (0.004267s) CREATE TABLE "data_bags" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:38:41.024202 #17764]  INFO -- : (0.001128s) CREATE INDEX "data_bags_org_id_index" ON "data_bags" ("org_id")
I, [2012-04-26T16:38:41.024657 #17764]  INFO -- : (0.000229s) UPDATE "schema_info" SET "version" = 6
I, [2012-04-26T16:38:41.025460 #17764]  INFO -- : (0.000709s) COMMIT
I, [2012-04-26T16:38:41.025555 #17764]  INFO -- : Finished applying migration version 6, direction: up, took 0.007607 seconds
I, [2012-04-26T16:38:41.025606 #17764]  INFO -- : Begin applying migration version 7, direction: up
I, [2012-04-26T16:38:41.025835 #17764]  INFO -- : (0.000153s) BEGIN
I, [2012-04-26T16:38:41.029351 #17764]  INFO -- : (0.002947s) CREATE TABLE "data_bag_items" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "data_bag_name" text NOT NULL, "item_name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "data_bag_name", "item_name"))
I, [2012-04-26T16:38:41.030536 #17764]  INFO -- : (0.000964s) CREATE INDEX "data_bag_items_org_id_index" ON "data_bag_items" ("org_id")
I, [2012-04-26T16:38:41.030852 #17764]  INFO -- : (0.000202s) ALTER TABLE data_bag_items ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T16:38:41.031236 #17764]  INFO -- : (0.000185s) UPDATE "schema_info" SET "version" = 7
I, [2012-04-26T16:38:41.032106 #17764]  INFO -- : (0.000787s) COMMIT
I, [2012-04-26T16:38:41.032199 #17764]  INFO -- : Finished applying migration version 7, direction: up, took 0.006591 seconds
I, [2012-04-26T16:38:41.032251 #17764]  INFO -- : Begin applying migration version 8, direction: up
I, [2012-04-26T16:38:41.032478 #17764]  INFO -- : (0.000159s) BEGIN
I, [2012-04-26T16:38:41.037516 #17764]  INFO -- : (0.004354s) CREATE TABLE "environments" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:38:41.038422 #17764]  INFO -- : (0.000728s) CREATE INDEX "environments_org_id_index" ON "environments" ("org_id")
I, [2012-04-26T16:38:41.038728 #17764]  INFO -- : (0.000218s) ALTER TABLE environments ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T16:38:41.039006 #17764]  INFO -- : (0.000139s) UPDATE "schema_info" SET "version" = 8
I, [2012-04-26T16:38:41.040122 #17764]  INFO -- : (0.001055s) COMMIT
I, [2012-04-26T16:38:41.040192 #17764]  INFO -- : Finished applying migration version 8, direction: up, took 0.007937 seconds
I, [2012-04-26T16:38:41.040227 #17764]  INFO -- : Begin applying migration version 9, direction: up
I, [2012-04-26T16:38:41.040483 #17764]  INFO -- : (0.000172s) BEGIN
I, [2012-04-26T16:38:41.043123 #17764]  INFO -- : (0.002351s) ALTER TABLE "data_bag_items" ADD FOREIGN KEY ("org_id", "data_bag_name") REFERENCES "data_bags"("org_id", "name") ON DELETE CASCADE ON UPDATE CASCADE
I, [2012-04-26T16:38:41.043609 #17764]  INFO -- : (0.000240s) UPDATE "schema_info" SET "version" = 9
I, [2012-04-26T16:38:41.044424 #17764]  INFO -- : (0.000720s) COMMIT
I, [2012-04-26T16:38:41.044535 #17764]  INFO -- : Finished applying migration version 9, direction: up, took 0.004298 seconds
I, [2012-04-26T16:38:41.044596 #17764]  INFO -- : Begin applying migration version 10, direction: up
I, [2012-04-26T16:38:41.044824 #17764]  INFO -- : (0.000144s) BEGIN
I, [2012-04-26T16:38:41.045589 #17764]  INFO -- : (0.000549s) DROP INDEX "clients_org_id_index"
I, [2012-04-26T16:38:41.046028 #17764]  INFO -- : (0.000264s) DROP INDEX "environments_org_id_index"
I, [2012-04-26T16:38:41.046403 #17764]  INFO -- : (0.000240s) DROP INDEX "nodes_org_id_index"
I, [2012-04-26T16:38:41.046719 #17764]  INFO -- : (0.000188s) DROP INDEX "roles_org_id_index"
I, [2012-04-26T16:38:41.047011 #17764]  INFO -- : (0.000166s) DROP INDEX "data_bags_org_id_index"
I, [2012-04-26T16:38:41.047329 #17764]  INFO -- : (0.000178s) DROP INDEX "data_bag_items_org_id_index"
I, [2012-04-26T16:38:41.047722 #17764]  INFO -- : (0.000215s) UPDATE "schema_info" SET "version" = 10
I, [2012-04-26T16:38:41.048575 #17764]  INFO -- : (0.000796s) COMMIT
I, [2012-04-26T16:38:41.048631 #17764]  INFO -- : Finished applying migration version 10, direction: up, took 0.004035 seconds
I, [2012-04-26T16:38:41.048671 #17764]  INFO -- : Begin applying migration version 11, direction: up
I, [2012-04-26T16:38:41.048806 #17764]  INFO -- : (0.000079s) BEGIN
I, [2012-04-26T16:38:41.049234 #17764]  INFO -- : (0.000215s) ALTER TABLE "users" ADD COLUMN "external_authentication_uid" text NULL
I, [2012-04-26T16:38:41.049452 #17764]  INFO -- : (0.000164s) ALTER TABLE "users" ADD COLUMN "recovery_authentication_enabled" boolean NULL
I, [2012-04-26T16:38:41.049657 #17764]  INFO -- : (0.000149s) ALTER TABLE "users" ALTER COLUMN "email" DROP NOT NULL
I, [2012-04-26T16:38:41.049895 #17764]  INFO -- : (0.000130s) UPDATE "schema_info" SET "version" = 11
I, [2012-04-26T16:38:41.050338 #17764]  INFO -- : (0.000393s) COMMIT
I, [2012-04-26T16:38:41.050387 #17764]  INFO -- : Finished applying migration version 11, direction: up, took 0.001718 seconds
I, [2012-04-26T16:39:01.299101 #17932]  INFO -- : (0.000391s) SET standard_conforming_strings = ON
I, [2012-04-26T16:39:01.299357 #17932]  INFO -- : (0.000123s) SET client_min_messages = 'WARNING'
I, [2012-04-26T16:39:01.299496 #17932]  INFO -- : (0.000080s) SET DateStyle = 'ISO'
E, [2012-04-26T16:39:01.306907 #17932] ERROR -- : PG::Error: ERROR:  relation "schema_info" does not exist
LINE 1: SELECT NULL FROM "schema_info" LIMIT 1
                         ^: SELECT NULL FROM "schema_info" LIMIT 1
I, [2012-04-26T16:39:01.311898 #17932]  INFO -- : (0.004728s) CREATE TABLE "schema_info" ("version" integer DEFAULT 0 NOT NULL)
I, [2012-04-26T16:39:01.312778 #17932]  INFO -- : (0.000693s) SELECT 1 AS "one" FROM "schema_info" LIMIT 1
I, [2012-04-26T16:39:01.314751 #17932]  INFO -- : (0.001786s) SELECT pg_attribute.attname FROM pg_class, pg_attribute, pg_index, pg_namespace WHERE pg_class.oid = pg_attribute.attrelid AND pg_class.relnamespace = pg_namespace.oid AND pg_class.oid = pg_index.indrelid AND pg_index.indkey[0] = pg_attribute.attnum AND pg_index.indisprimary = 't' AND pg_class.relname = 'schema_info'
I, [2012-04-26T16:39:01.315660 #17932]  INFO -- : (0.000712s) INSERT INTO "schema_info" ("version") VALUES (0) RETURNING NULL
I, [2012-04-26T16:39:01.316342 #17932]  INFO -- : (0.000425s) SELECT COUNT(*) AS "count" FROM "schema_info" LIMIT 1
I, [2012-04-26T16:39:01.316718 #17932]  INFO -- : (0.000210s) SELECT "version" FROM "schema_info" LIMIT 1
I, [2012-04-26T16:39:01.332584 #17932]  INFO -- : Begin applying migration version 1, direction: up
I, [2012-04-26T16:39:01.332825 #17932]  INFO -- : (0.000134s) BEGIN
I, [2012-04-26T16:39:01.338174 #17932]  INFO -- : (0.004985s) CREATE TABLE "users" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "username" text NOT NULL UNIQUE, "email" text NOT NULL UNIQUE, "pubkey_version" integer NOT NULL, "public_key" text, "serialized_object" text, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-04-26T16:39:01.338553 #17932]  INFO -- : (0.000198s) UPDATE "schema_info" SET "version" = 1
I, [2012-04-26T16:39:01.339574 #17932]  INFO -- : (0.000964s) COMMIT
I, [2012-04-26T16:39:01.339632 #17932]  INFO -- : Finished applying migration version 1, direction: up, took 0.007052 seconds
I, [2012-04-26T16:39:01.339666 #17932]  INFO -- : Begin applying migration version 2, direction: up
I, [2012-04-26T16:39:01.339883 #17932]  INFO -- : (0.000165s) BEGIN
I, [2012-04-26T16:39:01.343921 #17932]  INFO -- : (0.003658s) CREATE TABLE "nodes" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "environment" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" text, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:39:01.345208 #17932]  INFO -- : (0.001078s) CREATE INDEX "nodes_org_id_index" ON "nodes" ("org_id")
I, [2012-04-26T16:39:01.346137 #17932]  INFO -- : (0.000720s) CREATE INDEX "nodes_org_id_environment_index" ON "nodes" ("org_id", "environment")
I, [2012-04-26T16:39:01.346486 #17932]  INFO -- : (0.000187s) UPDATE "schema_info" SET "version" = 2
I, [2012-04-26T16:39:01.347115 #17932]  INFO -- : (0.000571s) COMMIT
I, [2012-04-26T16:39:01.347182 #17932]  INFO -- : Finished applying migration version 2, direction: up, took 0.007512 seconds
I, [2012-04-26T16:39:01.347219 #17932]  INFO -- : Begin applying migration version 3, direction: up
I, [2012-04-26T16:39:01.347395 #17932]  INFO -- : (0.000118s) BEGIN
I, [2012-04-26T16:39:01.351658 #17932]  INFO -- : (0.003832s) CREATE TABLE "clients" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, "name" text NOT NULL, "public_key" text, "validator" boolean NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "pubkey_version" smallint NOT NULL, CONSTRAINT "org_id_name_unique" UNIQUE ("org_id", "name"))
I, [2012-04-26T16:39:01.352536 #17932]  INFO -- : (0.000744s) CREATE INDEX "clients_org_id_index" ON "clients" ("org_id")
I, [2012-04-26T16:39:01.352856 #17932]  INFO -- : (0.000184s) UPDATE "schema_info" SET "version" = 3
I, [2012-04-26T16:39:01.353605 #17932]  INFO -- : (0.000671s) COMMIT
I, [2012-04-26T16:39:01.353666 #17932]  INFO -- : Finished applying migration version 3, direction: up, took 0.006444 seconds
I, [2012-04-26T16:39:01.353700 #17932]  INFO -- : Begin applying migration version 4, direction: up
I, [2012-04-26T16:39:01.354135 #17932]  INFO -- : (0.000375s) BEGIN
I, [2012-04-26T16:39:01.358882 #17932]  INFO -- : (0.004279s) CREATE TABLE "roles" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:39:01.359937 #17932]  INFO -- : (0.000917s) CREATE INDEX "roles_org_id_index" ON "roles" ("org_id")
I, [2012-04-26T16:39:01.360260 #17932]  INFO -- : (0.000236s) ALTER TABLE roles ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T16:39:01.360551 #17932]  INFO -- : (0.000155s) UPDATE "schema_info" SET "version" = 4
I, [2012-04-26T16:39:01.361139 #17932]  INFO -- : (0.000539s) COMMIT
I, [2012-04-26T16:39:01.361189 #17932]  INFO -- : Finished applying migration version 4, direction: up, took 0.007486 seconds
I, [2012-04-26T16:39:01.361222 #17932]  INFO -- : Begin applying migration version 5, direction: up
I, [2012-04-26T16:39:01.361401 #17932]  INFO -- : (0.000121s) BEGIN
I, [2012-04-26T16:39:01.361797 #17932]  INFO -- : (0.000225s) ALTER TABLE "nodes" ADD COLUMN "last_audit_id" bytea
I, [2012-04-26T16:39:01.365800 #17932]  INFO -- : (0.003672s) CREATE TABLE "node_audit" ("audit_id" bytea NOT NULL, "node_id" char(32), "status" varchar(16), "start_time" timestamp NOT NULL, "end_time" timestamp NULL, "event_data" text NULL, PRIMARY KEY ("audit_id"), CONSTRAINT "node_id_fk" FOREIGN KEY ("node_id") REFERENCES "nodes")
I, [2012-04-26T16:39:01.366861 #17932]  INFO -- : (0.000900s) CREATE INDEX "node_audit_node_id_index" ON "node_audit" ("node_id")
I, [2012-04-26T16:39:01.370646 #17932]  INFO -- : (0.003345s) CREATE TABLE "node_audit_detail" ("audit_id" bytea NOT NULL, "seq" int NOT NULL, "duration" int NOT NULL, "res_id" varchar(255) NOT NULL, "res_type" varchar(16) NOT NULL, "res_name" varchar(255) NOT NULL, "res_result" varchar(16) NULL, "res_initial_state" text NULL, "res_final_state" text NULL, "delta" text NULL, PRIMARY KEY ("audit_id", "seq"), CONSTRAINT "audit_id_fk" FOREIGN KEY ("audit_id") REFERENCES "node_audit")
I, [2012-04-26T16:39:01.370987 #17932]  INFO -- : (0.000167s) UPDATE "schema_info" SET "version" = 5
I, [2012-04-26T16:39:01.372126 #17932]  INFO -- : (0.001075s) COMMIT
I, [2012-04-26T16:39:01.372213 #17932]  INFO -- : Finished applying migration version 5, direction: up, took 0.010981 seconds
I, [2012-04-26T16:39:01.372287 #17932]  INFO -- : Begin applying migration version 6, direction: up
I, [2012-04-26T16:39:01.372475 #17932]  INFO -- : (0.000122s) BEGIN
I, [2012-04-26T16:39:01.376727 #17932]  INFO -- : (0.003896s) CREATE TABLE "data_bags" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:39:01.377644 #17932]  INFO -- : (0.000729s) CREATE INDEX "data_bags_org_id_index" ON "data_bags" ("org_id")
I, [2012-04-26T16:39:01.378072 #17932]  INFO -- : (0.000219s) UPDATE "schema_info" SET "version" = 6
I, [2012-04-26T16:39:01.378672 #17932]  INFO -- : (0.000525s) COMMIT
I, [2012-04-26T16:39:01.378737 #17932]  INFO -- : Finished applying migration version 6, direction: up, took 0.006449 seconds
I, [2012-04-26T16:39:01.378773 #17932]  INFO -- : Begin applying migration version 7, direction: up
I, [2012-04-26T16:39:01.378953 #17932]  INFO -- : (0.000123s) BEGIN
I, [2012-04-26T16:39:01.382807 #17932]  INFO -- : (0.003421s) CREATE TABLE "data_bag_items" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "data_bag_name" text NOT NULL, "item_name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "data_bag_name", "item_name"))
I, [2012-04-26T16:39:01.383844 #17932]  INFO -- : (0.000856s) CREATE INDEX "data_bag_items_org_id_index" ON "data_bag_items" ("org_id")
I, [2012-04-26T16:39:01.384083 #17932]  INFO -- : (0.000162s) ALTER TABLE data_bag_items ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T16:39:01.384360 #17932]  INFO -- : (0.000144s) UPDATE "schema_info" SET "version" = 7
I, [2012-04-26T16:39:01.385291 #17932]  INFO -- : (0.000871s) COMMIT
I, [2012-04-26T16:39:01.385348 #17932]  INFO -- : Finished applying migration version 7, direction: up, took 0.006571 seconds
I, [2012-04-26T16:39:01.385383 #17932]  INFO -- : Begin applying migration version 8, direction: up
I, [2012-04-26T16:39:01.385541 #17932]  INFO -- : (0.000093s) BEGIN
I, [2012-04-26T16:39:01.390155 #17932]  INFO -- : (0.004243s) CREATE TABLE "environments" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:39:01.391112 #17932]  INFO -- : (0.000730s) CREATE INDEX "environments_org_id_index" ON "environments" ("org_id")
I, [2012-04-26T16:39:01.391409 #17932]  INFO -- : (0.000194s) ALTER TABLE environments ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T16:39:01.391752 #17932]  INFO -- : (0.000181s) UPDATE "schema_info" SET "version" = 8
I, [2012-04-26T16:39:01.392692 #17932]  INFO -- : (0.000863s) COMMIT
I, [2012-04-26T16:39:01.392754 #17932]  INFO -- : Finished applying migration version 8, direction: up, took 0.007366 seconds
I, [2012-04-26T16:39:01.392788 #17932]  INFO -- : Begin applying migration version 9, direction: up
I, [2012-04-26T16:39:01.392953 #17932]  INFO -- : (0.000110s) BEGIN
I, [2012-04-26T16:39:01.394603 #17932]  INFO -- : (0.001444s) ALTER TABLE "data_bag_items" ADD FOREIGN KEY ("org_id", "data_bag_name") REFERENCES "data_bags"("org_id", "name") ON DELETE CASCADE ON UPDATE CASCADE
I, [2012-04-26T16:39:01.394935 #17932]  INFO -- : (0.000209s) UPDATE "schema_info" SET "version" = 9
I, [2012-04-26T16:39:01.395459 #17932]  INFO -- : (0.000471s) COMMIT
I, [2012-04-26T16:39:01.395516 #17932]  INFO -- : Finished applying migration version 9, direction: up, took 0.002725 seconds
I, [2012-04-26T16:39:01.395548 #17932]  INFO -- : Begin applying migration version 10, direction: up
I, [2012-04-26T16:39:01.395797 #17932]  INFO -- : (0.000203s) BEGIN
I, [2012-04-26T16:39:01.396362 #17932]  INFO -- : (0.000445s) DROP INDEX "clients_org_id_index"
I, [2012-04-26T16:39:01.396764 #17932]  INFO -- : (0.000274s) DROP INDEX "environments_org_id_index"
I, [2012-04-26T16:39:01.397091 #17932]  INFO -- : (0.000198s) DROP INDEX "nodes_org_id_index"
I, [2012-04-26T16:39:01.397506 #17932]  INFO -- : (0.000258s) DROP INDEX "roles_org_id_index"
I, [2012-04-26T16:39:01.397839 #17932]  INFO -- : (0.000218s) DROP INDEX "data_bags_org_id_index"
I, [2012-04-26T16:39:01.398180 #17932]  INFO -- : (0.000195s) DROP INDEX "data_bag_items_org_id_index"
I, [2012-04-26T16:39:01.398554 #17932]  INFO -- : (0.000203s) UPDATE "schema_info" SET "version" = 10
I, [2012-04-26T16:39:01.399408 #17932]  INFO -- : (0.000792s) COMMIT
I, [2012-04-26T16:39:01.399468 #17932]  INFO -- : Finished applying migration version 10, direction: up, took 0.003915 seconds
I, [2012-04-26T16:39:01.399502 #17932]  INFO -- : Begin applying migration version 11, direction: up
I, [2012-04-26T16:39:01.399666 #17932]  INFO -- : (0.000111s) BEGIN
I, [2012-04-26T16:39:01.400105 #17932]  INFO -- : (0.000234s) ALTER TABLE "users" ADD COLUMN "external_authentication_uid" text NULL
I, [2012-04-26T16:39:01.400328 #17932]  INFO -- : (0.000173s) ALTER TABLE "users" ADD COLUMN "recovery_authentication_enabled" boolean NULL
I, [2012-04-26T16:39:01.400509 #17932]  INFO -- : (0.000135s) ALTER TABLE "users" ALTER COLUMN "email" DROP NOT NULL
I, [2012-04-26T16:39:01.400736 #17932]  INFO -- : (0.000124s) UPDATE "schema_info" SET "version" = 11
I, [2012-04-26T16:39:01.401339 #17932]  INFO -- : (0.000552s) COMMIT
I, [2012-04-26T16:39:01.401394 #17932]  INFO -- : Finished applying migration version 11, direction: up, took 0.001889 seconds
I, [2012-04-26T16:46:38.379809 #18449]  INFO -- : (0.000369s) SET standard_conforming_strings = ON
I, [2012-04-26T16:46:38.380078 #18449]  INFO -- : (0.000131s) SET client_min_messages = 'WARNING'
I, [2012-04-26T16:46:38.380217 #18449]  INFO -- : (0.000079s) SET DateStyle = 'ISO'
E, [2012-04-26T16:46:38.388236 #18449] ERROR -- : PG::Error: ERROR:  relation "schema_info" does not exist
LINE 1: SELECT NULL FROM "schema_info" LIMIT 1
                         ^: SELECT NULL FROM "schema_info" LIMIT 1
I, [2012-04-26T16:46:38.393304 #18449]  INFO -- : (0.004782s) CREATE TABLE "schema_info" ("version" integer DEFAULT 0 NOT NULL)
I, [2012-04-26T16:46:38.394133 #18449]  INFO -- : (0.000593s) SELECT 1 AS "one" FROM "schema_info" LIMIT 1
I, [2012-04-26T16:46:38.396087 #18449]  INFO -- : (0.001741s) SELECT pg_attribute.attname FROM pg_class, pg_attribute, pg_index, pg_namespace WHERE pg_class.oid = pg_attribute.attrelid AND pg_class.relnamespace = pg_namespace.oid AND pg_class.oid = pg_index.indrelid AND pg_index.indkey[0] = pg_attribute.attnum AND pg_index.indisprimary = 't' AND pg_class.relname = 'schema_info'
I, [2012-04-26T16:46:38.397076 #18449]  INFO -- : (0.000775s) INSERT INTO "schema_info" ("version") VALUES (0) RETURNING NULL
I, [2012-04-26T16:46:38.397722 #18449]  INFO -- : (0.000392s) SELECT COUNT(*) AS "count" FROM "schema_info" LIMIT 1
I, [2012-04-26T16:46:38.398120 #18449]  INFO -- : (0.000197s) SELECT "version" FROM "schema_info" LIMIT 1
I, [2012-04-26T16:46:38.413583 #18449]  INFO -- : Begin applying migration version 1, direction: up
I, [2012-04-26T16:46:38.413977 #18449]  INFO -- : (0.000276s) BEGIN
I, [2012-04-26T16:46:38.418859 #18449]  INFO -- : (0.004484s) CREATE TABLE "users" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "username" text NOT NULL UNIQUE, "email" text NOT NULL UNIQUE, "pubkey_version" integer NOT NULL, "public_key" text, "serialized_object" text, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-04-26T16:46:38.419262 #18449]  INFO -- : (0.000217s) UPDATE "schema_info" SET "version" = 1
I, [2012-04-26T16:46:38.420012 #18449]  INFO -- : (0.000683s) COMMIT
I, [2012-04-26T16:46:38.420071 #18449]  INFO -- : Finished applying migration version 1, direction: up, took 0.006490 seconds
I, [2012-04-26T16:46:38.420103 #18449]  INFO -- : Begin applying migration version 2, direction: up
I, [2012-04-26T16:46:38.420266 #18449]  INFO -- : (0.000104s) BEGIN
I, [2012-04-26T16:46:38.424384 #18449]  INFO -- : (0.003707s) CREATE TABLE "nodes" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "environment" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" text, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:46:38.425232 #18449]  INFO -- : (0.000663s) CREATE INDEX "nodes_org_id_index" ON "nodes" ("org_id")
I, [2012-04-26T16:46:38.426114 #18449]  INFO -- : (0.000706s) CREATE INDEX "nodes_org_id_environment_index" ON "nodes" ("org_id", "environment")
I, [2012-04-26T16:46:38.426519 #18449]  INFO -- : (0.000218s) UPDATE "schema_info" SET "version" = 2
I, [2012-04-26T16:46:38.427227 #18449]  INFO -- : (0.000626s) COMMIT
I, [2012-04-26T16:46:38.427292 #18449]  INFO -- : Finished applying migration version 2, direction: up, took 0.007185 seconds
I, [2012-04-26T16:46:38.427328 #18449]  INFO -- : Begin applying migration version 3, direction: up
I, [2012-04-26T16:46:38.427545 #18449]  INFO -- : (0.000156s) BEGIN
I, [2012-04-26T16:46:38.431479 #18449]  INFO -- : (0.003239s) CREATE TABLE "clients" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, "name" text NOT NULL, "public_key" text, "validator" boolean NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "pubkey_version" smallint NOT NULL, CONSTRAINT "org_id_name_unique" UNIQUE ("org_id", "name"))
I, [2012-04-26T16:46:38.432311 #18449]  INFO -- : (0.000675s) CREATE INDEX "clients_org_id_index" ON "clients" ("org_id")
I, [2012-04-26T16:46:38.432681 #18449]  INFO -- : (0.000229s) UPDATE "schema_info" SET "version" = 3
I, [2012-04-26T16:46:38.433686 #18449]  INFO -- : (0.000937s) COMMIT
I, [2012-04-26T16:46:38.433748 #18449]  INFO -- : Finished applying migration version 3, direction: up, took 0.006417 seconds
I, [2012-04-26T16:46:38.433783 #18449]  INFO -- : Begin applying migration version 4, direction: up
I, [2012-04-26T16:46:38.433987 #18449]  INFO -- : (0.000147s) BEGIN
I, [2012-04-26T16:46:38.438183 #18449]  INFO -- : (0.003805s) CREATE TABLE "roles" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:46:38.439238 #18449]  INFO -- : (0.000843s) CREATE INDEX "roles_org_id_index" ON "roles" ("org_id")
I, [2012-04-26T16:46:38.439532 #18449]  INFO -- : (0.000188s) ALTER TABLE roles ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T16:46:38.439854 #18449]  INFO -- : (0.000169s) UPDATE "schema_info" SET "version" = 4
I, [2012-04-26T16:46:38.440642 #18449]  INFO -- : (0.000719s) COMMIT
I, [2012-04-26T16:46:38.440736 #18449]  INFO -- : Finished applying migration version 4, direction: up, took 0.006942 seconds
I, [2012-04-26T16:46:38.440796 #18449]  INFO -- : Begin applying migration version 5, direction: up
I, [2012-04-26T16:46:38.441030 #18449]  INFO -- : (0.000146s) BEGIN
I, [2012-04-26T16:46:38.441577 #18449]  INFO -- : (0.000290s) ALTER TABLE "nodes" ADD COLUMN "last_audit_id" bytea
I, [2012-04-26T16:46:38.445566 #18449]  INFO -- : (0.003412s) CREATE TABLE "node_audit" ("audit_id" bytea NOT NULL, "node_id" char(32), "status" varchar(16), "start_time" timestamp NOT NULL, "end_time" timestamp NULL, "event_data" text NULL, PRIMARY KEY ("audit_id"), CONSTRAINT "node_id_fk" FOREIGN KEY ("node_id") REFERENCES "nodes")
I, [2012-04-26T16:46:38.446562 #18449]  INFO -- : (0.000779s) CREATE INDEX "node_audit_node_id_index" ON "node_audit" ("node_id")
I, [2012-04-26T16:46:38.451725 #18449]  INFO -- : (0.004359s) CREATE TABLE "node_audit_detail" ("audit_id" bytea NOT NULL, "seq" int NOT NULL, "duration" int NOT NULL, "res_id" varchar(255) NOT NULL, "res_type" varchar(16) NOT NULL, "res_name" varchar(255) NOT NULL, "res_result" varchar(16) NULL, "res_initial_state" text NULL, "res_final_state" text NULL, "delta" text NULL, PRIMARY KEY ("audit_id", "seq"), CONSTRAINT "audit_id_fk" FOREIGN KEY ("audit_id") REFERENCES "node_audit")
I, [2012-04-26T16:46:38.452166 #18449]  INFO -- : (0.000183s) UPDATE "schema_info" SET "version" = 5
I, [2012-04-26T16:46:38.452968 #18449]  INFO -- : (0.000738s) COMMIT
I, [2012-04-26T16:46:38.453028 #18449]  INFO -- : Finished applying migration version 5, direction: up, took 0.012232 seconds
I, [2012-04-26T16:46:38.453063 #18449]  INFO -- : Begin applying migration version 6, direction: up
I, [2012-04-26T16:46:38.453263 #18449]  INFO -- : (0.000146s) BEGIN
I, [2012-04-26T16:46:38.457608 #18449]  INFO -- : (0.003997s) CREATE TABLE "data_bags" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:46:38.458701 #18449]  INFO -- : (0.000853s) CREATE INDEX "data_bags_org_id_index" ON "data_bags" ("org_id")
I, [2012-04-26T16:46:38.459129 #18449]  INFO -- : (0.000220s) UPDATE "schema_info" SET "version" = 6
I, [2012-04-26T16:46:38.459741 #18449]  INFO -- : (0.000529s) COMMIT
I, [2012-04-26T16:46:38.459841 #18449]  INFO -- : Finished applying migration version 6, direction: up, took 0.006766 seconds
I, [2012-04-26T16:46:38.459899 #18449]  INFO -- : Begin applying migration version 7, direction: up
I, [2012-04-26T16:46:38.460113 #18449]  INFO -- : (0.000130s) BEGIN
I, [2012-04-26T16:46:38.464422 #18449]  INFO -- : (0.003833s) CREATE TABLE "data_bag_items" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "data_bag_name" text NOT NULL, "item_name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "data_bag_name", "item_name"))
I, [2012-04-26T16:46:38.465426 #18449]  INFO -- : (0.000840s) CREATE INDEX "data_bag_items_org_id_index" ON "data_bag_items" ("org_id")
I, [2012-04-26T16:46:38.465717 #18449]  INFO -- : (0.000213s) ALTER TABLE data_bag_items ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T16:46:38.466083 #18449]  INFO -- : (0.000163s) UPDATE "schema_info" SET "version" = 7
I, [2012-04-26T16:46:38.466864 #18449]  INFO -- : (0.000726s) COMMIT
I, [2012-04-26T16:46:38.466918 #18449]  INFO -- : Finished applying migration version 7, direction: up, took 0.007019 seconds
I, [2012-04-26T16:46:38.466950 #18449]  INFO -- : Begin applying migration version 8, direction: up
I, [2012-04-26T16:46:38.467172 #18449]  INFO -- : (0.000160s) BEGIN
I, [2012-04-26T16:46:38.472134 #18449]  INFO -- : (0.004340s) CREATE TABLE "environments" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T16:46:38.473283 #18449]  INFO -- : (0.000906s) CREATE INDEX "environments_org_id_index" ON "environments" ("org_id")
I, [2012-04-26T16:46:38.473528 #18449]  INFO -- : (0.000170s) ALTER TABLE environments ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T16:46:38.473833 #18449]  INFO -- : (0.000178s) UPDATE "schema_info" SET "version" = 8
I, [2012-04-26T16:46:38.474458 #18449]  INFO -- : (0.000573s) COMMIT
I, [2012-04-26T16:46:38.474511 #18449]  INFO -- : Finished applying migration version 8, direction: up, took 0.007557 seconds
I, [2012-04-26T16:46:38.474542 #18449]  INFO -- : Begin applying migration version 9, direction: up
I, [2012-04-26T16:46:38.474703 #18449]  INFO -- : (0.000112s) BEGIN
I, [2012-04-26T16:46:38.477327 #18449]  INFO -- : (0.002438s) ALTER TABLE "data_bag_items" ADD FOREIGN KEY ("org_id", "data_bag_name") REFERENCES "data_bags"("org_id", "name") ON DELETE CASCADE ON UPDATE CASCADE
I, [2012-04-26T16:46:38.477768 #18449]  INFO -- : (0.000294s) UPDATE "schema_info" SET "version" = 9
I, [2012-04-26T16:46:38.478284 #18449]  INFO -- : (0.000456s) COMMIT
I, [2012-04-26T16:46:38.478336 #18449]  INFO -- : Finished applying migration version 9, direction: up, took 0.003791 seconds
I, [2012-04-26T16:46:38.478369 #18449]  INFO -- : Begin applying migration version 10, direction: up
I, [2012-04-26T16:46:38.478539 #18449]  INFO -- : (0.000116s) BEGIN
I, [2012-04-26T16:46:38.479323 #18449]  INFO -- : (0.000591s) DROP INDEX "clients_org_id_index"
I, [2012-04-26T16:46:38.479932 #18449]  INFO -- : (0.000363s) DROP INDEX "environments_org_id_index"
I, [2012-04-26T16:46:38.480449 #18449]  INFO -- : (0.000309s) DROP INDEX "nodes_org_id_index"
I, [2012-04-26T16:46:38.480911 #18449]  INFO -- : (0.000282s) DROP INDEX "roles_org_id_index"
I, [2012-04-26T16:46:38.481286 #18449]  INFO -- : (0.000216s) DROP INDEX "data_bags_org_id_index"
I, [2012-04-26T16:46:38.481754 #18449]  INFO -- : (0.000306s) DROP INDEX "data_bag_items_org_id_index"
I, [2012-04-26T16:46:38.482176 #18449]  INFO -- : (0.000237s) UPDATE "schema_info" SET "version" = 10
I, [2012-04-26T16:46:38.483638 #18449]  INFO -- : (0.001372s) COMMIT
I, [2012-04-26T16:46:38.483735 #18449]  INFO -- : Finished applying migration version 10, direction: up, took 0.005354 seconds
I, [2012-04-26T16:46:38.483796 #18449]  INFO -- : Begin applying migration version 11, direction: up
I, [2012-04-26T16:46:38.484005 #18449]  INFO -- : (0.000122s) BEGIN
I, [2012-04-26T16:46:38.484705 #18449]  INFO -- : (0.000338s) ALTER TABLE "users" ADD COLUMN "external_authentication_uid" text NULL
I, [2012-04-26T16:46:38.484986 #18449]  INFO -- : (0.000199s) ALTER TABLE "users" ADD COLUMN "recovery_authentication_enabled" boolean NULL
I, [2012-04-26T16:46:38.485304 #18449]  INFO -- : (0.000239s) ALTER TABLE "users" ALTER COLUMN "email" DROP NOT NULL
I, [2012-04-26T16:46:38.485644 #18449]  INFO -- : (0.000162s) UPDATE "schema_info" SET "version" = 11
I, [2012-04-26T16:46:38.486188 #18449]  INFO -- : (0.000469s) COMMIT
I, [2012-04-26T16:46:38.486269 #18449]  INFO -- : Finished applying migration version 11, direction: up, took 0.002468 seconds
I, [2012-04-26T17:11:08.539197 #18937]  INFO -- : (0.000327s) SET standard_conforming_strings = ON
I, [2012-04-26T17:11:08.539441 #18937]  INFO -- : (0.000095s) SET client_min_messages = 'WARNING'
I, [2012-04-26T17:11:08.539679 #18937]  INFO -- : (0.000192s) SET DateStyle = 'ISO'
E, [2012-04-26T17:11:08.547477 #18937] ERROR -- : PG::Error: ERROR:  relation "schema_info" does not exist
LINE 1: SELECT NULL FROM "schema_info" LIMIT 1
                         ^: SELECT NULL FROM "schema_info" LIMIT 1
I, [2012-04-26T17:11:08.570445 #18937]  INFO -- : (0.022674s) CREATE TABLE "schema_info" ("version" integer DEFAULT 0 NOT NULL)
I, [2012-04-26T17:11:08.571235 #18937]  INFO -- : (0.000559s) SELECT 1 AS "one" FROM "schema_info" LIMIT 1
I, [2012-04-26T17:11:08.573138 #18937]  INFO -- : (0.001701s) SELECT pg_attribute.attname FROM pg_class, pg_attribute, pg_index, pg_namespace WHERE pg_class.oid = pg_attribute.attrelid AND pg_class.relnamespace = pg_namespace.oid AND pg_class.oid = pg_index.indrelid AND pg_index.indkey[0] = pg_attribute.attnum AND pg_index.indisprimary = 't' AND pg_class.relname = 'schema_info'
I, [2012-04-26T17:11:08.574213 #18937]  INFO -- : (0.000851s) INSERT INTO "schema_info" ("version") VALUES (0) RETURNING NULL
I, [2012-04-26T17:11:08.574894 #18937]  INFO -- : (0.000423s) SELECT COUNT(*) AS "count" FROM "schema_info" LIMIT 1
I, [2012-04-26T17:11:08.575334 #18937]  INFO -- : (0.000257s) SELECT "version" FROM "schema_info" LIMIT 1
I, [2012-04-26T17:11:08.590543 #18937]  INFO -- : Begin applying migration version 1, direction: up
I, [2012-04-26T17:11:08.590811 #18937]  INFO -- : (0.000154s) BEGIN
I, [2012-04-26T17:11:08.595761 #18937]  INFO -- : (0.004564s) CREATE TABLE "users" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "username" text NOT NULL UNIQUE, "email" text NOT NULL UNIQUE, "pubkey_version" integer NOT NULL, "public_key" text, "serialized_object" text, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-04-26T17:11:08.596184 #18937]  INFO -- : (0.000259s) UPDATE "schema_info" SET "version" = 1
I, [2012-04-26T17:11:08.597261 #18937]  INFO -- : (0.001011s) COMMIT
I, [2012-04-26T17:11:08.597326 #18937]  INFO -- : Finished applying migration version 1, direction: up, took 0.006785 seconds
I, [2012-04-26T17:11:08.597360 #18937]  INFO -- : Begin applying migration version 2, direction: up
I, [2012-04-26T17:11:08.597543 #18937]  INFO -- : (0.000133s) BEGIN
I, [2012-04-26T17:11:08.601789 #18937]  INFO -- : (0.003861s) CREATE TABLE "nodes" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "environment" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" text, UNIQUE ("org_id", "name"))
I, [2012-04-26T17:11:08.602827 #18937]  INFO -- : (0.000815s) CREATE INDEX "nodes_org_id_index" ON "nodes" ("org_id")
I, [2012-04-26T17:11:08.603698 #18937]  INFO -- : (0.000733s) CREATE INDEX "nodes_org_id_environment_index" ON "nodes" ("org_id", "environment")
I, [2012-04-26T17:11:08.604054 #18937]  INFO -- : (0.000171s) UPDATE "schema_info" SET "version" = 2
I, [2012-04-26T17:11:08.604726 #18937]  INFO -- : (0.000607s) COMMIT
I, [2012-04-26T17:11:08.604811 #18937]  INFO -- : Finished applying migration version 2, direction: up, took 0.007440 seconds
I, [2012-04-26T17:11:08.604868 #18937]  INFO -- : Begin applying migration version 3, direction: up
I, [2012-04-26T17:11:08.605074 #18937]  INFO -- : (0.000126s) BEGIN
I, [2012-04-26T17:11:08.608898 #18937]  INFO -- : (0.003416s) CREATE TABLE "clients" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, "name" text NOT NULL, "public_key" text, "validator" boolean NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "pubkey_version" smallint NOT NULL, CONSTRAINT "org_id_name_unique" UNIQUE ("org_id", "name"))
I, [2012-04-26T17:11:08.609894 #18937]  INFO -- : (0.000869s) CREATE INDEX "clients_org_id_index" ON "clients" ("org_id")
I, [2012-04-26T17:11:08.610270 #18937]  INFO -- : (0.000235s) UPDATE "schema_info" SET "version" = 3
I, [2012-04-26T17:11:08.611047 #18937]  INFO -- : (0.000688s) COMMIT
I, [2012-04-26T17:11:08.611137 #18937]  INFO -- : Finished applying migration version 3, direction: up, took 0.006263 seconds
I, [2012-04-26T17:11:08.611198 #18937]  INFO -- : Begin applying migration version 4, direction: up
I, [2012-04-26T17:11:08.611490 #18937]  INFO -- : (0.000201s) BEGIN
I, [2012-04-26T17:11:08.616489 #18937]  INFO -- : (0.004418s) CREATE TABLE "roles" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T17:11:08.617468 #18937]  INFO -- : (0.000836s) CREATE INDEX "roles_org_id_index" ON "roles" ("org_id")
I, [2012-04-26T17:11:08.617770 #18937]  INFO -- : (0.000230s) ALTER TABLE roles ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T17:11:08.618033 #18937]  INFO -- : (0.000133s) UPDATE "schema_info" SET "version" = 4
I, [2012-04-26T17:11:08.618616 #18937]  INFO -- : (0.000536s) COMMIT
I, [2012-04-26T17:11:08.618665 #18937]  INFO -- : Finished applying migration version 4, direction: up, took 0.007469 seconds
I, [2012-04-26T17:11:08.618697 #18937]  INFO -- : Begin applying migration version 5, direction: up
I, [2012-04-26T17:11:08.618872 #18937]  INFO -- : (0.000119s) BEGIN
I, [2012-04-26T17:11:08.619244 #18937]  INFO -- : (0.000208s) ALTER TABLE "nodes" ADD COLUMN "last_audit_id" bytea
I, [2012-04-26T17:11:08.623088 #18937]  INFO -- : (0.003510s) CREATE TABLE "node_audit" ("audit_id" bytea NOT NULL, "node_id" char(32), "status" varchar(16), "start_time" timestamp NOT NULL, "end_time" timestamp NULL, "event_data" text NULL, PRIMARY KEY ("audit_id"), CONSTRAINT "node_id_fk" FOREIGN KEY ("node_id") REFERENCES "nodes")
I, [2012-04-26T17:11:08.624163 #18937]  INFO -- : (0.000858s) CREATE INDEX "node_audit_node_id_index" ON "node_audit" ("node_id")
I, [2012-04-26T17:11:08.627902 #18937]  INFO -- : (0.003271s) CREATE TABLE "node_audit_detail" ("audit_id" bytea NOT NULL, "seq" int NOT NULL, "duration" int NOT NULL, "res_id" varchar(255) NOT NULL, "res_type" varchar(16) NOT NULL, "res_name" varchar(255) NOT NULL, "res_result" varchar(16) NULL, "res_initial_state" text NULL, "res_final_state" text NULL, "delta" text NULL, PRIMARY KEY ("audit_id", "seq"), CONSTRAINT "audit_id_fk" FOREIGN KEY ("audit_id") REFERENCES "node_audit")
I, [2012-04-26T17:11:08.628323 #18937]  INFO -- : (0.000215s) UPDATE "schema_info" SET "version" = 5
I, [2012-04-26T17:11:08.629138 #18937]  INFO -- : (0.000753s) COMMIT
I, [2012-04-26T17:11:08.629201 #18937]  INFO -- : Finished applying migration version 5, direction: up, took 0.010499 seconds
I, [2012-04-26T17:11:08.629237 #18937]  INFO -- : Begin applying migration version 6, direction: up
I, [2012-04-26T17:11:08.629467 #18937]  INFO -- : (0.000169s) BEGIN
I, [2012-04-26T17:11:08.633536 #18937]  INFO -- : (0.003665s) CREATE TABLE "data_bags" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, UNIQUE ("org_id", "name"))
I, [2012-04-26T17:11:08.634651 #18937]  INFO -- : (0.000900s) CREATE INDEX "data_bags_org_id_index" ON "data_bags" ("org_id")
I, [2012-04-26T17:11:08.635004 #18937]  INFO -- : (0.000197s) UPDATE "schema_info" SET "version" = 6
I, [2012-04-26T17:11:08.635681 #18937]  INFO -- : (0.000590s) COMMIT
I, [2012-04-26T17:11:08.635774 #18937]  INFO -- : Finished applying migration version 6, direction: up, took 0.006527 seconds
I, [2012-04-26T17:11:08.635832 #18937]  INFO -- : Begin applying migration version 7, direction: up
I, [2012-04-26T17:11:08.636095 #18937]  INFO -- : (0.000183s) BEGIN
I, [2012-04-26T17:11:08.639721 #18937]  INFO -- : (0.003201s) CREATE TABLE "data_bag_items" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "data_bag_name" text NOT NULL, "item_name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "data_bag_name", "item_name"))
I, [2012-04-26T17:11:08.640683 #18937]  INFO -- : (0.000816s) CREATE INDEX "data_bag_items_org_id_index" ON "data_bag_items" ("org_id")
I, [2012-04-26T17:11:08.641046 #18937]  INFO -- : (0.000298s) ALTER TABLE data_bag_items ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T17:11:08.641359 #18937]  INFO -- : (0.000182s) UPDATE "schema_info" SET "version" = 7
I, [2012-04-26T17:11:08.642374 #18937]  INFO -- : (0.000959s) COMMIT
I, [2012-04-26T17:11:08.642440 #18937]  INFO -- : Finished applying migration version 7, direction: up, took 0.006608 seconds
I, [2012-04-26T17:11:08.642474 #18937]  INFO -- : Begin applying migration version 8, direction: up
I, [2012-04-26T17:11:08.642671 #18937]  INFO -- : (0.000140s) BEGIN
I, [2012-04-26T17:11:08.646694 #18937]  INFO -- : (0.003661s) CREATE TABLE "environments" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T17:11:08.647675 #18937]  INFO -- : (0.000772s) CREATE INDEX "environments_org_id_index" ON "environments" ("org_id")
I, [2012-04-26T17:11:08.647932 #18937]  INFO -- : (0.000179s) ALTER TABLE environments ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T17:11:08.648311 #18937]  INFO -- : (0.000196s) UPDATE "schema_info" SET "version" = 8
I, [2012-04-26T17:11:08.649032 #18937]  INFO -- : (0.000639s) COMMIT
I, [2012-04-26T17:11:08.649108 #18937]  INFO -- : Finished applying migration version 8, direction: up, took 0.006624 seconds
I, [2012-04-26T17:11:08.649161 #18937]  INFO -- : Begin applying migration version 9, direction: up
I, [2012-04-26T17:11:08.649376 #18937]  INFO -- : (0.000136s) BEGIN
I, [2012-04-26T17:11:08.651033 #18937]  INFO -- : (0.001447s) ALTER TABLE "data_bag_items" ADD FOREIGN KEY ("org_id", "data_bag_name") REFERENCES "data_bags"("org_id", "name") ON DELETE CASCADE ON UPDATE CASCADE
I, [2012-04-26T17:11:08.651297 #18937]  INFO -- : (0.000125s) UPDATE "schema_info" SET "version" = 9
I, [2012-04-26T17:11:08.651802 #18937]  INFO -- : (0.000452s) COMMIT
I, [2012-04-26T17:11:08.651859 #18937]  INFO -- : Finished applying migration version 9, direction: up, took 0.002695 seconds
I, [2012-04-26T17:11:08.651895 #18937]  INFO -- : Begin applying migration version 10, direction: up
I, [2012-04-26T17:11:08.652030 #18937]  INFO -- : (0.000084s) BEGIN
I, [2012-04-26T17:11:08.652480 #18937]  INFO -- : (0.000332s) DROP INDEX "clients_org_id_index"
I, [2012-04-26T17:11:08.652803 #18937]  INFO -- : (0.000221s) DROP INDEX "environments_org_id_index"
I, [2012-04-26T17:11:08.653186 #18937]  INFO -- : (0.000287s) DROP INDEX "nodes_org_id_index"
I, [2012-04-26T17:11:08.653578 #18937]  INFO -- : (0.000280s) DROP INDEX "roles_org_id_index"
I, [2012-04-26T17:11:08.653835 #18937]  INFO -- : (0.000151s) DROP INDEX "data_bags_org_id_index"
I, [2012-04-26T17:11:08.654074 #18937]  INFO -- : (0.000147s) DROP INDEX "data_bag_items_org_id_index"
I, [2012-04-26T17:11:08.654282 #18937]  INFO -- : (0.000114s) UPDATE "schema_info" SET "version" = 10
I, [2012-04-26T17:11:08.655158 #18937]  INFO -- : (0.000824s) COMMIT
I, [2012-04-26T17:11:08.655227 #18937]  INFO -- : Finished applying migration version 10, direction: up, took 0.003324 seconds
I, [2012-04-26T17:11:08.655279 #18937]  INFO -- : Begin applying migration version 11, direction: up
I, [2012-04-26T17:11:08.655507 #18937]  INFO -- : (0.000145s) BEGIN
I, [2012-04-26T17:11:08.656167 #18937]  INFO -- : (0.000307s) ALTER TABLE "users" ADD COLUMN "external_authentication_uid" text NULL
I, [2012-04-26T17:11:08.656515 #18937]  INFO -- : (0.000259s) ALTER TABLE "users" ADD COLUMN "recovery_authentication_enabled" boolean NULL
I, [2012-04-26T17:11:08.656841 #18937]  INFO -- : (0.000233s) ALTER TABLE "users" ALTER COLUMN "email" DROP NOT NULL
I, [2012-04-26T17:11:08.657134 #18937]  INFO -- : (0.000170s) UPDATE "schema_info" SET "version" = 11
I, [2012-04-26T17:11:08.657657 #18937]  INFO -- : (0.000462s) COMMIT
I, [2012-04-26T17:11:08.657718 #18937]  INFO -- : Finished applying migration version 11, direction: up, took 0.002436 seconds
I, [2012-04-26T17:25:41.029802 #19602]  INFO -- : (0.000312s) SET standard_conforming_strings = ON
I, [2012-04-26T17:25:41.086073 #19602]  INFO -- : (0.000177s) SET client_min_messages = 'WARNING'
I, [2012-04-26T17:25:41.086806 #19602]  INFO -- : (0.000115s) SET DateStyle = 'ISO'
E, [2012-04-26T17:25:41.100215 #19602] ERROR -- : PG::Error: ERROR:  relation "schema_info" does not exist
LINE 1: SELECT NULL FROM "schema_info" LIMIT 1
                         ^: SELECT NULL FROM "schema_info" LIMIT 1
I, [2012-04-26T17:25:41.105090 #19602]  INFO -- : (0.004527s) CREATE TABLE "schema_info" ("version" integer DEFAULT 0 NOT NULL)
I, [2012-04-26T17:25:41.105853 #19602]  INFO -- : (0.000559s) SELECT 1 AS "one" FROM "schema_info" LIMIT 1
I, [2012-04-26T17:25:41.107831 #19602]  INFO -- : (0.001771s) SELECT pg_attribute.attname FROM pg_class, pg_attribute, pg_index, pg_namespace WHERE pg_class.oid = pg_attribute.attrelid AND pg_class.relnamespace = pg_namespace.oid AND pg_class.oid = pg_index.indrelid AND pg_index.indkey[0] = pg_attribute.attnum AND pg_index.indisprimary = 't' AND pg_class.relname = 'schema_info'
I, [2012-04-26T17:25:41.108871 #19602]  INFO -- : (0.000828s) INSERT INTO "schema_info" ("version") VALUES (0) RETURNING NULL
I, [2012-04-26T17:25:41.109577 #19602]  INFO -- : (0.000458s) SELECT COUNT(*) AS "count" FROM "schema_info" LIMIT 1
I, [2012-04-26T17:25:41.109958 #19602]  INFO -- : (0.000202s) SELECT "version" FROM "schema_info" LIMIT 1
I, [2012-04-26T17:25:41.126434 #19602]  INFO -- : Begin applying migration version 1, direction: up
I, [2012-04-26T17:25:41.126759 #19602]  INFO -- : (0.000212s) BEGIN
I, [2012-04-26T17:25:41.132326 #19602]  INFO -- : (0.005171s) CREATE TABLE "users" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "username" text NOT NULL UNIQUE, "email" text NOT NULL UNIQUE, "pubkey_version" integer NOT NULL, "public_key" text, "serialized_object" text, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-04-26T17:25:41.132791 #19602]  INFO -- : (0.000286s) UPDATE "schema_info" SET "version" = 1
I, [2012-04-26T17:25:41.133726 #19602]  INFO -- : (0.000879s) COMMIT
I, [2012-04-26T17:25:41.133788 #19602]  INFO -- : Finished applying migration version 1, direction: up, took 0.007357 seconds
I, [2012-04-26T17:25:41.133829 #19602]  INFO -- : Begin applying migration version 2, direction: up
I, [2012-04-26T17:25:41.134013 #19602]  INFO -- : (0.000128s) BEGIN
I, [2012-04-26T17:25:41.137655 #19602]  INFO -- : (0.003252s) CREATE TABLE "nodes" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "environment" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" text, UNIQUE ("org_id", "name"))
I, [2012-04-26T17:25:41.138484 #19602]  INFO -- : (0.000613s) CREATE INDEX "nodes_org_id_index" ON "nodes" ("org_id")
I, [2012-04-26T17:25:41.139288 #19602]  INFO -- : (0.000691s) CREATE INDEX "nodes_org_id_environment_index" ON "nodes" ("org_id", "environment")
I, [2012-04-26T17:25:41.139592 #19602]  INFO -- : (0.000179s) UPDATE "schema_info" SET "version" = 2
I, [2012-04-26T17:25:41.140828 #19602]  INFO -- : (0.001178s) COMMIT
I, [2012-04-26T17:25:41.140889 #19602]  INFO -- : Finished applying migration version 2, direction: up, took 0.007056 seconds
I, [2012-04-26T17:25:41.140923 #19602]  INFO -- : Begin applying migration version 3, direction: up
I, [2012-04-26T17:25:41.141233 #19602]  INFO -- : (0.000254s) BEGIN
I, [2012-04-26T17:25:41.144935 #19602]  INFO -- : (0.003310s) CREATE TABLE "clients" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, "name" text NOT NULL, "public_key" text, "validator" boolean NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "pubkey_version" smallint NOT NULL, CONSTRAINT "org_id_name_unique" UNIQUE ("org_id", "name"))
I, [2012-04-26T17:25:41.145840 #19602]  INFO -- : (0.000782s) CREATE INDEX "clients_org_id_index" ON "clients" ("org_id")
I, [2012-04-26T17:25:41.146130 #19602]  INFO -- : (0.000173s) UPDATE "schema_info" SET "version" = 3
I, [2012-04-26T17:25:41.146868 #19602]  INFO -- : (0.000675s) COMMIT
I, [2012-04-26T17:25:41.146924 #19602]  INFO -- : Finished applying migration version 3, direction: up, took 0.005998 seconds
I, [2012-04-26T17:25:41.146956 #19602]  INFO -- : Begin applying migration version 4, direction: up
I, [2012-04-26T17:25:41.147100 #19602]  INFO -- : (0.000097s) BEGIN
I, [2012-04-26T17:25:41.150723 #19602]  INFO -- : (0.003319s) CREATE TABLE "roles" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T17:25:41.151627 #19602]  INFO -- : (0.000781s) CREATE INDEX "roles_org_id_index" ON "roles" ("org_id")
I, [2012-04-26T17:25:41.151932 #19602]  INFO -- : (0.000234s) ALTER TABLE roles ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T17:25:41.152175 #19602]  INFO -- : (0.000124s) UPDATE "schema_info" SET "version" = 4
I, [2012-04-26T17:25:41.152931 #19602]  INFO -- : (0.000700s) COMMIT
I, [2012-04-26T17:25:41.152991 #19602]  INFO -- : Finished applying migration version 4, direction: up, took 0.006030 seconds
I, [2012-04-26T17:25:41.153025 #19602]  INFO -- : Begin applying migration version 5, direction: up
I, [2012-04-26T17:25:41.153166 #19602]  INFO -- : (0.000090s) BEGIN
I, [2012-04-26T17:25:41.153491 #19602]  INFO -- : (0.000182s) ALTER TABLE "nodes" ADD COLUMN "last_audit_id" bytea
I, [2012-04-26T17:25:41.157012 #19602]  INFO -- : (0.003211s) CREATE TABLE "node_audit" ("audit_id" bytea NOT NULL, "node_id" char(32), "status" varchar(16), "start_time" timestamp NOT NULL, "end_time" timestamp NULL, "event_data" text NULL, PRIMARY KEY ("audit_id"), CONSTRAINT "node_id_fk" FOREIGN KEY ("node_id") REFERENCES "nodes")
I, [2012-04-26T17:25:41.157831 #19602]  INFO -- : (0.000687s) CREATE INDEX "node_audit_node_id_index" ON "node_audit" ("node_id")
I, [2012-04-26T17:25:41.160958 #19602]  INFO -- : (0.002724s) CREATE TABLE "node_audit_detail" ("audit_id" bytea NOT NULL, "seq" int NOT NULL, "duration" int NOT NULL, "res_id" varchar(255) NOT NULL, "res_type" varchar(16) NOT NULL, "res_name" varchar(255) NOT NULL, "res_result" varchar(16) NULL, "res_initial_state" text NULL, "res_final_state" text NULL, "delta" text NULL, PRIMARY KEY ("audit_id", "seq"), CONSTRAINT "audit_id_fk" FOREIGN KEY ("audit_id") REFERENCES "node_audit")
I, [2012-04-26T17:25:41.161337 #19602]  INFO -- : (0.000227s) UPDATE "schema_info" SET "version" = 5
I, [2012-04-26T17:25:41.162691 #19602]  INFO -- : (0.001274s) COMMIT
I, [2012-04-26T17:25:41.162751 #19602]  INFO -- : Finished applying migration version 5, direction: up, took 0.009723 seconds
I, [2012-04-26T17:25:41.162784 #19602]  INFO -- : Begin applying migration version 6, direction: up
I, [2012-04-26T17:25:41.162987 #19602]  INFO -- : (0.000146s) BEGIN
I, [2012-04-26T17:25:41.166587 #19602]  INFO -- : (0.003288s) CREATE TABLE "data_bags" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, UNIQUE ("org_id", "name"))
I, [2012-04-26T17:25:41.167487 #19602]  INFO -- : (0.000782s) CREATE INDEX "data_bags_org_id_index" ON "data_bags" ("org_id")
I, [2012-04-26T17:25:41.167802 #19602]  INFO -- : (0.000193s) UPDATE "schema_info" SET "version" = 6
I, [2012-04-26T17:25:41.168423 #19602]  INFO -- : (0.000548s) COMMIT
I, [2012-04-26T17:25:41.168474 #19602]  INFO -- : Finished applying migration version 6, direction: up, took 0.005686 seconds
I, [2012-04-26T17:25:41.168505 #19602]  INFO -- : Begin applying migration version 7, direction: up
I, [2012-04-26T17:25:41.169009 #19602]  INFO -- : (0.000450s) BEGIN
I, [2012-04-26T17:25:41.172022 #19602]  INFO -- : (0.002677s) CREATE TABLE "data_bag_items" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "data_bag_name" text NOT NULL, "item_name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "data_bag_name", "item_name"))
I, [2012-04-26T17:25:41.172993 #19602]  INFO -- : (0.000853s) CREATE INDEX "data_bag_items_org_id_index" ON "data_bag_items" ("org_id")
I, [2012-04-26T17:25:41.173219 #19602]  INFO -- : (0.000155s) ALTER TABLE data_bag_items ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T17:25:41.173472 #19602]  INFO -- : (0.000135s) UPDATE "schema_info" SET "version" = 7
I, [2012-04-26T17:25:41.174226 #19602]  INFO -- : (0.000701s) COMMIT
I, [2012-04-26T17:25:41.174277 #19602]  INFO -- : Finished applying migration version 7, direction: up, took 0.005768 seconds
I, [2012-04-26T17:25:41.174310 #19602]  INFO -- : Begin applying migration version 8, direction: up
I, [2012-04-26T17:25:41.174610 #19602]  INFO -- : (0.000252s) BEGIN
I, [2012-04-26T17:25:41.178226 #19602]  INFO -- : (0.003301s) CREATE TABLE "environments" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T17:25:41.179053 #19602]  INFO -- : (0.000706s) CREATE INDEX "environments_org_id_index" ON "environments" ("org_id")
I, [2012-04-26T17:25:41.179264 #19602]  INFO -- : (0.000150s) ALTER TABLE environments ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T17:25:41.179484 #19602]  INFO -- : (0.000117s) UPDATE "schema_info" SET "version" = 8
I, [2012-04-26T17:25:41.180298 #19602]  INFO -- : (0.000763s) COMMIT
I, [2012-04-26T17:25:41.180345 #19602]  INFO -- : Finished applying migration version 8, direction: up, took 0.006032 seconds
I, [2012-04-26T17:25:41.180377 #19602]  INFO -- : Begin applying migration version 9, direction: up
I, [2012-04-26T17:25:41.180553 #19602]  INFO -- : (0.000119s) BEGIN
I, [2012-04-26T17:25:41.182244 #19602]  INFO -- : (0.001408s) ALTER TABLE "data_bag_items" ADD FOREIGN KEY ("org_id", "data_bag_name") REFERENCES "data_bags"("org_id", "name") ON DELETE CASCADE ON UPDATE CASCADE
I, [2012-04-26T17:25:41.182491 #19602]  INFO -- : (0.000129s) UPDATE "schema_info" SET "version" = 9
I, [2012-04-26T17:25:41.183519 #19602]  INFO -- : (0.000974s) COMMIT
I, [2012-04-26T17:25:41.183581 #19602]  INFO -- : Finished applying migration version 9, direction: up, took 0.003200 seconds
I, [2012-04-26T17:25:41.183614 #19602]  INFO -- : Begin applying migration version 10, direction: up
I, [2012-04-26T17:25:41.183842 #19602]  INFO -- : (0.000173s) BEGIN
I, [2012-04-26T17:25:41.184312 #19602]  INFO -- : (0.000351s) DROP INDEX "clients_org_id_index"
I, [2012-04-26T17:25:41.184687 #19602]  INFO -- : (0.000284s) DROP INDEX "environments_org_id_index"
I, [2012-04-26T17:25:41.184982 #19602]  INFO -- : (0.000200s) DROP INDEX "nodes_org_id_index"
I, [2012-04-26T17:25:41.185286 #19602]  INFO -- : (0.000186s) DROP INDEX "roles_org_id_index"
I, [2012-04-26T17:25:41.185583 #19602]  INFO -- : (0.000180s) DROP INDEX "data_bags_org_id_index"
I, [2012-04-26T17:25:41.185832 #19602]  INFO -- : (0.000140s) DROP INDEX "data_bag_items_org_id_index"
I, [2012-04-26T17:25:41.186035 #19602]  INFO -- : (0.000109s) UPDATE "schema_info" SET "version" = 10
I, [2012-04-26T17:25:41.186861 #19602]  INFO -- : (0.000774s) COMMIT
I, [2012-04-26T17:25:41.186919 #19602]  INFO -- : Finished applying migration version 10, direction: up, took 0.003301 seconds
I, [2012-04-26T17:25:41.186965 #19602]  INFO -- : Begin applying migration version 11, direction: up
I, [2012-04-26T17:25:41.187151 #19602]  INFO -- : (0.000129s) BEGIN
I, [2012-04-26T17:25:41.187583 #19602]  INFO -- : (0.000232s) ALTER TABLE "users" ADD COLUMN "external_authentication_uid" text NULL
I, [2012-04-26T17:25:41.187775 #19602]  INFO -- : (0.000143s) ALTER TABLE "users" ADD COLUMN "recovery_authentication_enabled" boolean NULL
I, [2012-04-26T17:25:41.187945 #19602]  INFO -- : (0.000126s) ALTER TABLE "users" ALTER COLUMN "email" DROP NOT NULL
I, [2012-04-26T17:25:41.188159 #19602]  INFO -- : (0.000119s) UPDATE "schema_info" SET "version" = 11
I, [2012-04-26T17:25:41.188565 #19602]  INFO -- : (0.000349s) COMMIT
I, [2012-04-26T17:25:41.188613 #19602]  INFO -- : Finished applying migration version 11, direction: up, took 0.001646 seconds
I, [2012-04-26T17:27:26.728772 #19774]  INFO -- : (0.000359s) SET standard_conforming_strings = ON
I, [2012-04-26T17:27:26.729116 #19774]  INFO -- : (0.000210s) SET client_min_messages = 'WARNING'
I, [2012-04-26T17:27:26.729254 #19774]  INFO -- : (0.000083s) SET DateStyle = 'ISO'
E, [2012-04-26T17:27:26.736967 #19774] ERROR -- : PG::Error: ERROR:  relation "schema_info" does not exist
LINE 1: SELECT NULL FROM "schema_info" LIMIT 1
                         ^: SELECT NULL FROM "schema_info" LIMIT 1
I, [2012-04-26T17:27:26.741551 #19774]  INFO -- : (0.004314s) CREATE TABLE "schema_info" ("version" integer DEFAULT 0 NOT NULL)
I, [2012-04-26T17:27:26.742461 #19774]  INFO -- : (0.000706s) SELECT 1 AS "one" FROM "schema_info" LIMIT 1
I, [2012-04-26T17:27:26.744366 #19774]  INFO -- : (0.001727s) SELECT pg_attribute.attname FROM pg_class, pg_attribute, pg_index, pg_namespace WHERE pg_class.oid = pg_attribute.attrelid AND pg_class.relnamespace = pg_namespace.oid AND pg_class.oid = pg_index.indrelid AND pg_index.indkey[0] = pg_attribute.attnum AND pg_index.indisprimary = 't' AND pg_class.relname = 'schema_info'
I, [2012-04-26T17:27:26.745252 #19774]  INFO -- : (0.000700s) INSERT INTO "schema_info" ("version") VALUES (0) RETURNING NULL
I, [2012-04-26T17:27:26.745837 #19774]  INFO -- : (0.000355s) SELECT COUNT(*) AS "count" FROM "schema_info" LIMIT 1
I, [2012-04-26T17:27:26.746178 #19774]  INFO -- : (0.000143s) SELECT "version" FROM "schema_info" LIMIT 1
I, [2012-04-26T17:27:26.761358 #19774]  INFO -- : Begin applying migration version 1, direction: up
I, [2012-04-26T17:27:26.761600 #19774]  INFO -- : (0.000134s) BEGIN
I, [2012-04-26T17:27:26.766495 #19774]  INFO -- : (0.004512s) CREATE TABLE "users" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "username" text NOT NULL UNIQUE, "email" text NOT NULL UNIQUE, "pubkey_version" integer NOT NULL, "public_key" text, "serialized_object" text, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-04-26T17:27:26.766868 #19774]  INFO -- : (0.000182s) UPDATE "schema_info" SET "version" = 1
I, [2012-04-26T17:27:26.767614 #19774]  INFO -- : (0.000686s) COMMIT
I, [2012-04-26T17:27:26.767681 #19774]  INFO -- : Finished applying migration version 1, direction: up, took 0.006323 seconds
I, [2012-04-26T17:27:26.767715 #19774]  INFO -- : Begin applying migration version 2, direction: up
I, [2012-04-26T17:27:26.767902 #19774]  INFO -- : (0.000133s) BEGIN
I, [2012-04-26T17:27:26.771918 #19774]  INFO -- : (0.003627s) CREATE TABLE "nodes" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "environment" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" text, UNIQUE ("org_id", "name"))
I, [2012-04-26T17:27:26.772798 #19774]  INFO -- : (0.000678s) CREATE INDEX "nodes_org_id_index" ON "nodes" ("org_id")
I, [2012-04-26T17:27:26.773845 #19774]  INFO -- : (0.000865s) CREATE INDEX "nodes_org_id_environment_index" ON "nodes" ("org_id", "environment")
I, [2012-04-26T17:27:26.774177 #19774]  INFO -- : (0.000179s) UPDATE "schema_info" SET "version" = 2
I, [2012-04-26T17:27:26.775330 #19774]  INFO -- : (0.001068s) COMMIT
I, [2012-04-26T17:27:26.775414 #19774]  INFO -- : Finished applying migration version 2, direction: up, took 0.007690 seconds
I, [2012-04-26T17:27:26.775465 #19774]  INFO -- : Begin applying migration version 3, direction: up
I, [2012-04-26T17:27:26.775710 #19774]  INFO -- : (0.000158s) BEGIN
I, [2012-04-26T17:27:26.779707 #19774]  INFO -- : (0.003427s) CREATE TABLE "clients" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, "name" text NOT NULL, "public_key" text, "validator" boolean NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "pubkey_version" smallint NOT NULL, CONSTRAINT "org_id_name_unique" UNIQUE ("org_id", "name"))
I, [2012-04-26T17:27:26.780594 #19774]  INFO -- : (0.000742s) CREATE INDEX "clients_org_id_index" ON "clients" ("org_id")
I, [2012-04-26T17:27:26.780905 #19774]  INFO -- : (0.000186s) UPDATE "schema_info" SET "version" = 3
I, [2012-04-26T17:27:26.781552 #19774]  INFO -- : (0.000586s) COMMIT
I, [2012-04-26T17:27:26.781613 #19774]  INFO -- : Finished applying migration version 3, direction: up, took 0.006143 seconds
I, [2012-04-26T17:27:26.781648 #19774]  INFO -- : Begin applying migration version 4, direction: up
I, [2012-04-26T17:27:26.781925 #19774]  INFO -- : (0.000222s) BEGIN
I, [2012-04-26T17:27:26.786080 #19774]  INFO -- : (0.003793s) CREATE TABLE "roles" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T17:27:26.786837 #19774]  INFO -- : (0.000604s) CREATE INDEX "roles_org_id_index" ON "roles" ("org_id")
I, [2012-04-26T17:27:26.787126 #19774]  INFO -- : (0.000201s) ALTER TABLE roles ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T17:27:26.787477 #19774]  INFO -- : (0.000160s) UPDATE "schema_info" SET "version" = 4
I, [2012-04-26T17:27:26.788066 #19774]  INFO -- : (0.000523s) COMMIT
I, [2012-04-26T17:27:26.788123 #19774]  INFO -- : Finished applying migration version 4, direction: up, took 0.006471 seconds
I, [2012-04-26T17:27:26.788157 #19774]  INFO -- : Begin applying migration version 5, direction: up
I, [2012-04-26T17:27:26.788307 #19774]  INFO -- : (0.000100s) BEGIN
I, [2012-04-26T17:27:26.788658 #19774]  INFO -- : (0.000203s) ALTER TABLE "nodes" ADD COLUMN "last_audit_id" bytea
I, [2012-04-26T17:27:26.793262 #19774]  INFO -- : (0.004268s) CREATE TABLE "node_audit" ("audit_id" bytea NOT NULL, "node_id" char(32), "status" varchar(16), "start_time" timestamp NOT NULL, "end_time" timestamp NULL, "event_data" text NULL, PRIMARY KEY ("audit_id"), CONSTRAINT "node_id_fk" FOREIGN KEY ("node_id") REFERENCES "nodes")
I, [2012-04-26T17:27:26.794288 #19774]  INFO -- : (0.000823s) CREATE INDEX "node_audit_node_id_index" ON "node_audit" ("node_id")
I, [2012-04-26T17:27:26.798359 #19774]  INFO -- : (0.003619s) CREATE TABLE "node_audit_detail" ("audit_id" bytea NOT NULL, "seq" int NOT NULL, "duration" int NOT NULL, "res_id" varchar(255) NOT NULL, "res_type" varchar(16) NOT NULL, "res_name" varchar(255) NOT NULL, "res_result" varchar(16) NULL, "res_initial_state" text NULL, "res_final_state" text NULL, "delta" text NULL, PRIMARY KEY ("audit_id", "seq"), CONSTRAINT "audit_id_fk" FOREIGN KEY ("audit_id") REFERENCES "node_audit")
I, [2012-04-26T17:27:26.798748 #19774]  INFO -- : (0.000178s) UPDATE "schema_info" SET "version" = 5
I, [2012-04-26T17:27:26.799424 #19774]  INFO -- : (0.000618s) COMMIT
I, [2012-04-26T17:27:26.799481 #19774]  INFO -- : Finished applying migration version 5, direction: up, took 0.011320 seconds
I, [2012-04-26T17:27:26.799515 #19774]  INFO -- : Begin applying migration version 6, direction: up
I, [2012-04-26T17:27:26.799689 #19774]  INFO -- : (0.000123s) BEGIN
I, [2012-04-26T17:27:26.803770 #19774]  INFO -- : (0.003758s) CREATE TABLE "data_bags" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, UNIQUE ("org_id", "name"))
I, [2012-04-26T17:27:26.804872 #19774]  INFO -- : (0.000926s) CREATE INDEX "data_bags_org_id_index" ON "data_bags" ("org_id")
I, [2012-04-26T17:27:26.805299 #19774]  INFO -- : (0.000223s) UPDATE "schema_info" SET "version" = 6
I, [2012-04-26T17:27:26.806115 #19774]  INFO -- : (0.000725s) COMMIT
I, [2012-04-26T17:27:26.806211 #19774]  INFO -- : Finished applying migration version 6, direction: up, took 0.006685 seconds
I, [2012-04-26T17:27:26.806270 #19774]  INFO -- : Begin applying migration version 7, direction: up
I, [2012-04-26T17:27:26.806527 #19774]  INFO -- : (0.000171s) BEGIN
I, [2012-04-26T17:27:26.810266 #19774]  INFO -- : (0.003328s) CREATE TABLE "data_bag_items" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "data_bag_name" text NOT NULL, "item_name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "data_bag_name", "item_name"))
I, [2012-04-26T17:27:26.811108 #19774]  INFO -- : (0.000635s) CREATE INDEX "data_bag_items_org_id_index" ON "data_bag_items" ("org_id")
I, [2012-04-26T17:27:26.811353 #19774]  INFO -- : (0.000154s) ALTER TABLE data_bag_items ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T17:27:26.811725 #19774]  INFO -- : (0.000219s) UPDATE "schema_info" SET "version" = 7
I, [2012-04-26T17:27:26.812278 #19774]  INFO -- : (0.000474s) COMMIT
I, [2012-04-26T17:27:26.812337 #19774]  INFO -- : Finished applying migration version 7, direction: up, took 0.006067 seconds
I, [2012-04-26T17:27:26.812371 #19774]  INFO -- : Begin applying migration version 8, direction: up
I, [2012-04-26T17:27:26.812532 #19774]  INFO -- : (0.000107s) BEGIN
I, [2012-04-26T17:27:26.816404 #19774]  INFO -- : (0.003505s) CREATE TABLE "environments" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T17:27:26.817450 #19774]  INFO -- : (0.000893s) CREATE INDEX "environments_org_id_index" ON "environments" ("org_id")
I, [2012-04-26T17:27:26.817740 #19774]  INFO -- : (0.000185s) ALTER TABLE environments ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T17:27:26.818086 #19774]  INFO -- : (0.000187s) UPDATE "schema_info" SET "version" = 8
I, [2012-04-26T17:27:26.818988 #19774]  INFO -- : (0.000836s) COMMIT
I, [2012-04-26T17:27:26.819051 #19774]  INFO -- : Finished applying migration version 8, direction: up, took 0.006676 seconds
I, [2012-04-26T17:27:26.819092 #19774]  INFO -- : Begin applying migration version 9, direction: up
I, [2012-04-26T17:27:26.819298 #19774]  INFO -- : (0.000144s) BEGIN
I, [2012-04-26T17:27:26.821490 #19774]  INFO -- : (0.001902s) ALTER TABLE "data_bag_items" ADD FOREIGN KEY ("org_id", "data_bag_name") REFERENCES "data_bags"("org_id", "name") ON DELETE CASCADE ON UPDATE CASCADE
I, [2012-04-26T17:27:26.821827 #19774]  INFO -- : (0.000179s) UPDATE "schema_info" SET "version" = 9
I, [2012-04-26T17:27:26.822497 #19774]  INFO -- : (0.000591s) COMMIT
I, [2012-04-26T17:27:26.822557 #19774]  INFO -- : Finished applying migration version 9, direction: up, took 0.003460 seconds
I, [2012-04-26T17:27:26.822595 #19774]  INFO -- : Begin applying migration version 10, direction: up
I, [2012-04-26T17:27:26.822731 #19774]  INFO -- : (0.000084s) BEGIN
I, [2012-04-26T17:27:26.823391 #19774]  INFO -- : (0.000531s) DROP INDEX "clients_org_id_index"
I, [2012-04-26T17:27:26.823764 #19774]  INFO -- : (0.000263s) DROP INDEX "environments_org_id_index"
I, [2012-04-26T17:27:26.824026 #19774]  INFO -- : (0.000151s) DROP INDEX "nodes_org_id_index"
I, [2012-04-26T17:27:26.824267 #19774]  INFO -- : (0.000145s) DROP INDEX "roles_org_id_index"
I, [2012-04-26T17:27:26.824561 #19774]  INFO -- : (0.000167s) DROP INDEX "data_bags_org_id_index"
I, [2012-04-26T17:27:26.824804 #19774]  INFO -- : (0.000146s) DROP INDEX "data_bag_items_org_id_index"
I, [2012-04-26T17:27:26.825027 #19774]  INFO -- : (0.000125s) UPDATE "schema_info" SET "version" = 10
I, [2012-04-26T17:27:26.826357 #19774]  INFO -- : (0.001255s) COMMIT
I, [2012-04-26T17:27:26.826422 #19774]  INFO -- : Finished applying migration version 10, direction: up, took 0.003823 seconds
I, [2012-04-26T17:27:26.826456 #19774]  INFO -- : Begin applying migration version 11, direction: up
I, [2012-04-26T17:27:26.826610 #19774]  INFO -- : (0.000104s) BEGIN
I, [2012-04-26T17:27:26.827055 #19774]  INFO -- : (0.000231s) ALTER TABLE "users" ADD COLUMN "external_authentication_uid" text NULL
I, [2012-04-26T17:27:26.827288 #19774]  INFO -- : (0.000168s) ALTER TABLE "users" ADD COLUMN "recovery_authentication_enabled" boolean NULL
I, [2012-04-26T17:27:26.827506 #19774]  INFO -- : (0.000164s) ALTER TABLE "users" ALTER COLUMN "email" DROP NOT NULL
I, [2012-04-26T17:27:26.827760 #19774]  INFO -- : (0.000133s) UPDATE "schema_info" SET "version" = 11
I, [2012-04-26T17:27:26.828265 #19774]  INFO -- : (0.000455s) COMMIT
I, [2012-04-26T17:27:26.828312 #19774]  INFO -- : Finished applying migration version 11, direction: up, took 0.001853 seconds
I, [2012-04-26T17:28:50.415913 #19954]  INFO -- : (0.000354s) SET standard_conforming_strings = ON
I, [2012-04-26T17:28:50.416191 #19954]  INFO -- : (0.000142s) SET client_min_messages = 'WARNING'
I, [2012-04-26T17:28:50.416394 #19954]  INFO -- : (0.000144s) SET DateStyle = 'ISO'
E, [2012-04-26T17:28:50.424315 #19954] ERROR -- : PG::Error: ERROR:  relation "schema_info" does not exist
LINE 1: SELECT NULL FROM "schema_info" LIMIT 1
                         ^: SELECT NULL FROM "schema_info" LIMIT 1
I, [2012-04-26T17:28:50.428842 #19954]  INFO -- : (0.004255s) CREATE TABLE "schema_info" ("version" integer DEFAULT 0 NOT NULL)
I, [2012-04-26T17:28:50.429623 #19954]  INFO -- : (0.000584s) SELECT 1 AS "one" FROM "schema_info" LIMIT 1
I, [2012-04-26T17:28:50.431699 #19954]  INFO -- : (0.001877s) SELECT pg_attribute.attname FROM pg_class, pg_attribute, pg_index, pg_namespace WHERE pg_class.oid = pg_attribute.attrelid AND pg_class.relnamespace = pg_namespace.oid AND pg_class.oid = pg_index.indrelid AND pg_index.indkey[0] = pg_attribute.attnum AND pg_index.indisprimary = 't' AND pg_class.relname = 'schema_info'
I, [2012-04-26T17:28:50.432512 #19954]  INFO -- : (0.000605s) INSERT INTO "schema_info" ("version") VALUES (0) RETURNING NULL
I, [2012-04-26T17:28:50.433154 #19954]  INFO -- : (0.000393s) SELECT COUNT(*) AS "count" FROM "schema_info" LIMIT 1
I, [2012-04-26T17:28:50.433503 #19954]  INFO -- : (0.000175s) SELECT "version" FROM "schema_info" LIMIT 1
I, [2012-04-26T17:28:50.449280 #19954]  INFO -- : Begin applying migration version 1, direction: up
I, [2012-04-26T17:28:50.449963 #19954]  INFO -- : (0.000556s) BEGIN
I, [2012-04-26T17:28:50.455365 #19954]  INFO -- : (0.004992s) CREATE TABLE "users" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "username" text NOT NULL UNIQUE, "email" text NOT NULL UNIQUE, "pubkey_version" integer NOT NULL, "public_key" text, "serialized_object" text, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-04-26T17:28:50.455872 #19954]  INFO -- : (0.000312s) UPDATE "schema_info" SET "version" = 1
I, [2012-04-26T17:28:50.456780 #19954]  INFO -- : (0.000846s) COMMIT
I, [2012-04-26T17:28:50.456848 #19954]  INFO -- : Finished applying migration version 1, direction: up, took 0.007570 seconds
I, [2012-04-26T17:28:50.456883 #19954]  INFO -- : Begin applying migration version 2, direction: up
I, [2012-04-26T17:28:50.457072 #19954]  INFO -- : (0.000135s) BEGIN
I, [2012-04-26T17:28:50.461030 #19954]  INFO -- : (0.003564s) CREATE TABLE "nodes" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "environment" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" text, UNIQUE ("org_id", "name"))
I, [2012-04-26T17:28:50.462054 #19954]  INFO -- : (0.000773s) CREATE INDEX "nodes_org_id_index" ON "nodes" ("org_id")
I, [2012-04-26T17:28:50.462808 #19954]  INFO -- : (0.000623s) CREATE INDEX "nodes_org_id_environment_index" ON "nodes" ("org_id", "environment")
I, [2012-04-26T17:28:50.463132 #19954]  INFO -- : (0.000175s) UPDATE "schema_info" SET "version" = 2
I, [2012-04-26T17:28:50.463900 #19954]  INFO -- : (0.000690s) COMMIT
I, [2012-04-26T17:28:50.463962 #19954]  INFO -- : Finished applying migration version 2, direction: up, took 0.007074 seconds
I, [2012-04-26T17:28:50.463996 #19954]  INFO -- : Begin applying migration version 3, direction: up
I, [2012-04-26T17:28:50.464168 #19954]  INFO -- : (0.000118s) BEGIN
I, [2012-04-26T17:28:50.468171 #19954]  INFO -- : (0.003588s) CREATE TABLE "clients" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, "name" text NOT NULL, "public_key" text, "validator" boolean NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "pubkey_version" smallint NOT NULL, CONSTRAINT "org_id_name_unique" UNIQUE ("org_id", "name"))
I, [2012-04-26T17:28:50.469124 #19954]  INFO -- : (0.000828s) CREATE INDEX "clients_org_id_index" ON "clients" ("org_id")
I, [2012-04-26T17:28:50.469471 #19954]  INFO -- : (0.000211s) UPDATE "schema_info" SET "version" = 3
I, [2012-04-26T17:28:50.470101 #19954]  INFO -- : (0.000562s) COMMIT
I, [2012-04-26T17:28:50.470164 #19954]  INFO -- : Finished applying migration version 3, direction: up, took 0.006162 seconds
I, [2012-04-26T17:28:50.470200 #19954]  INFO -- : Begin applying migration version 4, direction: up
I, [2012-04-26T17:28:50.470387 #19954]  INFO -- : (0.000125s) BEGIN
I, [2012-04-26T17:28:50.474757 #19954]  INFO -- : (0.003826s) CREATE TABLE "roles" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T17:28:50.475704 #19954]  INFO -- : (0.000803s) CREATE INDEX "roles_org_id_index" ON "roles" ("org_id")
I, [2012-04-26T17:28:50.476051 #19954]  INFO -- : (0.000273s) ALTER TABLE roles ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T17:28:50.476370 #19954]  INFO -- : (0.000182s) UPDATE "schema_info" SET "version" = 4
I, [2012-04-26T17:28:50.477061 #19954]  INFO -- : (0.000630s) COMMIT
I, [2012-04-26T17:28:50.477113 #19954]  INFO -- : Finished applying migration version 4, direction: up, took 0.006911 seconds
I, [2012-04-26T17:28:50.477144 #19954]  INFO -- : Begin applying migration version 5, direction: up
I, [2012-04-26T17:28:50.477285 #19954]  INFO -- : (0.000093s) BEGIN
I, [2012-04-26T17:28:50.477605 #19954]  INFO -- : (0.000178s) ALTER TABLE "nodes" ADD COLUMN "last_audit_id" bytea
I, [2012-04-26T17:28:50.481478 #19954]  INFO -- : (0.003559s) CREATE TABLE "node_audit" ("audit_id" bytea NOT NULL, "node_id" char(32), "status" varchar(16), "start_time" timestamp NOT NULL, "end_time" timestamp NULL, "event_data" text NULL, PRIMARY KEY ("audit_id"), CONSTRAINT "node_id_fk" FOREIGN KEY ("node_id") REFERENCES "nodes")
I, [2012-04-26T17:28:50.482376 #19954]  INFO -- : (0.000688s) CREATE INDEX "node_audit_node_id_index" ON "node_audit" ("node_id")
I, [2012-04-26T17:28:50.486363 #19954]  INFO -- : (0.003526s) CREATE TABLE "node_audit_detail" ("audit_id" bytea NOT NULL, "seq" int NOT NULL, "duration" int NOT NULL, "res_id" varchar(255) NOT NULL, "res_type" varchar(16) NOT NULL, "res_name" varchar(255) NOT NULL, "res_result" varchar(16) NULL, "res_initial_state" text NULL, "res_final_state" text NULL, "delta" text NULL, PRIMARY KEY ("audit_id", "seq"), CONSTRAINT "audit_id_fk" FOREIGN KEY ("audit_id") REFERENCES "node_audit")
I, [2012-04-26T17:28:50.486752 #19954]  INFO -- : (0.000198s) UPDATE "schema_info" SET "version" = 5
I, [2012-04-26T17:28:50.487723 #19954]  INFO -- : (0.000908s) COMMIT
I, [2012-04-26T17:28:50.487783 #19954]  INFO -- : Finished applying migration version 5, direction: up, took 0.010634 seconds
I, [2012-04-26T17:28:50.487816 #19954]  INFO -- : Begin applying migration version 6, direction: up
I, [2012-04-26T17:28:50.487996 #19954]  INFO -- : (0.000124s) BEGIN
I, [2012-04-26T17:28:50.491856 #19954]  INFO -- : (0.003523s) CREATE TABLE "data_bags" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, UNIQUE ("org_id", "name"))
I, [2012-04-26T17:28:50.493222 #19954]  INFO -- : (0.001165s) CREATE INDEX "data_bags_org_id_index" ON "data_bags" ("org_id")
I, [2012-04-26T17:28:50.493647 #19954]  INFO -- : (0.000220s) UPDATE "schema_info" SET "version" = 6
I, [2012-04-26T17:28:50.494500 #19954]  INFO -- : (0.000768s) COMMIT
I, [2012-04-26T17:28:50.494605 #19954]  INFO -- : Finished applying migration version 6, direction: up, took 0.006778 seconds
I, [2012-04-26T17:28:50.494664 #19954]  INFO -- : Begin applying migration version 7, direction: up
I, [2012-04-26T17:28:50.494889 #19954]  INFO -- : (0.000136s) BEGIN
I, [2012-04-26T17:28:50.498473 #19954]  INFO -- : (0.002914s) CREATE TABLE "data_bag_items" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "data_bag_name" text NOT NULL, "item_name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "data_bag_name", "item_name"))
I, [2012-04-26T17:28:50.499402 #19954]  INFO -- : (0.000793s) CREATE INDEX "data_bag_items_org_id_index" ON "data_bag_items" ("org_id")
I, [2012-04-26T17:28:50.499661 #19954]  INFO -- : (0.000191s) ALTER TABLE data_bag_items ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T17:28:50.500030 #19954]  INFO -- : (0.000236s) UPDATE "schema_info" SET "version" = 7
I, [2012-04-26T17:28:50.500697 #19954]  INFO -- : (0.000605s) COMMIT
I, [2012-04-26T17:28:50.500757 #19954]  INFO -- : Finished applying migration version 7, direction: up, took 0.006092 seconds
I, [2012-04-26T17:28:50.500792 #19954]  INFO -- : Begin applying migration version 8, direction: up
I, [2012-04-26T17:28:50.500975 #19954]  INFO -- : (0.000131s) BEGIN
I, [2012-04-26T17:28:50.504855 #19954]  INFO -- : (0.003527s) CREATE TABLE "environments" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T17:28:50.505687 #19954]  INFO -- : (0.000680s) CREATE INDEX "environments_org_id_index" ON "environments" ("org_id")
I, [2012-04-26T17:28:50.505930 #19954]  INFO -- : (0.000148s) ALTER TABLE environments ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T17:28:50.506228 #19954]  INFO -- : (0.000164s) UPDATE "schema_info" SET "version" = 8
I, [2012-04-26T17:28:50.506768 #19954]  INFO -- : (0.000481s) COMMIT
I, [2012-04-26T17:28:50.506826 #19954]  INFO -- : Finished applying migration version 8, direction: up, took 0.006029 seconds
I, [2012-04-26T17:28:50.506861 #19954]  INFO -- : Begin applying migration version 9, direction: up
I, [2012-04-26T17:28:50.507058 #19954]  INFO -- : (0.000123s) BEGIN
I, [2012-04-26T17:28:50.508685 #19954]  INFO -- : (0.001433s) ALTER TABLE "data_bag_items" ADD FOREIGN KEY ("org_id", "data_bag_name") REFERENCES "data_bags"("org_id", "name") ON DELETE CASCADE ON UPDATE CASCADE
I, [2012-04-26T17:28:50.508940 #19954]  INFO -- : (0.000126s) UPDATE "schema_info" SET "version" = 9
I, [2012-04-26T17:28:50.509767 #19954]  INFO -- : (0.000771s) COMMIT
I, [2012-04-26T17:28:50.509823 #19954]  INFO -- : Finished applying migration version 9, direction: up, took 0.002959 seconds
I, [2012-04-26T17:28:50.509868 #19954]  INFO -- : Begin applying migration version 10, direction: up
I, [2012-04-26T17:28:50.510113 #19954]  INFO -- : (0.000194s) BEGIN
I, [2012-04-26T17:28:50.510593 #19954]  INFO -- : (0.000365s) DROP INDEX "clients_org_id_index"
I, [2012-04-26T17:28:50.510942 #19954]  INFO -- : (0.000237s) DROP INDEX "environments_org_id_index"
I, [2012-04-26T17:28:50.511224 #19954]  INFO -- : (0.000178s) DROP INDEX "nodes_org_id_index"
I, [2012-04-26T17:28:50.511468 #19954]  INFO -- : (0.000151s) DROP INDEX "roles_org_id_index"
I, [2012-04-26T17:28:50.511714 #19954]  INFO -- : (0.000151s) DROP INDEX "data_bags_org_id_index"
I, [2012-04-26T17:28:50.511972 #19954]  INFO -- : (0.000160s) DROP INDEX "data_bag_items_org_id_index"
I, [2012-04-26T17:28:50.512184 #19954]  INFO -- : (0.000114s) UPDATE "schema_info" SET "version" = 10
I, [2012-04-26T17:28:50.513192 #19954]  INFO -- : (0.000950s) COMMIT
I, [2012-04-26T17:28:50.513281 #19954]  INFO -- : Finished applying migration version 10, direction: up, took 0.003403 seconds
I, [2012-04-26T17:28:50.513342 #19954]  INFO -- : Begin applying migration version 11, direction: up
I, [2012-04-26T17:28:50.513542 #19954]  INFO -- : (0.000122s) BEGIN
I, [2012-04-26T17:28:50.513980 #19954]  INFO -- : (0.000223s) ALTER TABLE "users" ADD COLUMN "external_authentication_uid" text NULL
I, [2012-04-26T17:28:50.514375 #19954]  INFO -- : (0.000320s) ALTER TABLE "users" ADD COLUMN "recovery_authentication_enabled" boolean NULL
I, [2012-04-26T17:28:50.514985 #19954]  INFO -- : (0.000547s) ALTER TABLE "users" ALTER COLUMN "email" DROP NOT NULL
I, [2012-04-26T17:28:50.515294 #19954]  INFO -- : (0.000178s) UPDATE "schema_info" SET "version" = 11
I, [2012-04-26T17:28:50.515853 #19954]  INFO -- : (0.000496s) COMMIT
I, [2012-04-26T17:28:50.515933 #19954]  INFO -- : Finished applying migration version 11, direction: up, took 0.002586 seconds
I, [2012-04-26T17:32:06.656678 #20442]  INFO -- : (0.000435s) SET standard_conforming_strings = ON
I, [2012-04-26T17:32:06.656987 #20442]  INFO -- : (0.000168s) SET client_min_messages = 'WARNING'
I, [2012-04-26T17:32:06.657202 #20442]  INFO -- : (0.000151s) SET DateStyle = 'ISO'
E, [2012-04-26T17:32:06.665464 #20442] ERROR -- : PG::Error: ERROR:  relation "schema_info" does not exist
LINE 1: SELECT NULL FROM "schema_info" LIMIT 1
                         ^: SELECT NULL FROM "schema_info" LIMIT 1
I, [2012-04-26T17:32:06.670499 #20442]  INFO -- : (0.004714s) CREATE TABLE "schema_info" ("version" integer DEFAULT 0 NOT NULL)
I, [2012-04-26T17:32:06.671180 #20442]  INFO -- : (0.000518s) SELECT 1 AS "one" FROM "schema_info" LIMIT 1
I, [2012-04-26T17:32:06.673066 #20442]  INFO -- : (0.001672s) SELECT pg_attribute.attname FROM pg_class, pg_attribute, pg_index, pg_namespace WHERE pg_class.oid = pg_attribute.attrelid AND pg_class.relnamespace = pg_namespace.oid AND pg_class.oid = pg_index.indrelid AND pg_index.indkey[0] = pg_attribute.attnum AND pg_index.indisprimary = 't' AND pg_class.relname = 'schema_info'
I, [2012-04-26T17:32:06.673843 #20442]  INFO -- : (0.000597s) INSERT INTO "schema_info" ("version") VALUES (0) RETURNING NULL
I, [2012-04-26T17:32:06.674515 #20442]  INFO -- : (0.000430s) SELECT COUNT(*) AS "count" FROM "schema_info" LIMIT 1
I, [2012-04-26T17:32:06.674931 #20442]  INFO -- : (0.000244s) SELECT "version" FROM "schema_info" LIMIT 1
I, [2012-04-26T17:32:06.690753 #20442]  INFO -- : Begin applying migration version 1, direction: up
I, [2012-04-26T17:32:06.691405 #20442]  INFO -- : (0.000509s) BEGIN
I, [2012-04-26T17:32:06.697985 #20442]  INFO -- : (0.006202s) CREATE TABLE "users" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "username" text NOT NULL UNIQUE, "email" text NOT NULL UNIQUE, "pubkey_version" integer NOT NULL, "public_key" text, "serialized_object" text, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-04-26T17:32:06.698526 #20442]  INFO -- : (0.000307s) UPDATE "schema_info" SET "version" = 1
I, [2012-04-26T17:32:06.700383 #20442]  INFO -- : (0.001765s) COMMIT
I, [2012-04-26T17:32:06.700512 #20442]  INFO -- : Finished applying migration version 1, direction: up, took 0.009760 seconds
I, [2012-04-26T17:32:06.700550 #20442]  INFO -- : Begin applying migration version 2, direction: up
I, [2012-04-26T17:32:06.700879 #20442]  INFO -- : (0.000266s) BEGIN
I, [2012-04-26T17:32:06.704812 #20442]  INFO -- : (0.003510s) CREATE TABLE "nodes" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "environment" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" text, UNIQUE ("org_id", "name"))
I, [2012-04-26T17:32:06.705835 #20442]  INFO -- : (0.000845s) CREATE INDEX "nodes_org_id_index" ON "nodes" ("org_id")
I, [2012-04-26T17:32:06.706677 #20442]  INFO -- : (0.000712s) CREATE INDEX "nodes_org_id_environment_index" ON "nodes" ("org_id", "environment")
I, [2012-04-26T17:32:06.707014 #20442]  INFO -- : (0.000185s) UPDATE "schema_info" SET "version" = 2
I, [2012-04-26T17:32:06.708061 #20442]  INFO -- : (0.000993s) COMMIT
I, [2012-04-26T17:32:06.708117 #20442]  INFO -- : Finished applying migration version 2, direction: up, took 0.007564 seconds
I, [2012-04-26T17:32:06.708150 #20442]  INFO -- : Begin applying migration version 3, direction: up
I, [2012-04-26T17:32:06.708375 #20442]  INFO -- : (0.000171s) BEGIN
I, [2012-04-26T17:32:06.712241 #20442]  INFO -- : (0.003455s) CREATE TABLE "clients" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, "name" text NOT NULL, "public_key" text, "validator" boolean NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "pubkey_version" smallint NOT NULL, CONSTRAINT "org_id_name_unique" UNIQUE ("org_id", "name"))
I, [2012-04-26T17:32:06.713147 #20442]  INFO -- : (0.000706s) CREATE INDEX "clients_org_id_index" ON "clients" ("org_id")
I, [2012-04-26T17:32:06.713851 #20442]  INFO -- : (0.000519s) UPDATE "schema_info" SET "version" = 3
I, [2012-04-26T17:32:06.714459 #20442]  INFO -- : (0.000521s) COMMIT
I, [2012-04-26T17:32:06.714545 #20442]  INFO -- : Finished applying migration version 3, direction: up, took 0.006385 seconds
I, [2012-04-26T17:32:06.714606 #20442]  INFO -- : Begin applying migration version 4, direction: up
I, [2012-04-26T17:32:06.714831 #20442]  INFO -- : (0.000139s) BEGIN
I, [2012-04-26T17:32:06.719011 #20442]  INFO -- : (0.003661s) CREATE TABLE "roles" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T17:32:06.719821 #20442]  INFO -- : (0.000656s) CREATE INDEX "roles_org_id_index" ON "roles" ("org_id")
I, [2012-04-26T17:32:06.720080 #20442]  INFO -- : (0.000186s) ALTER TABLE roles ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T17:32:06.720343 #20442]  INFO -- : (0.000132s) UPDATE "schema_info" SET "version" = 4
I, [2012-04-26T17:32:06.721135 #20442]  INFO -- : (0.000736s) COMMIT
I, [2012-04-26T17:32:06.721199 #20442]  INFO -- : Finished applying migration version 4, direction: up, took 0.006594 seconds
I, [2012-04-26T17:32:06.721233 #20442]  INFO -- : Begin applying migration version 5, direction: up
I, [2012-04-26T17:32:06.721442 #20442]  INFO -- : (0.000150s) BEGIN
I, [2012-04-26T17:32:06.721807 #20442]  INFO -- : (0.000203s) ALTER TABLE "nodes" ADD COLUMN "last_audit_id" bytea
I, [2012-04-26T17:32:06.725560 #20442]  INFO -- : (0.003438s) CREATE TABLE "node_audit" ("audit_id" bytea NOT NULL, "node_id" char(32), "status" varchar(16), "start_time" timestamp NOT NULL, "end_time" timestamp NULL, "event_data" text NULL, PRIMARY KEY ("audit_id"), CONSTRAINT "node_id_fk" FOREIGN KEY ("node_id") REFERENCES "nodes")
I, [2012-04-26T17:32:06.726500 #20442]  INFO -- : (0.000781s) CREATE INDEX "node_audit_node_id_index" ON "node_audit" ("node_id")
I, [2012-04-26T17:32:06.730601 #20442]  INFO -- : (0.003407s) CREATE TABLE "node_audit_detail" ("audit_id" bytea NOT NULL, "seq" int NOT NULL, "duration" int NOT NULL, "res_id" varchar(255) NOT NULL, "res_type" varchar(16) NOT NULL, "res_name" varchar(255) NOT NULL, "res_result" varchar(16) NULL, "res_initial_state" text NULL, "res_final_state" text NULL, "delta" text NULL, PRIMARY KEY ("audit_id", "seq"), CONSTRAINT "audit_id_fk" FOREIGN KEY ("audit_id") REFERENCES "node_audit")
I, [2012-04-26T17:32:06.731022 #20442]  INFO -- : (0.000197s) UPDATE "schema_info" SET "version" = 5
I, [2012-04-26T17:32:06.732177 #20442]  INFO -- : (0.001081s) COMMIT
I, [2012-04-26T17:32:06.732231 #20442]  INFO -- : Finished applying migration version 5, direction: up, took 0.010994 seconds
I, [2012-04-26T17:32:06.732264 #20442]  INFO -- : Begin applying migration version 6, direction: up
I, [2012-04-26T17:32:06.732537 #20442]  INFO -- : (0.000223s) BEGIN
I, [2012-04-26T17:32:06.736427 #20442]  INFO -- : (0.003560s) CREATE TABLE "data_bags" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, UNIQUE ("org_id", "name"))
I, [2012-04-26T17:32:06.737631 #20442]  INFO -- : (0.000978s) CREATE INDEX "data_bags_org_id_index" ON "data_bags" ("org_id")
I, [2012-04-26T17:32:06.738096 #20442]  INFO -- : (0.000231s) UPDATE "schema_info" SET "version" = 6
I, [2012-04-26T17:32:06.738898 #20442]  INFO -- : (0.000706s) COMMIT
I, [2012-04-26T17:32:06.738999 #20442]  INFO -- : Finished applying migration version 6, direction: up, took 0.006722 seconds
I, [2012-04-26T17:32:06.739061 #20442]  INFO -- : Begin applying migration version 7, direction: up
I, [2012-04-26T17:32:06.739533 #20442]  INFO -- : (0.000381s) BEGIN
I, [2012-04-26T17:32:06.743275 #20442]  INFO -- : (0.003167s) CREATE TABLE "data_bag_items" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "data_bag_name" text NOT NULL, "item_name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "data_bag_name", "item_name"))
I, [2012-04-26T17:32:06.744120 #20442]  INFO -- : (0.000715s) CREATE INDEX "data_bag_items_org_id_index" ON "data_bag_items" ("org_id")
I, [2012-04-26T17:32:06.744347 #20442]  INFO -- : (0.000156s) ALTER TABLE data_bag_items ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T17:32:06.744619 #20442]  INFO -- : (0.000142s) UPDATE "schema_info" SET "version" = 7
I, [2012-04-26T17:32:06.745248 #20442]  INFO -- : (0.000578s) COMMIT
I, [2012-04-26T17:32:06.745299 #20442]  INFO -- : Finished applying migration version 7, direction: up, took 0.006239 seconds
I, [2012-04-26T17:32:06.745332 #20442]  INFO -- : Begin applying migration version 8, direction: up
I, [2012-04-26T17:32:06.745478 #20442]  INFO -- : (0.000095s) BEGIN
I, [2012-04-26T17:32:06.749683 #20442]  INFO -- : (0.003858s) CREATE TABLE "environments" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-04-26T17:32:06.750876 #20442]  INFO -- : (0.001012s) CREATE INDEX "environments_org_id_index" ON "environments" ("org_id")
I, [2012-04-26T17:32:06.751100 #20442]  INFO -- : (0.000146s) ALTER TABLE environments ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-04-26T17:32:06.751399 #20442]  INFO -- : (0.000166s) UPDATE "schema_info" SET "version" = 8
I, [2012-04-26T17:32:06.752241 #20442]  INFO -- : (0.000776s) COMMIT
I, [2012-04-26T17:32:06.752300 #20442]  INFO -- : Finished applying migration version 8, direction: up, took 0.006964 seconds
I, [2012-04-26T17:32:06.752342 #20442]  INFO -- : Begin applying migration version 9, direction: up
I, [2012-04-26T17:32:06.752528 #20442]  INFO -- : (0.000126s) BEGIN
I, [2012-04-26T17:32:06.754219 #20442]  INFO -- : (0.001428s) ALTER TABLE "data_bag_items" ADD FOREIGN KEY ("org_id", "data_bag_name") REFERENCES "data_bags"("org_id", "name") ON DELETE CASCADE ON UPDATE CASCADE
I, [2012-04-26T17:32:06.754548 #20442]  INFO -- : (0.000179s) UPDATE "schema_info" SET "version" = 9
I, [2012-04-26T17:32:06.755181 #20442]  INFO -- : (0.000579s) COMMIT
I, [2012-04-26T17:32:06.755234 #20442]  INFO -- : Finished applying migration version 9, direction: up, took 0.002889 seconds
I, [2012-04-26T17:32:06.755267 #20442]  INFO -- : Begin applying migration version 10, direction: up
I, [2012-04-26T17:32:06.755397 #20442]  INFO -- : (0.000081s) BEGIN
I, [2012-04-26T17:32:06.755857 #20442]  INFO -- : (0.000354s) DROP INDEX "clients_org_id_index"
I, [2012-04-26T17:32:06.756172 #20442]  INFO -- : (0.000223s) DROP INDEX "environments_org_id_index"
I, [2012-04-26T17:32:06.756432 #20442]  INFO -- : (0.000164s) DROP INDEX "nodes_org_id_index"
I, [2012-04-26T17:32:06.756728 #20442]  INFO -- : (0.000203s) DROP INDEX "roles_org_id_index"
I, [2012-04-26T17:32:06.757022 #20442]  INFO -- : (0.000205s) DROP INDEX "data_bags_org_id_index"
I, [2012-04-26T17:32:06.757274 #20442]  INFO -- : (0.000163s) DROP INDEX "data_bag_items_org_id_index"
I, [2012-04-26T17:32:06.757507 #20442]  INFO -- : (0.000130s) UPDATE "schema_info" SET "version" = 10
I, [2012-04-26T17:32:06.758557 #20442]  INFO -- : (0.000996s) COMMIT
I, [2012-04-26T17:32:06.758628 #20442]  INFO -- : Finished applying migration version 10, direction: up, took 0.003355 seconds
I, [2012-04-26T17:32:06.758664 #20442]  INFO -- : Begin applying migration version 11, direction: up
I, [2012-04-26T17:32:06.758831 #20442]  INFO -- : (0.000109s) BEGIN
I, [2012-04-26T17:32:06.759283 #20442]  INFO -- : (0.000224s) ALTER TABLE "users" ADD COLUMN "external_authentication_uid" text NULL
I, [2012-04-26T17:32:06.759626 #20442]  INFO -- : (0.000278s) ALTER TABLE "users" ADD COLUMN "recovery_authentication_enabled" boolean NULL
I, [2012-04-26T17:32:06.759911 #20442]  INFO -- : (0.000204s) ALTER TABLE "users" ALTER COLUMN "email" DROP NOT NULL
I, [2012-04-26T17:32:06.760192 #20442]  INFO -- : (0.000142s) UPDATE "schema_info" SET "version" = 11
I, [2012-04-26T17:32:06.760654 #20442]  INFO -- : (0.000408s) COMMIT
I, [2012-04-26T17:32:06.760710 #20442]  INFO -- : Finished applying migration version 11, direction: up, took 0.002043 seconds
I, [2012-05-30T09:43:47.549398 #16016]  INFO -- : (0.000371s) SET standard_conforming_strings = ON
I, [2012-05-30T09:43:47.595560 #16016]  INFO -- : (0.000364s) SET client_min_messages = 'WARNING'
I, [2012-05-30T09:43:47.597505 #16016]  INFO -- : (0.000384s) SET DateStyle = 'ISO'
E, [2012-05-30T09:43:47.619408 #16016] ERROR -- : PG::Error: ERROR:  relation "schema_info" does not exist
LINE 1: SELECT NULL FROM "schema_info" LIMIT 1
                         ^: SELECT NULL FROM "schema_info" LIMIT 1
I, [2012-05-30T09:43:47.625095 #16016]  INFO -- : (0.005422s) CREATE TABLE "schema_info" ("version" integer DEFAULT 0 NOT NULL)
I, [2012-05-30T09:43:47.638094 #16016]  INFO -- : (0.012795s) SELECT 1 AS "one" FROM "schema_info" LIMIT 1
I, [2012-05-30T09:43:47.640418 #16016]  INFO -- : (0.002074s) SELECT pg_attribute.attname FROM pg_class, pg_attribute, pg_index, pg_namespace WHERE pg_class.oid = pg_attribute.attrelid AND pg_class.relnamespace = pg_namespace.oid AND pg_class.oid = pg_index.indrelid AND pg_index.indkey[0] = pg_attribute.attnum AND pg_index.indisprimary = 't' AND pg_class.relname = 'schema_info'
I, [2012-05-30T09:43:47.641489 #16016]  INFO -- : (0.000875s) INSERT INTO "schema_info" ("version") VALUES (0) RETURNING NULL
I, [2012-05-30T09:43:47.642075 #16016]  INFO -- : (0.000361s) SELECT COUNT(*) AS "count" FROM "schema_info" LIMIT 1
I, [2012-05-30T09:43:47.642369 #16016]  INFO -- : (0.000130s) SELECT "version" FROM "schema_info" LIMIT 1
I, [2012-05-30T09:43:47.648662 #16016]  INFO -- : Begin applying migration version 1, direction: up
I, [2012-05-30T09:43:47.649035 #16016]  INFO -- : (0.000275s) BEGIN
I, [2012-05-30T09:43:47.654974 #16016]  INFO -- : (0.005590s) CREATE TABLE "users" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "username" text NOT NULL UNIQUE, "email" text NOT NULL UNIQUE, "pubkey_version" integer NOT NULL, "public_key" text, "serialized_object" text, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-05-30T09:43:47.655317 #16016]  INFO -- : (0.000167s) UPDATE "schema_info" SET "version" = 1
I, [2012-05-30T09:43:47.656391 #16016]  INFO -- : (0.001016s) COMMIT
I, [2012-05-30T09:43:47.656456 #16016]  INFO -- : Finished applying migration version 1, direction: up, took 0.007792 seconds
I, [2012-05-30T09:43:47.656491 #16016]  INFO -- : Begin applying migration version 2, direction: up
I, [2012-05-30T09:43:47.656644 #16016]  INFO -- : (0.000092s) BEGIN
I, [2012-05-30T09:43:47.660471 #16016]  INFO -- : (0.003472s) CREATE TABLE "nodes" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "environment" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" text, UNIQUE ("org_id", "name"))
I, [2012-05-30T09:43:47.661558 #16016]  INFO -- : (0.000862s) CREATE INDEX "nodes_org_id_index" ON "nodes" ("org_id")
I, [2012-05-30T09:43:47.662360 #16016]  INFO -- : (0.000664s) CREATE INDEX "nodes_org_id_environment_index" ON "nodes" ("org_id", "environment")
I, [2012-05-30T09:43:47.662757 #16016]  INFO -- : (0.000203s) UPDATE "schema_info" SET "version" = 2
I, [2012-05-30T09:43:47.663396 #16016]  INFO -- : (0.000579s) COMMIT
I, [2012-05-30T09:43:47.663458 #16016]  INFO -- : Finished applying migration version 2, direction: up, took 0.006962 seconds
I, [2012-05-30T09:43:47.663495 #16016]  INFO -- : Begin applying migration version 3, direction: up
I, [2012-05-30T09:43:47.663672 #16016]  INFO -- : (0.000116s) BEGIN
I, [2012-05-30T09:43:47.667950 #16016]  INFO -- : (0.003877s) CREATE TABLE "clients" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, "name" text NOT NULL, "public_key" text, "validator" boolean NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "pubkey_version" smallint NOT NULL, CONSTRAINT "org_id_name_unique" UNIQUE ("org_id", "name"))
I, [2012-05-30T09:43:47.668853 #16016]  INFO -- : (0.000785s) CREATE INDEX "clients_org_id_index" ON "clients" ("org_id")
I, [2012-05-30T09:43:47.669146 #16016]  INFO -- : (0.000182s) UPDATE "schema_info" SET "version" = 3
I, [2012-05-30T09:43:47.670792 #16016]  INFO -- : (0.001588s) COMMIT
I, [2012-05-30T09:43:47.670856 #16016]  INFO -- : Finished applying migration version 3, direction: up, took 0.007356 seconds
I, [2012-05-30T09:43:47.670891 #16016]  INFO -- : Begin applying migration version 4, direction: up
I, [2012-05-30T09:43:47.671148 #16016]  INFO -- : (0.000201s) BEGIN
I, [2012-05-30T09:43:47.674919 #16016]  INFO -- : (0.003419s) CREATE TABLE "roles" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-05-30T09:43:47.675663 #16016]  INFO -- : (0.000597s) CREATE INDEX "roles_org_id_index" ON "roles" ("org_id")
I, [2012-05-30T09:43:47.675971 #16016]  INFO -- : (0.000234s) ALTER TABLE roles ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-05-30T09:43:47.676334 #16016]  INFO -- : (0.000169s) UPDATE "schema_info" SET "version" = 4
I, [2012-05-30T09:43:47.676907 #16016]  INFO -- : (0.000503s) COMMIT
I, [2012-05-30T09:43:47.676965 #16016]  INFO -- : Finished applying migration version 4, direction: up, took 0.006069 seconds
I, [2012-05-30T09:43:47.677007 #16016]  INFO -- : Begin applying migration version 5, direction: up
I, [2012-05-30T09:43:47.677215 #16016]  INFO -- : (0.000149s) BEGIN
I, [2012-05-30T09:43:47.677612 #16016]  INFO -- : (0.000234s) ALTER TABLE "nodes" ADD COLUMN "last_audit_id" bytea
I, [2012-05-30T09:43:47.681449 #16016]  INFO -- : (0.003511s) CREATE TABLE "node_audit" ("audit_id" bytea NOT NULL, "node_id" char(32), "status" varchar(16), "start_time" timestamp NOT NULL, "end_time" timestamp NULL, "event_data" text NULL, PRIMARY KEY ("audit_id"), CONSTRAINT "node_id_fk" FOREIGN KEY ("node_id") REFERENCES "nodes")
I, [2012-05-30T09:43:47.682407 #16016]  INFO -- : (0.000808s) CREATE INDEX "node_audit_node_id_index" ON "node_audit" ("node_id")
I, [2012-05-30T09:43:47.686336 #16016]  INFO -- : (0.003409s) CREATE TABLE "node_audit_detail" ("audit_id" bytea NOT NULL, "seq" int NOT NULL, "duration" int NOT NULL, "res_id" varchar(255) NOT NULL, "res_type" varchar(16) NOT NULL, "res_name" varchar(255) NOT NULL, "res_result" varchar(16) NULL, "res_initial_state" text NULL, "res_final_state" text NULL, "delta" text NULL, PRIMARY KEY ("audit_id", "seq"), CONSTRAINT "audit_id_fk" FOREIGN KEY ("audit_id") REFERENCES "node_audit")
I, [2012-05-30T09:43:47.686730 #16016]  INFO -- : (0.000184s) UPDATE "schema_info" SET "version" = 5
I, [2012-05-30T09:43:47.687778 #16016]  INFO -- : (0.000974s) COMMIT
I, [2012-05-30T09:43:47.687839 #16016]  INFO -- : Finished applying migration version 5, direction: up, took 0.010833 seconds
I, [2012-05-30T09:43:47.687875 #16016]  INFO -- : Begin applying migration version 6, direction: up
I, [2012-05-30T09:43:47.688074 #16016]  INFO -- : (0.000140s) BEGIN
I, [2012-05-30T09:43:47.692151 #16016]  INFO -- : (0.003736s) CREATE TABLE "data_bags" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, UNIQUE ("org_id", "name"))
I, [2012-05-30T09:43:47.693134 #16016]  INFO -- : (0.000786s) CREATE INDEX "data_bags_org_id_index" ON "data_bags" ("org_id")
I, [2012-05-30T09:43:47.693478 #16016]  INFO -- : (0.000182s) UPDATE "schema_info" SET "version" = 6
I, [2012-05-30T09:43:47.694106 #16016]  INFO -- : (0.000564s) COMMIT
I, [2012-05-30T09:43:47.694164 #16016]  INFO -- : Finished applying migration version 6, direction: up, took 0.006286 seconds
I, [2012-05-30T09:43:47.694206 #16016]  INFO -- : Begin applying migration version 7, direction: up
I, [2012-05-30T09:43:47.694434 #16016]  INFO -- : (0.000141s) BEGIN
I, [2012-05-30T09:43:47.697854 #16016]  INFO -- : (0.002888s) CREATE TABLE "data_bag_items" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "data_bag_name" text NOT NULL, "item_name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "data_bag_name", "item_name"))
I, [2012-05-30T09:43:47.698758 #16016]  INFO -- : (0.000747s) CREATE INDEX "data_bag_items_org_id_index" ON "data_bag_items" ("org_id")
I, [2012-05-30T09:43:47.698984 #16016]  INFO -- : (0.000158s) ALTER TABLE data_bag_items ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-05-30T09:43:47.699257 #16016]  INFO -- : (0.000147s) UPDATE "schema_info" SET "version" = 7
I, [2012-05-30T09:43:47.700165 #16016]  INFO -- : (0.000851s) COMMIT
I, [2012-05-30T09:43:47.700229 #16016]  INFO -- : Finished applying migration version 7, direction: up, took 0.006023 seconds
I, [2012-05-30T09:43:47.700264 #16016]  INFO -- : Begin applying migration version 8, direction: up
I, [2012-05-30T09:43:47.700522 #16016]  INFO -- : (0.000203s) BEGIN
I, [2012-05-30T09:43:47.704796 #16016]  INFO -- : (0.003920s) CREATE TABLE "environments" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-05-30T09:43:47.705643 #16016]  INFO -- : (0.000650s) CREATE INDEX "environments_org_id_index" ON "environments" ("org_id")
I, [2012-05-30T09:43:47.705901 #16016]  INFO -- : (0.000183s) ALTER TABLE environments ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-05-30T09:43:47.706259 #16016]  INFO -- : (0.000173s) UPDATE "schema_info" SET "version" = 8
I, [2012-05-30T09:43:47.707005 #16016]  INFO -- : (0.000664s) COMMIT
I, [2012-05-30T09:43:47.707099 #16016]  INFO -- : Finished applying migration version 8, direction: up, took 0.006826 seconds
I, [2012-05-30T09:43:47.707140 #16016]  INFO -- : Begin applying migration version 9, direction: up
I, [2012-05-30T09:43:47.707355 #16016]  INFO -- : (0.000155s) BEGIN
I, [2012-05-30T09:43:47.709030 #16016]  INFO -- : (0.001468s) ALTER TABLE "data_bag_items" ADD FOREIGN KEY ("org_id", "data_bag_name") REFERENCES "data_bags"("org_id", "name") ON DELETE CASCADE ON UPDATE CASCADE
I, [2012-05-30T09:43:47.709336 #16016]  INFO -- : (0.000164s) UPDATE "schema_info" SET "version" = 9
I, [2012-05-30T09:43:47.709963 #16016]  INFO -- : (0.000570s) COMMIT
I, [2012-05-30T09:43:47.710027 #16016]  INFO -- : Finished applying migration version 9, direction: up, took 0.002883 seconds
I, [2012-05-30T09:43:47.710065 #16016]  INFO -- : Begin applying migration version 10, direction: up
I, [2012-05-30T09:43:47.710208 #16016]  INFO -- : (0.000090s) BEGIN
I, [2012-05-30T09:43:47.710658 #16016]  INFO -- : (0.000334s) DROP INDEX "clients_org_id_index"
I, [2012-05-30T09:43:47.711029 #16016]  INFO -- : (0.000277s) DROP INDEX "environments_org_id_index"
I, [2012-05-30T09:43:47.711434 #16016]  INFO -- : (0.000305s) DROP INDEX "nodes_org_id_index"
I, [2012-05-30T09:43:47.711720 #16016]  INFO -- : (0.000176s) DROP INDEX "roles_org_id_index"
I, [2012-05-30T09:43:47.712093 #16016]  INFO -- : (0.000279s) DROP INDEX "data_bags_org_id_index"
I, [2012-05-30T09:43:47.712458 #16016]  INFO -- : (0.000264s) DROP INDEX "data_bag_items_org_id_index"
I, [2012-05-30T09:43:47.712784 #16016]  INFO -- : (0.000221s) UPDATE "schema_info" SET "version" = 10
I, [2012-05-30T09:43:47.713676 #16016]  INFO -- : (0.000837s) COMMIT
I, [2012-05-30T09:43:47.713738 #16016]  INFO -- : Finished applying migration version 10, direction: up, took 0.003669 seconds
I, [2012-05-30T09:43:47.713773 #16016]  INFO -- : Begin applying migration version 11, direction: up
I, [2012-05-30T09:43:47.713944 #16016]  INFO -- : (0.000112s) BEGIN
I, [2012-05-30T09:43:47.714494 #16016]  INFO -- : (0.000326s) ALTER TABLE "users" ADD COLUMN "external_authentication_uid" text NULL
I, [2012-05-30T09:43:47.714809 #16016]  INFO -- : (0.000229s) ALTER TABLE "users" ADD COLUMN "recovery_authentication_enabled" boolean NULL
I, [2012-05-30T09:43:47.715110 #16016]  INFO -- : (0.000239s) ALTER TABLE "users" ALTER COLUMN "email" DROP NOT NULL
I, [2012-05-30T09:43:47.715453 #16016]  INFO -- : (0.000186s) UPDATE "schema_info" SET "version" = 11
I, [2012-05-30T09:43:47.716025 #16016]  INFO -- : (0.000488s) COMMIT
I, [2012-05-30T09:43:47.716088 #16016]  INFO -- : Finished applying migration version 11, direction: up, took 0.002310 seconds
I, [2012-05-30T09:43:47.716125 #16016]  INFO -- : Begin applying migration version 12, direction: up
I, [2012-05-30T09:43:47.716298 #16016]  INFO -- : (0.000120s) BEGIN
I, [2012-05-30T09:43:47.721372 #16016]  INFO -- : (0.004738s) CREATE TABLE "opc_customers" ("id" serial PRIMARY KEY, "name" text NOT NULL UNIQUE, "display_name" text NOT NULL, "domain" text NOT NULL UNIQUE, "contact" text NOT NULL, "priority" integer DEFAULT 0 NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-05-30T09:43:47.723624 #16016]  INFO -- : (0.001967s) CREATE TABLE "opc_users" ("user_id" char(32) NOT NULL, "customer_id" integer REFERENCES "opc_customers" ON DELETE CASCADE, FOREIGN KEY ("user_id") REFERENCES "users" ON DELETE CASCADE, UNIQUE ("user_id", "customer_id"))
I, [2012-05-30T09:43:47.723939 #16016]  INFO -- : (0.000185s) UPDATE "schema_info" SET "version" = 12
I, [2012-05-30T09:43:47.724913 #16016]  INFO -- : (0.000922s) COMMIT
I, [2012-05-30T09:43:47.724962 #16016]  INFO -- : Finished applying migration version 12, direction: up, took 0.008834 seconds
I, [2012-05-30T09:43:47.724994 #16016]  INFO -- : Begin applying migration version 13, direction: up
I, [2012-05-30T09:43:47.725177 #16016]  INFO -- : (0.000134s) BEGIN
I, [2012-05-30T09:43:47.726584 #16016]  INFO -- : (0.001219s) CREATE TABLE "checksums" ("org_id" char(32) NOT NULL, "checksum" char(32) NOT NULL, PRIMARY KEY ("org_id", "checksum"))
I, [2012-05-30T09:43:47.728307 #16016]  INFO -- : (0.001414s) CREATE TABLE "sandboxed_checksums" ("org_id" char(32), "sandbox_id" char(32), "checksum" char(32), "created_at" timestamp NOT NULL, PRIMARY KEY ("sandbox_id", "org_id", "checksum"))
I, [2012-05-30T09:43:47.728683 #16016]  INFO -- : (0.000186s) UPDATE "schema_info" SET "version" = 13
I, [2012-05-30T09:43:47.729274 #16016]  INFO -- : (0.000528s) COMMIT
I, [2012-05-30T09:43:47.729351 #16016]  INFO -- : Finished applying migration version 13, direction: up, took 0.004349 seconds
I, [2012-05-30T09:43:47.729409 #16016]  INFO -- : Begin applying migration version 14, direction: up
I, [2012-05-30T09:43:47.729601 #16016]  INFO -- : (0.000117s) BEGIN
I, [2012-05-30T09:43:47.734259 #16016]  INFO -- : (0.004382s) CREATE TABLE "cookbooks" ("id" serial PRIMARY KEY, "org_id" char(32) NOT NULL, "name" text NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, UNIQUE ("org_id", "name"))
I, [2012-05-30T09:43:47.735146 #16016]  INFO -- : (0.000757s) CREATE INDEX "cookbooks_org_id_index" ON "cookbooks" ("org_id")
I, [2012-05-30T09:43:47.741018 #16016]  INFO -- : (0.005383s) CREATE TABLE "cookbook_versions" ("id" char(32) PRIMARY KEY, "major" integer NOT NULL, "minor" integer NOT NULL, "patch" integer NOT NULL, "frozen" Boolean NOT NULL, "meta_attributes" bytea NOT NULL, "meta_deps" text NOT NULL, "meta_long_desc" bytea NOT NULL, "metadata" bytea NOT NULL, "serialized_object" bytea NOT NULL, "updated_at" timestamp NOT NULL, "created_at" timestamp NOT NULL, "last_updated_by" char(32) NOT NULL, "cookbook_id" integer REFERENCES "cookbooks" ON DELETE RESTRICT, UNIQUE ("cookbook_id", "major", "minor", "patch"))
I, [2012-05-30T09:43:47.741363 #16016]  INFO -- : (0.000225s) ALTER TABLE cookbook_versions ALTER meta_attributes SET STORAGE EXTERNAL
I, [2012-05-30T09:43:47.741579 #16016]  INFO -- : (0.000160s) ALTER TABLE cookbook_versions ALTER meta_long_desc SET STORAGE EXTERNAL
I, [2012-05-30T09:43:47.741824 #16016]  INFO -- : (0.000179s) ALTER TABLE cookbook_versions ALTER metadata SET STORAGE EXTERNAL
I, [2012-05-30T09:43:47.742101 #16016]  INFO -- : (0.000194s) ALTER TABLE cookbook_versions ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-05-30T09:43:47.744378 #16016]  INFO -- : (0.001771s) CREATE TABLE "cookbook_version_checksums" ("cookbook_version_id" char(32), "org_id" char(32) NOT NULL, "checksum" char(32) NOT NULL, FOREIGN KEY ("cookbook_version_id") REFERENCES "cookbook_versions"("id"), FOREIGN KEY ("org_id", "checksum") REFERENCES "checksums"("org_id", "checksum") ON DELETE CASCADE ON UPDATE CASCADE)
I, [2012-05-30T09:43:47.744700 #16016]  INFO -- : (0.000183s) UPDATE "schema_info" SET "version" = 14
I, [2012-05-30T09:43:47.745544 #16016]  INFO -- : (0.000792s) COMMIT
I, [2012-05-30T09:43:47.745596 #16016]  INFO -- : Finished applying migration version 14, direction: up, took 0.016187 seconds
I, [2012-05-30T10:42:48.596476 #19664]  INFO -- : (0.000344s) SET standard_conforming_strings = ON
I, [2012-05-30T10:42:48.611418 #19664]  INFO -- : (0.000248s) SET client_min_messages = 'WARNING'
I, [2012-05-30T10:42:48.612348 #19664]  INFO -- : (0.000161s) SET DateStyle = 'ISO'
E, [2012-05-30T10:42:48.680570 #19664] ERROR -- : PG::Error: ERROR:  relation "schema_info" does not exist
LINE 1: SELECT NULL FROM "schema_info" LIMIT 1
                         ^: SELECT NULL FROM "schema_info" LIMIT 1
I, [2012-05-30T10:42:48.687524 #19664]  INFO -- : (0.006427s) CREATE TABLE "schema_info" ("version" integer DEFAULT 0 NOT NULL)
I, [2012-05-30T10:42:48.688674 #19664]  INFO -- : (0.000854s) SELECT 1 AS "one" FROM "schema_info" LIMIT 1
I, [2012-05-30T10:42:48.691128 #19664]  INFO -- : (0.002181s) SELECT pg_attribute.attname FROM pg_class, pg_attribute, pg_index, pg_namespace WHERE pg_class.oid = pg_attribute.attrelid AND pg_class.relnamespace = pg_namespace.oid AND pg_class.oid = pg_index.indrelid AND pg_index.indkey[0] = pg_attribute.attnum AND pg_index.indisprimary = 't' AND pg_class.relname = 'schema_info'
I, [2012-05-30T10:42:48.692126 #19664]  INFO -- : (0.000754s) INSERT INTO "schema_info" ("version") VALUES (0) RETURNING NULL
I, [2012-05-30T10:42:48.693048 #19664]  INFO -- : (0.000655s) SELECT COUNT(*) AS "count" FROM "schema_info" LIMIT 1
I, [2012-05-30T10:42:48.693569 #19664]  INFO -- : (0.000320s) SELECT "version" FROM "schema_info" LIMIT 1
I, [2012-05-30T10:42:48.700125 #19664]  INFO -- : Begin applying migration version 1, direction: up
I, [2012-05-30T10:42:48.700550 #19664]  INFO -- : (0.000332s) BEGIN
I, [2012-05-30T10:42:48.706507 #19664]  INFO -- : (0.005563s) CREATE TABLE "users" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "username" text NOT NULL UNIQUE, "email" text NOT NULL UNIQUE, "pubkey_version" integer NOT NULL, "public_key" text, "serialized_object" text, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-05-30T10:42:48.706980 #19664]  INFO -- : (0.000300s) UPDATE "schema_info" SET "version" = 1
I, [2012-05-30T10:42:48.707884 #19664]  INFO -- : (0.000848s) COMMIT
I, [2012-05-30T10:42:48.707954 #19664]  INFO -- : Finished applying migration version 1, direction: up, took 0.007824 seconds
I, [2012-05-30T10:42:48.707986 #19664]  INFO -- : Begin applying migration version 2, direction: up
I, [2012-05-30T10:42:48.708192 #19664]  INFO -- : (0.000155s) BEGIN
I, [2012-05-30T10:42:48.713069 #19664]  INFO -- : (0.004487s) CREATE TABLE "nodes" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "environment" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" text, UNIQUE ("org_id", "name"))
I, [2012-05-30T10:42:48.713938 #19664]  INFO -- : (0.000680s) CREATE INDEX "nodes_org_id_index" ON "nodes" ("org_id")
I, [2012-05-30T10:42:48.714819 #19664]  INFO -- : (0.000764s) CREATE INDEX "nodes_org_id_environment_index" ON "nodes" ("org_id", "environment")
I, [2012-05-30T10:42:48.715497 #19664]  INFO -- : (0.000512s) UPDATE "schema_info" SET "version" = 2
I, [2012-05-30T10:42:48.716734 #19664]  INFO -- : (0.001162s) COMMIT
I, [2012-05-30T10:42:48.716794 #19664]  INFO -- : Finished applying migration version 2, direction: up, took 0.008803 seconds
I, [2012-05-30T10:42:48.716832 #19664]  INFO -- : Begin applying migration version 3, direction: up
I, [2012-05-30T10:42:48.716998 #19664]  INFO -- : (0.000113s) BEGIN
I, [2012-05-30T10:42:48.722090 #19664]  INFO -- : (0.004663s) CREATE TABLE "clients" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, "name" text NOT NULL, "public_key" text, "validator" boolean NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "pubkey_version" smallint NOT NULL, CONSTRAINT "org_id_name_unique" UNIQUE ("org_id", "name"))
I, [2012-05-30T10:42:48.723208 #19664]  INFO -- : (0.000922s) CREATE INDEX "clients_org_id_index" ON "clients" ("org_id")
I, [2012-05-30T10:42:48.723649 #19664]  INFO -- : (0.000233s) UPDATE "schema_info" SET "version" = 3
I, [2012-05-30T10:42:48.724280 #19664]  INFO -- : (0.000536s) COMMIT
I, [2012-05-30T10:42:48.724342 #19664]  INFO -- : Finished applying migration version 3, direction: up, took 0.007510 seconds
I, [2012-05-30T10:42:48.724379 #19664]  INFO -- : Begin applying migration version 4, direction: up
I, [2012-05-30T10:42:48.724587 #19664]  INFO -- : (0.000140s) BEGIN
I, [2012-05-30T10:42:48.729539 #19664]  INFO -- : (0.004541s) CREATE TABLE "roles" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-05-30T10:42:48.730653 #19664]  INFO -- : (0.000986s) CREATE INDEX "roles_org_id_index" ON "roles" ("org_id")
I, [2012-05-30T10:42:48.730859 #19664]  INFO -- : (0.000141s) ALTER TABLE roles ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-05-30T10:42:48.731206 #19664]  INFO -- : (0.000235s) UPDATE "schema_info" SET "version" = 4
I, [2012-05-30T10:42:48.732097 #19664]  INFO -- : (0.000828s) COMMIT
I, [2012-05-30T10:42:48.732152 #19664]  INFO -- : Finished applying migration version 4, direction: up, took 0.007770 seconds
I, [2012-05-30T10:42:48.732183 #19664]  INFO -- : Begin applying migration version 5, direction: up
I, [2012-05-30T10:42:48.732437 #19664]  INFO -- : (0.000199s) BEGIN
I, [2012-05-30T10:42:48.732862 #19664]  INFO -- : (0.000265s) ALTER TABLE "nodes" ADD COLUMN "last_audit_id" bytea
I, [2012-05-30T10:42:48.736258 #19664]  INFO -- : (0.003087s) CREATE TABLE "node_audit" ("audit_id" bytea NOT NULL, "node_id" char(32), "status" varchar(16), "start_time" timestamp NOT NULL, "end_time" timestamp NULL, "event_data" text NULL, PRIMARY KEY ("audit_id"), CONSTRAINT "node_id_fk" FOREIGN KEY ("node_id") REFERENCES "nodes")
I, [2012-05-30T10:42:48.737040 #19664]  INFO -- : (0.000622s) CREATE INDEX "node_audit_node_id_index" ON "node_audit" ("node_id")
I, [2012-05-30T10:42:48.740573 #19664]  INFO -- : (0.003109s) CREATE TABLE "node_audit_detail" ("audit_id" bytea NOT NULL, "seq" int NOT NULL, "duration" int NOT NULL, "res_id" varchar(255) NOT NULL, "res_type" varchar(16) NOT NULL, "res_name" varchar(255) NOT NULL, "res_result" varchar(16) NULL, "res_initial_state" text NULL, "res_final_state" text NULL, "delta" text NULL, PRIMARY KEY ("audit_id", "seq"), CONSTRAINT "audit_id_fk" FOREIGN KEY ("audit_id") REFERENCES "node_audit")
I, [2012-05-30T10:42:48.740993 #19664]  INFO -- : (0.000217s) UPDATE "schema_info" SET "version" = 5
I, [2012-05-30T10:42:48.741974 #19664]  INFO -- : (0.000884s) COMMIT
I, [2012-05-30T10:42:48.742053 #19664]  INFO -- : Finished applying migration version 5, direction: up, took 0.009863 seconds
I, [2012-05-30T10:42:48.742092 #19664]  INFO -- : Begin applying migration version 6, direction: up
I, [2012-05-30T10:42:48.742283 #19664]  INFO -- : (0.000136s) BEGIN
I, [2012-05-30T10:42:48.746762 #19664]  INFO -- : (0.004107s) CREATE TABLE "data_bags" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, UNIQUE ("org_id", "name"))
I, [2012-05-30T10:42:48.747798 #19664]  INFO -- : (0.000830s) CREATE INDEX "data_bags_org_id_index" ON "data_bags" ("org_id")
I, [2012-05-30T10:42:48.748203 #19664]  INFO -- : (0.000194s) UPDATE "schema_info" SET "version" = 6
I, [2012-05-30T10:42:48.748976 #19664]  INFO -- : (0.000708s) COMMIT
I, [2012-05-30T10:42:48.749040 #19664]  INFO -- : Finished applying migration version 6, direction: up, took 0.006944 seconds
I, [2012-05-30T10:42:48.749075 #19664]  INFO -- : Begin applying migration version 7, direction: up
I, [2012-05-30T10:42:48.749236 #19664]  INFO -- : (0.000108s) BEGIN
I, [2012-05-30T10:42:48.752850 #19664]  INFO -- : (0.003230s) CREATE TABLE "data_bag_items" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "data_bag_name" text NOT NULL, "item_name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "data_bag_name", "item_name"))
I, [2012-05-30T10:42:48.753774 #19664]  INFO -- : (0.000740s) CREATE INDEX "data_bag_items_org_id_index" ON "data_bag_items" ("org_id")
I, [2012-05-30T10:42:48.754084 #19664]  INFO -- : (0.000233s) ALTER TABLE data_bag_items ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-05-30T10:42:48.754438 #19664]  INFO -- : (0.000206s) UPDATE "schema_info" SET "version" = 7
I, [2012-05-30T10:42:48.755917 #19664]  INFO -- : (0.001380s) COMMIT
I, [2012-05-30T10:42:48.756012 #19664]  INFO -- : Finished applying migration version 7, direction: up, took 0.006931 seconds
I, [2012-05-30T10:42:48.756067 #19664]  INFO -- : Begin applying migration version 8, direction: up
I, [2012-05-30T10:42:48.756360 #19664]  INFO -- : (0.000184s) BEGIN
I, [2012-05-30T10:42:48.761050 #19664]  INFO -- : (0.004164s) CREATE TABLE "environments" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-05-30T10:42:48.761862 #19664]  INFO -- : (0.000670s) CREATE INDEX "environments_org_id_index" ON "environments" ("org_id")
I, [2012-05-30T10:42:48.762035 #19664]  INFO -- : (0.000117s) ALTER TABLE environments ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-05-30T10:42:48.762335 #19664]  INFO -- : (0.000182s) UPDATE "schema_info" SET "version" = 8
I, [2012-05-30T10:42:48.763300 #19664]  INFO -- : (0.000900s) COMMIT
I, [2012-05-30T10:42:48.763360 #19664]  INFO -- : Finished applying migration version 8, direction: up, took 0.007293 seconds
I, [2012-05-30T10:42:48.763395 #19664]  INFO -- : Begin applying migration version 9, direction: up
I, [2012-05-30T10:42:48.763681 #19664]  INFO -- : (0.000229s) BEGIN
I, [2012-05-30T10:42:48.765314 #19664]  INFO -- : (0.001438s) ALTER TABLE "data_bag_items" ADD FOREIGN KEY ("org_id", "data_bag_name") REFERENCES "data_bags"("org_id", "name") ON DELETE CASCADE ON UPDATE CASCADE
I, [2012-05-30T10:42:48.765691 #19664]  INFO -- : (0.000256s) UPDATE "schema_info" SET "version" = 9
I, [2012-05-30T10:42:48.766358 #19664]  INFO -- : (0.000599s) COMMIT
I, [2012-05-30T10:42:48.766414 #19664]  INFO -- : Finished applying migration version 9, direction: up, took 0.003015 seconds
I, [2012-05-30T10:42:48.766460 #19664]  INFO -- : Begin applying migration version 10, direction: up
I, [2012-05-30T10:42:48.766747 #19664]  INFO -- : (0.000234s) BEGIN
I, [2012-05-30T10:42:48.767208 #19664]  INFO -- : (0.000327s) DROP INDEX "clients_org_id_index"
I, [2012-05-30T10:42:48.767475 #19664]  INFO -- : (0.000166s) DROP INDEX "environments_org_id_index"
I, [2012-05-30T10:42:48.767736 #19664]  INFO -- : (0.000163s) DROP INDEX "nodes_org_id_index"
I, [2012-05-30T10:42:48.767985 #19664]  INFO -- : (0.000155s) DROP INDEX "roles_org_id_index"
I, [2012-05-30T10:42:48.768249 #19664]  INFO -- : (0.000165s) DROP INDEX "data_bags_org_id_index"
I, [2012-05-30T10:42:48.768648 #19664]  INFO -- : (0.000254s) DROP INDEX "data_bag_items_org_id_index"
I, [2012-05-30T10:42:48.769326 #19664]  INFO -- : (0.000498s) UPDATE "schema_info" SET "version" = 10
I, [2012-05-30T10:42:48.770758 #19664]  INFO -- : (0.001336s) COMMIT
I, [2012-05-30T10:42:48.770832 #19664]  INFO -- : Finished applying migration version 10, direction: up, took 0.004374 seconds
I, [2012-05-30T10:42:48.770868 #19664]  INFO -- : Begin applying migration version 11, direction: up
I, [2012-05-30T10:42:48.771017 #19664]  INFO -- : (0.000090s) BEGIN
I, [2012-05-30T10:42:48.771527 #19664]  INFO -- : (0.000257s) ALTER TABLE "users" ADD COLUMN "external_authentication_uid" text NULL
I, [2012-05-30T10:42:48.771847 #19664]  INFO -- : (0.000263s) ALTER TABLE "users" ADD COLUMN "recovery_authentication_enabled" boolean NULL
I, [2012-05-30T10:42:48.772101 #19664]  INFO -- : (0.000192s) ALTER TABLE "users" ALTER COLUMN "email" DROP NOT NULL
I, [2012-05-30T10:42:48.772408 #19664]  INFO -- : (0.000178s) UPDATE "schema_info" SET "version" = 11
I, [2012-05-30T10:42:48.772884 #19664]  INFO -- : (0.000418s) COMMIT
I, [2012-05-30T10:42:48.772938 #19664]  INFO -- : Finished applying migration version 11, direction: up, took 0.002067 seconds
I, [2012-05-30T10:42:48.772972 #19664]  INFO -- : Begin applying migration version 12, direction: up
I, [2012-05-30T10:42:48.773128 #19664]  INFO -- : (0.000104s) BEGIN
I, [2012-05-30T10:42:48.778450 #19664]  INFO -- : (0.004971s) CREATE TABLE "opc_customers" ("id" serial PRIMARY KEY, "name" text NOT NULL UNIQUE, "display_name" text NOT NULL, "domain" text NOT NULL UNIQUE, "contact" text NOT NULL, "priority" integer DEFAULT 0 NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-05-30T10:42:48.781234 #19664]  INFO -- : (0.002315s) CREATE TABLE "opc_users" ("user_id" char(32) NOT NULL, "customer_id" integer REFERENCES "opc_customers" ON DELETE CASCADE, FOREIGN KEY ("user_id") REFERENCES "users" ON DELETE CASCADE, UNIQUE ("user_id", "customer_id"))
I, [2012-05-30T10:42:48.781572 #19664]  INFO -- : (0.000172s) UPDATE "schema_info" SET "version" = 12
I, [2012-05-30T10:42:48.782476 #19664]  INFO -- : (0.000827s) COMMIT
I, [2012-05-30T10:42:48.782571 #19664]  INFO -- : Finished applying migration version 12, direction: up, took 0.009588 seconds
I, [2012-05-30T10:42:48.782632 #19664]  INFO -- : Begin applying migration version 13, direction: up
I, [2012-05-30T10:42:48.782938 #19664]  INFO -- : (0.000222s) BEGIN
I, [2012-05-30T10:42:48.784782 #19664]  INFO -- : (0.001619s) CREATE TABLE "checksums" ("org_id" char(32) NOT NULL, "checksum" char(32) NOT NULL, PRIMARY KEY ("org_id", "checksum"))
I, [2012-05-30T10:42:48.786172 #19664]  INFO -- : (0.001132s) CREATE TABLE "sandboxed_checksums" ("org_id" char(32), "sandbox_id" char(32), "checksum" char(32), "created_at" timestamp NOT NULL, PRIMARY KEY ("sandbox_id", "org_id", "checksum"))
I, [2012-05-30T10:42:48.786486 #19664]  INFO -- : (0.000184s) UPDATE "schema_info" SET "version" = 13
I, [2012-05-30T10:42:48.786994 #19664]  INFO -- : (0.000453s) COMMIT
I, [2012-05-30T10:42:48.787043 #19664]  INFO -- : Finished applying migration version 13, direction: up, took 0.004414 seconds
I, [2012-05-30T10:42:48.787076 #19664]  INFO -- : Begin applying migration version 14, direction: up
I, [2012-05-30T10:42:48.787239 #19664]  INFO -- : (0.000115s) BEGIN
I, [2012-05-30T10:42:48.792890 #19664]  INFO -- : (0.005382s) CREATE TABLE "cookbooks" ("id" serial PRIMARY KEY, "org_id" char(32) NOT NULL, "name" text NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, UNIQUE ("org_id", "name"))
I, [2012-05-30T10:42:48.793811 #19664]  INFO -- : (0.000690s) CREATE INDEX "cookbooks_org_id_index" ON "cookbooks" ("org_id")
I, [2012-05-30T10:42:48.800193 #19664]  INFO -- : (0.005688s) CREATE TABLE "cookbook_versions" ("id" char(32) PRIMARY KEY, "major" integer NOT NULL, "minor" integer NOT NULL, "patch" integer NOT NULL, "frozen" Boolean NOT NULL, "meta_attributes" bytea NOT NULL, "meta_deps" text NOT NULL, "meta_long_desc" bytea NOT NULL, "metadata" bytea NOT NULL, "serialized_object" bytea NOT NULL, "updated_at" timestamp NOT NULL, "created_at" timestamp NOT NULL, "last_updated_by" char(32) NOT NULL, "cookbook_id" integer REFERENCES "cookbooks" ON DELETE RESTRICT, UNIQUE ("cookbook_id", "major", "minor", "patch"))
I, [2012-05-30T10:42:48.800426 #19664]  INFO -- : (0.000148s) ALTER TABLE cookbook_versions ALTER meta_attributes SET STORAGE EXTERNAL
I, [2012-05-30T10:42:48.800592 #19664]  INFO -- : (0.000114s) ALTER TABLE cookbook_versions ALTER meta_long_desc SET STORAGE EXTERNAL
I, [2012-05-30T10:42:48.800752 #19664]  INFO -- : (0.000111s) ALTER TABLE cookbook_versions ALTER metadata SET STORAGE EXTERNAL
I, [2012-05-30T10:42:48.800920 #19664]  INFO -- : (0.000119s) ALTER TABLE cookbook_versions ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-05-30T10:42:48.803283 #19664]  INFO -- : (0.002052s) CREATE TABLE "cookbook_version_checksums" ("cookbook_version_id" char(32), "org_id" char(32) NOT NULL, "checksum" char(32) NOT NULL, FOREIGN KEY ("cookbook_version_id") REFERENCES "cookbook_versions"("id"), FOREIGN KEY ("org_id", "checksum") REFERENCES "checksums"("org_id", "checksum") ON DELETE CASCADE ON UPDATE CASCADE)
I, [2012-05-30T10:42:48.803604 #19664]  INFO -- : (0.000190s) UPDATE "schema_info" SET "version" = 14
I, [2012-05-30T10:42:48.804626 #19664]  INFO -- : (0.000955s) COMMIT
I, [2012-05-30T10:42:48.804719 #19664]  INFO -- : Finished applying migration version 14, direction: up, took 0.017634 seconds
I, [2012-06-25T15:46:58.916509 #4649]  INFO -- : (0.000368s) SET standard_conforming_strings = ON
I, [2012-06-25T15:46:58.959158 #4649]  INFO -- : (0.000193s) SET client_min_messages = 'WARNING'
I, [2012-06-25T15:46:58.959933 #4649]  INFO -- : (0.000128s) SET DateStyle = 'ISO'
E, [2012-06-25T15:46:59.043439 #4649] ERROR -- : PG::Error: ERROR:  relation "schema_info" does not exist
LINE 1: SELECT NULL FROM "schema_info" LIMIT 1
                         ^: SELECT NULL FROM "schema_info" LIMIT 1
I, [2012-06-25T15:46:59.049155 #4649]  INFO -- : (0.005370s) CREATE TABLE "schema_info" ("version" integer DEFAULT 0 NOT NULL)
I, [2012-06-25T15:46:59.071174 #4649]  INFO -- : (0.021780s) SELECT 1 AS "one" FROM "schema_info" LIMIT 1
I, [2012-06-25T15:46:59.073287 #4649]  INFO -- : (0.001835s) SELECT pg_attribute.attname FROM pg_class, pg_attribute, pg_index, pg_namespace WHERE pg_class.oid = pg_attribute.attrelid AND pg_class.relnamespace = pg_namespace.oid AND pg_class.oid = pg_index.indrelid AND pg_index.indkey[0] = pg_attribute.attnum AND pg_index.indisprimary = 't' AND pg_class.relname = 'schema_info'
I, [2012-06-25T15:46:59.074176 #4649]  INFO -- : (0.000683s) INSERT INTO "schema_info" ("version") VALUES (0) RETURNING NULL
I, [2012-06-25T15:46:59.074775 #4649]  INFO -- : (0.000375s) SELECT COUNT(*) AS "count" FROM "schema_info" LIMIT 1
I, [2012-06-25T15:46:59.075143 #4649]  INFO -- : (0.000191s) SELECT "version" FROM "schema_info" LIMIT 1
I, [2012-06-25T15:46:59.082631 #4649]  INFO -- : Begin applying migration version 1, direction: up
I, [2012-06-25T15:46:59.083075 #4649]  INFO -- : (0.000340s) BEGIN
I, [2012-06-25T15:46:59.088810 #4649]  INFO -- : (0.005318s) CREATE TABLE "users" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "username" text NOT NULL UNIQUE, "email" text NOT NULL UNIQUE, "pubkey_version" integer NOT NULL, "public_key" text, "serialized_object" text, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-06-25T15:46:59.089167 #4649]  INFO -- : (0.000177s) UPDATE "schema_info" SET "version" = 1
I, [2012-06-25T15:46:59.090110 #4649]  INFO -- : (0.000889s) COMMIT
I, [2012-06-25T15:46:59.090168 #4649]  INFO -- : Finished applying migration version 1, direction: up, took 0.007539 seconds
I, [2012-06-25T15:46:59.090204 #4649]  INFO -- : Begin applying migration version 2, direction: up
I, [2012-06-25T15:46:59.090454 #4649]  INFO -- : (0.000197s) BEGIN
I, [2012-06-25T15:46:59.094748 #4649]  INFO -- : (0.003904s) CREATE TABLE "nodes" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "environment" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" text, UNIQUE ("org_id", "name"))
I, [2012-06-25T15:46:59.095775 #4649]  INFO -- : (0.000868s) CREATE INDEX "nodes_org_id_index" ON "nodes" ("org_id")
I, [2012-06-25T15:46:59.096837 #4649]  INFO -- : (0.000947s) CREATE INDEX "nodes_org_id_environment_index" ON "nodes" ("org_id", "environment")
I, [2012-06-25T15:46:59.097167 #4649]  INFO -- : (0.000194s) UPDATE "schema_info" SET "version" = 2
I, [2012-06-25T15:46:59.098137 #4649]  INFO -- : (0.000911s) COMMIT
I, [2012-06-25T15:46:59.098200 #4649]  INFO -- : Finished applying migration version 2, direction: up, took 0.007991 seconds
I, [2012-06-25T15:46:59.098233 #4649]  INFO -- : Begin applying migration version 3, direction: up
I, [2012-06-25T15:46:59.098440 #4649]  INFO -- : (0.000151s) BEGIN
I, [2012-06-25T15:46:59.102428 #4649]  INFO -- : (0.003606s) CREATE TABLE "clients" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, "name" text NOT NULL, "public_key" text, "validator" boolean NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "pubkey_version" smallint NOT NULL, CONSTRAINT "org_id_name_unique" UNIQUE ("org_id", "name"))
I, [2012-06-25T15:46:59.103223 #4649]  INFO -- : (0.000673s) CREATE INDEX "clients_org_id_index" ON "clients" ("org_id")
I, [2012-06-25T15:46:59.103506 #4649]  INFO -- : (0.000175s) UPDATE "schema_info" SET "version" = 3
I, [2012-06-25T15:46:59.104076 #4649]  INFO -- : (0.000509s) COMMIT
I, [2012-06-25T15:46:59.104128 #4649]  INFO -- : Finished applying migration version 3, direction: up, took 0.005892 seconds
I, [2012-06-25T15:46:59.104172 #4649]  INFO -- : Begin applying migration version 4, direction: up
I, [2012-06-25T15:46:59.104327 #4649]  INFO -- : (0.000100s) BEGIN
I, [2012-06-25T15:46:59.108585 #4649]  INFO -- : (0.003931s) CREATE TABLE "roles" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-06-25T15:46:59.109512 #4649]  INFO -- : (0.000825s) CREATE INDEX "roles_org_id_index" ON "roles" ("org_id")
I, [2012-06-25T15:46:59.109796 #4649]  INFO -- : (0.000225s) ALTER TABLE roles ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-06-25T15:46:59.110070 #4649]  INFO -- : (0.000162s) UPDATE "schema_info" SET "version" = 4
I, [2012-06-25T15:46:59.111049 #4649]  INFO -- : (0.000917s) COMMIT
I, [2012-06-25T15:46:59.111107 #4649]  INFO -- : Finished applying migration version 4, direction: up, took 0.006932 seconds
I, [2012-06-25T15:46:59.111140 #4649]  INFO -- : Begin applying migration version 5, direction: up
I, [2012-06-25T15:46:59.111337 #4649]  INFO -- : (0.000144s) BEGIN
I, [2012-06-25T15:46:59.111676 #4649]  INFO -- : (0.000179s) ALTER TABLE "nodes" ADD COLUMN "last_audit_id" bytea
I, [2012-06-25T15:46:59.115478 #4649]  INFO -- : (0.003484s) CREATE TABLE "node_audit" ("audit_id" bytea NOT NULL, "node_id" char(32), "status" varchar(16), "start_time" timestamp NOT NULL, "end_time" timestamp NULL, "event_data" text NULL, PRIMARY KEY ("audit_id"), CONSTRAINT "node_id_fk" FOREIGN KEY ("node_id") REFERENCES "nodes")
I, [2012-06-25T15:46:59.116403 #4649]  INFO -- : (0.000749s) CREATE INDEX "node_audit_node_id_index" ON "node_audit" ("node_id")
I, [2012-06-25T15:46:59.119921 #4649]  INFO -- : (0.003075s) CREATE TABLE "node_audit_detail" ("audit_id" bytea NOT NULL, "seq" int NOT NULL, "duration" int NOT NULL, "res_id" varchar(255) NOT NULL, "res_type" varchar(16) NOT NULL, "res_name" varchar(255) NOT NULL, "res_result" varchar(16) NULL, "res_initial_state" text NULL, "res_final_state" text NULL, "delta" text NULL, PRIMARY KEY ("audit_id", "seq"), CONSTRAINT "audit_id_fk" FOREIGN KEY ("audit_id") REFERENCES "node_audit")
I, [2012-06-25T15:46:59.120343 #4649]  INFO -- : (0.000286s) UPDATE "schema_info" SET "version" = 5
I, [2012-06-25T15:46:59.121499 #4649]  INFO -- : (0.001096s) COMMIT
I, [2012-06-25T15:46:59.121562 #4649]  INFO -- : Finished applying migration version 5, direction: up, took 0.010410 seconds
I, [2012-06-25T15:46:59.121594 #4649]  INFO -- : Begin applying migration version 6, direction: up
I, [2012-06-25T15:46:59.121751 #4649]  INFO -- : (0.000110s) BEGIN
I, [2012-06-25T15:46:59.125211 #4649]  INFO -- : (0.003160s) CREATE TABLE "data_bags" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, UNIQUE ("org_id", "name"))
I, [2012-06-25T15:46:59.126075 #4649]  INFO -- : (0.000720s) CREATE INDEX "data_bags_org_id_index" ON "data_bags" ("org_id")
I, [2012-06-25T15:46:59.126461 #4649]  INFO -- : (0.000193s) UPDATE "schema_info" SET "version" = 6
I, [2012-06-25T15:46:59.127120 #4649]  INFO -- : (0.000584s) COMMIT
I, [2012-06-25T15:46:59.127184 #4649]  INFO -- : Finished applying migration version 6, direction: up, took 0.005585 seconds
I, [2012-06-25T15:46:59.127219 #4649]  INFO -- : Begin applying migration version 7, direction: up
I, [2012-06-25T15:46:59.127424 #4649]  INFO -- : (0.000152s) BEGIN
I, [2012-06-25T15:46:59.131462 #4649]  INFO -- : (0.003666s) CREATE TABLE "data_bag_items" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "data_bag_name" text NOT NULL, "item_name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "data_bag_name", "item_name"))
I, [2012-06-25T15:46:59.132317 #4649]  INFO -- : (0.000678s) CREATE INDEX "data_bag_items_org_id_index" ON "data_bag_items" ("org_id")
I, [2012-06-25T15:46:59.132506 #4649]  INFO -- : (0.000133s) ALTER TABLE data_bag_items ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-06-25T15:46:59.132783 #4649]  INFO -- : (0.000144s) UPDATE "schema_info" SET "version" = 7
I, [2012-06-25T15:46:59.133402 #4649]  INFO -- : (0.000568s) COMMIT
I, [2012-06-25T15:46:59.133451 #4649]  INFO -- : Finished applying migration version 7, direction: up, took 0.006229 seconds
I, [2012-06-25T15:46:59.133482 #4649]  INFO -- : Begin applying migration version 8, direction: up
I, [2012-06-25T15:46:59.133731 #4649]  INFO -- : (0.000201s) BEGIN
I, [2012-06-25T15:46:59.138505 #4649]  INFO -- : (0.004417s) CREATE TABLE "environments" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-06-25T15:46:59.139567 #4649]  INFO -- : (0.000903s) CREATE INDEX "environments_org_id_index" ON "environments" ("org_id")
I, [2012-06-25T15:46:59.139806 #4649]  INFO -- : (0.000163s) ALTER TABLE environments ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-06-25T15:46:59.140049 #4649]  INFO -- : (0.000133s) UPDATE "schema_info" SET "version" = 8
I, [2012-06-25T15:46:59.140810 #4649]  INFO -- : (0.000708s) COMMIT
I, [2012-06-25T15:46:59.140872 #4649]  INFO -- : Finished applying migration version 8, direction: up, took 0.007385 seconds
I, [2012-06-25T15:46:59.140907 #4649]  INFO -- : Begin applying migration version 9, direction: up
I, [2012-06-25T15:46:59.141066 #4649]  INFO -- : (0.000106s) BEGIN
I, [2012-06-25T15:46:59.142692 #4649]  INFO -- : (0.001437s) ALTER TABLE "data_bag_items" ADD FOREIGN KEY ("org_id", "data_bag_name") REFERENCES "data_bags"("org_id", "name") ON DELETE CASCADE ON UPDATE CASCADE
I, [2012-06-25T15:46:59.142974 #4649]  INFO -- : (0.000157s) UPDATE "schema_info" SET "version" = 9
I, [2012-06-25T15:46:59.143662 #4649]  INFO -- : (0.000630s) COMMIT
I, [2012-06-25T15:46:59.143720 #4649]  INFO -- : Finished applying migration version 9, direction: up, took 0.002809 seconds
I, [2012-06-25T15:46:59.143760 #4649]  INFO -- : Begin applying migration version 10, direction: up
I, [2012-06-25T15:46:59.143939 #4649]  INFO -- : (0.000125s) BEGIN
I, [2012-06-25T15:46:59.144385 #4649]  INFO -- : (0.000326s) DROP INDEX "clients_org_id_index"
I, [2012-06-25T15:46:59.144647 #4649]  INFO -- : (0.000164s) DROP INDEX "environments_org_id_index"
I, [2012-06-25T15:46:59.144893 #4649]  INFO -- : (0.000157s) DROP INDEX "nodes_org_id_index"
I, [2012-06-25T15:46:59.145219 #4649]  INFO -- : (0.000235s) DROP INDEX "roles_org_id_index"
I, [2012-06-25T15:46:59.145517 #4649]  INFO -- : (0.000163s) DROP INDEX "data_bags_org_id_index"
I, [2012-06-25T15:46:59.145783 #4649]  INFO -- : (0.000173s) DROP INDEX "data_bag_items_org_id_index"
I, [2012-06-25T15:46:59.145999 #4649]  INFO -- : (0.000121s) UPDATE "schema_info" SET "version" = 10
I, [2012-06-25T15:46:59.146915 #4649]  INFO -- : (0.000857s) COMMIT
I, [2012-06-25T15:46:59.146974 #4649]  INFO -- : Finished applying migration version 10, direction: up, took 0.003217 seconds
I, [2012-06-25T15:46:59.147013 #4649]  INFO -- : Begin applying migration version 11, direction: up
I, [2012-06-25T15:46:59.147246 #4649]  INFO -- : (0.000175s) BEGIN
I, [2012-06-25T15:46:59.147675 #4649]  INFO -- : (0.000218s) ALTER TABLE "users" ADD COLUMN "external_authentication_uid" text NULL
I, [2012-06-25T15:46:59.147899 #4649]  INFO -- : (0.000167s) ALTER TABLE "users" ADD COLUMN "recovery_authentication_enabled" boolean NULL
I, [2012-06-25T15:46:59.148104 #4649]  INFO -- : (0.000153s) ALTER TABLE "users" ALTER COLUMN "email" DROP NOT NULL
I, [2012-06-25T15:46:59.148439 #4649]  INFO -- : (0.000221s) UPDATE "schema_info" SET "version" = 11
I, [2012-06-25T15:46:59.148917 #4649]  INFO -- : (0.000419s) COMMIT
I, [2012-06-25T15:46:59.148981 #4649]  INFO -- : Finished applying migration version 11, direction: up, took 0.001963 seconds
I, [2012-06-25T15:46:59.149015 #4649]  INFO -- : Begin applying migration version 12, direction: up
I, [2012-06-25T15:46:59.149157 #4649]  INFO -- : (0.000094s) BEGIN
I, [2012-06-25T15:46:59.153963 #4649]  INFO -- : (0.004467s) CREATE TABLE "opc_customers" ("id" serial PRIMARY KEY, "name" text NOT NULL UNIQUE, "display_name" text NOT NULL, "domain" text NOT NULL UNIQUE, "contact" text NOT NULL, "priority" integer DEFAULT 0 NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-06-25T15:46:59.156535 #4649]  INFO -- : (0.002217s) CREATE TABLE "opc_users" ("user_id" char(32) NOT NULL, "customer_id" integer REFERENCES "opc_customers" ON DELETE CASCADE, FOREIGN KEY ("user_id") REFERENCES "users" ON DELETE CASCADE, UNIQUE ("user_id", "customer_id"))
I, [2012-06-25T15:46:59.156915 #4649]  INFO -- : (0.000194s) UPDATE "schema_info" SET "version" = 12
I, [2012-06-25T15:46:59.158047 #4649]  INFO -- : (0.001064s) COMMIT
I, [2012-06-25T15:46:59.158136 #4649]  INFO -- : Finished applying migration version 12, direction: up, took 0.009113 seconds
I, [2012-06-25T15:46:59.158189 #4649]  INFO -- : Begin applying migration version 13, direction: up
I, [2012-06-25T15:46:59.158499 #4649]  INFO -- : (0.000226s) BEGIN
I, [2012-06-25T15:46:59.160492 #4649]  INFO -- : (0.001740s) CREATE TABLE "checksums" ("org_id" char(32) NOT NULL, "checksum" char(32) NOT NULL, PRIMARY KEY ("org_id", "checksum"))
I, [2012-06-25T15:46:59.162962 #4649]  INFO -- : (0.002001s) CREATE TABLE "sandboxed_checksums" ("org_id" char(32), "sandbox_id" char(32), "checksum" char(32), "created_at" timestamp NOT NULL, PRIMARY KEY ("sandbox_id", "org_id", "checksum"))
I, [2012-06-25T15:46:59.163320 #4649]  INFO -- : (0.000202s) UPDATE "schema_info" SET "version" = 13
I, [2012-06-25T15:46:59.163920 #4649]  INFO -- : (0.000537s) COMMIT
I, [2012-06-25T15:46:59.163981 #4649]  INFO -- : Finished applying migration version 13, direction: up, took 0.005793 seconds
I, [2012-06-25T15:46:59.164016 #4649]  INFO -- : Begin applying migration version 14, direction: up
I, [2012-06-25T15:46:59.164220 #4649]  INFO -- : (0.000143s) BEGIN
I, [2012-06-25T15:46:59.169294 #4649]  INFO -- : (0.004768s) CREATE TABLE "cookbooks" ("id" serial PRIMARY KEY, "org_id" char(32) NOT NULL, "name" text NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, UNIQUE ("org_id", "name"))
I, [2012-06-25T15:46:59.170229 #4649]  INFO -- : (0.000752s) CREATE INDEX "cookbooks_org_id_index" ON "cookbooks" ("org_id")
I, [2012-06-25T15:46:59.175749 #4649]  INFO -- : (0.004766s) CREATE TABLE "cookbook_versions" ("id" char(32) PRIMARY KEY, "major" integer NOT NULL, "minor" integer NOT NULL, "patch" integer NOT NULL, "frozen" Boolean NOT NULL, "meta_attributes" bytea NOT NULL, "meta_deps" text NOT NULL, "meta_long_desc" bytea NOT NULL, "metadata" bytea NOT NULL, "serialized_object" bytea NOT NULL, "updated_at" timestamp NOT NULL, "created_at" timestamp NOT NULL, "last_updated_by" char(32) NOT NULL, "cookbook_id" integer REFERENCES "cookbooks" ON DELETE RESTRICT, UNIQUE ("cookbook_id", "major", "minor", "patch"))
I, [2012-06-25T15:46:59.176143 #4649]  INFO -- : (0.000272s) ALTER TABLE cookbook_versions ALTER meta_attributes SET STORAGE EXTERNAL
I, [2012-06-25T15:46:59.176449 #4649]  INFO -- : (0.000226s) ALTER TABLE cookbook_versions ALTER meta_long_desc SET STORAGE EXTERNAL
I, [2012-06-25T15:46:59.176678 #4649]  INFO -- : (0.000170s) ALTER TABLE cookbook_versions ALTER metadata SET STORAGE EXTERNAL
I, [2012-06-25T15:46:59.176897 #4649]  INFO -- : (0.000159s) ALTER TABLE cookbook_versions ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-06-25T15:46:59.179141 #4649]  INFO -- : (0.001919s) CREATE TABLE "cookbook_version_checksums" ("cookbook_version_id" char(32), "org_id" char(32) NOT NULL, "checksum" char(32) NOT NULL, FOREIGN KEY ("cookbook_version_id") REFERENCES "cookbook_versions"("id"), FOREIGN KEY ("org_id", "checksum") REFERENCES "checksums"("org_id", "checksum") ON DELETE CASCADE ON UPDATE CASCADE)
I, [2012-06-25T15:46:59.179497 #4649]  INFO -- : (0.000195s) UPDATE "schema_info" SET "version" = 14
I, [2012-06-25T15:46:59.180545 #4649]  INFO -- : (0.000984s) COMMIT
I, [2012-06-25T15:46:59.180609 #4649]  INFO -- : Finished applying migration version 14, direction: up, took 0.016588 seconds
I, [2012-06-25T15:46:59.180644 #4649]  INFO -- : Begin applying migration version 15, direction: up
I, [2012-06-25T15:46:59.180978 #4649]  INFO -- : (0.000277s) BEGIN
I, [2012-06-25T15:46:59.181419 #4649]  INFO -- : (0.000314s) ALTER TABLE "cookbook_versions" ALTER COLUMN "cookbook_id" SET NOT NULL
I, [2012-06-25T15:46:59.181889 #4649]  INFO -- : (0.000303s) ALTER TABLE "cookbook_version_checksums" ALTER COLUMN "cookbook_version_id" SET NOT NULL
I, [2012-06-25T15:46:59.182226 #4649]  INFO -- : (0.000182s) UPDATE "schema_info" SET "version" = 15
I, [2012-06-25T15:46:59.182785 #4649]  INFO -- : (0.000478s) COMMIT
I, [2012-06-25T15:46:59.182858 #4649]  INFO -- : Finished applying migration version 15, direction: up, took 0.002209 seconds
I, [2012-06-25T15:46:59.182894 #4649]  INFO -- : Begin applying migration version 16, direction: up
I, [2012-06-25T15:46:59.183095 #4649]  INFO -- : (0.000137s) BEGIN
I, [2012-06-25T15:46:59.184960 #4649]  INFO -- : (0.001788s) CREATE OR REPLACE VIEW cookbook_versions_by_rank(
    -- Cookbook Version fields
    major, -- these 3 are needed for version information (duh)
    minor,
    patch,
    serialized_object, -- needed to access recipe manifest

    -- Cookbook fields
    org_id, -- used for filtering
    name, -- both version and recipe queries require the cookbook name

    -- View-specific fields
    -- (also used for filtering)
    rank) AS
SELECT v.major,
       v.minor,
       v.patch,
       v.serialized_object,
       c.org_id,
       c.name,
       rank() OVER (PARTITION BY v.cookbook_id
                    ORDER BY v.major DESC, v.minor DESC, v.patch DESC)
FROM cookbooks AS c
JOIN cookbook_versions AS v
  ON c.id = v.cookbook_id;

I, [2012-06-25T15:46:59.185346 #4649]  INFO -- : (0.000204s) UPDATE "schema_info" SET "version" = 16
I, [2012-06-25T15:46:59.185944 #4649]  INFO -- : (0.000529s) COMMIT
I, [2012-06-25T15:46:59.186031 #4649]  INFO -- : Finished applying migration version 16, direction: up, took 0.003129 seconds
I, [2012-06-25T15:51:13.108947 #5271]  INFO -- : (0.000369s) SET standard_conforming_strings = ON
I, [2012-06-25T15:51:13.109196 #5271]  INFO -- : (0.000115s) SET client_min_messages = 'WARNING'
I, [2012-06-25T15:51:13.109343 #5271]  INFO -- : (0.000098s) SET DateStyle = 'ISO'
E, [2012-06-25T15:51:13.116940 #5271] ERROR -- : PG::Error: ERROR:  relation "schema_info" does not exist
LINE 1: SELECT NULL FROM "schema_info" LIMIT 1
                         ^: SELECT NULL FROM "schema_info" LIMIT 1
I, [2012-06-25T15:51:13.137901 #5271]  INFO -- : (0.020696s) CREATE TABLE "schema_info" ("version" integer DEFAULT 0 NOT NULL)
I, [2012-06-25T15:51:13.138644 #5271]  INFO -- : (0.000520s) SELECT 1 AS "one" FROM "schema_info" LIMIT 1
I, [2012-06-25T15:51:13.140733 #5271]  INFO -- : (0.001890s) SELECT pg_attribute.attname FROM pg_class, pg_attribute, pg_index, pg_namespace WHERE pg_class.oid = pg_attribute.attrelid AND pg_class.relnamespace = pg_namespace.oid AND pg_class.oid = pg_index.indrelid AND pg_index.indkey[0] = pg_attribute.attnum AND pg_index.indisprimary = 't' AND pg_class.relname = 'schema_info'
I, [2012-06-25T15:51:13.141774 #5271]  INFO -- : (0.000866s) INSERT INTO "schema_info" ("version") VALUES (0) RETURNING NULL
I, [2012-06-25T15:51:13.142338 #5271]  INFO -- : (0.000358s) SELECT COUNT(*) AS "count" FROM "schema_info" LIMIT 1
I, [2012-06-25T15:51:13.142633 #5271]  INFO -- : (0.000132s) SELECT "version" FROM "schema_info" LIMIT 1
I, [2012-06-25T15:51:13.150234 #5271]  INFO -- : Begin applying migration version 1, direction: up
I, [2012-06-25T15:51:13.150752 #5271]  INFO -- : (0.000415s) BEGIN
I, [2012-06-25T15:51:13.156679 #5271]  INFO -- : (0.005525s) CREATE TABLE "users" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "username" text NOT NULL UNIQUE, "email" text NOT NULL UNIQUE, "pubkey_version" integer NOT NULL, "public_key" text, "serialized_object" text, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-06-25T15:51:13.157153 #5271]  INFO -- : (0.000307s) UPDATE "schema_info" SET "version" = 1
I, [2012-06-25T15:51:13.159320 #5271]  INFO -- : (0.002088s) COMMIT
I, [2012-06-25T15:51:13.159429 #5271]  INFO -- : Finished applying migration version 1, direction: up, took 0.009194 seconds
I, [2012-06-25T15:51:13.159465 #5271]  INFO -- : Begin applying migration version 2, direction: up
I, [2012-06-25T15:51:13.159663 #5271]  INFO -- : (0.000135s) BEGIN
I, [2012-06-25T15:51:13.163922 #5271]  INFO -- : (0.003843s) CREATE TABLE "nodes" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "environment" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" text, UNIQUE ("org_id", "name"))
I, [2012-06-25T15:51:13.164924 #5271]  INFO -- : (0.000769s) CREATE INDEX "nodes_org_id_index" ON "nodes" ("org_id")
I, [2012-06-25T15:51:13.165900 #5271]  INFO -- : (0.000752s) CREATE INDEX "nodes_org_id_environment_index" ON "nodes" ("org_id", "environment")
I, [2012-06-25T15:51:13.166186 #5271]  INFO -- : (0.000155s) UPDATE "schema_info" SET "version" = 2
I, [2012-06-25T15:51:13.166909 #5271]  INFO -- : (0.000666s) COMMIT
I, [2012-06-25T15:51:13.166971 #5271]  INFO -- : Finished applying migration version 2, direction: up, took 0.007503 seconds
I, [2012-06-25T15:51:13.167005 #5271]  INFO -- : Begin applying migration version 3, direction: up
I, [2012-06-25T15:51:13.167171 #5271]  INFO -- : (0.000115s) BEGIN
I, [2012-06-25T15:51:13.172376 #5271]  INFO -- : (0.004794s) CREATE TABLE "clients" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, "name" text NOT NULL, "public_key" text, "validator" boolean NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "pubkey_version" smallint NOT NULL, CONSTRAINT "org_id_name_unique" UNIQUE ("org_id", "name"))
I, [2012-06-25T15:51:13.173474 #5271]  INFO -- : (0.000873s) CREATE INDEX "clients_org_id_index" ON "clients" ("org_id")
I, [2012-06-25T15:51:13.173851 #5271]  INFO -- : (0.000225s) UPDATE "schema_info" SET "version" = 3
I, [2012-06-25T15:51:13.174589 #5271]  INFO -- : (0.000673s) COMMIT
I, [2012-06-25T15:51:13.174652 #5271]  INFO -- : Finished applying migration version 3, direction: up, took 0.007642 seconds
I, [2012-06-25T15:51:13.174687 #5271]  INFO -- : Begin applying migration version 4, direction: up
I, [2012-06-25T15:51:13.174913 #5271]  INFO -- : (0.000164s) BEGIN
I, [2012-06-25T15:51:13.179277 #5271]  INFO -- : (0.003811s) CREATE TABLE "roles" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-06-25T15:51:13.180034 #5271]  INFO -- : (0.000598s) CREATE INDEX "roles_org_id_index" ON "roles" ("org_id")
I, [2012-06-25T15:51:13.180268 #5271]  INFO -- : (0.000164s) ALTER TABLE roles ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-06-25T15:51:13.180535 #5271]  INFO -- : (0.000146s) UPDATE "schema_info" SET "version" = 4
I, [2012-06-25T15:51:13.181047 #5271]  INFO -- : (0.000459s) COMMIT
I, [2012-06-25T15:51:13.181102 #5271]  INFO -- : Finished applying migration version 4, direction: up, took 0.006411 seconds
I, [2012-06-25T15:51:13.181135 #5271]  INFO -- : Begin applying migration version 5, direction: up
I, [2012-06-25T15:51:13.181287 #5271]  INFO -- : (0.000099s) BEGIN
I, [2012-06-25T15:51:13.181632 #5271]  INFO -- : (0.000195s) ALTER TABLE "nodes" ADD COLUMN "last_audit_id" bytea
I, [2012-06-25T15:51:13.185086 #5271]  INFO -- : (0.003135s) CREATE TABLE "node_audit" ("audit_id" bytea NOT NULL, "node_id" char(32), "status" varchar(16), "start_time" timestamp NOT NULL, "end_time" timestamp NULL, "event_data" text NULL, PRIMARY KEY ("audit_id"), CONSTRAINT "node_id_fk" FOREIGN KEY ("node_id") REFERENCES "nodes")
I, [2012-06-25T15:51:13.186150 #5271]  INFO -- : (0.000865s) CREATE INDEX "node_audit_node_id_index" ON "node_audit" ("node_id")
I, [2012-06-25T15:51:13.190362 #5271]  INFO -- : (0.003793s) CREATE TABLE "node_audit_detail" ("audit_id" bytea NOT NULL, "seq" int NOT NULL, "duration" int NOT NULL, "res_id" varchar(255) NOT NULL, "res_type" varchar(16) NOT NULL, "res_name" varchar(255) NOT NULL, "res_result" varchar(16) NULL, "res_initial_state" text NULL, "res_final_state" text NULL, "delta" text NULL, PRIMARY KEY ("audit_id", "seq"), CONSTRAINT "audit_id_fk" FOREIGN KEY ("audit_id") REFERENCES "node_audit")
I, [2012-06-25T15:51:13.190679 #5271]  INFO -- : (0.000163s) UPDATE "schema_info" SET "version" = 5
I, [2012-06-25T15:51:13.191992 #5271]  INFO -- : (0.001255s) COMMIT
I, [2012-06-25T15:51:13.192059 #5271]  INFO -- : Finished applying migration version 5, direction: up, took 0.010920 seconds
I, [2012-06-25T15:51:13.192093 #5271]  INFO -- : Begin applying migration version 6, direction: up
I, [2012-06-25T15:51:13.192369 #5271]  INFO -- : (0.000219s) BEGIN
I, [2012-06-25T15:51:13.196689 #5271]  INFO -- : (0.004003s) CREATE TABLE "data_bags" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, UNIQUE ("org_id", "name"))
I, [2012-06-25T15:51:13.197563 #5271]  INFO -- : (0.000721s) CREATE INDEX "data_bags_org_id_index" ON "data_bags" ("org_id")
I, [2012-06-25T15:51:13.197922 #5271]  INFO -- : (0.000175s) UPDATE "schema_info" SET "version" = 6
I, [2012-06-25T15:51:13.198503 #5271]  INFO -- : (0.000515s) COMMIT
I, [2012-06-25T15:51:13.198580 #5271]  INFO -- : Finished applying migration version 6, direction: up, took 0.006477 seconds
I, [2012-06-25T15:51:13.198637 #5271]  INFO -- : Begin applying migration version 7, direction: up
I, [2012-06-25T15:51:13.198858 #5271]  INFO -- : (0.000143s) BEGIN
I, [2012-06-25T15:51:13.202168 #5271]  INFO -- : (0.002946s) CREATE TABLE "data_bag_items" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "data_bag_name" text NOT NULL, "item_name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "data_bag_name", "item_name"))
I, [2012-06-25T15:51:13.203278 #5271]  INFO -- : (0.000904s) CREATE INDEX "data_bag_items_org_id_index" ON "data_bag_items" ("org_id")
I, [2012-06-25T15:51:13.203617 #5271]  INFO -- : (0.000239s) ALTER TABLE data_bag_items ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-06-25T15:51:13.204026 #5271]  INFO -- : (0.000219s) UPDATE "schema_info" SET "version" = 7
I, [2012-06-25T15:51:13.204854 #5271]  INFO -- : (0.000743s) COMMIT
I, [2012-06-25T15:51:13.204941 #5271]  INFO -- : Finished applying migration version 7, direction: up, took 0.006297 seconds
I, [2012-06-25T15:51:13.204999 #5271]  INFO -- : Begin applying migration version 8, direction: up
I, [2012-06-25T15:51:13.205214 #5271]  INFO -- : (0.000130s) BEGIN
I, [2012-06-25T15:51:13.209322 #5271]  INFO -- : (0.003723s) CREATE TABLE "environments" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-06-25T15:51:13.210018 #5271]  INFO -- : (0.000555s) CREATE INDEX "environments_org_id_index" ON "environments" ("org_id")
I, [2012-06-25T15:51:13.210208 #5271]  INFO -- : (0.000129s) ALTER TABLE environments ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-06-25T15:51:13.210472 #5271]  INFO -- : (0.000145s) UPDATE "schema_info" SET "version" = 8
I, [2012-06-25T15:51:13.211106 #5271]  INFO -- : (0.000576s) COMMIT
I, [2012-06-25T15:51:13.211179 #5271]  INFO -- : Finished applying migration version 8, direction: up, took 0.006180 seconds
I, [2012-06-25T15:51:13.211228 #5271]  INFO -- : Begin applying migration version 9, direction: up
I, [2012-06-25T15:51:13.211395 #5271]  INFO -- : (0.000106s) BEGIN
I, [2012-06-25T15:51:13.213046 #5271]  INFO -- : (0.001455s) ALTER TABLE "data_bag_items" ADD FOREIGN KEY ("org_id", "data_bag_name") REFERENCES "data_bags"("org_id", "name") ON DELETE CASCADE ON UPDATE CASCADE
I, [2012-06-25T15:51:13.213408 #5271]  INFO -- : (0.000213s) UPDATE "schema_info" SET "version" = 9
I, [2012-06-25T15:51:13.213908 #5271]  INFO -- : (0.000450s) COMMIT
I, [2012-06-25T15:51:13.213957 #5271]  INFO -- : Finished applying migration version 9, direction: up, took 0.002730 seconds
I, [2012-06-25T15:51:13.213990 #5271]  INFO -- : Begin applying migration version 10, direction: up
I, [2012-06-25T15:51:13.214128 #5271]  INFO -- : (0.000090s) BEGIN
I, [2012-06-25T15:51:13.214551 #5271]  INFO -- : (0.000319s) DROP INDEX "clients_org_id_index"
I, [2012-06-25T15:51:13.214821 #5271]  INFO -- : (0.000180s) DROP INDEX "environments_org_id_index"
I, [2012-06-25T15:51:13.215084 #5271]  INFO -- : (0.000169s) DROP INDEX "nodes_org_id_index"
I, [2012-06-25T15:51:13.215336 #5271]  INFO -- : (0.000159s) DROP INDEX "roles_org_id_index"
I, [2012-06-25T15:51:13.215696 #5271]  INFO -- : (0.000243s) DROP INDEX "data_bags_org_id_index"
I, [2012-06-25T15:51:13.215993 #5271]  INFO -- : (0.000183s) DROP INDEX "data_bag_items_org_id_index"
I, [2012-06-25T15:51:13.216308 #5271]  INFO -- : (0.000191s) UPDATE "schema_info" SET "version" = 10
I, [2012-06-25T15:51:13.217513 #5271]  INFO -- : (0.001123s) COMMIT
I, [2012-06-25T15:51:13.217599 #5271]  INFO -- : Finished applying migration version 10, direction: up, took 0.003600 seconds
I, [2012-06-25T15:51:13.217656 #5271]  INFO -- : Begin applying migration version 11, direction: up
I, [2012-06-25T15:51:13.217855 #5271]  INFO -- : (0.000122s) BEGIN
I, [2012-06-25T15:51:13.218473 #5271]  INFO -- : (0.000282s) ALTER TABLE "users" ADD COLUMN "external_authentication_uid" text NULL
I, [2012-06-25T15:51:13.218764 #5271]  INFO -- : (0.000220s) ALTER TABLE "users" ADD COLUMN "recovery_authentication_enabled" boolean NULL
I, [2012-06-25T15:51:13.219089 #5271]  INFO -- : (0.000244s) ALTER TABLE "users" ALTER COLUMN "email" DROP NOT NULL
I, [2012-06-25T15:51:13.219453 #5271]  INFO -- : (0.000202s) UPDATE "schema_info" SET "version" = 11
I, [2012-06-25T15:51:13.219954 #5271]  INFO -- : (0.000444s) COMMIT
I, [2012-06-25T15:51:13.220011 #5271]  INFO -- : Finished applying migration version 11, direction: up, took 0.002354 seconds
I, [2012-06-25T15:51:13.220065 #5271]  INFO -- : Begin applying migration version 12, direction: up
I, [2012-06-25T15:51:13.220284 #5271]  INFO -- : (0.000137s) BEGIN
I, [2012-06-25T15:51:13.225693 #5271]  INFO -- : (0.004960s) CREATE TABLE "opc_customers" ("id" serial PRIMARY KEY, "name" text NOT NULL UNIQUE, "display_name" text NOT NULL, "domain" text NOT NULL UNIQUE, "contact" text NOT NULL, "priority" integer DEFAULT 0 NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-06-25T15:51:13.228703 #5271]  INFO -- : (0.002535s) CREATE TABLE "opc_users" ("user_id" char(32) NOT NULL, "customer_id" integer REFERENCES "opc_customers" ON DELETE CASCADE, FOREIGN KEY ("user_id") REFERENCES "users" ON DELETE CASCADE, UNIQUE ("user_id", "customer_id"))
I, [2012-06-25T15:51:13.229120 #5271]  INFO -- : (0.000204s) UPDATE "schema_info" SET "version" = 12
I, [2012-06-25T15:51:13.230676 #5271]  INFO -- : (0.001483s) COMMIT
I, [2012-06-25T15:51:13.230771 #5271]  INFO -- : Finished applying migration version 12, direction: up, took 0.010699 seconds
I, [2012-06-25T15:51:13.230827 #5271]  INFO -- : Begin applying migration version 13, direction: up
I, [2012-06-25T15:51:13.231141 #5271]  INFO -- : (0.000233s) BEGIN
I, [2012-06-25T15:51:13.232968 #5271]  INFO -- : (0.001498s) CREATE TABLE "checksums" ("org_id" char(32) NOT NULL, "checksum" char(32) NOT NULL, PRIMARY KEY ("org_id", "checksum"))
I, [2012-06-25T15:51:13.234394 #5271]  INFO -- : (0.001159s) CREATE TABLE "sandboxed_checksums" ("org_id" char(32), "sandbox_id" char(32), "checksum" char(32), "created_at" timestamp NOT NULL, PRIMARY KEY ("sandbox_id", "org_id", "checksum"))
I, [2012-06-25T15:51:13.234673 #5271]  INFO -- : (0.000147s) UPDATE "schema_info" SET "version" = 13
I, [2012-06-25T15:51:13.235227 #5271]  INFO -- : (0.000493s) COMMIT
I, [2012-06-25T15:51:13.235315 #5271]  INFO -- : Finished applying migration version 13, direction: up, took 0.004481 seconds
I, [2012-06-25T15:51:13.235370 #5271]  INFO -- : Begin applying migration version 14, direction: up
I, [2012-06-25T15:51:13.235625 #5271]  INFO -- : (0.000175s) BEGIN
I, [2012-06-25T15:51:13.240620 #5271]  INFO -- : (0.004711s) CREATE TABLE "cookbooks" ("id" serial PRIMARY KEY, "org_id" char(32) NOT NULL, "name" text NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, UNIQUE ("org_id", "name"))
I, [2012-06-25T15:51:13.241486 #5271]  INFO -- : (0.000694s) CREATE INDEX "cookbooks_org_id_index" ON "cookbooks" ("org_id")
I, [2012-06-25T15:51:13.246160 #5271]  INFO -- : (0.004166s) CREATE TABLE "cookbook_versions" ("id" char(32) PRIMARY KEY, "major" integer NOT NULL, "minor" integer NOT NULL, "patch" integer NOT NULL, "frozen" Boolean NOT NULL, "meta_attributes" bytea NOT NULL, "meta_deps" text NOT NULL, "meta_long_desc" bytea NOT NULL, "metadata" bytea NOT NULL, "serialized_object" bytea NOT NULL, "updated_at" timestamp NOT NULL, "created_at" timestamp NOT NULL, "last_updated_by" char(32) NOT NULL, "cookbook_id" integer REFERENCES "cookbooks" ON DELETE RESTRICT, UNIQUE ("cookbook_id", "major", "minor", "patch"))
I, [2012-06-25T15:51:13.246383 #5271]  INFO -- : (0.000145s) ALTER TABLE cookbook_versions ALTER meta_attributes SET STORAGE EXTERNAL
I, [2012-06-25T15:51:13.246548 #5271]  INFO -- : (0.000115s) ALTER TABLE cookbook_versions ALTER meta_long_desc SET STORAGE EXTERNAL
I, [2012-06-25T15:51:13.246733 #5271]  INFO -- : (0.000136s) ALTER TABLE cookbook_versions ALTER metadata SET STORAGE EXTERNAL
I, [2012-06-25T15:51:13.246997 #5271]  INFO -- : (0.000211s) ALTER TABLE cookbook_versions ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-06-25T15:51:13.249824 #5271]  INFO -- : (0.002518s) CREATE TABLE "cookbook_version_checksums" ("cookbook_version_id" char(32), "org_id" char(32) NOT NULL, "checksum" char(32) NOT NULL, FOREIGN KEY ("cookbook_version_id") REFERENCES "cookbook_versions"("id"), FOREIGN KEY ("org_id", "checksum") REFERENCES "checksums"("org_id", "checksum") ON DELETE CASCADE ON UPDATE CASCADE)
I, [2012-06-25T15:51:13.250256 #5271]  INFO -- : (0.000231s) UPDATE "schema_info" SET "version" = 14
I, [2012-06-25T15:51:13.251067 #5271]  INFO -- : (0.000727s) COMMIT
I, [2012-06-25T15:51:13.251150 #5271]  INFO -- : Finished applying migration version 14, direction: up, took 0.015773 seconds
I, [2012-06-25T15:51:13.251209 #5271]  INFO -- : Begin applying migration version 15, direction: up
I, [2012-06-25T15:51:13.251526 #5271]  INFO -- : (0.000231s) BEGIN
I, [2012-06-25T15:51:13.251920 #5271]  INFO -- : (0.000263s) ALTER TABLE "cookbook_versions" ALTER COLUMN "cookbook_id" SET NOT NULL
I, [2012-06-25T15:51:13.252368 #5271]  INFO -- : (0.000290s) ALTER TABLE "cookbook_version_checksums" ALTER COLUMN "cookbook_version_id" SET NOT NULL
I, [2012-06-25T15:51:13.252735 #5271]  INFO -- : (0.000205s) UPDATE "schema_info" SET "version" = 15
I, [2012-06-25T15:51:13.253163 #5271]  INFO -- : (0.000372s) COMMIT
I, [2012-06-25T15:51:13.253219 #5271]  INFO -- : Finished applying migration version 15, direction: up, took 0.002011 seconds
I, [2012-06-25T15:51:13.253254 #5271]  INFO -- : Begin applying migration version 16, direction: up
I, [2012-06-25T15:51:13.253412 #5271]  INFO -- : (0.000108s) BEGIN
I, [2012-06-25T15:51:13.255172 #5271]  INFO -- : (0.001699s) CREATE OR REPLACE VIEW cookbook_versions_by_rank(
    -- Cookbook Version fields
    major, -- these 3 are needed for version information (duh)
    minor,
    patch,
    serialized_object, -- needed to access recipe manifest

    -- Cookbook fields
    org_id, -- used for filtering
    name, -- both version and recipe queries require the cookbook name

    -- View-specific fields
    -- (also used for filtering)
    rank) AS
SELECT v.major,
       v.minor,
       v.patch,
       v.serialized_object,
       c.org_id,
       c.name,
       rank() OVER (PARTITION BY v.cookbook_id
                    ORDER BY v.major DESC, v.minor DESC, v.patch DESC)
FROM cookbooks AS c
JOIN cookbook_versions AS v
  ON c.id = v.cookbook_id;

I, [2012-06-25T15:51:13.255573 #5271]  INFO -- : (0.000264s) UPDATE "schema_info" SET "version" = 16
I, [2012-06-25T15:51:13.256158 #5271]  INFO -- : (0.000531s) COMMIT
I, [2012-06-25T15:51:13.256206 #5271]  INFO -- : Finished applying migration version 16, direction: up, took 0.002949 seconds
I, [2012-07-13T13:17:04.070170 #69299]  INFO -- : (0.000356s) SET standard_conforming_strings = ON
I, [2012-07-13T13:17:04.106231 #69299]  INFO -- : (0.000175s) SET client_min_messages = 'WARNING'
I, [2012-07-13T13:17:04.107069 #69299]  INFO -- : (0.000196s) SET DateStyle = 'ISO'
E, [2012-07-13T13:17:04.177277 #69299] ERROR -- : PG::Error: ERROR:  relation "schema_info" does not exist
LINE 1: SELECT NULL FROM "schema_info" LIMIT 1
                         ^: SELECT NULL FROM "schema_info" LIMIT 1
I, [2012-07-13T13:17:04.181912 #69299]  INFO -- : (0.004270s) CREATE TABLE "schema_info" ("version" integer DEFAULT 0 NOT NULL)
I, [2012-07-13T13:17:04.182663 #69299]  INFO -- : (0.000530s) SELECT 1 AS "one" FROM "schema_info" LIMIT 1
I, [2012-07-13T13:17:04.184788 #69299]  INFO -- : (0.001920s) SELECT pg_attribute.attname FROM pg_class, pg_attribute, pg_index, pg_namespace WHERE pg_class.oid = pg_attribute.attrelid AND pg_class.relnamespace = pg_namespace.oid AND pg_class.oid = pg_index.indrelid AND pg_index.indkey[0] = pg_attribute.attnum AND pg_index.indisprimary = 't' AND pg_class.relname = 'schema_info'
I, [2012-07-13T13:17:04.185879 #69299]  INFO -- : (0.000900s) INSERT INTO "schema_info" ("version") VALUES (0) RETURNING NULL
I, [2012-07-13T13:17:04.186709 #69299]  INFO -- : (0.000552s) SELECT COUNT(*) AS "count" FROM "schema_info" LIMIT 1
I, [2012-07-13T13:17:04.187092 #69299]  INFO -- : (0.000185s) SELECT "version" FROM "schema_info" LIMIT 1
I, [2012-07-13T13:17:04.218484 #69299]  INFO -- : Begin applying migration version 1, direction: up
I, [2012-07-13T13:17:04.218730 #69299]  INFO -- : (0.000137s) BEGIN
I, [2012-07-13T13:17:04.224888 #69299]  INFO -- : (0.005736s) CREATE TABLE "users" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "username" text NOT NULL UNIQUE, "email" text NOT NULL UNIQUE, "pubkey_version" integer NOT NULL, "public_key" text, "serialized_object" text, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-07-13T13:17:04.225272 #69299]  INFO -- : (0.000212s) UPDATE "schema_info" SET "version" = 1
I, [2012-07-13T13:17:04.226197 #69299]  INFO -- : (0.000846s) COMMIT
I, [2012-07-13T13:17:04.226263 #69299]  INFO -- : Finished applying migration version 1, direction: up, took 0.007781 seconds
I, [2012-07-13T13:17:04.226296 #69299]  INFO -- : Begin applying migration version 2, direction: up
I, [2012-07-13T13:17:04.226501 #69299]  INFO -- : (0.000146s) BEGIN
I, [2012-07-13T13:17:04.230302 #69299]  INFO -- : (0.003413s) CREATE TABLE "nodes" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "environment" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" text, UNIQUE ("org_id", "name"))
I, [2012-07-13T13:17:04.231191 #69299]  INFO -- : (0.000735s) CREATE INDEX "nodes_org_id_index" ON "nodes" ("org_id")
I, [2012-07-13T13:17:04.232182 #69299]  INFO -- : (0.000884s) CREATE INDEX "nodes_org_id_environment_index" ON "nodes" ("org_id", "environment")
I, [2012-07-13T13:17:04.232510 #69299]  INFO -- : (0.000202s) UPDATE "schema_info" SET "version" = 2
I, [2012-07-13T13:17:04.233504 #69299]  INFO -- : (0.000930s) COMMIT
I, [2012-07-13T13:17:04.233570 #69299]  INFO -- : Finished applying migration version 2, direction: up, took 0.007270 seconds
I, [2012-07-13T13:17:04.233604 #69299]  INFO -- : Begin applying migration version 3, direction: up
I, [2012-07-13T13:17:04.233865 #69299]  INFO -- : (0.000206s) BEGIN
I, [2012-07-13T13:17:04.237813 #69299]  INFO -- : (0.003540s) CREATE TABLE "clients" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, "name" text NOT NULL, "public_key" text, "validator" boolean NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "pubkey_version" smallint NOT NULL, CONSTRAINT "org_id_name_unique" UNIQUE ("org_id", "name"))
I, [2012-07-13T13:17:04.238794 #69299]  INFO -- : (0.000863s) CREATE INDEX "clients_org_id_index" ON "clients" ("org_id")
I, [2012-07-13T13:17:04.239085 #69299]  INFO -- : (0.000176s) UPDATE "schema_info" SET "version" = 3
I, [2012-07-13T13:17:04.239844 #69299]  INFO -- : (0.000705s) COMMIT
I, [2012-07-13T13:17:04.239907 #69299]  INFO -- : Finished applying migration version 3, direction: up, took 0.006299 seconds
I, [2012-07-13T13:17:04.239940 #69299]  INFO -- : Begin applying migration version 4, direction: up
I, [2012-07-13T13:17:04.240095 #69299]  INFO -- : (0.000104s) BEGIN
I, [2012-07-13T13:17:04.244723 #69299]  INFO -- : (0.004282s) CREATE TABLE "roles" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-07-13T13:17:04.245600 #69299]  INFO -- : (0.000712s) CREATE INDEX "roles_org_id_index" ON "roles" ("org_id")
I, [2012-07-13T13:17:04.245827 #69299]  INFO -- : (0.000159s) ALTER TABLE roles ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-07-13T13:17:04.246100 #69299]  INFO -- : (0.000147s) UPDATE "schema_info" SET "version" = 4
I, [2012-07-13T13:17:04.246824 #69299]  INFO -- : (0.000670s) COMMIT
I, [2012-07-13T13:17:04.246877 #69299]  INFO -- : Finished applying migration version 4, direction: up, took 0.006933 seconds
I, [2012-07-13T13:17:04.246910 #69299]  INFO -- : Begin applying migration version 5, direction: up
I, [2012-07-13T13:17:04.247059 #69299]  INFO -- : (0.000098s) BEGIN
I, [2012-07-13T13:17:04.247415 #69299]  INFO -- : (0.000205s) ALTER TABLE "nodes" ADD COLUMN "last_audit_id" bytea
I, [2012-07-13T13:17:04.251987 #69299]  INFO -- : (0.004240s) CREATE TABLE "node_audit" ("audit_id" bytea NOT NULL, "node_id" char(32), "status" varchar(16), "start_time" timestamp NOT NULL, "end_time" timestamp NULL, "event_data" text NULL, PRIMARY KEY ("audit_id"), CONSTRAINT "node_id_fk" FOREIGN KEY ("node_id") REFERENCES "nodes")
I, [2012-07-13T13:17:04.253054 #69299]  INFO -- : (0.000899s) CREATE INDEX "node_audit_node_id_index" ON "node_audit" ("node_id")
I, [2012-07-13T13:17:04.256743 #69299]  INFO -- : (0.003254s) CREATE TABLE "node_audit_detail" ("audit_id" bytea NOT NULL, "seq" int NOT NULL, "duration" int NOT NULL, "res_id" varchar(255) NOT NULL, "res_type" varchar(16) NOT NULL, "res_name" varchar(255) NOT NULL, "res_result" varchar(16) NULL, "res_initial_state" text NULL, "res_final_state" text NULL, "delta" text NULL, PRIMARY KEY ("audit_id", "seq"), CONSTRAINT "audit_id_fk" FOREIGN KEY ("audit_id") REFERENCES "node_audit")
I, [2012-07-13T13:17:04.257405 #69299]  INFO -- : (0.000493s) UPDATE "schema_info" SET "version" = 5
I, [2012-07-13T13:17:04.258473 #69299]  INFO -- : (0.000979s) COMMIT
I, [2012-07-13T13:17:04.258542 #69299]  INFO -- : Finished applying migration version 5, direction: up, took 0.011626 seconds
I, [2012-07-13T13:17:04.258577 #69299]  INFO -- : Begin applying migration version 6, direction: up
I, [2012-07-13T13:17:04.258789 #69299]  INFO -- : (0.000160s) BEGIN
I, [2012-07-13T13:17:04.262950 #69299]  INFO -- : (0.003818s) CREATE TABLE "data_bags" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, UNIQUE ("org_id", "name"))
I, [2012-07-13T13:17:04.264072 #69299]  INFO -- : (0.000949s) CREATE INDEX "data_bags_org_id_index" ON "data_bags" ("org_id")
I, [2012-07-13T13:17:04.264361 #69299]  INFO -- : (0.000154s) UPDATE "schema_info" SET "version" = 6
I, [2012-07-13T13:17:04.265150 #69299]  INFO -- : (0.000737s) COMMIT
I, [2012-07-13T13:17:04.265201 #69299]  INFO -- : Finished applying migration version 6, direction: up, took 0.006621 seconds
I, [2012-07-13T13:17:04.265233 #69299]  INFO -- : Begin applying migration version 7, direction: up
I, [2012-07-13T13:17:04.265415 #69299]  INFO -- : (0.000132s) BEGIN
I, [2012-07-13T13:17:04.269228 #69299]  INFO -- : (0.003473s) CREATE TABLE "data_bag_items" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "data_bag_name" text NOT NULL, "item_name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "data_bag_name", "item_name"))
I, [2012-07-13T13:17:04.270123 #69299]  INFO -- : (0.000775s) CREATE INDEX "data_bag_items_org_id_index" ON "data_bag_items" ("org_id")
I, [2012-07-13T13:17:04.270356 #69299]  INFO -- : (0.000161s) ALTER TABLE data_bag_items ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-07-13T13:17:04.270621 #69299]  INFO -- : (0.000145s) UPDATE "schema_info" SET "version" = 7
I, [2012-07-13T13:17:04.271287 #69299]  INFO -- : (0.000610s) COMMIT
I, [2012-07-13T13:17:04.271347 #69299]  INFO -- : Finished applying migration version 7, direction: up, took 0.006110 seconds
I, [2012-07-13T13:17:04.271382 #69299]  INFO -- : Begin applying migration version 8, direction: up
I, [2012-07-13T13:17:04.271618 #69299]  INFO -- : (0.000182s) BEGIN
I, [2012-07-13T13:17:04.276152 #69299]  INFO -- : (0.004173s) CREATE TABLE "environments" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-07-13T13:17:04.277065 #69299]  INFO -- : (0.000733s) CREATE INDEX "environments_org_id_index" ON "environments" ("org_id")
I, [2012-07-13T13:17:04.277302 #69299]  INFO -- : (0.000167s) ALTER TABLE environments ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-07-13T13:17:04.277615 #69299]  INFO -- : (0.000186s) UPDATE "schema_info" SET "version" = 8
I, [2012-07-13T13:17:04.278521 #69299]  INFO -- : (0.000851s) COMMIT
I, [2012-07-13T13:17:04.278586 #69299]  INFO -- : Finished applying migration version 8, direction: up, took 0.007200 seconds
I, [2012-07-13T13:17:04.278620 #69299]  INFO -- : Begin applying migration version 9, direction: up
I, [2012-07-13T13:17:04.278779 #69299]  INFO -- : (0.000105s) BEGIN
I, [2012-07-13T13:17:04.280411 #69299]  INFO -- : (0.001446s) ALTER TABLE "data_bag_items" ADD FOREIGN KEY ("org_id", "data_bag_name") REFERENCES "data_bags"("org_id", "name") ON DELETE CASCADE ON UPDATE CASCADE
I, [2012-07-13T13:17:04.280797 #69299]  INFO -- : (0.000254s) UPDATE "schema_info" SET "version" = 9
I, [2012-07-13T13:17:04.281504 #69299]  INFO -- : (0.000648s) COMMIT
I, [2012-07-13T13:17:04.281558 #69299]  INFO -- : Finished applying migration version 9, direction: up, took 0.002934 seconds
I, [2012-07-13T13:17:04.281592 #69299]  INFO -- : Begin applying migration version 10, direction: up
I, [2012-07-13T13:17:04.281764 #69299]  INFO -- : (0.000124s) BEGIN
I, [2012-07-13T13:17:04.282200 #69299]  INFO -- : (0.000321s) DROP INDEX "clients_org_id_index"
I, [2012-07-13T13:17:04.282559 #69299]  INFO -- : (0.000268s) DROP INDEX "environments_org_id_index"
I, [2012-07-13T13:17:04.282932 #69299]  INFO -- : (0.000272s) DROP INDEX "nodes_org_id_index"
I, [2012-07-13T13:17:04.283258 #69299]  INFO -- : (0.000173s) DROP INDEX "roles_org_id_index"
I, [2012-07-13T13:17:04.283517 #69299]  INFO -- : (0.000159s) DROP INDEX "data_bags_org_id_index"
I, [2012-07-13T13:17:04.283782 #69299]  INFO -- : (0.000150s) DROP INDEX "data_bag_items_org_id_index"
I, [2012-07-13T13:17:04.284011 #69299]  INFO -- : (0.000127s) UPDATE "schema_info" SET "version" = 10
I, [2012-07-13T13:17:04.284957 #69299]  INFO -- : (0.000895s) COMMIT
I, [2012-07-13T13:17:04.285009 #69299]  INFO -- : Finished applying migration version 10, direction: up, took 0.003414 seconds
I, [2012-07-13T13:17:04.285042 #69299]  INFO -- : Begin applying migration version 11, direction: up
I, [2012-07-13T13:17:04.285204 #69299]  INFO -- : (0.000117s) BEGIN
I, [2012-07-13T13:17:04.285626 #69299]  INFO -- : (0.000234s) ALTER TABLE "users" ADD COLUMN "external_authentication_uid" text NULL
I, [2012-07-13T13:17:04.285881 #69299]  INFO -- : (0.000208s) ALTER TABLE "users" ADD COLUMN "recovery_authentication_enabled" boolean NULL
I, [2012-07-13T13:17:04.286116 #69299]  INFO -- : (0.000191s) ALTER TABLE "users" ALTER COLUMN "email" DROP NOT NULL
I, [2012-07-13T13:17:04.286314 #69299]  INFO -- : (0.000111s) UPDATE "schema_info" SET "version" = 11
I, [2012-07-13T13:17:04.286800 #69299]  INFO -- : (0.000442s) COMMIT
I, [2012-07-13T13:17:04.286846 #69299]  INFO -- : Finished applying migration version 11, direction: up, took 0.001801 seconds
I, [2012-07-13T13:17:04.286876 #69299]  INFO -- : Begin applying migration version 12, direction: up
I, [2012-07-13T13:17:04.286992 #69299]  INFO -- : (0.000071s) BEGIN
I, [2012-07-13T13:17:04.292631 #69299]  INFO -- : (0.005330s) CREATE TABLE "opc_customers" ("id" serial PRIMARY KEY, "name" text NOT NULL UNIQUE, "display_name" text NOT NULL, "domain" text NOT NULL UNIQUE, "contact" text NOT NULL, "priority" integer DEFAULT 0 NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-07-13T13:17:04.294945 #69299]  INFO -- : (0.002034s) CREATE TABLE "opc_users" ("user_id" char(32) NOT NULL, "customer_id" integer REFERENCES "opc_customers" ON DELETE CASCADE, FOREIGN KEY ("user_id") REFERENCES "users" ON DELETE CASCADE, UNIQUE ("user_id", "customer_id"))
I, [2012-07-13T13:17:04.295281 #69299]  INFO -- : (0.000204s) UPDATE "schema_info" SET "version" = 12
I, [2012-07-13T13:17:04.296466 #69299]  INFO -- : (0.001120s) COMMIT
I, [2012-07-13T13:17:04.296526 #69299]  INFO -- : Finished applying migration version 12, direction: up, took 0.009645 seconds
I, [2012-07-13T13:17:04.296561 #69299]  INFO -- : Begin applying migration version 13, direction: up
I, [2012-07-13T13:17:04.296809 #69299]  INFO -- : (0.000197s) BEGIN
I, [2012-07-13T13:17:04.298311 #69299]  INFO -- : (0.001316s) CREATE TABLE "checksums" ("org_id" char(32) NOT NULL, "checksum" char(32) NOT NULL, PRIMARY KEY ("org_id", "checksum"))
I, [2012-07-13T13:17:04.299871 #69299]  INFO -- : (0.001324s) CREATE TABLE "sandboxed_checksums" ("org_id" char(32), "sandbox_id" char(32), "checksum" char(32), "created_at" timestamp NOT NULL, PRIMARY KEY ("sandbox_id", "org_id", "checksum"))
I, [2012-07-13T13:17:04.300251 #69299]  INFO -- : (0.000257s) UPDATE "schema_info" SET "version" = 13
I, [2012-07-13T13:17:04.301099 #69299]  INFO -- : (0.000788s) COMMIT
I, [2012-07-13T13:17:04.301157 #69299]  INFO -- : Finished applying migration version 13, direction: up, took 0.004593 seconds
I, [2012-07-13T13:17:04.301190 #69299]  INFO -- : Begin applying migration version 14, direction: up
I, [2012-07-13T13:17:04.301364 #69299]  INFO -- : (0.000121s) BEGIN
I, [2012-07-13T13:17:04.306232 #69299]  INFO -- : (0.004601s) CREATE TABLE "cookbooks" ("id" serial PRIMARY KEY, "org_id" char(32) NOT NULL, "name" text NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, UNIQUE ("org_id", "name"))
I, [2012-07-13T13:17:04.307294 #69299]  INFO -- : (0.000899s) CREATE INDEX "cookbooks_org_id_index" ON "cookbooks" ("org_id")
I, [2012-07-13T13:17:04.312858 #69299]  INFO -- : (0.005059s) CREATE TABLE "cookbook_versions" ("id" char(32) PRIMARY KEY, "major" integer NOT NULL, "minor" integer NOT NULL, "patch" integer NOT NULL, "frozen" Boolean NOT NULL, "meta_attributes" bytea NOT NULL, "meta_deps" text NOT NULL, "meta_long_desc" bytea NOT NULL, "metadata" bytea NOT NULL, "serialized_object" bytea NOT NULL, "updated_at" timestamp NOT NULL, "created_at" timestamp NOT NULL, "last_updated_by" char(32) NOT NULL, "cookbook_id" integer REFERENCES "cookbooks" ON DELETE RESTRICT, UNIQUE ("cookbook_id", "major", "minor", "patch"))
I, [2012-07-13T13:17:04.313229 #69299]  INFO -- : (0.000252s) ALTER TABLE cookbook_versions ALTER meta_attributes SET STORAGE EXTERNAL
I, [2012-07-13T13:17:04.313446 #69299]  INFO -- : (0.000153s) ALTER TABLE cookbook_versions ALTER meta_long_desc SET STORAGE EXTERNAL
I, [2012-07-13T13:17:04.313672 #69299]  INFO -- : (0.000175s) ALTER TABLE cookbook_versions ALTER metadata SET STORAGE EXTERNAL
I, [2012-07-13T13:17:04.313826 #69299]  INFO -- : (0.000109s) ALTER TABLE cookbook_versions ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-07-13T13:17:04.316196 #69299]  INFO -- : (0.002060s) CREATE TABLE "cookbook_version_checksums" ("cookbook_version_id" char(32), "org_id" char(32) NOT NULL, "checksum" char(32) NOT NULL, FOREIGN KEY ("cookbook_version_id") REFERENCES "cookbook_versions"("id"), FOREIGN KEY ("org_id", "checksum") REFERENCES "checksums"("org_id", "checksum") ON DELETE CASCADE ON UPDATE CASCADE)
I, [2012-07-13T13:17:04.316567 #69299]  INFO -- : (0.000226s) UPDATE "schema_info" SET "version" = 14
I, [2012-07-13T13:17:04.317684 #69299]  INFO -- : (0.001048s) COMMIT
I, [2012-07-13T13:17:04.317751 #69299]  INFO -- : Finished applying migration version 14, direction: up, took 0.016555 seconds
I, [2012-07-13T13:17:04.317786 #69299]  INFO -- : Begin applying migration version 15, direction: up
I, [2012-07-13T13:17:04.318137 #69299]  INFO -- : (0.000298s) BEGIN
I, [2012-07-13T13:17:04.318489 #69299]  INFO -- : (0.000244s) ALTER TABLE "cookbook_versions" ALTER COLUMN "cookbook_id" SET NOT NULL
I, [2012-07-13T13:17:04.318795 #69299]  INFO -- : (0.000217s) ALTER TABLE "cookbook_version_checksums" ALTER COLUMN "cookbook_version_id" SET NOT NULL
I, [2012-07-13T13:17:04.319018 #69299]  INFO -- : (0.000129s) UPDATE "schema_info" SET "version" = 15
I, [2012-07-13T13:17:04.319426 #69299]  INFO -- : (0.000356s) COMMIT
I, [2012-07-13T13:17:04.319487 #69299]  INFO -- : Finished applying migration version 15, direction: up, took 0.001698 seconds
I, [2012-07-13T13:17:04.319521 #69299]  INFO -- : Begin applying migration version 16, direction: up
I, [2012-07-13T13:17:04.319694 #69299]  INFO -- : (0.000126s) BEGIN
I, [2012-07-13T13:17:04.321452 #69299]  INFO -- : (0.001698s) CREATE OR REPLACE VIEW cookbook_versions_by_rank(
    -- Cookbook Version fields
    major, -- these 3 are needed for version information (duh)
    minor,
    patch,
    serialized_object, -- needed to access recipe manifest

    -- Cookbook fields
    org_id, -- used for filtering
    name, -- both version and recipe queries require the cookbook name

    -- View-specific fields
    -- (also used for filtering)
    rank) AS
SELECT v.major,
       v.minor,
       v.patch,
       v.serialized_object,
       c.org_id,
       c.name,
       rank() OVER (PARTITION BY v.cookbook_id
                    ORDER BY v.major DESC, v.minor DESC, v.patch DESC)
FROM cookbooks AS c
JOIN cookbook_versions AS v
  ON c.id = v.cookbook_id;

I, [2012-07-13T13:17:04.321765 #69299]  INFO -- : (0.000178s) UPDATE "schema_info" SET "version" = 16
I, [2012-07-13T13:17:04.322398 #69299]  INFO -- : (0.000586s) COMMIT
I, [2012-07-13T13:17:04.322446 #69299]  INFO -- : Finished applying migration version 16, direction: up, took 0.002921 seconds
I, [2012-07-13T13:20:46.878580 #69766]  INFO -- : (0.000391s) SET standard_conforming_strings = ON
I, [2012-07-13T13:20:46.878906 #69766]  INFO -- : (0.000202s) SET client_min_messages = 'WARNING'
I, [2012-07-13T13:20:46.879125 #69766]  INFO -- : (0.000164s) SET DateStyle = 'ISO'
E, [2012-07-13T13:20:46.898187 #69766] ERROR -- : PG::Error: ERROR:  relation "schema_info" does not exist
LINE 1: SELECT NULL FROM "schema_info" LIMIT 1
                         ^: SELECT NULL FROM "schema_info" LIMIT 1
I, [2012-07-13T13:20:46.913334 #69766]  INFO -- : (0.014875s) CREATE TABLE "schema_info" ("version" integer DEFAULT 0 NOT NULL)
I, [2012-07-13T13:20:46.914118 #69766]  INFO -- : (0.000550s) SELECT 1 AS "one" FROM "schema_info" LIMIT 1
I, [2012-07-13T13:20:46.916011 #69766]  INFO -- : (0.001696s) SELECT pg_attribute.attname FROM pg_class, pg_attribute, pg_index, pg_namespace WHERE pg_class.oid = pg_attribute.attrelid AND pg_class.relnamespace = pg_namespace.oid AND pg_class.oid = pg_index.indrelid AND pg_index.indkey[0] = pg_attribute.attnum AND pg_index.indisprimary = 't' AND pg_class.relname = 'schema_info'
I, [2012-07-13T13:20:46.916929 #69766]  INFO -- : (0.000723s) INSERT INTO "schema_info" ("version") VALUES (0) RETURNING NULL
I, [2012-07-13T13:20:46.917651 #69766]  INFO -- : (0.000499s) SELECT COUNT(*) AS "count" FROM "schema_info" LIMIT 1
I, [2012-07-13T13:20:46.918013 #69766]  INFO -- : (0.000156s) SELECT "version" FROM "schema_info" LIMIT 1
I, [2012-07-13T13:20:46.927010 #69766]  INFO -- : Begin applying migration version 1, direction: up
I, [2012-07-13T13:20:46.927346 #69766]  INFO -- : (0.000234s) BEGIN
I, [2012-07-13T13:20:46.933423 #69766]  INFO -- : (0.005646s) CREATE TABLE "users" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "username" text NOT NULL UNIQUE, "email" text NOT NULL UNIQUE, "pubkey_version" integer NOT NULL, "public_key" text, "serialized_object" text, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-07-13T13:20:46.933924 #69766]  INFO -- : (0.000296s) UPDATE "schema_info" SET "version" = 1
I, [2012-07-13T13:20:46.934978 #69766]  INFO -- : (0.000983s) COMMIT
I, [2012-07-13T13:20:46.935052 #69766]  INFO -- : Finished applying migration version 1, direction: up, took 0.008041 seconds
I, [2012-07-13T13:20:46.935086 #69766]  INFO -- : Begin applying migration version 2, direction: up
I, [2012-07-13T13:20:46.935280 #69766]  INFO -- : (0.000133s) BEGIN
I, [2012-07-13T13:20:46.939320 #69766]  INFO -- : (0.003647s) CREATE TABLE "nodes" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "environment" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" text, UNIQUE ("org_id", "name"))
I, [2012-07-13T13:20:46.940302 #69766]  INFO -- : (0.000831s) CREATE INDEX "nodes_org_id_index" ON "nodes" ("org_id")
I, [2012-07-13T13:20:46.941177 #69766]  INFO -- : (0.000758s) CREATE INDEX "nodes_org_id_environment_index" ON "nodes" ("org_id", "environment")
I, [2012-07-13T13:20:46.941465 #69766]  INFO -- : (0.000169s) UPDATE "schema_info" SET "version" = 2
I, [2012-07-13T13:20:46.942116 #69766]  INFO -- : (0.000597s) COMMIT
I, [2012-07-13T13:20:46.942179 #69766]  INFO -- : Finished applying migration version 2, direction: up, took 0.007089 seconds
I, [2012-07-13T13:20:46.942214 #69766]  INFO -- : Begin applying migration version 3, direction: up
I, [2012-07-13T13:20:46.942359 #69766]  INFO -- : (0.000095s) BEGIN
I, [2012-07-13T13:20:47.054957 #69766]  INFO -- : (0.112198s) CREATE TABLE "clients" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, "name" text NOT NULL, "public_key" text, "validator" boolean NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "pubkey_version" smallint NOT NULL, CONSTRAINT "org_id_name_unique" UNIQUE ("org_id", "name"))
I, [2012-07-13T13:20:47.055856 #69766]  INFO -- : (0.000728s) CREATE INDEX "clients_org_id_index" ON "clients" ("org_id")
I, [2012-07-13T13:20:47.056183 #69766]  INFO -- : (0.000192s) UPDATE "schema_info" SET "version" = 3
I, [2012-07-13T13:20:47.057086 #69766]  INFO -- : (0.000847s) COMMIT
I, [2012-07-13T13:20:47.057151 #69766]  INFO -- : Finished applying migration version 3, direction: up, took 0.114933 seconds
I, [2012-07-13T13:20:47.057186 #69766]  INFO -- : Begin applying migration version 4, direction: up
I, [2012-07-13T13:20:47.057374 #69766]  INFO -- : (0.000130s) BEGIN
I, [2012-07-13T13:20:47.061708 #69766]  INFO -- : (0.003964s) CREATE TABLE "roles" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-07-13T13:20:47.062775 #69766]  INFO -- : (0.000940s) CREATE INDEX "roles_org_id_index" ON "roles" ("org_id")
I, [2012-07-13T13:20:47.063097 #69766]  INFO -- : (0.000232s) ALTER TABLE roles ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-07-13T13:20:47.063459 #69766]  INFO -- : (0.000229s) UPDATE "schema_info" SET "version" = 4
I, [2012-07-13T13:20:47.064086 #69766]  INFO -- : (0.000555s) COMMIT
I, [2012-07-13T13:20:47.064152 #69766]  INFO -- : Finished applying migration version 4, direction: up, took 0.006962 seconds
I, [2012-07-13T13:20:47.064186 #69766]  INFO -- : Begin applying migration version 5, direction: up
I, [2012-07-13T13:20:47.064393 #69766]  INFO -- : (0.000151s) BEGIN
I, [2012-07-13T13:20:47.064822 #69766]  INFO -- : (0.000253s) ALTER TABLE "nodes" ADD COLUMN "last_audit_id" bytea
I, [2012-07-13T13:20:47.069372 #69766]  INFO -- : (0.004210s) CREATE TABLE "node_audit" ("audit_id" bytea NOT NULL, "node_id" char(32), "status" varchar(16), "start_time" timestamp NOT NULL, "end_time" timestamp NULL, "event_data" text NULL, PRIMARY KEY ("audit_id"), CONSTRAINT "node_id_fk" FOREIGN KEY ("node_id") REFERENCES "nodes")
I, [2012-07-13T13:20:47.070315 #69766]  INFO -- : (0.000773s) CREATE INDEX "node_audit_node_id_index" ON "node_audit" ("node_id")
I, [2012-07-13T13:20:47.073821 #69766]  INFO -- : (0.003086s) CREATE TABLE "node_audit_detail" ("audit_id" bytea NOT NULL, "seq" int NOT NULL, "duration" int NOT NULL, "res_id" varchar(255) NOT NULL, "res_type" varchar(16) NOT NULL, "res_name" varchar(255) NOT NULL, "res_result" varchar(16) NULL, "res_initial_state" text NULL, "res_final_state" text NULL, "delta" text NULL, PRIMARY KEY ("audit_id", "seq"), CONSTRAINT "audit_id_fk" FOREIGN KEY ("audit_id") REFERENCES "node_audit")
I, [2012-07-13T13:20:47.074222 #69766]  INFO -- : (0.000236s) UPDATE "schema_info" SET "version" = 5
I, [2012-07-13T13:20:47.075623 #69766]  INFO -- : (0.001334s) COMMIT
I, [2012-07-13T13:20:47.075686 #69766]  INFO -- : Finished applying migration version 5, direction: up, took 0.011497 seconds
I, [2012-07-13T13:20:47.075721 #69766]  INFO -- : Begin applying migration version 6, direction: up
I, [2012-07-13T13:20:47.075940 #69766]  INFO -- : (0.000163s) BEGIN
I, [2012-07-13T13:20:47.080430 #69766]  INFO -- : (0.004166s) CREATE TABLE "data_bags" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, UNIQUE ("org_id", "name"))
I, [2012-07-13T13:20:47.081655 #69766]  INFO -- : (0.001089s) CREATE INDEX "data_bags_org_id_index" ON "data_bags" ("org_id")
I, [2012-07-13T13:20:47.081976 #69766]  INFO -- : (0.000191s) UPDATE "schema_info" SET "version" = 6
I, [2012-07-13T13:20:47.082750 #69766]  INFO -- : (0.000711s) COMMIT
I, [2012-07-13T13:20:47.082809 #69766]  INFO -- : Finished applying migration version 6, direction: up, took 0.007085 seconds
I, [2012-07-13T13:20:47.082843 #69766]  INFO -- : Begin applying migration version 7, direction: up
I, [2012-07-13T13:20:47.083106 #69766]  INFO -- : (0.000210s) BEGIN
I, [2012-07-13T13:20:47.086468 #69766]  INFO -- : (0.003018s) CREATE TABLE "data_bag_items" ("id" char(32) PRIMARY KEY, "org_id" char(32) NOT NULL, "data_bag_name" text NOT NULL, "item_name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "data_bag_name", "item_name"))
I, [2012-07-13T13:20:47.087273 #69766]  INFO -- : (0.000680s) CREATE INDEX "data_bag_items_org_id_index" ON "data_bag_items" ("org_id")
I, [2012-07-13T13:20:47.087468 #69766]  INFO -- : (0.000135s) ALTER TABLE data_bag_items ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-07-13T13:20:47.087748 #69766]  INFO -- : (0.000159s) UPDATE "schema_info" SET "version" = 7
I, [2012-07-13T13:20:47.088507 #69766]  INFO -- : (0.000704s) COMMIT
I, [2012-07-13T13:20:47.088573 #69766]  INFO -- : Finished applying migration version 7, direction: up, took 0.005726 seconds
I, [2012-07-13T13:20:47.088607 #69766]  INFO -- : Begin applying migration version 8, direction: up
I, [2012-07-13T13:20:47.088804 #69766]  INFO -- : (0.000142s) BEGIN
I, [2012-07-13T13:20:47.093521 #69766]  INFO -- : (0.004325s) CREATE TABLE "environments" ("id" char(32) PRIMARY KEY, "authz_id" char(32) NOT NULL UNIQUE, "org_id" char(32) NOT NULL, "name" text NOT NULL, "last_updated_by" char(32) NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "serialized_object" bytea, UNIQUE ("org_id", "name"))
I, [2012-07-13T13:20:47.094797 #69766]  INFO -- : (0.000901s) CREATE INDEX "environments_org_id_index" ON "environments" ("org_id")
I, [2012-07-13T13:20:47.095015 #69766]  INFO -- : (0.000135s) ALTER TABLE environments ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-07-13T13:20:47.095402 #69766]  INFO -- : (0.000261s) UPDATE "schema_info" SET "version" = 8
I, [2012-07-13T13:20:47.096221 #69766]  INFO -- : (0.000756s) COMMIT
I, [2012-07-13T13:20:47.096284 #69766]  INFO -- : Finished applying migration version 8, direction: up, took 0.007673 seconds
I, [2012-07-13T13:20:47.096317 #69766]  INFO -- : Begin applying migration version 9, direction: up
I, [2012-07-13T13:20:47.096472 #69766]  INFO -- : (0.000105s) BEGIN
I, [2012-07-13T13:20:47.098052 #69766]  INFO -- : (0.001402s) ALTER TABLE "data_bag_items" ADD FOREIGN KEY ("org_id", "data_bag_name") REFERENCES "data_bags"("org_id", "name") ON DELETE CASCADE ON UPDATE CASCADE
I, [2012-07-13T13:20:47.098314 #69766]  INFO -- : (0.000132s) UPDATE "schema_info" SET "version" = 9
I, [2012-07-13T13:20:47.098902 #69766]  INFO -- : (0.000536s) COMMIT
I, [2012-07-13T13:20:47.098952 #69766]  INFO -- : Finished applying migration version 9, direction: up, took 0.002631 seconds
I, [2012-07-13T13:20:47.098984 #69766]  INFO -- : Begin applying migration version 10, direction: up
I, [2012-07-13T13:20:47.099158 #69766]  INFO -- : (0.000125s) BEGIN
I, [2012-07-13T13:20:47.099617 #69766]  INFO -- : (0.000354s) DROP INDEX "clients_org_id_index"
I, [2012-07-13T13:20:47.099920 #69766]  INFO -- : (0.000213s) DROP INDEX "environments_org_id_index"
I, [2012-07-13T13:20:47.100164 #69766]  INFO -- : (0.000156s) DROP INDEX "nodes_org_id_index"
I, [2012-07-13T13:20:47.100425 #69766]  INFO -- : (0.000174s) DROP INDEX "roles_org_id_index"
I, [2012-07-13T13:20:47.100687 #69766]  INFO -- : (0.000171s) DROP INDEX "data_bags_org_id_index"
I, [2012-07-13T13:20:47.100923 #69766]  INFO -- : (0.000149s) DROP INDEX "data_bag_items_org_id_index"
I, [2012-07-13T13:20:47.101127 #69766]  INFO -- : (0.000114s) UPDATE "schema_info" SET "version" = 10
I, [2012-07-13T13:20:47.102044 #69766]  INFO -- : (0.000868s) COMMIT
I, [2012-07-13T13:20:47.102100 #69766]  INFO -- : Finished applying migration version 10, direction: up, took 0.003113 seconds
I, [2012-07-13T13:20:47.102132 #69766]  INFO -- : Begin applying migration version 11, direction: up
I, [2012-07-13T13:20:47.102291 #69766]  INFO -- : (0.000109s) BEGIN
I, [2012-07-13T13:20:47.102668 #69766]  INFO -- : (0.000175s) ALTER TABLE "users" ADD COLUMN "external_authentication_uid" text NULL
I, [2012-07-13T13:20:47.102863 #69766]  INFO -- : (0.000146s) ALTER TABLE "users" ADD COLUMN "recovery_authentication_enabled" boolean NULL
I, [2012-07-13T13:20:47.103038 #69766]  INFO -- : (0.000130s) ALTER TABLE "users" ALTER COLUMN "email" DROP NOT NULL
I, [2012-07-13T13:20:47.103234 #69766]  INFO -- : (0.000107s) UPDATE "schema_info" SET "version" = 11
I, [2012-07-13T13:20:47.103745 #69766]  INFO -- : (0.000469s) COMMIT
I, [2012-07-13T13:20:47.103788 #69766]  INFO -- : Finished applying migration version 11, direction: up, took 0.001653 seconds
I, [2012-07-13T13:20:47.103818 #69766]  INFO -- : Begin applying migration version 12, direction: up
I, [2012-07-13T13:20:47.103937 #69766]  INFO -- : (0.000063s) BEGIN
I, [2012-07-13T13:20:47.109329 #69766]  INFO -- : (0.005074s) CREATE TABLE "opc_customers" ("id" serial PRIMARY KEY, "name" text NOT NULL UNIQUE, "display_name" text NOT NULL, "domain" text NOT NULL UNIQUE, "contact" text NOT NULL, "priority" integer DEFAULT 0 NOT NULL, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)
I, [2012-07-13T13:20:47.112180 #69766]  INFO -- : (0.002441s) CREATE TABLE "opc_users" ("user_id" char(32) NOT NULL, "customer_id" integer REFERENCES "opc_customers" ON DELETE CASCADE, FOREIGN KEY ("user_id") REFERENCES "users" ON DELETE CASCADE, UNIQUE ("user_id", "customer_id"))
I, [2012-07-13T13:20:47.112593 #69766]  INFO -- : (0.000283s) UPDATE "schema_info" SET "version" = 12
I, [2012-07-13T13:20:47.113627 #69766]  INFO -- : (0.000974s) COMMIT
I, [2012-07-13T13:20:47.113679 #69766]  INFO -- : Finished applying migration version 12, direction: up, took 0.009856 seconds
I, [2012-07-13T13:20:47.113710 #69766]  INFO -- : Begin applying migration version 13, direction: up
I, [2012-07-13T13:20:47.114010 #69766]  INFO -- : (0.000251s) BEGIN
I, [2012-07-13T13:20:47.115557 #69766]  INFO -- : (0.001366s) CREATE TABLE "checksums" ("org_id" char(32) NOT NULL, "checksum" char(32) NOT NULL, PRIMARY KEY ("org_id", "checksum"))
I, [2012-07-13T13:20:47.117121 #69766]  INFO -- : (0.001343s) CREATE TABLE "sandboxed_checksums" ("org_id" char(32), "sandbox_id" char(32), "checksum" char(32), "created_at" timestamp NOT NULL, PRIMARY KEY ("sandbox_id", "org_id", "checksum"))
I, [2012-07-13T13:20:47.117489 #69766]  INFO -- : (0.000257s) UPDATE "schema_info" SET "version" = 13
I, [2012-07-13T13:20:47.118609 #69766]  INFO -- : (0.001050s) COMMIT
I, [2012-07-13T13:20:47.118695 #69766]  INFO -- : Finished applying migration version 13, direction: up, took 0.004981 seconds
I, [2012-07-13T13:20:47.118728 #69766]  INFO -- : Begin applying migration version 14, direction: up
I, [2012-07-13T13:20:47.119003 #69766]  INFO -- : (0.000219s) BEGIN
I, [2012-07-13T13:20:47.124106 #69766]  INFO -- : (0.004807s) CREATE TABLE "cookbooks" ("id" serial PRIMARY KEY, "org_id" char(32) NOT NULL, "name" text NOT NULL, "authz_id" char(32) NOT NULL UNIQUE, UNIQUE ("org_id", "name"))
I, [2012-07-13T13:20:47.124894 #69766]  INFO -- : (0.000613s) CREATE INDEX "cookbooks_org_id_index" ON "cookbooks" ("org_id")
I, [2012-07-13T13:20:47.130267 #69766]  INFO -- : (0.004876s) CREATE TABLE "cookbook_versions" ("id" char(32) PRIMARY KEY, "major" integer NOT NULL, "minor" integer NOT NULL, "patch" integer NOT NULL, "frozen" Boolean NOT NULL, "meta_attributes" bytea NOT NULL, "meta_deps" text NOT NULL, "meta_long_desc" bytea NOT NULL, "metadata" bytea NOT NULL, "serialized_object" bytea NOT NULL, "updated_at" timestamp NOT NULL, "created_at" timestamp NOT NULL, "last_updated_by" char(32) NOT NULL, "cookbook_id" integer REFERENCES "cookbooks" ON DELETE RESTRICT, UNIQUE ("cookbook_id", "major", "minor", "patch"))
I, [2012-07-13T13:20:47.130670 #69766]  INFO -- : (0.000288s) ALTER TABLE cookbook_versions ALTER meta_attributes SET STORAGE EXTERNAL
I, [2012-07-13T13:20:47.131527 #69766]  INFO -- : (0.000795s) ALTER TABLE cookbook_versions ALTER meta_long_desc SET STORAGE EXTERNAL
I, [2012-07-13T13:20:47.131803 #69766]  INFO -- : (0.000213s) ALTER TABLE cookbook_versions ALTER metadata SET STORAGE EXTERNAL
I, [2012-07-13T13:20:47.132023 #69766]  INFO -- : (0.000153s) ALTER TABLE cookbook_versions ALTER serialized_object SET STORAGE EXTERNAL
I, [2012-07-13T13:20:47.134217 #69766]  INFO -- : (0.001867s) CREATE TABLE "cookbook_version_checksums" ("cookbook_version_id" char(32), "org_id" char(32) NOT NULL, "checksum" char(32) NOT NULL, FOREIGN KEY ("cookbook_version_id") REFERENCES "cookbook_versions"("id"), FOREIGN KEY ("org_id", "checksum") REFERENCES "checksums"("org_id", "checksum") ON DELETE CASCADE ON UPDATE CASCADE)
I, [2012-07-13T13:20:47.134508 #69766]  INFO -- : (0.000155s) UPDATE "schema_info" SET "version" = 14
I, [2012-07-13T13:20:47.135558 #69766]  INFO -- : (0.000986s) COMMIT
I, [2012-07-13T13:20:47.135645 #69766]  INFO -- : Finished applying migration version 14, direction: up, took 0.016912 seconds
I, [2012-07-13T13:20:47.135684 #69766]  INFO -- : Begin applying migration version 15, direction: up
I, [2012-07-13T13:20:47.135943 #69766]  INFO -- : (0.000204s) BEGIN
I, [2012-07-13T13:20:47.136277 #69766]  INFO -- : (0.000216s) ALTER TABLE "cookbook_versions" ALTER COLUMN "cookbook_id" SET NOT NULL
I, [2012-07-13T13:20:47.136616 #69766]  INFO -- : (0.000236s) ALTER TABLE "cookbook_version_checksums" ALTER COLUMN "cookbook_version_id" SET NOT NULL
I, [2012-07-13T13:20:47.136973 #69766]  INFO -- : (0.000225s) UPDATE "schema_info" SET "version" = 15
I, [2012-07-13T13:20:47.137586 #69766]  INFO -- : (0.000552s) COMMIT
I, [2012-07-13T13:20:47.137636 #69766]  INFO -- : Finished applying migration version 15, direction: up, took 0.001951 seconds
I, [2012-07-13T13:20:47.137668 #69766]  INFO -- : Begin applying migration version 16, direction: up
I, [2012-07-13T13:20:47.137800 #69766]  INFO -- : (0.000086s) BEGIN
I, [2012-07-13T13:20:47.138193 #69766]  INFO -- : (0.000240s) ALTER TABLE "nodes" DROP COLUMN "last_audit_id"
I, [2012-07-13T13:20:47.138401 #69766]  INFO -- : (0.000164s) ALTER TABLE "nodes" ADD COLUMN "last_run_id" varchar(32)
I, [2012-07-13T13:20:47.139412 #69766]  INFO -- : (0.000942s) DROP TABLE "node_audit_detail"
I, [2012-07-13T13:20:47.140384 #69766]  INFO -- : (0.000877s) DROP TABLE "node_audit"
I, [2012-07-13T13:20:47.145264 #69766]  INFO -- : (0.004454s) CREATE TABLE "node_run" ("run_id" char(32) PRIMARY KEY, "node_id" char(32), "status" varchar(16), "start_time" timestamp NOT NULL, "end_time" timestamp, "event_data" text, "run_list" text DEFAULT '' NOT NULL, "updated_res_count" integer DEFAULT 0 NOT NULL, "total_res_count" integer DEFAULT 0 NOT NULL, CONSTRAINT "node_id_fk" FOREIGN KEY ("node_id") REFERENCES "nodes"("id") ON DELETE CASCADE ON UPDATE RESTRICT)
I, [2012-07-13T13:20:47.146226 #69766]  INFO -- : (0.000794s) CREATE INDEX "node_run_node_id_index" ON "node_run" ("node_id")
I, [2012-07-13T13:20:47.150308 #69766]  INFO -- : (0.003593s) CREATE TABLE "node_run_detail" ("run_id" char(32), "seq" integer NOT NULL, "duration" integer NOT NULL, "res_id" varchar(255) NOT NULL, "res_type" varchar(255) NOT NULL, "res_name" varchar(255) NOT NULL, "res_result" varchar(16), "res_initial_state" text, "res_final_state" text, "delta" text, "cookbook_name" text DEFAULT '' NOT NULL, "cookbook_ver" varchar(32) DEFAULT '' NOT NULL, PRIMARY KEY ("run_id", "seq"), CONSTRAINT "node_run_run_id_fk" FOREIGN KEY ("run_id") REFERENCES "node_run" ON DELETE CASCADE ON UPDATE RESTRICT)
I, [2012-07-13T13:20:47.150666 #69766]  INFO -- : (0.000203s) UPDATE "schema_info" SET "version" = 16
I, [2012-07-13T13:20:47.151941 #69766]  INFO -- : (0.001217s) COMMIT
I, [2012-07-13T13:20:47.152012 #69766]  INFO -- : Finished applying migration version 16, direction: up, took 0.014339 seconds
I, [2012-07-13T13:20:47.152047 #69766]  INFO -- : Begin applying migration version 17, direction: up
I, [2012-07-13T13:20:47.152314 #69766]  INFO -- : (0.000211s) BEGIN
I, [2012-07-13T13:20:47.154028 #69766]  INFO -- : (0.001646s) CREATE OR REPLACE VIEW cookbook_versions_by_rank(
    -- Cookbook Version fields
    major, -- these 3 are needed for version information (duh)
    minor,
    patch,
    serialized_object, -- needed to access recipe manifest

    -- Cookbook fields
    org_id, -- used for filtering
    name, -- both version and recipe queries require the cookbook name

    -- View-specific fields
    -- (also used for filtering)
    rank) AS
SELECT v.major,
       v.minor,
       v.patch,
       v.serialized_object,
       c.org_id,
       c.name,
       rank() OVER (PARTITION BY v.cookbook_id
                    ORDER BY v.major DESC, v.minor DESC, v.patch DESC)
FROM cookbooks AS c
JOIN cookbook_versions AS v
  ON c.id = v.cookbook_id;

I, [2012-07-13T13:20:47.154388 #69766]  INFO -- : (0.000232s) UPDATE "schema_info" SET "version" = 17
I, [2012-07-13T13:20:47.155217 #69766]  INFO -- : (0.000772s) COMMIT
I, [2012-07-13T13:20:47.155279 #69766]  INFO -- : Finished applying migration version 17, direction: up, took 0.003228 seconds
I, [2012-07-13T13:20:47.155312 #69766]  INFO -- : Begin applying migration version 18, direction: up
I, [2012-07-13T13:20:47.155482 #69766]  INFO -- : (0.000122s) BEGIN
I, [2012-07-13T13:20:47.156436 #69766]  INFO -- : (0.000899s) CREATE OR REPLACE VIEW cookbook_version_dependencies(
    org_id, -- for filtering
    name, -- cookbook name
    major,
    minor,
    patch,
    dependencies) -- version dependency JSON blob; needed for depsolver
AS
SELECT c.org_id,
       c.name,
       v.major,
       v.minor,
       v.patch,
       v.meta_deps
FROM cookbooks AS c
JOIN cookbook_versions AS v
  ON c.id = v.cookbook_id;

I, [2012-07-13T13:20:47.156695 #69766]  INFO -- : (0.000145s) UPDATE "schema_info" SET "version" = 18
I, [2012-07-13T13:20:47.157529 #69766]  INFO -- : (0.000781s) COMMIT
I, [2012-07-13T13:20:47.157590 #69766]  INFO -- : Finished applying migration version 18, direction: up, took 0.002273 seconds
I, [2012-07-13T13:20:47.157623 #69766]  INFO -- : Begin applying migration version 19, direction: up
I, [2012-07-13T13:20:47.157853 #69766]  INFO -- : (0.000178s) BEGIN
I, [2012-07-13T13:20:47.158341 #69766]  INFO -- : (0.000426s) DROP VIEW cookbook_versions_by_rank;
I, [2012-07-13T13:20:47.159960 #69766]  INFO -- : (0.001565s) CREATE OR REPLACE VIEW cookbook_versions_by_rank(
    -- Cookbook Version fields
    major, -- these 3 are needed for version information (duh)
    minor,
    patch,
    version, -- concatenated string of the complete version
    serialized_object, -- needed to access recipe manifest

    -- Cookbook fields
    org_id, -- used for filtering
    name, -- both version and recipe queries require the cookbook name

    -- View-specific fields
    -- (also used for filtering)
    rank) AS
SELECT v.major,
       v.minor,
       v.patch,
       v.major || '.' || v.minor || '.' || v.patch,
       v.serialized_object,
       c.org_id,
       c.name,
       rank() OVER (PARTITION BY v.cookbook_id
                    ORDER BY v.major DESC, v.minor DESC, v.patch DESC)
FROM cookbooks AS c
JOIN cookbook_versions AS v
  ON c.id = v.cookbook_id;

I, [2012-07-13T13:20:47.160312 #69766]  INFO -- : (0.000229s) UPDATE "schema_info" SET "version" = 19
I, [2012-07-13T13:20:47.161127 #69766]  INFO -- : (0.000750s) COMMIT
I, [2012-07-13T13:20:47.161184 #69766]  INFO -- : Finished applying migration version 19, direction: up, took 0.003558 seconds
I, [2012-07-13T13:20:47.161216 #69766]  INFO -- : Begin applying migration version 20, direction: up
I, [2012-07-13T13:20:47.161429 #69766]  INFO -- : (0.000161s) BEGIN
I, [2012-07-13T13:20:47.162593 #69766]  INFO -- : (0.001090s) CREATE OR REPLACE VIEW joined_cookbook_version(
    -- Cookbook Version fields
    major, -- these 3 are needed for version information (duh)
    minor,
    patch,
    version, -- concatenated string of the complete version
    serialized_object, -- needed to access recipe manifest
    id, -- used for retrieving environment-filtered recipes

    -- Cookbook fields
    org_id, -- used for filtering
    name) -- both version and recipe queries require the cookbook name
AS
SELECT v.major,
       v.minor,
       v.patch,
       v.major || '.' || v.minor || '.' || v.patch,
       v.serialized_object,
       v.id,
       c.org_id,
       c.name
FROM cookbooks AS c
JOIN cookbook_versions AS v
  ON c.id = v.cookbook_id;

I, [2012-07-13T13:20:47.162872 #69766]  INFO -- : (0.000169s) UPDATE "schema_info" SET "version" = 20
I, [2012-07-13T13:20:47.163975 #69766]  INFO -- : (0.001048s) COMMIT
I, [2012-07-13T13:20:47.164037 #69766]  INFO -- : Finished applying migration version 20, direction: up, took 0.002817 seconds
