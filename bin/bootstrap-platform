#! /usr/bin/env ruby

# Usage:
# ./bootstrap-platform CONFIG_FILE BOOTSTRAP_SCRIPT

require 'rubygems'
require 'bundler/setup'
$:.unshift(File.expand_path('../../lib', __FILE__))

require 'opscode/server-bootstrap'
require 'opscode/server-bootstrap/bootstrapper'

class BootstrapPlatform
  def initialize(config_file, bootstrap_script)
    @config_file, @bootstrap_script = config_file, bootstrap_script
  end

  def run
    configure
    bootstrap
  end

  def configure
    Opscode::ServerBootstrap.configure do |c|
      c.instance_eval(File.read(config[:config_file]))
    end
  end

  def bootstrap
    Opscode::Bootstrap::Bootstrapper.new.bootstrap(config[:bootstrap_script])
  end
end

if __FILE__ == $0
  if ARGV.length != 2
    puts "You must pass two arguments. Usage:"
    puts "./bootstrap-platform CONFIG_FILE BOOTSTRAP_SCRIPT"
    exit 1
  end
  BootstrapPlatform.new(ARGV[0], ARGV[1]).run
end
