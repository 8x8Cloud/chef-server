%% -*- erlang-indent-level: 4;indent-tabs-mode: nil -*-

{ping, <<"SELECT 'pong' as ping LIMIT 1">>}.

{find_by_username_for_authn,
 <<"SELECT `id`, `authz_id`, `username`, `pubkey_version`, `public_key` FROM `users` WHERE "
   "(`username` = ?) LIMIT 1">>}.

{find_node_by_orgid_name,
 <<"SELECT `id`, `authz_id`, `org_id`, `name`, `environment`, `last_updated_by`,"
   " `created_at`, `updated_at`, `serialized_object` FROM `nodes` WHERE (`org_id` = ?"
   " AND `name` = ?) LIMIT 1">>}.

{insert_node,
 <<"INSERT INTO `nodes` (`id`, `authz_id`, `org_id`, `name`, `environment`,"
   " `last_updated_by`, `created_at`, `updated_at`, `serialized_object` ) VALUES"
   " (?, ?, ?, ?, ?, ?, ?, ?, ?)">>}.

{update_node_by_id,
 <<"UPDATE `nodes` SET `environment`= ?, `last_updated_by`= ?, `updated_at`= ?, "
   "`serialized_object`= ? WHERE `id`= ?">>}.

{delete_node_by_id, <<"DELETE FROM `nodes` WHERE `id`= ?">>}.

{delete_node_by_name, <<"DELETE FROM `nodes` WHERE `id`= ?">>}.

{list_nodes_for_org, <<"SELECT `name` FROM `nodes` WHERE `org_id`= ?">>}.
{list_env_nodes_for_org,
 <<"SELECT `name` FROM `nodes` WHERE `org_id`= ? AND `environment` = ?">>}.

%% bulk_get_nodes_X queries used for fetching nodes returned from
%% search only returns the gzip JSON data.  If a node has been
%% deleted, you may get back fewer than X nodes and you won't know
%% which ids were not found without parsing and inspecting what did
%% come back.
{bulk_get_nodes_1, <<"SELECT `serialized_object` FROM `nodes` WHERE `id` IN (?)">>}.
{bulk_get_nodes_2, <<"SELECT `serialized_object` FROM `nodes` WHERE `id` IN (?,?)">>}.
{bulk_get_nodes_3, <<"SELECT `serialized_object` FROM `nodes` WHERE `id` IN (?,?,?)">>}.
{bulk_get_nodes_4, <<"SELECT `serialized_object` FROM `nodes` WHERE `id` IN (?,?,?,?)">>}.
{bulk_get_nodes_5, <<"SELECT `serialized_object` FROM `nodes` WHERE `id` IN (?,?,?,?,?)">>}.
